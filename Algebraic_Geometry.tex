\documentclass{article}
%build with recipe latexmk
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{fancyhdr}
\pagestyle{fancy}

\usepackage{tcolorbox}
\tcbuselibrary{theorems}
\usepackage{babel}
\usepackage{enumerate}
\usepackage{stmaryrd}
\usepackage{amsmath, amssymb, amsthm}
%\usepackage{a4wide}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{setspace}
\setstretch{1.1}
\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black,  %choose some color if you want links to stand out
}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{example}{Example}[section]
\newtheorem{defn}{Definition}[section]

\title{Part III - Algebraic Geometry
    \\ \large
    Lectured by Dhruv Ranganathan 
}
 
\author{Artur Avameri}
\date{}
 
\setcounter{section}{-1}
 
\begin{document}
\maketitle
\tableofcontents
\newpage
 
\section{Introduction}

\marginpar{6 Oct 2022, Lecture 1}


The course consists of four parts.
\begin{enumerate}[(1)]
    \item Basics of sheaves on topological spaces.
    \item Definition of schemes and morphisms.
    \item Properties of schemes (e.g. the algebraic geometry notion of compactness and other properties).
    \item A rapid introduction to the cohomology of schemes.
\end{enumerate}

The main reference for the course is Hartshorne's \textit{Algebraic Geometry}.

\section{Beyond algebraic varieties}
\marginpar{08 Oct 2022, Lecture 2}

\subsection{Summary of classical algebraic geometry}
We let $k = \overline{k}$ be a algebraically closed field and consider $\mathbb{A}_k^n = \mathbb{A}^n = k^n$ as a set.

\begin{defn}
    An \textbf{affine variety} is a subset $V \subset \mathbb{A}^n$ of the form $\mathbb{V}(S)$ with $S \subset k[x_1,\ldots,x_n]$, where $\mathbb{V}$ is the common vanishing locus.
\end{defn}
Note that $\mathbb{V}(S) = \mathbb{V}(I(S))$ (the ideal generated by $S$). By Hilbert Basis Theorem (since $k[x_1,\ldots,x_n]$ is noetherian), $\mathbb{V}(I(S)) = \mathbb{V}(S')$ for some finite set $S \subset k[x_1,\ldots,x_n]$.
\vspace{1mm}
 
In fact, $\mathbb{V}(I) = \mathbb{V}(\sqrt{I})$, where \[
\sqrt{I} = \{ f \in k[x_1,\ldots,x_n] \mid f^m \in I \text{ for some } m\ge 0\}
\] 
is the \textbf{radical} of $I$.
For example, in $k[x]$, if $I = (x^2)$, then $\sqrt{I} = (x)$.

\begin{defn}
    Given varieties $V \subset \mathbb{A}^n$ and $W \subset  \mathbb{A}^m$, a \textbf{morphism} is a (set-theoretic) map $\phi : V \to W \subset \mathbb{A}_k^m$ such that if $\phi = (f_1,\ldots,f_m)$, then each $f_i$ is the restriction of a polynomial in $\{x_1,\ldots,x_n\}$.
    \vspace{1mm}
     
    An \textbf{isomorphism} is a morphism with a two--sided inverse.  
\end{defn}

Our basic correspondence is 
\begin{align*}
    \{\text{Affine varieties over }k\}&/\text{up to isomorphism}\\  &\leftrightarrow \\ \{\text{finitely generated }k\text{--algebras }A &\text{ without nilpotent elements}\}
\end{align*}
A finitely generated $k$--algebra is just a quotient of a polynomial ring in finitely many variables. A nilpotent element is such that some power of it is zero. For example, in $k[x]/(x^2)$, the element $x$ is nilpotent.
\vspace{1mm}
 
How does this correspondence work? Given a variety $V$ (representing an isomorphism class), we write $V = \mathbb{V}(I)$ for $I \subset k[x_1,\ldots,x_n]$ a radical ideal\footnote{A radical ideal is an ideal equal to its radical.}, and map $V \mapsto k[x_1,\ldots,x_n]/I$.
\vspace{1mm}
 
For the reverse, if $A$ is a finitely generated nilpotent free algebra, then $A \cong k[y_1,\ldots,y_m]/J$ where we can choose $J$ to be radical (exercise: why?).
\vspace{1mm}
 
We have to check that this is independent of our choice on both sides (exercise: think through this, it should be clear).

\begin{defn}
    The algebra associated to $V$ is classically denoted $k[V]$ and called the \textbf{coordinate ring of} $V$.
\end{defn}

We have the compatibility of morphisms with our basic correspondence: there is a bijection between \[
\text{Morphisms}(V, W) \leftrightarrow \text{Ring homomorphisms}_k(k[W], k[V])
\]
(here $\text{RingHom}_k$ means that our homomorphisms preserve $k$).

We can now make our set into a topological space:
\begin{defn}
    Let $V = \mathbb{V}(I) \subset \mathbb{A}^n$ be a variety with coordinate ring $k[V]$. The \textbf{Zariski topology} on $V$ is defined such that the closed sets are $\mathbb{V}(S)$, where $S \subset k[V]$.
\end{defn}
If $V \cong W$, then the Zariski topological spaces are homeomorphic as varieties (exercise).

\begin{theorem}[Nullstellensatz]
    Fix $V$ a variety and let $k[V]$ be its coordinate ring. Given $p \in V$, we can produce a homomorphism $\text{ev}_p : k[V] \to k$ by sending $f \mapsto f(p)$. Note that $\text{ev}_p$ is surjective (since we have constant functions), hence $\text{ker}(\text{ev}_p) = m_p$ is a maximal ideal, giving us a map \[
        \{\text{points of }V\} \rightarrow \{\text{maximal ideals in }k[V]\}.
    \]
    Nullstellensatz says that this is actually a bijection. For the converse map, given $m \subset k[V]$, we get a quotient $k[V] \to k[V]/m = k$ (Nullstellensatz says this extension is finite, hence must be $k$). So using/choosing a representation for $V$ in $k[x_1,\ldots,x_n]$ gives a surjective homomorphism onto $k$ and specifies a bunch of points.
\end{theorem}
\subsection{Limitations of classical algebraic geometry}
\textbf{Question.} What is an abstract variety, i.e. ''some ''space'' $X$ such that  locally as a cover $\{U_i\}$, each $U_i$ is an affine variety, compatible with overlaps''. 

\begin{example}[non--algebraically closed fields]
    Take $I = (x^2+y^2+1) \subset \mathbb{R}[x,y]$. Then $\mathbb{V}(I) = \varnothing \subset \mathbb{R}^2$, but $I$ is prime, so radical, so nullstellensatz fails.
\end{example}

\textbf{Question.} On what topological space is $\mathbb{R}[x,y]/(x^2+y^2+1)$ ''naturally'' the set of functions? (or $\mathbb{Z}$, or $\mathbb{Z}[x]$).

\begin{example}[Why restrict to radical ideals?]
    Take $C = \mathbb{V}(y-x^2) \subset \mathbb{A}_k^2$ and $D = \mathbb{V}(x,y)$, so $C \cap D = \mathbb{V}(y, y-x^2) = \mathbb{V}(x,y) = \{(0,0)\}$. This is a single point, but if $D_\delta = \mathbb{V}(y+\delta)$ for some $\delta \in k$, then $C \cap D_\delta = \{\pm \sqrt{\delta}\}$, which is 2 points for all $\delta \neq 0$. In other words, intersections of varieties don't want to be varieties.
\end{example}

\subsection{The spectrum of a ring}

\marginpar{11 Oct 2022, Lecture 3}

Let $A$ be a commutative ring with identity. We will define a topological space on which $A$ is the ring of functions.

\begin{defn}
    The \textbf{Zariski spectrum} of $A$ is $$\text{Spec }A = \{\mathfrak{p} \subset A \mid \mathfrak{p} \text{ is a prime ideal}\}.$$
\end{defn}
A ring homomorphism $\phi : A \to B$ induces a map $\phi^{-1} : \text{Spec }B \to \text{Spec }A$ by $q \mapsto \phi^{-1}(q)$. In general, the preimage of a prime ideal is a prime ideal.
\vspace{1mm}
 
\textbf{Warning.} This would fail if we only considered maximal ideals, since the preimage of a maximal ideal need not be maximal. 
\vspace{1mm}
 
Given $f \in A$ and $\mathfrak{p} \in \text{Spec}(A)$, we have an induced $\overline{f} \in A/\mathfrak{p}$ obtained via a quotient. Informally, we can evaluate any $f \in A$ at points $\mathfrak{p} \in \text{Spec}(A)$ with the caveat that the codomain of this evaluation depends on $\mathfrak{p}$.

\begin{example}
    Take $A = \mathbb{Z}$. Then $\text{Spec }A  = \text{Spec }(\mathbb{Z}) = \{p \mid p \text{ is prime}\} \cup \{(0)\}$. Let's pick an element in $\mathbb{Z}$, say $132 \in \mathbb{Z}$. Given a prime $p$, we can look at ${132\pmod{p}} \in \mathbb{Z}/p$. The takeaway here is that 
    \begin{align*}
        \text{Spec }\mathbb{Z} &\rightarrow \text{Space}\\
        132 \in \mathbb{Z} &\rightarrow \text{a function}\\
        132 \text{ (mod }p) &\rightarrow \text{value of that function at }p.
    \end{align*}
    Note that based on the value of $p$, our codomain changes from point to point.
\end{example}
\begin{example}
    Take $A = \mathbb{R}[x]$, then $\text{Spec }\mathbb{R}[x] = \mathbb{C}/ \text{complex conjugation} \cup \{(0)\}$. 
\end{example}
\textbf{Exercise.} Draw $\text{Spec }\mathbb{Z}[x]$ and $\text{Spec }k[x]$ for $k$ any field (i.e. describe all prime ideals and their containment). This is on example sheet 1.
\begin{example}
    If $A = \mathbb{C}[x]$, then $\text{Spec }A = \mathbb{C} \cup\{(0)\}$, where given $a \in \mathbb{C}$, we send it to the maximal ideal $\langle z-a\rangle$.
\end{example}
\subsection{A topology on Spec $A$}
Fix $f \in A$. Then $\mathbb{V}(f) = \{\mathfrak{p} \in \text{Spec }A \mid f \equiv 0 \pmod{\mathfrak{p}}\} \subset \text{Spec }A$. (Note that $f \equiv 0 \pmod{\mathfrak{p}}$ is the same as $f  \in \mathfrak{p}$). \vspace{1mm}
 
Similarly for $J \subset A$ an ideal, $\mathbb{V}(J) = \{\mathfrak{p} \in \text{Spec }A \mid f \in \mathfrak{p} ~\forall f \in J\}$.

\begin{prop}
    The sets $\mathbb{V}(J) \subset \text{Spec }A$ ranging over all ideals $J$ form the closed sets of a topology on $\text{Spec }A$. This topology is called the \textbf{Zariski topology}.
\end{prop}
\begin{proof}
    Easy fact: $\varnothing$ and $\text{Spec }A$ are closed, since we have functions $1$ (vanishing nowhere) and $0$ (vanishing everywhere). Since $\mathbb{V}(\sum_{\alpha}^{} I_\alpha) = \bigcap_\alpha \mathbb{V}(I_\alpha)$ (this is because $I_1 + I_2$ is the smallest ideal containing $I_1 \cup I_2$), arbitrary intersections are closed.
    \vspace{1mm}
     
    Finally, we claim $\mathbb{V}(I_1) \cup \mathbb{V}(I_2) = \mathbb{V}(I_1 \cap I_2)$. The containment $\subset $ is clear: if a prime ideal contains $I_1$ or $I_2$, it contains $I_1 \cap I_2$. Conversely, $I_1I_2 \subset I_1 \cap I_2$, so if $I_1 I_2 \subset I_1 \cap I_2 \subset \mathfrak{p}$, then by primality $I_1 \subset \mathfrak{p}$ or $I_2 \subset \mathfrak{p}$. 
\end{proof}

\begin{example}
    Let $k = \mathbb{C}$ and consider $\text{Spec }\mathbb{C}[x,y]$. We make a few observations:
    \begin{itemize}
        \item The point $(0) \in \text{Spec }\mathbb{C}[x,y]$ is dense in the Zariski topology, i.e. $\overline{\{(0)\}} = \text{Spec }\mathbb{C}[x,y]$ because every prime ideal contains $(0)$ (because we are in an integral domain).
        \item Consider the prime ideal $(y^2-x^3)$ (which is prime since the quotient is an integral domain). Consider a maximal ideal $\mathfrak{m}_{a,b} = (x-a, y-b)$. We can ask: when is $\mathfrak{m}_{a,b} \in \overline{\{(y^2-x^3)\}}$? The answer: if and only if $b^2 = a^3$, e.g. $(1,1)$ (see example sheet 1). The lesson here is that points are not closed in the Zariski topology.
    \end{itemize}
\end{example}
\subsection{Functions on opens}
\begin{defn}
    Let $f \in A$. Define the \textbf{distinguished open} corresponding to $f$ to be \[
    \mathcal{U}_{f} = (\text{Spec}(A))/\mathbb{V}(f).
    \]
\end{defn}
\begin{example}
    \begin{itemize}
        \item Let $A = \mathbb{C}[x]$, so $\text{Spec }A = \mathbb{C} \cup \{(0)\}$ (with the Zariski topology). Take $f = x$ and consider $\mathcal{U}_x$. Recall the bijection $\text{Spec }\mathbb{C} \leftrightarrow \mathbb{C} \cup \{(0)\}$ by $(x-a) \mapsfrom a \in \mathbb{C}$ and $(0) \mapsfrom (0)$. Then $\mathbb{V}(x) = \{\mathfrak{p} \in \text{Spec }A \mid x \in \mathfrak{p}\} = \{(x)\}$, so $\mathcal{U}_f = \text{Spec }A \setminus \{(x)\}$.
        \item More generally, suppose we fix $a_1,\ldots,a_r \in \mathbb{C}$, then $\text{Spec }A\setminus \{(x-a_i)\}_{i=1}^r = \mathcal{U}$ and $\mathcal{U} = \mathcal{U}_f$, where $f = \prod_{i=1}^{r} (x-a_i)$.
    \end{itemize}
\end{example}
\begin{lemma}
    The distinguished opens $\mathcal{U}_f$ taken over all $f \in A$ form a basis for the Zariski topology on $\text{Spec }A$.
\end{lemma}
\begin{proof}
    Left as an exercise on example sheet 1.
\end{proof}

A bit of commutative algebra: 
\begin{defn}
    Given $f \in A$, the \textbf{localization of $A$ at $f$} is $A_f = A[x]/(xf-1)$, which we can informally think of as $A_f = A[\frac{1}{f}]$.
\end{defn}
\begin{lemma}
    The distinguished open $\mathcal{U}_f \subset \text{Spec }A$ is naturally homeomorphic to $\text{Spec }A_f$ via the ring homomorphism $A \stackrel{j}{\to} A_f$, which produces the inverse $j^{-1}: \text{Spec }A_f \to \text{Spec }A$.
\end{lemma}
\marginpar{13 Oct 2022, Lecture 4}
\begin{proof}
    Primes in the ring $A_f$ are in bijection with primes of $A$ that miss $f$ via $j^{-1}$. We exhibit this bijection: 
    \begin{itemize}
        \item Given $q \subset A_f$ prime, take $j^{-1}(q) \subset A$, which is prime. 
        \item Given $p \subset A$ a prime ideal, take $p_f = j(p) A_f$. We claim $p_f$ is a prime exactly when $f \not\in p$.
        \begin{itemize}
            \item If $f \in p$, then $p_f$ contains $f$, which is a unit, so $p_f = (1)$ is not prime.
            \item If $f \not\in p$, then $\left( A_f/p_f \right) \cong \left( A/p\right)_{\overline{f}}$, where $\overline{f}$ is $f + p$, a coset (exercise: check this formally). Hence $\left(A/p \right)_{\overline{f}} \subset FF \left(A/p \right)$ (FF stands for fraction field), so it is an integral domain, so $p_f$ is prime.
        \end{itemize}
    \end{itemize}
    Finally we need to check that these maps are inverses. This is left as an exercise.
\end{proof}

Facts about distinguished opens:
\begin{itemize}
    \item $U_f \cap U_g = U_{fg}$ (easy fact).
    \item $U_{f^n} = U_f$ for all $n \ge 1$ (easy fact).
    \item The rings $A_f$ and $A_{f^n}$ for $n\ge 1$ are isomorphic. Why? Since $A_f = A[x]/(xf-1)$ and $A_{f^n} = A[y]/(yf^n-1)$, the isomorphism is given by $A_f \to A_{f^n}$ by $x \mapsto f^{n-1}y$ and $A_{f^n} \to A_f$ by $y \mapsto x^n$ (check these are inverses).
    \item Containment. $U_{f} \subset U_{g} \iff f^n$ is a multiple of $g$ for some $n\ge 1$. To orient ourselves: if $f = g f'$, then $U_f \subset U_g$.
    \begin{proof}
        The $(\implies )$ direction is clear by the orientation above. Conversely, suppose $U_f \subset U_g$, so $\mathbb{V}(f) \supset \mathbb{V}(g)$. The set $\mathbb{V}(f)$ is the set of all primes containing $(f)$. We claim that $\sqrt{(f)} \subset \sqrt{(g)}$. But what is the radical of $I$? It is the intersection of all primes containing the ideal $I$.
    \end{proof}
\end{itemize}

Foreshadowing: fix $A$. We've made an assignment from distinguished opens in $\text{Spec }A$ to rings by mapping $U_f \mapsto A_f$. The association is ''functorial'', i.e. if $U_{f_1} \subset U_{f_2}$, then we can assume that $f_1^n = f_2 f_3$, so $U_{f_1} = U_{f_1^n} = U_{f_2f_3} \subset U_{f_2}$, so there is a homomorphism $A_{f_2} \to A_{f_1}$. This is the restriction map.

\vspace{1mm}
 
Question: can we extend this association to all open sets? See notes for the answer (yes).

\section{Sheaves}
\subsection{Presheaves}
Let $X$ be a topological space. 
\begin{defn}
    A \textbf{presheaf $\mathcal{F}$ on $X$ of abelian groups} is an association from the set of open sets in $X$ to abelian groups given by $U \mapsto \mathcal{F}(U)$ and for $U \subset V$ opens, a homomorphism $\text{res}_u^v : \mathcal{F}(V) \to \mathcal{F}(U)$ (a \textbf{restriction map}) such that $\text{res}_u^u = \text{id}$ and $\text{res}^v_u \circ \text{res}^w_v = \text{res}^w_u$ when $U \subset V \subset W$ are opens.
\end{defn}
\begin{example}
    For any space $X$, take $\mathcal{F}(U) = \{f : U \to \mathbb{R} \mid f \text{ continuous}\}$ with the usual restriction.
\end{example}
Similarly we can get sheaves of rings, sets, modules over a fixed ring, etc.

\begin{defn}
    A \textbf{morphism} $\phi : \mathcal{F} \to \mathcal{G}$ of presheaves on $X$ is, for each $U \subset X$ open, a homomorphism $\phi(u) : \mathcal{F}(u) \to \mathcal{G}(u)$ compatible with restriction maps, i.e. if $V \subset U$, then the following diagram commutes. 
    \[\begin{tikzcd}[row sep=large,column sep=large]
        \mathcal{F}(u) & \mathcal{G}(u) \\
        \mathcal{F}(v) & \mathcal{G}(v)
        \arrow["\phi(u)", from=1-1, to=1-2]
        \arrow["\text{res}^u_v",from=1-1, to=2-1]
        \arrow["\text{res}^u_v", from=1-2, to=2-2]
        \arrow["\phi(v)"', from=2-1, to=2-2]
    \end{tikzcd}\]
\end{defn}
\begin{defn}
    A morphism $\phi : \mathcal{F} \to \mathcal{G}$ of preshaves is injective (surjective) if $\phi(U) : \mathcal{F}(U) \to \mathcal{G}(U)$ is injective (surjective) for all $U \subset X$.
\end{defn}

\subsection{Sheaves}

\marginpar{16 Oct 2022, Lecture 5}

\begin{defn}
    A \textbf{sheaf} is a presheaf $\mathcal{F}$ such that 
    \begin{enumerate}[(1)]
        \item If $U \subset X$ is open and $\{U_i\}$ is an open cover of $U$, then for $s \in \mathcal{F}(U)$, if $s|_{U_i} = \text{res}^U_{U_i}(s) = 0$ for all $i$, then $s = 0$.
        \item If $U$ and $\{U_i\}$ are as in (1), then given $s_i \in \mathcal{F}(U_i)$ with $s_i |_{U_i \cap U_j} = s_j |_{U_i \cap U_j}$ for all $i,j$, then there exists $s \in \mathcal{F}(U)$ with $s |_{U_i} = s_i$.
    \end{enumerate}
\end{defn}
\textbf{Remark.} These axioms imply $\mathcal{F}(\varnothing) = 0$ (exercise).
\vspace{1mm}
 
A \textbf{morphism} of sheaves is a morphism of the underlying presheaves.

\begin{example}
    If $X$ is a topological space, $\mathcal{F}(U) = \{f : U \to \mathbb{R} \mid f \text{ continuous}\}$, then $f$ is a sheaf.
\end{example}
\textbf{Non--example.} Let $X = \mathbb{C}$ with the Euclidean topology and take $\mathcal{F}(U) = \{f: U \to \mathbb{C} \mid f \text{ holomorphic and bounded}\}$. Then $\mathcal{F}$ is not a sheaf, since bounded functions may glue to unbounded functions. For example, take $U = \mathbb{C}$ and $U_i = D(0,i)$. Then $f(z) = z$ is bounded on each $U_i$, but not on $U$. In general, the characterization of elements of a sheaf should be purely local, and being bounded is not a local condition.
\vspace{1mm}
 
\textbf{Non--example.} Fix a group $G$ and a set $\mathcal{F}(U)=G$ (the \textbf{constant presheaf}). If $U_1, U_2$ are disjoint, then $\mathcal{F}(U_1 \cup U_2) = G \times G$.

\begin{example}
    Give $G$ the discrete topology (every subset is open and closed) and define $$\mathcal{F}(U) = \{f : U \to G \text{ continuous}\} = \{f : U \to G \mid f \text{ is locally constant}\}.$$
    This is the \textbf{constant sheaf}.
\end{example}
\begin{example}
    If $V$ is an irreducible variety, then 
    \begin{align*}
        \mathcal{O}_V(v) = \{f \in k[V] \mid f \text{ is regular at }p ~\forall p \in U\}.
    \end{align*}
    Here regular at $p$ means that $f = \frac{g}{h}$ in a neighborhood of $p$ with $g,h$ polynomials and $h(p) \neq 0$. $\mathcal{O}_V$ is the \textbf{structure sheaf} of $V$.
    \vspace{1mm}
     
    This is a sheaf, since we have a local condition.
\end{example}

\subsection{Basic constructions}

\textbf{Terminology.} A \textbf{section} of $\mathcal{F}$ over $U$ is an element $s \in \mathcal{F}(U)$.

\vspace{1mm}
 
\textbf{Construction of stalks.} Fix $p \in X$ and $\mathcal{F}$ a presheaf on $X$. Then $\mathcal{F}_p$, the \textbf{stalk} of $\mathcal{F}$ at $p$, is defined to be $$\mathcal{F}_p = \{(U,s) \mid s \in \mathcal{F}(U), p \in U\}/\sim$$
with $(U,s) \sim (V, s')$ if $\exists W \subset U \cap V$ with $p \in W$ such that $s|_W = s'|_W$. 
\vspace{1mm}
 
The elements of $\mathcal{F}_p$ are called \textbf{germs}.

\begin{example}
    Take $\mathbb{A}^1$, the affine line, then $\mathcal{O}_{\mathbb{A}^1,0} = \left\{\frac{f(t)}{g(t)} \mid g(0)\neq 0\right\} = k[t]_{(t)} \subset k(t) $.
\end{example}
\begin{prop}
    If $f : \mathcal{F} \to \mathcal{G}$ is a morphism of sheaves on $X$ such that for all $p \in X$, the induced map $f_p :\mathcal{F}_p \to \mathcal{G}_p$ is an isomorphism, then $f$ is an isomorphism.
    \vspace{1mm}
     
    Here $f_p((U,s)) = (U, f_U(s))$, which is well--defined.
\end{prop}
\begin{proof}
    We will show $f_U : \mathcal{F}(U) \to \mathcal{G}(U)$ is an isomorphism for each $U$, and we can then define $f^{-1}$ by $(f^{-1})_U = (f_U)^{-1}$.
    \vspace{1mm}
     
    $f_U$ is injective: suppose $s \in \mathcal{F}(U)$ with $f_U(s) = 0$. Since $f_p$ is injective, $(U,s) = 0$ in $\mathcal{F}_p$ for every $p \in U$. Thus for every $p \in U$, there exists an open neighborhood $U_p$ of $p$ such that $s|_{U_p} = 0$. But $\{U_p \mid p \in U\}$ is a cover of $U$, so $s = 0$ in $\mathcal{F}(U)$ by the first condition of being a sheaf.
    \vspace{1mm}
     
    $f_U$ is surjective: take $t \in \mathcal{G}(U)$. For each $p \in U$, we have $(U_p, s_p) \in \mathcal{F}_p$ with $f_p(U_p, s_p) = (U,t) \in \mathcal{G}_p$. By shrinking $U_p$ if necessary, we can assume $f_{U_p}(s_p) = t|_{U_p}$. For points $p, p' \in U$, $$f(_{U_p \cap U_{p'}}) \left(s_p|_{U_p \cap U_{p'}} \setminus s_{p'}|_{U_p \cap U_{p'}}\right) = t|_{U_p \cap U_{p'}} - t |_{U_p \cap U_{p'}} = 0.$$
    Thus $s_p |_{U_p \cap U_{p'}} - s_{p'}|_{U_p \cap U_{p'}} = 0$ by the injectivity of $f_{U_p \cap U_{p'}}$. Thus by the second sheaf axiom, $\exists s \in \mathcal{F}(U)$ with $s|_{U_p} = s_p$. Now $f_U(s)|_{U_p} = f_{U_p}(s|_{U_p}) = f_{U_p}(s_p) = t|_{U_p}$. Thus $f_U(s) = t$ by the first sheaf axiom.
\end{proof}
We emphasize that this proof is asymmetric in the sense that we need to first prove injectivity to be able to prove surjectivity.

\marginpar{18 Oct 2022, Lecture 6}
\vspace{1mm}
 
\textbf{Exercises.}
\begin{enumerate}[(i)]
    \item There is a map $\mathcal{F}(U) \to \prod_{p \in U}^{} \mathcal{F}_p$ mapping $s \mapsto ((U,s))_{p \in U}$. The claim is that this map is injective (by sheaf axiom 1).
    \item Given two maps $\phi, \psi : \mathcal{F} \to \mathcal{G}$ with $\phi_p = \psi_p ~\forall p \in X$, we have $\phi = \psi$.
\end{enumerate} 

\begin{defn}[Sheafification]
    If $\mathcal{F}$ is a presheaf on $X$, then a morphism $\text{sh}: \mathcal{F} \to \mathcal{F}^{\text{sh}}$ to the sheaf $\mathcal{F}^{\text{sh}}$ is a \textbf{sheafification} if for any morphism of presheaves $\phi : \mathcal{F} \to \mathcal{G}$ for $\mathcal{G}$ a sheaf there is a unique commutative diagram of the following form:
    \[\begin{tikzcd}[row sep=large,column sep=large]
        \mathcal{F} & \mathcal{F}^{\text{sh}} \\
         & \mathcal{G}
        \arrow["\text{sh}", from=1-1, to=1-2]
        \arrow["\exists !", from=1-2, to=2-2]
        \arrow["\phi", from=1-1, to=2-2]
    \end{tikzcd}\]
\end{defn}
\textbf{Remark.} Since this is a definition by universal property, $\mathcal{F}^{\text{sh}}$ and the map $\mathcal{F} \to \mathcal{F}^{\text{sh}}$ are unique (up to unique isomorphism).
\vspace{1mm}
 
A morphism of presheaves $\mathcal{F} \to \mathcal{G}$ induces a morphism of sheaves $\mathcal{F}^{\text{sh}} \to \mathcal{G}^{\text{sh}}$.

\begin{prop}
    Sheafification exists.
\end{prop}
\begin{proof}
    Given a presheaf $\mathcal{F}$ on $X$, define 
    \begin{align*}
        \mathcal{F}^{\text{sh}}(U) = \{f : U \to \bigsqcup_{p \in U}^{} \mathcal{F}_p \mid& f(p) \in \mathcal{F}_p \text{ and for all } p \in U, \text{ there exists an open neighborhood }\\&V_p \subset U \text{ and }s \in \mathcal{F}(V_p) \text{ such that } (V_p, q) = f(q) \in \mathcal{F}_q ~\forall q \in V_p\}.
    \end{align*}
    This is clearly a sheaf. Verifying the universal property is left as an exercise.
\end{proof}
\begin{cor}
    The stalks of $\mathcal{F}$ and $\mathcal{F}^{\text{sh}}$ coincide.
\end{cor}
\begin{proof}
    Easy exercise from the definitions.
\end{proof}
\textbf{Exercise.} Find a nonzero presheaf $\mathcal{F}$ with $\mathcal{F}^{\text{sh}} = 0$. (Comment by Dhruv: this is rather stupid). 

\subsection{Kernels, cokernels, etc.}

Let $\phi : \mathcal{F} \to \mathcal{G}$ be a morphism of presheaves. Then we can define presheaves $\text{ker } \phi$, $\text{coker } \phi$, $\text{im } \phi$ by \begin{align*}
    &(\text{ker }\phi)(u) = \text{ker }\phi_u : \mathcal{F}(U) \to \mathcal{G}(U)\\
    &(\text{coker }\phi)(u) = \text{coker }\phi_u\\
    &(\text{im }\phi)(u) = \text{im }\phi_u.
\end{align*}
These are all presheaves.

\textbf{Exercise.} The presheaf kernel for a morphism of sheaves $\phi: \mathcal{F} \to \mathcal{G}$ is also a sheaf.
\vspace{1mm}
 
This is not true for $\text{coker }\phi$ in general!
\begin{example}
    Take $X = \mathbb{C}$ with the Euclidean topology, and let $\mathcal{O}_X$ be the sheaf of holomorphic functions on $X$ (with addition as its group operation). Let $\mathcal{O}_X^*$ be the sheaf of nowhere vanishing holomorphic functions (with multiplication as its group operation). 
    \vspace{1mm}
     
    We have a morphism of sheaves $\text{exp}: \mathcal{O}_X \to \mathcal{O}_X^*$ by $f \in \mathcal{O}_X(U) \mapsto \text{exp}(f) \in\mathcal{O}_X^*(U)$. Thus $\text{ker}(\text{exp}) = 2 \pi i \mathbb{Z}$ with $\mathbb{Z}$ the constant sheaf, but $\text{coker}(\text{exp})$ is not a sheaf: if we let $U_1 = \mathbb{C}\setminus [0,\infty)$, $U_2 = \mathbb{C}\setminus (-\infty,0]$ and $U = U_1 \cup U_2 = \mathbb{C}\setminus \{\infty\}$ and we let $f(z)=z \in \mathcal{O}_X^*(U)$, then it is not in the image of $\text{exp}:\mathcal{O}_X(U) \to \mathcal{O}_X^*(U)$ since $\log z$ is not single--valued on $U$. Thus $f$ defines a nonzero section of $(\text{coker exp})(U)$. But $f|_{U_i}$ is in the image of $\text{exp}_{U_i}$, since we just choose some branch of $\log z$. Thus $f|_{U_i} = 1$ in $\text{coker exp}$, so sheaf axiom 1 fails.
\end{example}
\begin{defn}
    For a morphism $\phi : \mathcal{F} \to \mathcal{G}$ of sheaves, we define the \textbf{sheaf cokernel} and the \textbf{sheaf image} to be the sheafification of the presheaf cokernel and the presheaf image.
\end{defn}
\textbf{Remark.} Crucial fact: there is an exact sequence of sheaves \[
0 \to 2\pi i \mathbb{Z} \to \mathcal{O}_X \stackrel{\text{exp}}{\to} \mathcal{O}_X^* \to 1.
\]
In other words, $2\pi i \mathbb{Z} = \text{ker}(\text{exp})$ and $\text{coker}(\text{exp}) = 1$ (the first of these we showed, the second of this we will show once we've developed the necessary theory). 
\vspace{1mm}
 
\textbf{Remark.} $\text{ker }\phi, \text{coker }\phi$ satisfy the category theoretic definitions of kernels and cokernels, i.e. they are universal in the appropriate sense. For example, for the kernel, if $\text{ker }\phi : \mathcal{F} \to \mathcal{G}$, then for any other sheaf $\mathcal{L}$ with a map  $\psi $ to $\mathcal{F}$ such that $\phi \circ \psi = 0$, this map factors uniquely through the kernel. This is easy to check and left as an exercise.
\[\begin{tikzcd}[row sep=large,column sep=large]
    & \mathcal{L} & \\
    \text{ker }\phi & \mathcal{F} & \mathcal{G}
    \arrow["\psi", from=1-2, to=2-2]
    \arrow["\phi", from=2-2, to=2-3]
    \arrow["\phi \circ \psi = 0", from=1-2, to=2-3]
    \arrow[,from = 2-1, to = 2-2]
    \arrow["\exists !", from=1-2, to=2-1, dashed]
    \arrow["0", from = 2-1, to = 2-3, bend right = 23]
\end{tikzcd}\]
For the cokernel, reverse all the arrows and check that $\text{coker }\phi$ satisfies the universal property (exercise).

\textbf{Adjacent notions.}
\begin{enumerate}[(i)]
    \item \textbf{Subsheaves}. $\mathcal{F} \subset \mathcal{G}$ is there exist inclusions $\mathcal{F}(U) \subset \mathcal{G}(U)$ compatible with restrictions. For example, $\text{ker}(\phi : \mathcal{F} \to \mathcal{G}) \subset \mathcal{F}$.
    \item \textbf{Quotient sheaves}. To be added at a later date.
\end{enumerate} 

\subsection{Moving between spaces}

\marginpar{20 Oct 2022, Lecture 7}


\begin{defn}
    Given $f: X \to Y$ continuous with sheaves $\mathcal{F}$ on $X$ and $\mathcal{G}$ on $Y$, the \textbf{presheaf pushforward} $f_{\star}\mathcal{F}$ is defined by \[
    \mathcal{U} \mapsto \mathcal{F}(f^{-1}(\mathcal{U}))
    \]
    for an open set $\mathcal{U} \subset \mathcal{Y}$. 
\end{defn}
\begin{prop}
    The presheaf pushforward of a sheaf is a sheaf.
\end{prop}
\begin{proof}
    Trivial.
\end{proof}
\begin{defn}
    Given $f: X \to Y$ continuous with sheaves $\mathcal{F}$ on $X$ and $\mathcal{G}$ on $Y$, the \textbf{inverse image presheaf} $(f^{-1}\mathcal{G})^{\text{pre}}$ is defined by (for $V$ open in $X$) \[
    (f^{-1}\mathcal{G})^{\text{pre}}(V) = \{(s_U,U) \mid U \text{ is an open set containing }V, s_U \in \mathcal{G}(U)\}/\sim
    \]
    where $\sim$ is an equivalence relation that identifies pairs that agree on a smaller open set containing $V$.
    \vspace{1mm}
     
    The \textbf{inverse image sheaf} is given by $f^{-1}\mathcal{G} = ((f^{-1}\mathcal{G})^{\text{pre}})^{\text{sh}}$.
\end{defn}
\begin{example}
    Take $Y$ a topological space and set $X = Y \sqcup Y$. Take $\mathcal{G} = \mathbb{Z}$ to be the constant sheaf and $\mathcal{F} = (f^{-1} \mathcal{G})^{\text{pre}}$. Fix $U \subset Y$ open and $V = f^{-1}(U)$. Then $\mathcal{F}(V) = \mathcal{G}(U) = \mathbb{Z}$, constant (assuming $U$ is connected). But $V = U \sqcup U$, so $\mathcal{F}^{\text{sh}}(V) = \mathcal{G}(U) \times \mathcal{G}(U) = \mathbb{Z}^2$. This happens because this isn't a local condition.
\end{example}
\begin{example}
    Let $\mathcal{F}$ be a sheaf of $X$ and $\pi : X \to \text{point}$. Then $\pi_{\star}\mathcal{F}$ is a sheaf on a point, i.e. an abelian group, specifically $\mathcal{F}(\pi^{-1}(\text{point})) = \mathcal{F}(X)$.
    \vspace{1mm}
     
    \textbf{Notation.} We write $\mathcal{F}(X) = \Gamma(X,\mathcal{F})$, called the global section, and $\mathcal{F}(X)=H^0(X,\mathcal{F})$, the $0^{\text{th}}$ cohomology of coefficients in $\mathcal{F}$.
    \vspace{1mm}
     
    For $p \in X$, $i : \{p\} \to X$, $\mathcal{G}$ a sheaf on the point, i.e. an abelian group $A$, we can consider $i_{\star}\mathcal{G}$. This is the sheaf on $X$ such that $i_{\star}(\mathcal{G})(U) = \begin{cases}
        0 & p \not\in U.\\
        A & p \in U.
    \end{cases}$ This is called the skyscraper at $p$ with value $A$.
\end{example}

\section{Schemes}
The summary: $\text{Spec}(A)$ has a sheaf $\mathcal{O}_{\text{Spec}(A)}$ such that the value on a distinguished open $\mathcal{U}_f = A_f$, and then globalize this to get a scheme. We now spell this out in detail.

\begin{defn}
    Let $A$ be a ring and $S \subset A$ a set that is closed under multiplication. The two examples we should keep in mind are $S = \{1,f,f^2,f^3,\ldots\}$ or $S = A\setminus \mathfrak{p}$ for $\mathfrak{p}$ a prime ideal. The \textbf{localization} of $A$ at $S$ is \[
    S^{-1}A = \{(a,s) \mid a \in A, s \in S\}/\sim
    \]
    where $(a,s) \sim (a',s') \iff \exists s'' \in S$ such that $s''(as'-a's) = 0 \in A$. We read $\frac{a}{s}$ for the equivalence class of $(a,s)$.
\end{defn}

\textbf{Warning.} The map $A \to S^{-1}A$ need not be injective, e.g. if $S$ contains a zero divisor.
\vspace{1mm}
 
What's going to happen now? We will define a sheaf $\mathcal{O}_{\text{Spec}(A)}$ on the topological space $\text{Spec}(A)$ with two features: 
\begin{itemize}
    \item The stalk at a prime $\mathfrak{p}$ will be $(A\setminus \mathfrak{p})^{-1}A$.
    \item If $\mathcal{U}_f$ is a distinguished open, then $\mathcal{O}_{\text{Spec}(A)}(\mathcal{U}_f) = A_f$.
\end{itemize}
\vspace{1mm}
 
\textbf{A sheaf on a base.} Fix a topological space $X$ and $\mathcal{B}$ a basis for the topology. A \textbf{sheaf on the base $\mathcal{B}$}, $\mathfrak{F}$, consists of assignments $B_i \mapsto \mathfrak{F}(B_i)$ on abelian groups/rings/some objects with restriction maps $\mathfrak{F}(B_i) \to \mathfrak{F}(B_j)$ whenever $B_j \subset B_i$. These satisfy the usual commutativity and the identities when $B_i \subset B_j \subset B_k$ or $B_i = B_j$, as well as the following two conditions:
\begin{enumerate}[(1)]
    \item If $B = \cup B_i$ with $B, B_i \in \mathcal{B}$ and $f, g \in \mathfrak{F}(B)$ such that $f|_{B_i} = g|_{B_i} ~\forall i$, then $f = g$. 
    \item If $B = \cup B_i$ as above with $f_i \in \mathfrak{F}(B_i)$ such that they agree where assigned (i.e. $\forall i,j$, if $B' = B_i \cap B_j$, then $f_i|_{B'} = f_j|_{B'}$), then $\exists f \in \mathfrak{F}(B)$ with $f|_{B_i} = f_i$.
\end{enumerate}
\begin{prop}
    Let $F$ be a sheaf on a base $\mathcal{B}$ of a topological space $X$. Then this uniquely (up to unique isomorphism) determines a sheaf $\mathfrak{F}$ by $\mathfrak{F}(B_i) = F(B_i)$ agreeing with restriction maps.
\end{prop}
\begin{proof}
    Define the stalks of $\mathfrak{F}$ first, i.e. $\mathfrak{F}_\mathfrak{p} = \{(S_B,B) \mid B \text{ is a basic open containing }\mathfrak{p}\}/\sim$. Now use the sheafification trick to define $$\mathfrak{F}(U) = \{(f_p \in \mathfrak{F}_p)_{p \in U} \mid ~\forall p \in U, \exists \text{ basic open }B \text{ containing }p \text{ and } s \in F(B) \text{ with }s_q = f_q \text{ in }\mathcal{F}_q ~\forall q \in B\}.$$
    Thirdly, the natural maps $F(B) \to \mathfrak{F}(B)$ are isomorphic by sheaf axioms. The final fact that this is unique (up to unique isomorphism) is left as an exercise.
\end{proof}

\marginpar{23 Oct 2022, Lecture 8}

Setup so far: $\text{Spec }A$ is a topological space with base $\{U_f\}$ for $U_f =\mathbb{V}(f)^C$ over $f \in A$. Recall also that $U_f = U_g$ if and only if $f$ and $g$ are both powers of some $h \in A$. Also, if $U_f = U_g$, then the localizations $A_f \cong A_g$ are isomorphic. Therefore, the assignment $U_f \mapsto A_f$ is well--defined.

\begin{prop}
    The assignment $U_f \to A_f$ defines a sheaf (of rings) on the base of the topology of $\text{Spec }A$ given by distinguished opens.
    \vspace{1mm}
     
    As a consequence, $\text{Spec }A$ inherits a sheaf of rings, denoted $\mathcal{O}_{\text{Spec }A}$ and called \textbf{the structure sheaf}.
\end{prop}
\textbf{Prelude.} Suppose $\{U_{f_i}\}_{i \in I}$ covers $\text{Spec }A$. Then there exists a finite subcover. In other words, $\text{Spec }A$ is quasi--compact. Why? Since the $U_{f_i}$ cover, there exists no prime ideal $\mathfrak{p} \subset A$ containing all $(f_i) \iff \sum_{i \in I}^{} (f_i) = (1)$. Hence $ 1 = \sum_{i}^{} a_i f_i$, where all but finitely many $a_i=0$. So if $J \subset I$ are the indices with nonzero coefficient, then $\{U_{f_i}\}_{i \in J}$ cover. 
\begin{proof}
    We need to check that axioms 1 and 2 of a sheaf hold. We will check these for a the basic open $B = \text{Spec }A$ itself (the general case is similar, restrict to a basic open and repeat the proof).
    \vspace{1mm}
     
    Axiom 1: Suppose $\text{Spec }A = \bigcup_{i=1}^n U_{f_i}$ (finite by the prelude). Given $s \in A$ such that $s|_{U_{f_i}} = 0 ~\forall i$, by the definition of localization $f_i^m s = 0$ for some $m$ large enough. But $(1) = (f_i^m)_{i=1}^n$ for any $m>0$ because $\{U_{f_i}\}$ cover $\text{Spec }A$, so hence so do $\{U_{f_i^m}\}$. Hence $1 = \left(\sum_{}^{} r_i f_i^m \right)$ and multiplying by $s$ on both sides gives us $s = 0$.
    \vspace{1mm}
     
    Axiom 2: Say $\text{Spec }A = \bigcup_{i \in I} U_{f_i}$ and choose elements in each $A_{f_i}$ that agree in $A_{f_i f_j}$, i.e. if $s_i \in A_{f_i}$, then the images of $s_i$ and $s_j$ in $A_{f_i f_j}$ coincide. We need to build an element in $A$ with these restrictions. 
    \vspace{1mm}
     
    First suppose $I$ is finite. On $U_{f_i}$, we've chosen an element $\frac{a_i}{f_i^{l_i}} \in A_{f_i}$. Write $g_i = f_i^{l_i}$, noting $U_{f_i} = U_{g_i}$. On overlaps, restrict to $A_{g_ig_j}$. The condition for the second axiom is $(g_i g_j)^{m_j}(a_i g_j - a_j g_i) = 0$. Rewriting this using algebra and $U_f = U_{f^k} ~\forall k\ge 1$, we may assume $m = m_{ij}$ by taking the largest. Write $b_i = a_i g_i^m$ and $h_i = g_i^{m+1}$, so on each $U_{h_i}$ we've chosen an element $\frac{b_i}{h_i}$. \footnote{So far, this is just rewriting everything symbolically with no actual content.} But $U_{h_i}$ cover $\text{Spec }A$, so $1 = \sum_{i}^{} r_i h_i$ for $r_i \in A$. Now we construct $r = \sum_{}^{} r_i b_i$ with $r_i$ as above. This restricts correctly to $\frac{b_i}{h_i}$ on $U_{h_i}$ (i.e. in the localization $A_{h_i}$).
    \vspace{1mm}
     
    When $I$ is infinite, pick a finite subcover $(f_1,\ldots,f_n) = A$ such that $U_{f_i}$ form a cover and use the above to build $r$. But given $(f_1,\ldots,f_n, f_{\alpha}) = A$, the same construction gives a ''new'' $r'$. But $r' = r$ by the first axiom. 
\end{proof}
\begin{defn}
    The structure sheaf on $\text{Spec }A$ is the sheaf associated to the sheaf on the base sending $U_f \mapsto A_f$, denoted $\mathcal{O}_{\text{Spec }A}$.
\end{defn}
\textbf{Observation.} The stalk $\mathcal{O}_{\text{Spec }A, \mathfrak{p}} = A_{\mathfrak{p}}$.
\vspace{1mm}
 
\textbf{Terminology.} A \textbf{ringed space} $(X, \mathcal{O}_X)$ is a topological space $X$ with a sheaf of rings $\mathcal{O}_X$. An isomorphism of ringed spaces $(X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ is the combination of a homomorphism $\pi : X \to Y$ and an isomorphism of sheaves on $Y$, $\mathcal{O}_Y \stackrel{\sim}{\to} \pi_{\star}\mathcal{O}_X$.

\begin{defn}
    An \textbf{affine scheme} is a ringed space $(X, \mathcal{O}_X)$ that is isomorphic (as a ringed space) to $(\text{Spec }A, \mathcal{O}_{\text{Spec }A})$.
\end{defn}
\begin{defn}
    A \textbf{scheme} is a ringed space $(X, \mathcal{O}_X)$ that is locally isomorphic to an affine scheme.
\end{defn}
Intuitively, every point $p \in X$ has a neighborhood $U_p$ such that the ringed space $(U_p, \mathcal{O}_{U_p})$ is isomorphic to some affine scheme (possibly depending on $p$).
Note that if $U \subset X$ is open, then $U$ is naturally a ringed space with $\mathcal{O}_U(V) = \mathcal{O}_X(V)$.

\begin{example}
    $\text{Spec }A$ for various rings $A$.
\end{example}
\begin{example}
    Open subschemes. Let $X$ be a scheme and $U \subset X$ be open.\footnote{From now on, whenever we say ''let $X$ be a scheme'', we silently take that to mean $(X, \mathcal{O}_X)$.} Take $\mathcal{O}_U = \mathcal{O}_X |_U$ to be the structure sheaf of $U$. This is a scheme, because the $U_f$ form a basis.
\end{example}
\begin{example}
    Take $X = \text{Spec }\mathbb{C}[x,y]$ and $U = \{(x,y)\}^C$. Then the scheme $U$ is not an affine scheme.
\end{example}

\end{document}