\documentclass{article}
%build with recipe latexmk
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{fancyhdr}
\pagestyle{fancy}

\usepackage{tcolorbox}
\tcbuselibrary{theorems}
\usepackage{babel}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
%\usepackage{a4wide}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{setspace}
\setstretch{1.1}
\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black,  %choose some color if you want links to stand out
}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{example}[theorem]{Example}
\newtheorem{defn}[theorem]{Definition}

\title{Introduction to Additive Combinatorics \\ Part III
    \\ \large
    Lectured by Julia Wolf
}
 
\author{Artur Avameri}
\date{}
 
\setcounter{section}{0}
 
\begin{document}
\maketitle
\tableofcontents
\newpage
 
\section{Fourier--analytic techniques}

\marginpar{19 Jan 2024, Lecture 1}


Let $G = \mathbb{F}_{p}^n$ for $p$ a small fixed prime (usually $p = 2,3,5$) and $n$ is large (often we consider $n \to \infty$).
\vspace{1mm}
 
\textbf{Notation.} Given a finite set $B$ and any function $f : B \to \mathbb{C}$, we write $\mathbb{E}_{x \in B}f(x)$ to mean $\frac{1}{B}\sum_{x \in B} f(x)$. Also write $\omega = e^{2\pi i /p}$ for the $p^{\text{th}}$ root of unity. Note that $\sum_{a \in \mathbb{F}_p}^{} \omega^a = 0$.

\begin{defn}
    Given $f : \mathbb{F}_{p}^n : \mathbb{C}$, we define its \textbf{Fourier transform} $\hat{f} : \mathbb{F}_{p}^n \to \mathbb{C}$ by \[
    \hat{f}(t) = \mathbb{E}_{x \in \mathbb{F}_{p}^n} f(x)\omega^{x \cdot t} ~\forall  t \in \mathbb{F}_{p}^n
    \] 
    where $x \cdot t$ is the standard scalar product.
\end{defn}
It is easy to verify the \textbf{inversion formula}:
\[
f(x) = \sum_{t \in \mathbb{F}_{p}^n}^{} \hat{f}(t) \omega^{-x \cdot t} ~\forall  x \in \mathbb{F}_{p}^n.
\]
Indeed, 
\begin{align*}
    &\sum_{t \in \mathbb{F}_{p}^n}^{} \hat{f}(t) \omega^{-x \cdot t} = \sum_{t \in \mathbb{F}_{p}^n}^{} \left(\mathbb{E}_y f(y) \omega^{y \cdot t} \right)\omega^{-x \cdot t}\\
    =& \mathbb{E}_y f(y) \underbrace{\sum_{t \in \mathbb{F}_{p}^n}^{} \omega^{(y-x)\cdot t}}_{p^n 1_{\{y=x\}}} = f(x).
\end{align*}

\textbf{Remark.} We could use an unnormalized sum in our definition and a normalized sum in the inversion formula, or a minus sign in our definition and a plus sign in the inversion formula -- this doesn't matter as long as we're consistent.

\vspace{1mm}
 
Given a subset $A$ of a finite group $G$, write:
\begin{itemize}
    \item $1_A$ for the \textbf{characteristic function} of $A$, i.e. $1_A(x) = \begin{cases}
            1 & \text{if }x \in A\\
            0 & \text{if } x \not\in A
    \end{cases}$. This is also called the \textbf{indicator function}.
    \item $f_A$ for the \textbf{balanced function} of $A$, i.e. $f_A(x) = 1_A(x) - \alpha$, where $\alpha = \frac{|A|}{|G|}$.
    \item $\mu_A$ for the \textbf{characteristic measure} of $A$, i.e. $\mu_A(x) = \alpha^{-1} 1_A(x)$.
\end{itemize}
Note $\mathbb{E}_{x \in G}f_A(x) = 0$ and $\mathbb{E}_{x \in G}\mu_A(x)=1$. Given $A \subset \mathbb{F}_{p}^n$, we have \[
\hat{1}_A(t) = \mathbb{E}_{x \in \mathbb{F}_{p}^n} 1_A(x)\omega^{x \cdot t}.
\]
At $t=0$, we get $\hat{1}_A(0) = \mathbb{E}_{x \in \mathbb{F}_{p}^n}1_A(x) = \alpha$.
\vspace{1mm}
 
Writing $-A = \{-a \mid a \in A\}$, we have 
\begin{align*}
    &\hat{1}_{-A}(t) = \mathbb{E}_{x \in \mathbb{F}_{p}^n} 1_{-A}(x) \omega^{x\cdot t} = \mathbb{E}_{x \in \mathbb{F}_{p}^n} 1_A(-x)\omega^{x \cdot t} \\
    \stackrel{y=-x}{=}&  \mathbb{E}_{y \in \mathbb{F}_{p}^n} 1_A(y) \omega^{-y \cdot t} = \overline{\mathbb{E}_{y \in \mathbb{F}_{p}^n}1_A(y)\omega^{y \cdot t}} = \overline{\hat{1}_A(t)}.
\end{align*}
\begin{example}\label{ex1.2}
    Let $V \le \mathbb{F}_{p}^n$. Then 
    \begin{align*}
        &\hat{1}_V(t) = \mathbb{E}_{x \in \mathbb{F}_{p}^n}1_V(x)\omega^{x\cdot t} = \frac{|V|}{p^n} 1_{\{x\cdot t = 0 ~\forall x \in V\}} = \frac{|V|}{p^n}1_{V^{\perp}}(t),
    \end{align*}
    so $\hat{\mu}_V(t) = 1_{V^{\perp}}(t)$.
    (Here we use the fact that if $t \not\in \{x \cdot t = 0 ~\forall x \in V\}$, then $x\cdot t$ runs over the values uniformly and the sum is zero - details left as exercise).
\end{example}
\begin{example}
    Let $R \subset \mathbb{F}_{p}^n$ be such that each $x \in \mathbb{F}_{p}^n$ lies in $R$ independently with probability $\frac{1}{2}$. Then with high probability (i.e. $\mathbb{P} \to 1$ as $n \to \infty$),
    \[
    \sup_{t \neq 0} |\hat{1}_R(t)| = O\left(\sqrt{\frac{\log (p^n)}{p^n}}\right).
    \]
    Proving this is on Ex. Sheet 1. This is proved using a Chernoff--type bound: given complex--valued independent random variables $X_1,\ldots,X_n$ with mean 0, $~\forall \theta \ge 0$, 
    \[
    \mathbb{P}\left(\left|\sum_{i=1}^{n} X_i\right| \ge \theta \sqrt{\sum_{i=1}^{n} ||X_i||^2_{L^\infty(\mathbb{P})}}\right) \le 4\exp \left(-\theta^2/4\right).
    \]
\end{example}
\begin{example}
    Let $Q = \{x \in \mathbb{F}_{p}^n \mid x \cdot x = 0\}$. Then $|Q| = \left(\frac{1}{p} + O(p^{-n}) \right)p^n$ and $\sup_{t \neq 0}|\hat{1}_Q(t)| = O(p^{-n/2})$. This is again on Ex. Sheet 1.
\end{example}
\textbf{Notation.} Given $f,g : \mathbb{F}_{p}^n \to \mathbb{C}$, write \[
\langle f,g \rangle = \mathbb{E}_{x \in \mathbb{F}_{p}^n}f(x)\overline{g(x)}
\]
and \[
\langle \hat{f},\hat{g}\rangle = \sum_{t \in \mathbb{F}_{p}^n}^{} \hat{f}(t)\overline{\hat{g}(t)}.
\]
Consequently, $||f||_2^2 = \mathbb{E}_x |f(x)|^2$ and $||\hat{f}||_2^2 = \sum_{t}^{} |\hat{f}(t)|^2$.

\begin{lemma}
    The following hold for all $f, g : \mathbb{F}_{p}^n \to \mathbb{C}$:
    \begin{enumerate}[(i)]
        \item $\langle f,g \rangle = \langle \hat{f}, \hat{g} \rangle$ (Plancherel's identity).
        \item $||f||_2 = ||\hat{f}||_2$ (Parseval's identity).
    \end{enumerate}
\end{lemma}
\begin{proof}
    (ii) follows from (i). For (i), compute
    \begin{align*}
        \langle \hat{f},\hat{g} \rangle &= \sum_{t \in \mathbb{F}_{p}^n}^{} \hat{f}(t)\overline{\hat{g}(t)} = \sum_{t \in \mathbb{F}_{p}^n}^{} \frac{1}{p^{2n}}\sum_{x \in \mathbb{F}_{p}^n}^{} f(x) \omega^{x \cdot t} \sum_{y \in \mathbb{F}_{p}^n}^{} \overline{g(y) \omega^{y\cdot t}}  \\
        &= \frac{1}{p^{2n}}\sum_{x,y \in \mathbb{F}_{p}^n}^{}  f(x)\overline{g(y)}\sum_{t \in \mathbb{F}_{p}^n}^{} \omega^{(x-y)t} = \frac{1}{p^{2n}}\sum_{x \in \mathbb{F}_{p}^n}^{} p^n f(x)\overline{g(x)} = \langle f,g \rangle.
    \end{align*}
    
\end{proof}
\begin{defn}
    Let $\rho > 0$ and $f : \mathbb{F}_{p}^n \to \mathbb{C}$. Define the \textbf{$\rho$--large spectrum} of $f$ to be
    \[
    \text{Spec}_{\rho}(f) = \{t \in \mathbb{F}_{p}^n \mid |\hat{f}(t)| \ge \rho ||f||_1\}.
    \]
\end{defn}
\begin{example}
    By Example \ref{ex1.2}, if $f = 1_V$ with $V \le \mathbb{F}_{p}^n$, then $\forall \rho >0$, $\text{Spec}_{\rho}(f) = V^\perp$.
\end{example}
\begin{lemma}\label{lemma1.8}
    For all $\rho > 0$, $|\text{Spec}_{\rho}(f)| \le \rho^{-2}\frac{||f||_2^2}{||f||_1^2}$.
\end{lemma}
\begin{proof}
    By Parseval,
    \begin{align*}
        ||f||_2^2 = ||\hat{f}||_2^2\ge \sum_{t \in \text{Spec}_{\rho}(f)}^{} |\hat{f}(t)^2| \ge |\text{Spec}_{\rho}(f)|(\rho ||f||_1)^2.
    \end{align*}
\end{proof}

\marginpar{22 Jan 2024, Lecture 2}

\begin{defn}
    Given $f, g : \mathbb{F}_p^n \to \mathbb{C}$, define their \textbf{convolution} $f * g :\mathbb{F}_p^n \to \mathbb{C}$ by $$f*g(x) = \mathbb{E}_{y \in \mathbb{F}_p^n}f(y)g(x-y) ~\forall x \in \mathbb{F}_p^n.$$
\end{defn}
\begin{example}
    Given $A, B \subset \mathbb{F}_p^n$, 
    \begin{align*}
        1_A * 1_B(x) &= \mathbb{E}_{y \in \mathbb{F}_p^n}1_A(y)1_B(x-y) = \frac{1}{p^n}|A \cap (x-B)| \\
        &= \frac{1}{p^n} \# \text{ways }x \text{ can be written as }x=a+b \text{ with }a \in A, b \in B.
    \end{align*}
    In particular, the support of $1_A * 1_B$ is the \textbf{sum set} \[
    A+B = \{a+b \mid a \in A, b \in B\}
    \]
    of $A$ and $B$.
\end{example}
\begin{lemma}
    Given $f, g : \mathbb{F}_p^n \to \mathbb{C}$, $$\widehat{f * g}(t) = \hat{f}(t)\hat{g}(t) ~\forall t \in \mathbb{F}_p^n.$$
\end{lemma}
\begin{proof}
    Set $u = x-y$ to get
    \begin{align*}
        \widehat{f * g}(t) &= \mathbb{E}_{x \in \mathbb{F}_p^n}\left(\mathbb{E}_{y \in \mathbb{F}_p^n}f(y)g(x-y)\right)\omega^{x \cdot t} \\
        &= \mathbb{E}_y f(y) \mathbb{E}_u g(u) \omega^{(u+y)\cdot t} \\
        &= \hat{f}(t)\hat{g}(t).
    \end{align*}
\end{proof}
\begin{example}
    $||\hat{f}||_4^4 = \mathbb{E}_{x+y=z+w}f(x)f(y)\overline{f(z)f(w)}$. This is on Ex. Sheet 1.
\end{example}
\begin{lemma}[Bogolyubov's Lemma]
    Given $A \subset \mathbb{F}_p^n$ of density $\alpha>0$, there exists a subspace $V\le \mathbb{F}_p^n$ of codimension at most $2\alpha^{-2}$ s.t. $A+A-A-A \supset V$. 
\end{lemma}
\begin{proof}
    Observe that 
    \begin{align*}
        A+A-A-A = \text{supp}(\underbrace{1_A * 1_A * 1_{-A} * 1_{-A}}_{:= g}).
    \end{align*}
    Hence we wish to find $V \le \mathbb{F}_p^n$ such that $g(x) > 0 ~\forall x \in V$. Let $K = \text{Spec}_{\rho}(1_A)$ with $\rho$ to be determined later and let $V = \langle K \rangle^{\perp}$. By Lemma \ref{lemma1.8}, $|K|\le \rho^{-2}\alpha^{-1}$ and hence $\text{codim}(V)\le |K| \le \rho^{-2}\alpha^{-1}$. By the inversion formula, 
    \begin{align*}
        g(x) &= \sum_{t \in \mathbb{F}_p^n}^{} (\widehat{1_A * 1_A * 1_{-A} * 1_{-A}})(t)\omega^{-x\cdot t} \\
        &= \sum_{t \in \mathbb{F}_p^n}^{} |\hat{1}_A(t)|^4 \omega^{-x\cdot t} \\
        &= \alpha^4 + \underbrace{\sum_{t \in K \setminus \{0\}}^{} |\hat{1}_A(t)|^4 \omega^{-x \cdot t}}_{(1)} + \underbrace{\sum_{t \not\in K}^{} |\hat{1}_A(t)|^4 \omega^{-x \cdot t}}_{(2)}.
    \end{align*}
    For $(1)$, we see it is $\ge 0$ since $x \cdot t = 0 ~\forall t \in K, x \in V$. (Note we could give better lower bounds but we don't need them).
    \vspace{1mm}
     
    For $(2)$, we have 
    \begin{align*}
        |(2)| &\le \sum_{t \not\in K}^{} |\hat{1}_A(t)|^4 \le \sup_{t \not\in K} |\hat{1}_A(t)|^2 \sum_{t \not\in K}^{} |\hat{1}_A(t)|^2 \le \sup_{t \not\in K} |\hat{1}_A(t)|^2 \sum_{t}^{} |\hat{1}_A(t)|^2 \\
        &\le (\rho \alpha)^2 ||1_A||_2^2 = \rho^2 \alpha^3.
    \end{align*}
    Now pick $\rho$ such that $\rho^2 \alpha^3 \le \frac{\alpha^4}{2}$, e.g. $\rho = \sqrt{\frac{\alpha}{2}}$.
\end{proof}
\begin{example}
    The set $A = \{x \in \mathbb{F}_2^n \mid |x|\ge \frac{n}{2}+\frac{\sqrt{n}}{2}\}$ has density at least $\frac{1}{4}$, and there is no coset $C$ of any subspace of codimension at most $\sqrt{n}$ such that $C \subset A + A$. This is on Ex. Sheet 1.
\end{example}
\begin{lemma}\label{lemma1.15}
    Let $A \subset \mathbb{F}_p^n$ of density $\alpha$ be such that $\exists t \neq 0$ in $\text{Spec}_{\rho}(1_A)$. Then $\exists V \le \mathbb{F}_p^n$ of codimension 1 and $\exists x \in \mathbb{F}_p^n$ such that \[
    |A \cap (x+V)| \ge \alpha \left(1+\frac{\rho}{2}\right)|V|.
    \]
\end{lemma}
\begin{proof}
    Let $t\neq 0$ be such that $|\hat{1}_A(t)|\ge \rho \alpha$ and let $V = \langle t \rangle^{\perp}$. Write $v_j + V$ for $j \in [p] := \{1,2,\ldots,p\}$ for the cosets of $V$ such that $v_j + V = \{x \in \mathbb{F}_p^n \mid x \cdot t = j\}$. Then 
    \begin{align*}
        \hat{1}_A(t) &= \hat{f}_A(t) \\
        &= \mathbb{E}_{x \in \mathbb{F}_p^n}(1_A(x)-\alpha)\omega^{x \cdot t} \\
        &= \mathbb{E}_{j \in [p]}\underbrace{\mathbb{E}_{x \in v_j+V}(1_A(x)-\alpha)}_{=: a_j = \frac{|A \cap (v_i +V)|}{|V|}-\alpha}\omega^j.
    \end{align*}
    By the triangle inequality, $\mathbb{E}_{j \in [p]} |a_j|\ge \rho \alpha$. Since $\mathbb{E}_{j \in [p]}a_j = 0$, $\mathbb{E}_{j \in [p]}(a_j + |a_j|) \ge \rho \alpha$, so $\exists j \in [p]$ such that $a_j + |a_j| \ge \rho \alpha \implies a_j \ge \frac{\rho \alpha}{2}$.
\end{proof}

\marginpar{24 Jan 2024, Lecture 3}

\begin{lemma}\label{lemma1.16}
    Let $p\ge 3$ and $A \subset \mathbb{F}_p^n$ of density $\alpha > 0$ be such that $$\sup_{t \neq 0} |\hat{1}_A(t)| = o(1).$$ Then $A$ contains $(\alpha^3+o(1))(p^n)^2$ 3--term arithmetic progressions (3--APs).
\end{lemma}
In other words, a set with small Fourier coefficients has the same number of 3--APs as a truly random set of the same density.
\vspace{1mm}
 
\textbf{Notation.} Given $f,g,h : \mathbb{F}_p^n \to \mathbb{C}$, $T_3(f,g,h) = \mathbb{E}_{x,d} f(x)g(x+d)h(x+2d)$. 

\vspace{1mm}
 
Given $A \subset \mathbb{F}_p^n$, write $2 \cdot A = \{2a \mid a \in A\}$. This is different from $2A = A + A =\{a + a' \mid a,a' \in A\}$.

\begin{proof}
    The number of 3--APs in $A$ is $(p^n)^2$ times $T_3(1_A,1_A,1_A)$, where
    \begin{align*}
        T_3(1_A,1_A,1_A) &= \mathbb{E}_{x,d}1_A(x)1_A(x+d)1_A(x+2d) \\
        &= \mathbb{E}_{x,y}1_A(x)1_A(y)1_A(2y-x) &y=x+d\\
        &= \mathbb{E}_{y}1_A(y) (1_A * 1_A)(2y) \\
        &= \langle 1_{2\cdot A}, 1_A * 1_A \rangle &z=2y\\
        &= \langle \hat{1}_{2\cdot A}, \widehat{1_A * 1_A}\rangle. &\text{by Plancherel}.
    \end{align*}
    Continue the last manipulation to get 
    \begin{align*}
        &= \langle \hat{1}_{2\cdot A}, \hat{1}_A^2 \rangle \\
        &= \alpha^3 + \sum_{t \neq 0}^{} \hat{1}_A(t)^2 \overline{\widehat{1_{2\cdot A}}(t)}.
    \end{align*}
    The sum in absolute value is at most 
    \begin{align*}
        &\le \sup_{t \neq 0}|\hat{1}_A(t)|\sum_{t\neq0}^{} |\hat{1}_A(t)\overline{\hat{1}_{2\cdot A}(t)}| \\
        &\le \sup_{t\neq 0}|\hat{1}_A(t)| \left(\sum_{t}^{} |\hat{1}_A(t)|^2\right)^{1/2}\left(\sum_{t}^{} |\hat{1}_{2\cdot A}(t)|^2\right)^{1/2}\\
        &\le \sup_{t \neq 0}|\hat{1}_A(t)|\cdot \alpha^{1/2} \cdot \alpha^{1/2} 
    \end{align*}
    by Parseval.
\end{proof}
Using the above two results, we prove:
\begin{theorem}[Meshulam's Theorem]
    Let $p\ge 3$ and let $A \subset \mathbb{F}_p^n$ be a set containing no non--trivial 3--APs. Then $|A| = O\left(\frac{p^n}{n \log p}\right)$. 
\end{theorem}
\begin{proof}
    By assumption, $T_3(1_A,1_A,1_A) = \frac{\alpha}{p^n}$, but as in Lemma \ref{lemma1.16}, \[
    T_3(1_A,1_A,1_A) = \alpha^3 + \sum_{t\neq 0}^{} \hat{1}_A(t) \hat{1}_{2\cdot A}(t),
    \]
    so provided $p^n \ge 2\alpha^{-2}$, $\left|\frac{\alpha}{p^n}-\alpha^3 \right| \le  \sup_{t\neq 0} |\hat{1}_A(t)| \cdot \alpha$, so $\sup_{t\neq 0}|\hat{1}_A(t)| \ge \frac{a^2}{2}$.
    By Lemma \ref{lemma1.15} with $\rho = \frac{\alpha}{2}$, $\exists V \le \mathbb{F}_p^n$ of codimension 1 and $x \in \mathbb{F}_p^n$ such that $|A \cap (x+V)| \ge \left(\alpha +\frac{\alpha^2}{4}\right)|V|$.
    \vspace{1mm}
     
    We iterate this observation. Let $A_0 = A, V_0 = \mathbb{F}_p^n$, $\alpha_0 = \alpha = \frac{|A_0|}{|V_0|}$. At step $i$ of this iteration, we are given a set $A_{i-1} \subset V_{i-1}$ of density $\alpha_{i-1}$ with no nontrivial 3--APs. Provided that $p^{\text{dim}(V_{i-1})}\ge 2\alpha_{i-1}^{-2}$, $\exists V_i \le V_{i-1}$ of codimension 1 and $x_i \in V_{i-1}$ such that $|A_{i-1} \cap (x_i + V_i)|\ge \left(\alpha_{i-1} + \frac{\alpha_{i-1}^2}{4}\right)|V_{i}|$. Set $A_i = A_{i-1} - x$. Note $\alpha_i \ge \alpha_{i-1}+\frac{\alpha_{i-1}^2}{4}$ and $A_i$ is free of nontrivial 3--APs. Through this iteration, the density of $A$ increases from $\alpha$ to $2\alpha$ in at most $\frac{\alpha}{\alpha^2/4} = 4\alpha^{-1}$ steps, from $2\alpha$ to $4\alpha$ in at most $\frac{2\alpha}{(2\alpha)^2/4} = 2\alpha^{-1}$ steps, etc, which reaches 1 in at most 
    \[
        (4\alpha^{-1} + 2\alpha^{-1} + \alpha^{-1} + \ldots) = 8\alpha^{-1}
    \]
    steps. The argument must therefore end with $\text{dim}(V_i)\ge n - 8\alpha^{-1}$, at which point we must have had $p^{\text{dim}(V_i)}\le 2\alpha_i^{-2}\le 2\alpha^{-2}$ (or else we could have continued). But we may assume that $\alpha \ge \sqrt{2}p^{-n/4}$ (else we're done), whence $p^{n - 8 \alpha ^{-1}} \le p^{n/2}$, i.e. $\frac{n}{2} \le 8\alpha ^{-1}$, so $\alpha \le \frac{16}{n}$, finishing the proof. 
\end{proof}
\end{document}
 