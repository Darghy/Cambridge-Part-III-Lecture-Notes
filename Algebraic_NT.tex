\documentclass{article}
%build with recipe latexmk
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{fancyhdr}
\pagestyle{fancy}

\usepackage{tcolorbox}
\tcbuselibrary{theorems}
\usepackage{babel}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
%\usepackage{a4wide}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{setspace}
\setstretch{1.1}
\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black,  %choose some color if you want links to stand out
}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{example}{Example}[section]
\newtheorem{defn}{Definition}[section]

\title{Part III - Algebraic Number Theory
    \\ \large
    Lectured by Hanneke Wiersema 
}
 
\author{Artur Avameri}
\date{}
 
\setcounter{section}{-1}
 
\begin{document}
\maketitle
\tableofcontents
\newpage
 
\section{Introduction}

\marginpar{19 Jan 2024, Lecture 1}


The lecturer will provide typed notes at the end of the course. The topics of the course are
\begin{itemize}
    \item global class field theory;
    \begin{itemize}
        \item both ideal--theoretic and idele--theoretic.
    \end{itemize}
    \item zeta functions;
    \item $L$--series;
    \item density theorems.
\end{itemize} 

\subsection{Rough goals of class field theory.}
\begin{enumerate}[(1)]
    \item Given a number field $K$, what are its abelian extensions? If $K = \mathbb{Q}$, we have the Kronecker--Weber theorem (which we will prove): Every finite abelian extension of $\mathbb{Q}$ is contained in some cyclotomic field, i.e. by adjoining a complex root of unity to $\mathbb{Q}$. We write $\mathbb{Q}(\zeta_n)$ for $\zeta_n = e^{2\pi i/n}$. 
    \vspace{1mm}
     
    Finite abelian extensions of $\mathbb{Q}$ can be generated by special values of the exponential function $e^{2\pi i z}$. It is an open problem to explicitly construct all abelian extensions for arbitrary number fields. Kronecker solved the case of imaginary quadratic fields using special values of analytic functions (elliptic and modular functions).
    \vspace{1mm}
     
    In class field theory, we classify extensions introducing the notion of a \textbf{class field}: for any $K$ we will show that any finite abelian extension will be contained in a class field. Moreover, the Galois group of this extension will be isomorphic to the generalized ideal class group (in the ideal case) or a subgroup of the Idele class group (in the idele case).
    \item Given a finite abelian extension, how do the prime ideals in the smaller field behave in the extension? In the quadratic case, we will prove quadratic reciprocity. There exist higher reciprocity laws. The most general answer we will see is the decomposition law, which is a consequence of the Artin reciprocity theorem.
\end{enumerate} 
\textbf{Warning.} There is no one convention for the notation for many objects -- different textbooks may use different notation.
\vspace{1mm}
 
\subsection{Review of basic Algebraic Number Theory}
Let $K$ be a number field and write $\mathcal{O}_K$ for its ring of integers. This is a Dedekind domain, so any ideal has a unique factorization into a product of prime ideals. Let $L/K$ be an extension of number fields and and $\mathfrak{p}$ a prime ideal of $K$. Then $\mathfrak{p}\mathcal{O}_L$ is an ideal of $L$ and by unique factorization $\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1^{e_1}\ldots \mathcal{P}_g^{e_g}$ with $\mathcal{P}_i$ distinct prime ideals in $\mathcal{O}_L$. Write $\mathcal{P}_i \mid \mathfrak{p}$ to mean that $\mathcal{P}_i$ appears in the factorization of $\mathcal{O}_L$. The number $e_i$ is called the ramification index $\mathcal{P}_1/\mathfrak{p}$. We also write $e_i = e_{\mathcal{P}_i/\mathfrak{p}}$. 
\begin{itemize}
    \item If $e_i=1$ for all $i$, we say $\mathfrak{p}$ is unramified in $L$.
    \item If $e_i>1$ for some $i$, we say $\mathfrak{p}$ is ramified.
    \item If there is a unique prime $\mathcal{P}$ dividing $\mathfrak{p}$ with $e_{\mathcal{P}/\mathfrak{p}} = [L:K]$, we say $\mathfrak{p}$ is totally ramified.
    \item If $\mathfrak{p}\mathcal{O}_L$ is prime, we say $\mathfrak{p}$ is inert (or remains inert) in $L$.
    \item If $g = [L:K]$, we say $\mathfrak{p}$ splits completely.
\end{itemize}
The quotient $\mathcal{O}_K/\mathfrak{p}$ is a finite field of characteristic $p$ ($\mathfrak{p} \cap \mathbb{Z} = p\mathbb{Z}$), called a residue field. If $\mathcal{P}\mid \mathfrak{p}$ (for $\mathcal{P} \in \mathcal{O}_L, \mathfrak{p} \in \mathcal{O}_K$), view $\mathcal{O}_K/\mathfrak{p}$ as a subfield of $\mathcal{O}_L/\mathcal{P}$. We call $f_{\mathcal{P}/\mathfrak{p}} = [\mathcal{O}_L/\mathcal{P} : \mathcal{O}_K/\mathfrak{p}]$ the residue field degree. If as before $\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1^{e_1}\ldots \mathcal{P}_g^{e_g}$, then $\sum_{i=1}^{g} e_{\mathcal{P}_i/\mathfrak{p}} f_{\mathcal{P}_i/\mathfrak{p}} = [L:K]$. If $L/K$ is Galois, then the Galois group permutes the $\mathcal{P}_i$ transitively, so $e_1 = \ldots = e_g = e$. Also if $L/K$ is Galois, $f_{\mathcal{P}_1/\mathfrak{p}} = \ldots f_{\mathcal{P}_g/\mathfrak{p}} = f$, so $efg = [L:K]$. Recall also that 
\begin{itemize}
    \item We can find the factorization of $\mathfrak{p}\mathcal{O}_L$ using the Kummer--Dedekind theorem.
    \item A prime $\mathfrak{p}$ in $\mathcal{O}_K$ ramifies in $L/K$ if and only if $\mathfrak{p} \mid d_{L/K}$ for $d_{L/K}$ the discriminant.
\end{itemize}
If $L/K$ is Galois, write $\text{Gal}(L/K)$ for the Galois group. Let $\mathcal{P}$ be a prime ideal in $\mathcal{O}_L$.

\begin{defn}
    The \textbf{decomposition subgroup} of $\mathcal{P}$ is $$D_{\mathcal{P}} = \{\sigma \in \text{Gal}(L/K) \mid \sigma(\mathcal{P})=\mathcal{P}\}.$$
    The \textbf{inertial subgroup} of $\mathcal{P}$ is \[
    I_{\mathcal{P}} = \{\sigma \in \text{Gal}(L/K) \mid \sigma(\alpha) \equiv \alpha \pmod{\mathcal{P}} ~\forall \alpha \in \mathcal{O}_L\}.
    \]
\end{defn}
\textbf{Remark.} We have $I_{\mathcal{P}} \subset D_{\mathcal{P}}$. Easy exercise: show this.
\vspace{1mm}
 
Let $\sigma \in D_\mathcal{P}$. This induces an automorphism $\overline{\sigma} : \mathcal{O}_L/\mathcal{P} \to \mathcal{O}_L/\mathcal{P}$ such that $\overline{\sigma}|_{\mathcal{O}_K/\mathfrak{p}} = \text{Id}|_{\mathcal{O}_K/\mathfrak{p}}$ for $\mathfrak{p} = \mathcal{P} \cap \mathcal{O}_K$. This gives a map $D_{\mathcal{P}} \to \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ by $\sigma \mapsto \overline{\sigma}$.

\begin{prop}\label{prop0.1}
    \begin{enumerate}[(i)]
        \item The Galois group $\text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ is a cyclic group with canonical generator the Frobenius automorphism $x \mapsto x^q$ for $q = |\mathcal{O}_K/\mathfrak{p}|$.
        \item The map $D_{\mathcal{P}} \stackrel{\sigma \mapsto \overline{\sigma}}{\to} \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ defines a surjective homomorphism with kernel $I_{\mathcal{P}}$.
        \item $|I_{\mathcal{P}}| = e_{\mathcal{P}/\mathfrak{p}}$ and $|D_{\mathcal{P}}| = e_{\mathcal{P}/\mathfrak{p}}f_{\mathcal{P}/\mathfrak{p}}$.
    \end{enumerate}
\end{prop}
Recall that if $\mathfrak{p}$ is a prime in $\mathcal{O}_K$ and $\mathcal{P}$ is a prime in $\mathcal{O}_L$ such that $\mathcal{P} \mid  \mathfrak{p}$, then the norm of $\mathcal{P}$ is $N_{L/K}(\mathcal{P}) = \mathfrak{p}^{f_{\mathcal{P}/\mathfrak{p}}}$. Note that if $\mathfrak{p}$ is a prime of $K$, we also write $N(\mathfrak{p})$ for $N_{K/\mathbb{Q}}(\mathfrak{p})$ and $N(\mathfrak{p}) = |\mathcal{O}_K/\mathfrak{p}|$.

\section{The Artin symbol}
\begin{lemma}
    Let $L/K$ be a Galois extension and let $\mathfrak{p}$ be a prime of $\mathcal{O}_K$, unramified in $L$. Suppose $\mathcal{P} \subset  \mathcal{O}_L$ such that $\mathcal{P} \mid  \mathfrak{p}$. Then there exists a unique element $\sigma \in \text{Gal}(L/K)$ such that for all $\alpha \in \mathcal{O}_L$,\[
    \sigma(\alpha) \equiv \alpha^{N(\mathfrak{p})} \pmod{\mathcal{P}}.
    \]
\end{lemma}
\begin{proof}
    Let $\sigma \in D_{\mathcal{P}}$ and $\overline{\sigma} \in \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ its image under the map from Proposition \ref{prop0.1}. By assumption, $\mathfrak{p}$ is unramified, so $|I_{\mathcal{P}}| = 1$, hence by Proposition \ref{prop0.1} again, we have $D_{\mathcal{P}} \stackrel{(\star)}{\cong}  \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$. Recall that $\text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ is generated by $x \mapsto x^q$ for $q = |\mathcal{O}_K/\mathfrak{p}|$. Let $\sigma \in D_{\mathcal{P}}$ be the unique element in $D_{\mathcal{P}}$ which maps to the Frobenius under $(\star)$. Then $\sigma(\alpha) \equiv \alpha^q \pmod{\mathcal{P}}$ for all $\alpha \in \mathcal{O}_L$ and $q = |\mathcal{O}_K/\mathfrak{p}| = N(\mathfrak{p})$. Uniqueness follows since any $\sigma \in \text{Gal}(L/K)$ satisfying this condition will be an element of $D_{\mathcal{P}}$.
\end{proof}
\marginpar{22 Jan 2024, Lecture 2}

\begin{defn}
    This unique element is called the \textbf{Artin symbol} and we denote it by $\left(\frac{L/K}{\mathcal{P}}\right)$.
\end{defn}
\begin{defn}
    Let $p$ be an odd prime and let $a$ be any integer. Recall that the \textbf{Legendre symbol} is $\left( \frac{a}{p}\right) = \begin{cases}
        1 &\text{ if} a \text{ is a QR mod }p.\\
        -1&\text{ if } a \text{ is not a QR mod }p.\\
        0 &\text{ if }a \equiv 0\pmod{p}.
    \end{cases}$
    Now let $n \in \mathbb{Z}$ be nonzero and write $ = u p_1^{k_1}\ldots p_u^{r_u}$ for $u = \pm 1$. Again let $a$ be an integer, then the \textbf{Kronecker symbol} is \[
    \left(\frac{a}{n}\right) = \left(\frac{a}{u}\right) \prod_{i=1}^{k} \left(\frac{a}{p_i}\right)^{r_i}
    \]
    with $\left(\frac{a}{p_i}\right)$ the Legendre symbol for odd primes, $\left(\frac{a}{2}\right) = \begin{cases}
        0 &a \equiv 0\pmod{2}\\
        1&a \equiv \pm 1 \pmod{8}\\
        -1 &a \equiv \pm 3 \pmod{8}
    \end{cases}$
    and $\left(\frac{a}{1}\right) =1$, $\left(\frac{a}{-1}\right) = \begin{cases}
        -1 & a<0\\
        1 &a\ge 0.
    \end{cases}$
\end{defn}
\textbf{The quadratic case.} Let $K=\mathbb{Q}$, $L = \mathbb{Q}(\sqrt{N})$ for $N\neq 0,1$ squarefree. Recall that \[
d_{L/\mathbb{Q}} = \begin{cases}
    N & N \equiv 1 \pmod{4}\\
    4N& N \not\equiv 1 \pmod{4}
\end{cases}
\]
with \[
\mathcal{O}_L = \begin{cases}
    \mathbb{Z}\left[\frac{1+\sqrt{N}}{2}\right] & N \equiv 1 \pmod{4}\\
    \mathbb{Z}[\sqrt{N}] & N \not\equiv 1\pmod{4}.
\end{cases}
\]
Then $\text{Gal}(L/K)$ has order 2 with $1 : \sqrt{N} \to \sqrt{N}$ and $\sigma: \sqrt{N} \to -\sqrt{N}$ and we can identify $\text{Gal}(L/K)$ with $\{\pm 1\}$. 
\vspace{1mm}
 
Let $\mathfrak{p}$ be unramified in $L$ and $\mathcal{P} \subset \mathcal{O}_L$ a prime lying above it (so $\mathcal{P} \mid \mathfrak{p}$). We then get $\sigma(\alpha) \equiv \alpha^{\mathfrak{p}} \pmod{\mathcal{P}}$ for all $\alpha \in \mathcal{O}_L$. We have \[
\left(\frac{L/K}{\mathfrak{p}}\right) = \left(\frac{\mathbb{Q}(\sqrt{N})/\mathbb{Q}}{\mathcal{P}}\right) = \left(\frac{d_{L/\mathbb{Q}}}{p}\right) = \pm 1
\]
since $p \nmid d_{L/\mathbb{Q}}$ (more on this on Ex. Sheet 1).
\begin{prop}
    Suppose $p$ is unramified in $L$. Then $p$ splits in $L$ if and only if $\left(\frac{d_{L/\mathbb{Q}}}{p}\right) = 1$.
\end{prop}
The Artin symbol tells us about the decomposition, but more generally:
\begin{lemma}
    Let $L/K$ be any Galois extension. Let $\mathfrak{p} \subset \mathcal{O}_K$ be unramified with $\mathcal{P} \subset \mathcal{O}_L$ lying above it. Then:
    \begin{enumerate}[(i)]
        \item Let $\sigma \in \text{Gal}(L/K)$. Then $\sigma \left(\frac{L/K}{\mathcal{P}}\right)\sigma^{-1} = \left(\frac{L/K}{\sigma(\mathcal{P})}\right)$.
        \item The order of $\left(\frac{L/K}{\mathcal{P}}\right)$ is the residue field degree $f = f_{\mathcal{P}/\mathfrak{p}}$.
        \item The prime $\mathfrak{p}$ splits completely in $L$ if and only if $\left(\frac{L/K}{\mathcal{P}}\right) = 1$ (i.e. the Artin map is trivial).
    \end{enumerate}
\end{lemma}
\begin{proof}
    Exercise!
\end{proof}
\begin{defn}
    In this course, we say $L/K$ is an abelian extension if it is a Galois extension of number fields with abelian Galois group $\text{Gal}(L/K)$.
\end{defn}
Suppose $L/K$ is abelian and let $\mathfrak{p} \subset \mathcal{O}_K$ be unramified. Let $\mathcal{P}, \mathcal{P}' \subset \mathcal{O}_L$ be distinct prime ideals lying above $\mathfrak{p}$. Then $\mathcal{P}' = \sigma(\mathcal{P})$ for some $\sigma \in \text{Gal}(L/K)$. Since the group is abelian, we find
\[
\left(\frac{L/K}{\mathcal{P}'}\right) = \left(\frac{L/K}{\sigma(\mathcal{P})}\right) = \sigma\left(\frac{L/K}{\mathcal{P}}\right)\sigma^{-1} = \left(\frac{L/K}{\mathcal{P}}\right).
\]
\textbf{Notation.} If $L/K$ is abelian, we also write $\left(\frac{L/K}{\mathfrak{p}}\right)$ for the Artin symbol for any $\mathcal{P} \mid \mathfrak{p}$. So for $L/K$ abelian, the Artin symbol defines a map 
\begin{align*}
    \{\text{unramified primes }\mathfrak{p} \subset \mathcal{O}_K \text{ in }L\} &\to \text{Gal}(L/K) \\
    \mathfrak{p} &\mapsto \left(\frac{L/K}{\mathfrak{p}}\right).
\end{align*}
We want to extend this map, for which we introduce fractional ideals. Quick review: recall that a \textbf{fractional ideal} of a number field $K$ is a $\mathcal{O}_K$--submodule $\mathfrak{a}$ of $K$ such that there exists $0 \neq x \in \mathcal{O}_K$ such that $x \mathfrak{a} \subset \mathcal{O}_K$. Equivalently, it is a set of the form $\alpha I$ for $\alpha \in K$ and some ideal $I$ of $\mathcal{O}_K$.
\vspace{1mm}
 
A principal fractional ideal is a $\mathcal{O}_K$--submodule generated by a single nonzero element of $K$. Since $\mathcal{O}_K$ is a Dedekind domain, each fractional ideal is invertible and we obtain a group with identity $\mathcal{O}_K$.
\vspace{1mm}
 
\textbf{Notation.} Write $I_K$ for the group of fractional ideals and $P_K$ for the subgroup of principal fractional ideals. The quotient $I_K/P_K$ is called the \textbf{ideal class group} $\text{Cl}(K)$, which is a finite abelian group with order $h_K$ called the \textbf{class number} of $K$.
\vspace{1mm}
 
Recall that for any $\mathfrak{a} \in I_K$, we have unique factorization \[
\mathfrak{a} = \prod_{i=1}^{n} \mathfrak{p}_i^{r_i}, r_i \in \mathbb{Z}
\]
with $\mathfrak{p}_i$ distinct prime ideals in $\mathcal{O}_K$.

\begin{defn}
    Suppose $L/K$ is an abelian unramified extension (i.e. every prime in $K$ is unramified in $L$). Then we define the \textbf{Artin map} to be the homomorphism \[
    \left(\frac{L/K}{\cdot }\right) : I_K \to \text{Gal}(L/K)
    \]
    by setting $\left(\frac{L/K}{\mathfrak{a}}\right) = \prod_{i=1}^{n} \left(\frac{L/K}{\mathfrak{p}_i}\right)^{r_i}$.
\end{defn}
To define this more generally, we need to define \textbf{moduli}.
\vspace{1mm}
 
\textbf{Interlude.} Finite and infinite primes. Let $K$ be a number field. Then a prime ideal is also called a finite prime to distinguish it from infinite primes. Infinite primes are determined by the embeddings of $K$ into $\mathbb{C}$. These correspond to archimedean absolute values (from local fields).
\vspace{1mm}
 
A real infinite prime is an embedding $\sigma: K \to \mathbb{R}$ and a complex infinite prime is a pair of conjugate embeddings $\sigma, \overline{\sigma}: K \to \mathbb{C}$ with $\sigma \neq \overline{\sigma}$. 
\begin{example}
    \begin{itemize}
        \item $\mathbb{Q}$ has one infinite real prime $\sigma\left(\frac{a}{b}\right) = \frac{a}{b}$.
        \item $\mathbb{Q}(\sqrt{2})$ has two infinite real primes $\sigma_1(\sqrt{2}) =\sqrt{2}$ and $\sigma_2(\sqrt{2}) = -\sqrt{2}$.
        \item $\mathbb{Q}(\sqrt{-2})$ has one infinite complex prime determined by $\sigma(\sqrt{-2})=\sqrt{-2}$, $\overline{\sigma}(\sqrt{-2})=-\sqrt{-2}$.
    \end{itemize}
\end{example}
\textbf{Remark.} If we have an extension $L/K$, then an infinite prime $\sigma$ of $K$ \textbf{ramifies} in $L$ is $\sigma$ is real, but has an extension to $L$ which is complex.
\begin{example}
    The infinite prime of $\mathbb{Q}$ is unramified in $\mathbb{Q}(\sqrt{2})$, but it is ramified in $\mathbb{Q}(\sqrt{-2})$.
\end{example}
\begin{defn}
    Let $K$ be a number field. Then a \textbf{modulus} in $K$ is a formal product \[
        \mathfrak{m} = \prod_{\mathfrak{p}}^{} \mathfrak{p}^{n_{\mathfrak{p}}}
    \]
    over all primes $\mathfrak{p}$, finite or infinite, of $K$, such that
    \begin{enumerate}[(i)]
        \item $n_{\mathfrak{p}}\ge 0$, and at most finitely many of these are nonzero.
        \item $n_{\mathfrak{p}} = 0$ for $\mathfrak{p}$ infinite complex primes.
        \item $n_{\mathfrak{p}} \le 1$ for $\mathfrak{p}$ infinite real primes.
    \end{enumerate}
    If $n_{\mathfrak{p}} = 0$ for all $\mathfrak{p}$, set $\mathfrak{m} = 1$.
\end{defn}
Note that if $K$ is a purely imaginary field (i.e. it has no real primes), then a modulus of $K$ is just an ideal of $\mathcal{O}_K$. We can write any modulus $\mathfrak{m}$ as a product $\mathfrak{m} = \mathfrak{m}_0 \mathfrak{m}_{\infty}$, where $\mathfrak{m}_0$ is an ideal of $\mathcal{O}_K$ and $\mathfrak{m}_{\infty}$ is a product of distinct real infinite primes. 

\marginpar{24 Jan 2024, Lecture 3}

Recall we write $v_{\mathfrak{p}_i}(\mathfrak{a}) = r_i$. We now extend this map using moduli.

\begin{defn}
    Let $\mathfrak{m}$ be a modulus. Define $I_K(\mathfrak{m})$ to be the group of fractional ideals coprime to $\mathfrak{m}$, where $\mathfrak{a} \in I_K$ is coprime to $\mathfrak{m}$ if $v_{\mathfrak{p}}(\mathfrak{a})=0$ for all primes $\mathfrak{p} \mid \mathfrak{m}_0$.
\end{defn}
Non--infinite primes play no role in this definition, i.e. $I_K(\mathfrak{m}) = I_K(\mathfrak{m}_0)$. 
\begin{example}
    \begin{itemize}
        \item Let $\mathfrak{m} = (1)$, then $I_K(\mathfrak{m}) = I_K$.
        \item Let $K = \mathbb{Q}$ and $\mathfrak{m} = (m)$ for $m$ a positive integer. Then $I_{\mathbb{Q}}(\mathfrak{m}) = \{\left(\frac{a}{b}\right)\mathbb{Z} \mid (a,m)=(b,m)=1\}$.
    \end{itemize}
\end{example}
Now let $L/K$ be abelian, not necessarily unramified.
\begin{defn}
    Let $\mathfrak{m}$ be a modulus of $K$ divisible by all prime ideals that ramify in $L$. The Artin map for $L/K$ and $\mathfrak{m}$ is a homomorphism \[
    \Phi_{\mathfrak{m}} = \Phi_{L/K, \mathfrak{m}} : I_K(\mathfrak{m}) \to \text{Gal}(L/K)
    \]
    given by $\mathfrak{a} \mapsto \left(\frac{L/K}{\mathfrak{a}}\right)$.
\end{defn}
\begin{example}
    Let $\mathfrak{m}$ be a positive integer and $\zeta_m$ a primitive $m^{\text{th}}$ root of unity. Let $K=\mathbb{Q}$ and $L = \mathbb{Q}(\zeta_m)$. Recall that $\text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q}) \cong (\mathbb{Z}/m\mathbb{Z})^\times$ given by $\{\sigma: \zeta_m \mapsto \zeta_m^a\} \mapsto [a]$. Also, if a prime $p$ ramifies in $\mathbb{Q}(\zeta_m)$, then $p \mid m$.
    \vspace{1mm}
     
    Hence let $\mathfrak{m} = (m)$, which contains all ramified prime ideals. We have a well--defined map $\Phi_{\mathfrak{m}} : I_{\mathbb{Q}}(\mathfrak{m}) \to \text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q}) \cong (\mathbb{Z}/m\mathbb{Z})^\times$.
    \vspace{1mm}
     
    Let $\left(\frac{a}{b}\right)\mathbb{Z} \in I_\mathbb{Q}(\mathfrak{m})$ with $\frac{a}{b}>0$, then \[
    \Phi_{\mathfrak{m}} \left( \left(\frac{a}{b}\right)\mathbb{Z}\right) = [a][b]^{-1} \in (\mathbb{Z}/m\mathbb{Z})^\times.
    \]
\end{example}
Exercises: verify this above claim, show that (here?) the Artin map is surjective and work out its kernel.

\begin{defn}
    Let $P_K(\mathfrak{m})$ be the subgroup of $I_K(\mathfrak{m})$ \underline{generated} by 
    \[
        \{(\alpha) \mid \alpha \in \mathcal{O}_K, \alpha \equiv 1 \text{ (mod }\mathfrak{m}_0), \sigma(\alpha)>0 \text{ for all real primes }\sigma \mid \mathfrak{m}_{\infty}\}.
    \]
    Note $\alpha \equiv 1 \pmod{\mathfrak{m}_0}$ can also be written as $v_{\mathfrak{p}}(\alpha-1) \ge v_{\mathfrak{p}}(\mathfrak{m}_0)$ (here $v_{\mathfrak{p}}(\alpha) = v_{\mathfrak{p}}(\alpha \mathcal{O}_K)$). This is called the \textbf{ray} or \textbf{ray group} for $\mathfrak{m}$.
\end{defn}
\textbf{Remark.} Definitions in the literature might differ a bit, but we use the one above.
\begin{example}
    Let $K = \mathbb{Q}, L = \mathbb{Q}(\zeta_m)$. Suppose $\mathfrak{m} = (m)$, then $P_{\mathbb{Q}}(\mathfrak{m}) = \{\left(\frac{a}{b}\right)\mathbb{Z} \in I_{\mathbb{Q}}(\mathfrak{m}) \mid a \equiv b \pmod{m}\}$. Note $I_{\mathbb{Q}}(\mathfrak{m}) = I_{\mathbb{Q}}(\mathfrak{m}_0)$, which is not true for $P_\mathbb{Q}(\mathfrak{m})$!
    \vspace{1mm}
     
    Now suppose $\mathfrak{m} = (m)\infty$ -- the infinite prime of $\mathbb{Q}$. Then \[
    P_\mathbb{Q}(\mathfrak{m}) = \left\{\left(\frac{a}{b}\right)\mathbb{Z} \in I_\mathbb{Q}(\mathfrak{m}) \mid a \equiv b\pmod{m}, \frac{a}{b}>0\right\}.
    \]
    We have $I_{\mathbb{Q}}((m))/P_\mathbb{Q}((m)) \cong (\mathbb{Z}/m\mathbb{Z})^\times/\{\pm 1\}$ and $I_\mathbb{Q}((m)\infty)/P_\mathbb{Q}((m)\infty) \cong (\mathbb{Z}/m\mathbb{Z})^\times$. 
\end{example}
In general, $P_K(\mathfrak{m})$ has finite index in $I_K(\mathfrak{m})$.
\begin{defn}
    The quotient $I_K(\mathfrak{m})/P_K(\mathfrak{m})$ is called the \textbf{ray class group}.
\end{defn}
Our goal is to show that this is a finite group. Recall by Ostrowski's theorem that every nontrivial absolute value is equivalent to either $|\cdot|_{\mathfrak{p}}$ for some prime ideal $\mathfrak{p}$ of $\mathcal{O}_K$ or $|\cdot|_{\sigma}$ for some embedding $\sigma : K \to \mathbb{C}$, where $|\cdot|_{\sigma} = |x|_{\mathbb{C}}$ with $|\cdot|_{\mathbb{C}}$ the complex absolute value; and $|x|_{\mathfrak{p}} = C^{v_\mathfrak{p}(x)}$ for $x \neq 0$ for some $0<C<1$ (often $C =\frac{1}{p}$) and $0$ for $0$. (Recall $v_{\mathfrak{p}}(x) = \alpha$ if $x \mathcal{O}_K = \mathfrak{p}^\alpha \mathfrak{p}_1^{\alpha_1}\ldots \mathfrak{p}_r^{\alpha_r}$.)

\vspace{1mm}
 
We quote a result proved in Local Fields:
\begin{theorem}[Approximation theorem]
    Let $|\cdot|_1,\ldots,|\cdot|_n$ be nontrivial pairwise inequivalent absolute values on $K$. Let $\beta_1,\ldots,\beta_n \in K$ be nonzero. Then for any $\epsilon>0$, there exists $\alpha \in K$ such that $|\alpha-\beta_j|_j <\epsilon$ for each $j = 1,\ldots,n$.
\end{theorem}
\textbf{Consequences.} 
\begin{itemize}
    \item Let $\mathfrak{p}$ be a real infinite prime corresponding to $\sigma : K \to \mathbb{R}$. If $\alpha \beta \neq 0$ and $|\alpha-\beta|_{\mathfrak{p}}<\epsilon$, then $\sigma \left(\frac{\alpha}{\beta}\right) > 0$.
    \item Let $\mathfrak{p}$ be a finite prime. Then $|\alpha-\beta|_{\mathfrak{p}}<\epsilon$ is equivalent to $\left|\frac{\alpha}{\beta}-1 \right|_{\mathfrak{p}} < \frac{\epsilon}{|\beta|_{\mathfrak{p}}}$. Let $\epsilon' = \frac{\epsilon'}{|\beta|_{\mathfrak{p}}}$. If $\epsilon'$ is small, say $\epsilon' < C^n$ for some $n$, then $v_{\mathfrak{p}}\left(\frac{\alpha}{\beta}-1\right) > n$ and so $\alpha \equiv  \beta \pmod{\mathfrak{p}^n}$.
\end{itemize}
\textbf{Remark/Exercise.} Let $I$ be an ideal of $\mathcal{O}_K$, then every class in $\text{Cl}(K)$ has a representative which is coprime to $I$.
\begin{defn}
    Let $P_{\mathfrak{m}} \subset I_K(\mathfrak{m})$ be the subgroup of principal fractional ideals which are coprime to $\mathfrak{m}$.
\end{defn}
\begin{prop}\label{prop1.5}
    Let $P_{\mathfrak{m}} \subset I_K(\mathfrak{m})$ be as above. Then we have two exact sequences
    \begin{align*}
        1 \to P_{\mathfrak{m}} \to &I_K(\mathfrak{m}) \to \text{Cl}(K) \to 1\\
        1 \to P_{\mathfrak{m}}/P_K(\mathfrak{m}) \to &I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to \text{Cl}(K) \to 1.
    \end{align*}
\end{prop}
\begin{proof}
    Let $\mathfrak{a} \in I_K(\mathfrak{m})$ and define $f: I_K(\mathfrak{m}) \to \text{Cl}(K)$ by $\mathfrak{a}\mapsto [a]$. This is a group homomorphism, it is surjective by the previous remark with kernel $P_{\mathfrak{m}}$, so $1 \to P_{\mathfrak{m}} \to I_K(\mathfrak{m}) \to \text{Cl}(K) \to 1$. The second sequence follows immediately because $f$ is trivial on $P_K(\mathfrak{m})$.
\end{proof}

\marginpar{26 Jan 2024, Lecture 4}

\begin{defn}
    For $\mathfrak{m}$ a modulus, let 
    \begin{align*}
        &K_{\mathfrak{m}} = \{\alpha \in K^\times \mid (\alpha) \in I_K(\mathfrak{m})\}\\
        &K_{\mathfrak{m},1} = \{\alpha \in K^\times \mid  \alpha \equiv 1 \pmod{\mathfrak{m}_0}, \sigma(\alpha)>0 ~\forall \sigma \mid \mathfrak{m}_\infty\}.
    \end{align*}
\end{defn}
Note $P_k(\mathfrak{m}) = \{(\alpha) \in I_K(\mathfrak{m}) \mid  \alpha \in K_{\mathfrak{m},1}\}$.

\begin{theorem}
    The ray class group $I_K(\mathfrak{m})/P_K(\mathfrak{m})$ is a finite group with size \[
    h_K(\mathfrak{m}) = |I_K(\mathfrak{m})/P_K(\mathfrak{m})| = \frac{h_K \cdot \phi(\mathfrak{m})}{[\mathcal{O}_K^\times : (\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})]},
    \]
    where $h_K$ is the class number of $K$ and $\phi(\mathfrak{m}) = \phi(\mathfrak{m}_0)\phi(\mathfrak{m}_{\infty})$ with $\phi(\mathfrak{m}_0) = |(\mathcal{O}_K/\mathfrak{m}_0)^\times| = N(\mathfrak{m}_0) \cdot \prod_{\mathfrak{p} \mid \mathfrak{m}_0}^{} (1-N(\mathfrak{p}^{-1}))$ and $\phi(\mathfrak{m}_{\infty}) = 2^{\# \mathfrak{m}_{\infty}}$ where $\# \mathfrak{m}_{\infty}$ is the number of infinite real primes dividing $\mathfrak{m}$.
\end{theorem}
\begin{proof}
    \textbf{Step 1.} $P_{\mathfrak{m}}/P_K(\mathfrak{m}) \cong K_{\mathfrak{m}}/\mathcal{O}_K^\times K_{\mathfrak{m},1}$.
    \begin{proof}[Proof of Step 1]
        Consider $K_{\mathfrak{m}} \to P_{\mathfrak{m}}/P_K(\mathfrak{m})$ by $\alpha \mapsto (\alpha)P_K(\mathfrak{m})$. This is a surjective homomorphism with kernel 
        \begin{align*}
            &\{\alpha \in K_{\mathfrak{m}}\mid  (\alpha) \in P_K(\mathfrak{m})\} \\
            =& \{\alpha \in K_{\mathfrak{m}} \mid \exists \beta \in K_{\mathfrak{m},1} \text{ s.t. }(\alpha)=(\beta)\} \\
            =& \{\alpha \in K_{\mathfrak{m}} \mid \exists \beta \in K_{\mathfrak{m},1} \text{ s.t. }\beta = \alpha\cdot \epsilon \text{ for some }\epsilon \in \mathcal{O}_K^\times\}.
        \end{align*}
    \end{proof}
    \textbf{Step 2.} $K_{\mathfrak{m}}/K_{\mathfrak{m},1} \cong \{\pm 1\}^{\# \mathfrak{m}_{\infty}} \times (\mathcal{O}_K/\mathfrak{m}_0)^\times$.
    \begin{proof}[Proof of Step 2]
        We can write $\alpha \in K_{\mathfrak{m}}$ as $\alpha = \frac{a}{b}$ for $a,b \in \mathcal{O}_K$ coprime, and $(a)$, $(b)$ coprime to $\mathfrak{m}_0$. For such $a,b$, the images $\overline{a},\overline{b} \in \mathcal{O}_K/\mathfrak{m}_0$ lie in $(\mathcal{O}_K/\mathfrak{m}_0)^\times$. Consider the map 
        \begin{align*}
            K_{\mathfrak{m}} &\to \left( \prod_{\sigma \mid \mathfrak{m}_{\infty}}^{} \{\pm 1\}\right) \times (\mathcal{O}_K/\mathfrak{m}_0)^\times\\
            \alpha &\mapsto \left(\prod_{\sigma \mid \mathfrak{m}_{\infty}}^{} \text{sgn}(\sigma(\alpha)) \right) \times \overline{\alpha}
        \end{align*}
        for $\overline{\alpha} = \overline{a} \overline{b}^{-1} \in (\mathcal{O}_K/\mathfrak{m}_0)^\times$. This map is surjective: this is an exercise, use the Approximation Theorem. It has kernel 
        \begin{align*}
            \{\alpha \in K_{\mathfrak{m}}\mid \sigma(\alpha) > 0 ~\forall \sigma \mid \mathfrak{m}_{\infty}, ~\alpha \equiv 1 \text{ (mod }\mathfrak{m}_0)\} = K_{\mathfrak{m},1}.
        \end{align*}
    \end{proof}
    \textbf{Step 3.} $\mathcal{O}_K^\times K_{\mathfrak{m},1}/K_{\mathfrak{m},1} \cong \mathcal{O}_K^\times/(\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})$.
    \begin{proof}[Proof of Step 3.]
        This is just the second isomorphism theorem.
    \end{proof}
    \vspace{1mm}
     
    Putting it all together:
    \begin{align*}
        [I_K(\mathfrak{m}):P_K(\mathfrak{m})] = [I_K(\mathfrak{m}):P_{\mathfrak{m}}][P_{\mathfrak{m}}:P_K(\mathfrak{m})]
    \end{align*}
    and \begin{align*}
        (P_\mathfrak{m}/P_K(\mathfrak{m})) &\stackrel{\text{(i)}}{\cong}  K_{\mathfrak{m}}/\mathcal{O}_K^\times K_{\mathfrak{m},1} \\
        &\cong (K_{\mathfrak{m}}/K_{\mathfrak{m},1})/(\mathcal{O}_K^\times K_{\mathfrak{m},1}/K_{\mathfrak{m},1}) \\
        &\stackrel{\text{(iii)}}{\cong}  (K_{\mathfrak{m}}/K_{\mathfrak{m},1})/(\mathcal{O}_K^\times/(\mathcal{O}_K^\times \cap K_{\mathfrak{m},1}))
    \end{align*}
    and \begin{align*}
        I_K(\mathfrak{m})/P_\mathfrak{m} \cong \text{Cl}(K)
    \end{align*}
    by Proposition \ref{prop1.5}.
    \vspace{1mm}
     
    This gives 
    \begin{align*}
        &[I_K(\mathfrak{m}) : P_K(\mathfrak{m})] = [I_K(\mathfrak{m}) : P_{\mathfrak{m}}][P_\mathfrak{m} : P_K(\mathfrak{m})] \\
        =& |\text{Cl}(K)| \frac{[K_{\mathfrak{m}}:K_{\mathfrak{m},1}]}{[\mathcal{O}_K: (\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})]} \stackrel{\text{(ii)}}{=}  \frac{h_K \cdot \phi(\mathfrak{\mathfrak{m}})}{[\mathcal{O}_K : (\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})]}.
    \end{align*}
\end{proof}
Next we have more general class groups, i.e. $I_K(\mathfrak{m})/H$ with $P_K(\mathfrak{m}) \subset H$.
\begin{defn}
    A subgroup $H \subset I_K(\mathfrak{m})$ is a \textbf{congruence subgroup} for $\mathfrak{m}$ if it satisfies $P_k(\mathfrak{m}) \subset  H \subset I_K(\mathfrak{m})$.
\end{defn}
Motivation: For ''suitably chosen'' moduli $\mathfrak{m}$, the congruence subgroup will be the kernel of the Artin map $\Phi_{\mathfrak{m}}$.

\begin{defn}
    Let $H$ be a congruence subgroup for $\mathfrak{m}$, then the quotient $I_K(\mathfrak{m})/H$ is called a \textbf{generalized ideal class group} for $\mathfrak{m}$.
\end{defn}
\textbf{Remark.} Recall that for $K=\mathbb{Q}$ and $\mathfrak{m}=(m)\infty$ for $m$ a positive integer, we saw $I_K(\mathfrak{m})/P_K(\mathfrak{m}) \cong (\mathbb{Z}/m\mathbb{Z})^\times$ and \[
(\mathbb{Z}/m\mathbb{Z})^\times \cong \text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q}) \cong I_K(\mathfrak{m})/P_K(\mathfrak{m})
\]
via the Artin map, so $\text{ker}(\Phi_{\mathbb{Q}(\zeta_m)/\mathbb{Q},\mathfrak{m}}) = P_K(\mathfrak{m})$.
\vspace{1mm}
 
The idea of class field theory is that generalized ideal class groups are Galois groups of abelian extensions and that the link between them is given by the Artin map. We will prove that the Artin map is surjective. Determining the kernel is a lot more difficult (not done in this course).
\vspace{1mm}
 
What is the meaning of ''suitably chosen'' above? For $L/K$ abelian, we want to know for which moduli $\mathfrak{m}$ will $\text{ker}(\Phi_\mathfrak{m})$ be a congruence subgroup.
\begin{lemma}\label{lemma1.7}
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus divisible by all ramified primes. If $\mathfrak{n}$ is another modulus such that $\mathfrak{m} \mid \mathfrak{n}$, then \[
    P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{\mathfrak{m}}) \implies P_K(\mathfrak{n}) \subset  \text{ker}(\Phi_{\mathfrak{n}}).
    \]
\end{lemma}
\begin{proof}
    Note first that if $\mathfrak{m} \mid \mathfrak{n}$, then $I_K(\mathfrak{n}) \subset I_K(\mathfrak{m})$, so $\Phi_\mathfrak{n} : I_K(\mathfrak{n}) \to \text{Gal}(L/K)$ is well--defined and $\Phi_{\mathfrak{n}} = \Phi_{\mathfrak{m}}|_{I_K(\mathfrak{m})}$, so $\text{ker}(\Phi_{\mathfrak{n}}) = \text{ker}(\Phi_{\mathfrak{m}}) \cap I_K(\mathfrak{n})$. If $\mathfrak{m} \mid \mathfrak{n}$, then $P_K(\mathfrak{n}) \subset P_K(\mathfrak{m})$. Now $P_K(\mathfrak{n}) \subset P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{\mathfrak{m}})$, so \[
        (\alpha) \in P_K(\mathfrak{n}) \subset P_K(\mathfrak{m}) \cap I_K(\mathfrak{n}) \subset \text{ker}(\Phi_{\mathfrak{m}}) \cap I_K(\mathfrak{n}) = \text{ker}(\Phi_{\mathfrak{n}}).
    \]
\end{proof}
In the above situation, if $\text{ker}(\Phi_{\mathfrak{m}})$ is a congruence subgroup for $\mathfrak{m}$, then $\text{ker}(\Phi_{\mathfrak{n}})$ is a congruence subgroup for $\mathfrak{n}$.
\vspace{1mm}
 
Now we find a special modulus that works for each extension, called \textbf{the conductor}. 

\marginpar{29 Jan 2024, Lecture 5}

\textbf{Statements of global class field theory (ideal theoretic).} For $L/K$ abelian, we are interested to find out for which $m \subset \mathcal{O}_K$ is $\text{ker}(\Phi_{L/K,\mathfrak{m}})$ a congruence subgroup (i.e. $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K, \mathfrak{m}})$).
\begin{theorem}[The Conductor Theorem]
    Let $L/K$ be abelian. Then there is a modulus $\mathfrak{f}=\mathfrak{f}(L/K)$ such that 
    \begin{itemize}
        \item a prime of $K$, finite or infinite, ramifies in $L$ if and only if it divides $\mathfrak{f}_{L/K}$.
        \item If $\mathfrak{m}$ is divisible by all primes that ramify, then $\text{ker}(\Phi_{L/K, \mathfrak{m}})$ is a congruence subgroup for $\mathfrak{m}$ if and only if $\mathfrak{f}_{L/K} \mid \mathfrak{m}$.
    \end{itemize}
\end{theorem}
\begin{defn}
    The modulus $\mathfrak{f}_{L/K}$ is uniquely determined by $L/K$ and called the \textbf{conductor}.
\end{defn}
\begin{example}
    Let $K=\mathbb{Q}$ and let $L = \mathbb{Q}(\sqrt{N})$ for $N \neq 0,1$ squarefree. Then $\mathfrak{f}_{L/K} = \begin{cases}
        \left|d_{L/K} \right| & N>0\\
        \left|d_{L/K} \right|{\infty} & N<0.
    \end{cases}$ ($\left|D_{L/K}\right|{\infty}$ is the real infinite place of $\mathbb{Q}$).
\end{example}
\textbf{Remark.} The conductor is not just the product of ramified primes. In Ex. Sheet 1, there will be a cubic extension $L/\mathbb{Q}$ which is ramified only at 3. However, for $\mathfrak{m} = (3)$ or $\mathfrak{m} = (3)\infty$, $\text{ker}(\Phi_{L/\mathbb{Q},\mathfrak{m}})$ is not a congruence subgroup, so $\mathfrak{f}_{L/Q}\nmid (3)$ and $\mathfrak{f}_{L/\mathbb{Q}}\nmid (3)\infty$.
\vspace{1mm}
 
Next we focus on the kernel. Recall that if $\mathcal{P} \subset \mathcal{O}_L$ is a prime ideal, then we have $N_{L/K}(\mathcal{P}) = \mathfrak{p}^{f_{\mathcal{P}/\mathfrak{p}}}$ if $\mathfrak{p} = \mathcal{P} \cap \mathcal{O}_K$.
\vspace{1mm}
 
\textbf{Notation.} Let $N_{L/K}: I_K \to I_K$ be the norm map, given by $\mathfrak{a} \mapsto N_{L/K}(\mathfrak{a})$. If $\mathfrak{a} =\prod_{i=1}^{n} \mathcal{P}_i^{r_i}$, then $N_{L/K}(\mathfrak{a}) = \prod_{i=1}^{n} (N(\mathcal{P}_i)^{r_i}) = \prod_{i=1}^{n} (\mathfrak{p}_i^{f_{\mathcal{P}_i/\mathfrak{p}_i}})^{r_i}$.
\begin{defn}
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus of $K$ divisible by $\mathfrak{f}(L/K)$. Then the \textbf{norm group} (also called a Tahagi group) is the congruence subgroup
    \[
    T_{L/K}(\mathfrak{m}) = P_K(\mathfrak{m})N_{L/K}(I_L(\mathfrak{m})),
    \]
    where $I_L(\mathfrak{m})$ is the subgroup of $I_L$ with elements fractional ideals that are coprime to $\mathfrak{m}\mathcal{O}_L$.
\end{defn}
\begin{theorem}[Artin Reciprocity Theorem]
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus of $K$ divisible by all ramified primes (both finite and infinite). Then the Artin map $\Phi_{L/K,\mathfrak{m}}(I_K(\mathfrak{m})) \to \text{Gal}(L/K)$ is surjective.
    \vspace{1mm}
     
    If also $\mathfrak{f}_{L/K} \mid \mathfrak{m}$, so that $\text{ker}(\Phi_{\mathfrak{m}})$ is a congruence subgroup, then $\text{ker}(\Phi_{L/K,\mathfrak{m}}) = T_{L/K}(\mathfrak{m})$ and the Artin map defines an isomorphism \[
    I_K(\mathfrak{m})/T_{L/K}(\mathfrak{m}) \cong \text{Gal}(L/K).
    \]
    So $\text{Gal}(L/K)$ is the generalized ideal class group for $\mathfrak{m}$. 
\end{theorem}
Artin reciprocity gives us information about the decomposition of primes:
\begin{theorem}[Decomposition law]
    Let $L/K$ be abelian of degree $n$ and let $\mathfrak{p} \subset \mathcal{O}_K$ be an unramified prime ideal. Let $\mathfrak{m}$ be divisible by $\mathfrak{f}(L/K)$, but not by $\mathfrak{p}$. Let $H = \text{ker}(\Phi_{\mathfrak{m}})$ be the congruence subgroup for $\mathfrak{m}$. Let $f$ be the smallest positive integer such that $\mathfrak{p}^{f} \in H$, i.e. $f$ is the order of $\mathfrak{p}$ mod $H$ in $I_K(\mathfrak{m})/H$. Then $\mathfrak{p}$ decomposes in $L$ into a product $$\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1 \ldots \mathcal{P}_g$$ for $g = \frac{n}{f}$ of distinct prime ideals of degree $f$ over $\mathfrak{p}$.
\end{theorem}
\begin{proof}
    Let $\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1\ldots\mathcal{P}_g$ be the prime decomposition in $L$. These have to be distinct as $\mathfrak{p}$ is unramified, and all $\mathcal{P}_i$ have the same residue field degree $f_{\mathcal{P}_i/\mathfrak{p}}$ (as the extension is abelian, in particular Galois). We know that $f_{\mathcal{P}_i/\mathfrak{p}}$ is the order of $\left(\frac{L/K}{\mathfrak{p}}\right)$ and so under the isomorphism $I_K(\mathfrak{m})/H \cong \text{Gal}(L/K)$, this means it is also the order of $\mathfrak{p}$ mod $H$ in $I_K(\mathfrak{m})/H$. The result follows since $[L:K] = n = efg = fg$.
\end{proof}
Next we want to show that every generalized ideal class group is the Galois group of some abelian extension and that this extension is unique.
\begin{theorem}[The Existence Theorem]
    Let $\mathfrak{m}$ be a modulus of $f$ and let $H$ be a congruence subgroup for $\mathfrak{m}$. Then there exists a unique abelian extension $L/K$ with the following properties:
    \begin{itemize}
        \item All its ramified primes, finite or infinite, divide $\mathfrak{m}$.
        \item $H = T_{L/K}(\mathfrak{m})$.
        \item $I_K(\mathfrak{m})/H \cong \text{Gal}(L/K)$ under the Artin map $\Phi_{L/K,\mathfrak{m}}$.
    \end{itemize}
\end{theorem}
So for any number field $K$, we can find abelian extensions with specified ramification.
\begin{defn}
    Let $\mathfrak{m}$ be any modulus and let $H = P_K(\mathfrak{m})$. The \textbf{ray class field} is the unique abelian extension $K(\mathfrak{m})$ of $K$ such that $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K(\mathfrak{m})/K, \mathfrak{m}})$. This explains the name $\text{Gal}(K(\mathfrak{m})/K) \cong I_K(\mathfrak{m})/P_K(\mathfrak{m})$.
\end{defn}
\begin{example}
    Let $K=\mathbb{Q}$ and let $\mathfrak{m} = (m)\infty$ for $m$ odd or divisible by 4. Then $\mathbb{Q}(\mathfrak{m}) = \mathbb{Q}(\zeta_m)$. Taking $\mathfrak{m} = (m)$ instead gives $\mathbb{Q}(\mathfrak{m}) = \mathbb{Q}(\zeta_m + \zeta_m^{-1})$.
\end{example}
Next we want to show that every abelian extension is contained in a ray class field.
\marginpar{31 Jan 2024, Lecture 6}
In other words, given $K, \mathfrak{m}$, there is a unique abelian extension $K(\mathfrak{m})/K$ such that $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K(\mathfrak{m})/K,\mathfrak{m}})$.

\begin{prop}\label{prop1.12}
    Let $K\le L\le M$ be a tower of abelian extensions. Suppose $\mathfrak{m}$ contains all prime ideals $\mathfrak{p} \subset \mathcal{O}_K$ that ramify in $M$. Write $\text{res}: \text{Gal}(M/K) \to \text{Gal}(L/K)$ for the restriction map $\sigma \mapsto \sigma_L$. Then we have a commutative diagram $\begin{tikzcd}[]
        I_K(\mathfrak{m}) & \text{Gal}(M/K)\\
         & \text{Gal}(L/K)
        \arrow["\Phi_{M/K,\mathfrak{m}}", from=1-1, to=1-2]
        \arrow["\text{res}", from=1-2, to=2-2]
        \arrow["\Phi_{L/K,\mathfrak{m}}", from=1-1, to=2-2]
    \end{tikzcd}$. 
\end{prop}
\begin{proof}
    Exercise on Example Sheet 1.
\end{proof}
\begin{lemma}\label{lemma1.13}
    Let $L/K$ and $M/K$ be abelian extensions. Then $ L \subset M$ if and only if there is a modulus $\mathfrak{m}$ divisible by all primes of $K$ which ramify in either $L$ or $M$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K},\mathfrak{m}) \subset \text{ker}(\Phi_{L/K},\mathfrak{m})$.
\end{lemma}
\begin{proof}
    Suppose $L \subset M$. Then by Artin reciprocity, there exists $\mathfrak{m}_1$ for $L/K$ and $\mathfrak{m}_2$ for $M/K$ such that $P_K(\mathfrak{m_1}) \subset \text{ker}(\Phi_{L/K},\mathfrak{m}_1)$ and $P_K(\mathfrak{m}_2) \subset \text{ker}(\Phi_{M/K,\mathfrak{m}_2})$. By Lemma \ref{lemma1.7}, we can find $\mathfrak{m}$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$ and $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K,\mathfrak{m}})$. By Proposition \ref{prop1.12}, we have $\text{res} \circ \Phi_{M/K,\mathfrak{m}} = \Phi_{L/K,\mathfrak{m}}$, so $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K}, \mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$.
    \vspace{1mm}
     
    Now suppose we have $\mathfrak{m}$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K}, \mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$. Then we get that under the map $\Phi_{M/K,\mathfrak{m}} : I_K(\mathfrak{m}) \to \text{Gal}(M/K)$, the subgroup $\text{ker}(\Phi_{L/K,\mathfrak{m}}) \subset I_K(\mathfrak{m})$ maps to a subgroup $H \subset \text{Gal}(M/K)$. By Galois theory, $H$ corresponds to an intermediate field $K \subset \tilde{L} \subset M$. Now apply the first part of the proof to $\tilde{L}\subset M$ to obtain  $\text{ker}(\Phi_{L/K,\mathfrak{m}}) = \text{ker}(\Phi_{\tilde{L}/M,\mathfrak{m}})$. By uniqueness, in the Existence Theorem, $L = \tilde{L} \subset M$.
\end{proof}
\begin{cor}
    Let $K$ be a number field. Then any abelian extension is contained in a ray class field.
\end{cor}
\begin{proof}
    Suppose $L/K$ is abelian and let $\mathfrak{m}$ be a modulus of $K$ such that $\mathfrak{f}_{L/K} \mid  \mathfrak{m}$. Then $H = \text{ker}(\Phi_{L/K,\mathfrak{m}})$ is a congruence subgroup for $\mathfrak{m}$. So $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K(\mathfrak{m})/K,\mathfrak{m}}) \subset H = \text{ker}(\Phi_{L/K},\mathfrak{m})$. By Lemma \ref{lemma1.13}, $L \subset K(\mathfrak{m})$.
\end{proof}

Before stating the Classification Theorem, we define an equivalence relation on the set of congruence subgroups. Why? 
\begin{itemize}
    \item If $\text{ker}(\Phi_\mathfrak{m})$ is a congruence subgroup for $\mathfrak{m}$, then $\text{ker}(\Phi_{\mathfrak{n}})$ is a congruence subgroup for $\mathfrak{n}$ for any modulus $\mathfrak{m} \mid  \mathfrak{n}$.
    \item Say a prime $\mathfrak{p}$ is in the support of $\mathfrak{m}$ if $\mathfrak{p} \mid \mathfrak{m}$. If $\mathfrak{m}$ and $\mathfrak{n}$ have the same support, then $I_K(\mathfrak{m}) = I_K(\mathfrak{n})$, but $P_K(\mathfrak{m})$ may differ from $P_K(\mathfrak{n})$.
\end{itemize}
\begin{defn}
    We say two congruence subgroups $H_1$ and $H_2$ are equivalent, written $H_1 \sim H_2$ if there is a modulus $\mathfrak{m}$ such that $I_K(\mathfrak{m}) \cap H_1 = I_K(\mathfrak{m}) \cap H_2$.
\end{defn}
Let $L/K$ be abelian. Let $\mathfrak{m}$ be such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$ and let $\mathfrak{m}'$ be such that $P_K(\mathfrak{m}') \subset \text{ker}(\Phi_{L/K,\mathfrak{m}'})$. Then $\text{ker}(\Phi_{L/K,\mathfrak{m}}) \sim \text{ker}(\Phi_{L/K,\mathfrak{m}'})$ because $$\text{ker}(\Phi_{L/K,\mathfrak{m}}) \cap I_K(\mathfrak{m}\mathfrak{m}') = \text{ker}(\Phi_{L/K},\mathfrak{m}\mathfrak{m}') = \text{ker}(\Phi_{L/K,\mathfrak{m}'}) \cap I_K(\mathfrak{m}\mathfrak{m}').$$ 
The collection of congruence subgroups $H$ for $\mathfrak{m}$ with $\mathfrak{m}$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$ lie in a single equivalence class of congruence subgroups. We write $H(L/K)$ for this class.

\begin{theorem}[The Classification Theorem]
    Let $K$ be a number field. Then there is a one--to--one inclusion--reversing correspondence 
    \begin{align*}
        \{\text{abelian extensions }L/K\} &\leftrightarrow \{\text{congruence subgroups}/\sim\}\\
        L/K &\mapsto H(L/K).
    \end{align*}
\end{theorem}
\textbf{''Applications'' of main theorems.}
\vspace{1mm}
 
\begin{theorem}[Kronecker--Weber theorem]
    Let $L/\mathbb{Q}$ be abelian. Then there is a positive integer $m$ such that $L \subset \mathbb{Q}(\zeta_m)$.
\end{theorem}
\begin{proof}
    By Artin reciprocity, there is a modulus $\mathfrak{m}$ satisfying the inclusions $P_{\mathbb{Q}}(\mathfrak{m}) \subset \text{ker}(\Phi_{L/\mathbb{Q}},\mathfrak{m}) \subset I_\mathbb{Q}(\mathfrak{m})$. Any modulus of $\mathbb{Q}$ will be $(m)$ or $(m)\infty$ for some $m$. By Lemma \ref{lemma1.7}, we may assume $\mathfrak{m} = (m)\infty$. We have $P_{\mathbb{Q}}(\mathfrak{m}) = \text{ker}(\Phi_{\mathbb{Q}(\zeta_m)/\mathbb{Q},\mathfrak{m}})$, so $P_{\mathbb{Q}}(\mathfrak{m}) = \text{ker}(\Phi_{\mathbb{Q}(\zeta_m)/\mathbb{Q},\mathfrak{m}}) \subset \text{ker}(\Phi_{L/\mathbb{Q},\mathfrak{m}})$. By Lemma \ref{lemma1.13}, we have $L \subset \mathbb{Q}(\zeta_m)$.
\end{proof}
\textbf{Remark.} There exist proofs of Kronecker--Weber that don't use class field theory (see e.g. \textit{Number Fields} by Marcus).
\vspace{1mm}
 
Hilbert Class Field: Given a number field $K$, by the Existence Theorem we can find an abelian extension and ''control'' the ramification. Now take $\mathfrak{m} = (1)$, then the corresponding abelian extension $K(\mathfrak{m})/K$ will be unramified at all primes (finite and infinite). We have $\Phi_{\mathfrak{m}}: I_K = I_K(1) \to \text{Gal}(K(1)/K)$ with kernel $P_K((1)) = P_K$, so we obtain $\text{Cl}(K) = I_K/P_K \cong \text{Gal}(K(1)/K)$. By the Existence Theorem, we obtain an unramified abelian extension with Galois group equal to the ideal class group. 
\begin{defn}
    The Hilbert class field $F$ is the ray class field for the modulus $\mathfrak{m}=(1)$.
\end{defn}
\begin{example}
    Let $K=\mathbb{Q}$. This is its own Hilbert class group (as $\text{Cl}(K)=1$).
\end{example}
\marginpar{02 Feb 2024, Lecture 7}
\begin{theorem}
    The Hilbert class field $F$ is the maximal unramified extension of $K$.
\end{theorem}
\begin{proof}
    Let $M$ be another unramified abelian extension. By the Conductor theorem, $\mathfrak{f}_{M/K} = (1)$. For $\mathfrak{m} = (1)$ we have $$P_K(\mathfrak{f}_{M/K}) = \underbrace{P_K(\mathfrak{m})}_{=\text{ker}(\Phi_{F/K,\mathfrak{m}})} \subset \text{ker}(\Phi_{M/K,\mathfrak{f}_{M/K}}).$$ By Lemma \ref{lemma1.13}, we have $M \subset F$.
\end{proof}
\begin{cor}
    Let $K$ be a number field. There is a one--to--one correspondence between unramified abelian expressions $M$ of $K$ and subgroups of the ideal class group $\text{Cl}(K)$. Furthermore, if $M/K$ corresponds to $H \subset \text{Cl}(K)$, then the Artin map induces an isomorphism 
    \begin{align*}
        \text{Cl}(K)/H \stackrel{\cong}{\to} \text{Gal}(M/K).
    \end{align*}
\end{cor}
\begin{proof}
    Let $F$ be the Hilbert class field at $K$. Then $\text{Gal}(F/K) \cong \text{Cl}(K)$. By Galois theory, there is a one-to-one inclusion-reversing correspondence between intermediate fields and subgroups of $\text{Gal}(F/K) \cong \text{Cl}(K)$. Since each unramified abelian extension is contained in $F$, the first part of the corollary follows.
    \vspace{1mm}
     
    Let $H$ be a subgroup of $\text{Gal}(F/K)$ and let \[
    M = F^H = \{x \in F \mid \sigma(x)=x ~\forall \sigma \in H\}.
    \]
    By Proposition \ref{prop1.12}, $\Phi_{M/K,\mathfrak{m}} : \text{Cl}(K) \to \text{Gal}(M/K)$ with $\Phi_{M/K,\mathfrak{m}} = \text{res} \circ \Phi_{F/K,\mathfrak{m}}$ and $\text{res}:\text{Gal}(F/K) \to \text{Gal}(M/K)$ by $\sigma \mapsto \sigma_M$. Now if $[a] \in H$, then $\Phi_{M/K,\mathfrak{m}}([a])=1$.
\end{proof}
\textbf{Fact.} Let $M_1/K$ and $M_2/K$ be extensions of number fields and $\mathfrak{p} \subset \mathcal{O}_K$ a prime ideal. If $\mathfrak{p}$ is unramified in both $M_1$ and $M_2$, then $\mathfrak{p}$ is unramified in the composite field $M_1M_2$.
\begin{example}
    Let $K = \mathbb{Q}(\sqrt{-5})$. We want to show the Hilbert class field $F$ is $\mathbb{Q}(\sqrt{-5},i)$. We know that $h_K=2$ and $\left|\text{Gal}(F/K)\right|=\left|\text{Cl}(K)\right|=2$, so $F$ is a quadratic unramified extension of $K$. Consider the diagram
    $$\begin{tikzcd}
        & \mathbb{Q}(\sqrt{-5},i) & \\
        \mathbb{Q}(i) & \mathbb{Q}(\sqrt{-5}) & \mathbb{Q}(\sqrt{5}) \\
        & \mathbb{Q} &
        \arrow[from=1-2, to=2-1, dash]
        \arrow[from=1-2, to=2-2, dash]
        \arrow["e_2\le 2", from=1-2, to=2-3, dash]
        \arrow[from=3-2, to=2-1, dash]
        \arrow["e_2 = 2", from=3-2, to=2-2, dash]
        \arrow["e_2 = 1", from=3-2, to=2-3, dash]
    \end{tikzcd}.$$
    \textbf{Fact.} If $\mathfrak{p}_F \subset \mathcal{O}_F$ and $\mathfrak{p}_M \subset \mathcal{O}_M$ with $M$ any of the intermediate fields, and if $p \in \mathbb{Z}$ is such that $\mathfrak{p}_F \mid \mathfrak{p}_M$ and $\mathfrak{p}_M \mid p$, then $e_{\mathfrak{p}_F/p} = e_{\mathfrak{p}_F/\mathfrak{p}_M}e_{\mathfrak{p}_M/p}\le [F:\mathbb{Q}] = 4$.

    \vspace{1mm}
     
    Since $\mathbb{Q}(i)/\mathbb{Q}$ has discriminant 8, the only ramified prime is 2. Similarly the only prime that ramifies in $\mathbb{Q}(\sqrt{5})/\mathbb{Q}$ is 5.If $p \neq 2,5$, then $p$ is unramified in $\mathbb{Q}(i)$ and $\mathbb{Q}(\sqrt{5})$, hence in $\mathbb{Q}(\sqrt{5},i)$. So $p$ is unramified in $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$.
    \vspace{1mm}
     
    Now $d_{K/\mathbb{Q}} = -20$, so the only ramified primes are 2 and 5. Suppose $2$ is ramified in $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$. Then $e_{\mathcal{P}_2/\mathfrak{p}_2}=2$, where $\mathfrak{p}_2$ is an ideal in $\mathbb{Q}(\sqrt{-5})$ such that $\mathfrak{p}_2 \mid 2$, $\mathcal{P}_2 \in \mathcal{O}_F$, $\mathcal{P}_2 \mid \mathfrak{p}_2$. Since 2 is unramified in $\mathbb{Q}(\sqrt{5})/\mathbb{Q}$, write $\mathfrak{q}_2$ for an ideal in $\mathbb{Q}(\sqrt{5})$ such that $\mathfrak{q}_2 \mid 2$. Then $e_{\mathcal{P}_2/2} = e_{\mathcal{P}_2/\mathfrak{q}_2}e_{\mathfrak{q_2}/2} = e_{\mathcal{P}_2/\mathfrak{q}_2}\cdot 1\le 2$ since $e_{\mathcal{P}_2/\mathfrak{q}_2}$ is at most $[F:\mathbb{Q}(\sqrt{5})]$. As $e_{\mathcal{P}_2/2} \neq 4$, 2 is unramified in $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$. In other words, just look at the diagram above (the notation here is bad but it's an easy example). The case $p=5$ is similar. Hence $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$ is unramified at all finite primes. In $\mathbb{Q}(\sqrt{-5})$ we only have one infinite prime, which is complex, so unramified by definition. Hence $(\sqrt{-5},i)$ is the Hilbert class field of $\mathbb{Q}(\sqrt{-5})$.
\end{example}
\begin{defn}
    The \textbf{narrow Hilbert class field} is the maximal abelian extension unramified at all finite primes.
\end{defn}
\begin{cor}
    Let $f$ be the Hilbert class field of $K$. Let $\mathfrak{p}$ be a prime ideal of $K$. Then $\mathfrak{p}$ splits completely in $F \iff \mathfrak{p}$ is a principal ideal.
\end{cor}
We can prove this in two ways: either we deduce this from the decomposition law, or we prove it directly, which we will now do.
\begin{proof}
    We know $\mathfrak{p}$ splits completely in $F$ if and only if $\left(\frac{F/K}{\mathfrak{p}}\right)=1$, and $\text{Cl}(K) \cong \text{Gal}(F/K)$. So \[
    \left(\frac{F/K}{\mathfrak{p}}\right) = 1 \iff [p]=[1] \text{ in }\text{Cl}(K).
    \qedhere\] 
\end{proof}
\begin{theorem}[Principal ideal theorem]
    In the Hilbert class field, any ideal $\mathfrak{a}$ of $K$ becomes a principal ideal.
\end{theorem}
We don't prove this.
\begin{example}
    Let $K = \mathbb{Q}(\sqrt{-5})$. Then $\text{Cl}(K) = \langle[\mathcal{O}_K], [(2,1+\sqrt{-5})]\rangle$, $F = \mathbb{Q}(\sqrt{-5},i)$ and $(2,1+\sqrt{-5})\mathcal{O}_F$ is generated by $(1+i)$ in $\mathcal{O}_F$.
\end{example}
\subsection{Reciprocity theorems}
Let $K$ be a number field containing a primitive $n^{\text{th}}$ root of unity $\zeta$. Then for $\alpha \in \mathcal{O}_K$ coprime to $\mathfrak{p}$, we have Fermat's little theorem: $\alpha^{N(\mathfrak{p})-1} \equiv 1 \pmod{\mathfrak{p}}$.
\vspace{1mm}
 
Exercise: Suppose $\mathfrak{p} \subset \mathcal{O}_K, \alpha \in \mathcal{O}_K$ such that $n, \alpha \not\in \mathfrak{p}$. Prove that:
\begin{enumerate}[(i)]
    \item $1, \zeta,\zeta^{n-1}$ are distinct mod $\mathfrak{p}$.
    \item $n \mid N(\mathfrak{p})-1$.
    \item $\alpha^{N(\mathfrak{p}-1)/n}$ is congruent to a unique $n^{\text{th}}$ root of unity mod $\mathfrak{p}$.
\end{enumerate} 
\begin{defn}
    This unique root of unity is called the $n^{\text{h}}$ power Legendre symbol, written $\left(\frac{\alpha}{\mathfrak{p}}\right)_n$.
\end{defn}
\marginpar{05 Feb 2024, Lecture 8}
Let $K$ be a number field containing a primitive $n^{\text{th}}$ root of $\zeta$. Let $\alpha \in \mathcal{O}_K$ and $\mathfrak{p} \subset \mathcal{O}_K$ such that $n \alpha \not\in \mathfrak{p}$. We saw that there was a unique $n^{\text{th}}$ root of unity congruent to $\alpha^{(N(\mathfrak{p})-1)/n}$ mod $\mathfrak{p}$.
\vspace{1mm}
 
Next let $I \subset \mathcal{O}_K$ be an ideal prime to both $n$ and $\alpha$, then if $I = \mathfrak{p}_1\ldots \mathfrak{p}_r, $\[
\left(\frac{\alpha}{I}\right)_n = \prod_{i=1}^{r} \left(\frac{\alpha}{\mathfrak{p}_i}\right).
\]
Let $\mathfrak{m}$ be a modulus containing all primes that contain $n \alpha$. Then we get a homomorphism $\left(\frac{\alpha}{\cdot }\right)_{n} : I_K(\mathfrak{m}) \to  \mu_n$ with $\mu_n \subset \mathbb{C}^\times$ the group of $n^{\text{th}}$ roots of unity. Let $L = K(\sqrt[n]{\alpha})$. Then $L/K$ is a Galois extension. If $\sigma \in \text{Gal}(L/K)$, then $\sigma(\sqrt[n]{\alpha}) = \zeta \sqrt[n]{\alpha}$ for some $n^{\text{th}}$ root of unity, i.e. we obtain an injective homomorphism $\text{Gal}(L/K) \hookrightarrow \mu_n$ by $\sigma \mapsto \zeta$.
\vspace{1mm}
 
\textbf{Exercises.} 1. Show that if $n \alpha \not\in \mathfrak{p}$, then $\mathfrak{p}$ is unramified in $L$.
\vspace{1mm}
 
2. Show that $\left(\frac{L/K}{\mathfrak{p}}\right)(\sqrt[n]{\alpha}) = \left(\frac{\alpha}{\mathfrak{p}}\right)_n \sqrt[n]{\alpha}$.

\begin{theorem}[Weak reciprocity]
    Let $K$ be a number field containing a primitive $n^{\text{h}}$ root of unity. Let $\alpha \in \mathcal{O}_K$ be nonzero and $L = K(\sqrt[n]{\alpha})$. Let $\mathfrak{m}$ be a modulus divisible by all primes of $K$ containing $n \alpha$, and assume that $\text{ker}(\Phi_{L/K,\mathfrak{m}})$ is a congruence subgroup. Then there is a commutative diagram $\begin{tikzcd}[]
        I_K(\mathfrak{m}) & \text{Gal}(L/K)\\
         & \mu_n
        \arrow["\Phi_{L/K,\mathfrak{m}}", from=1-1, to=1-2]
        \arrow["", from=1-2, to=2-2]
        \arrow["\left(\frac{\alpha}{\cdot }\right)_n", from=1-1, to=2-2, swap]
    \end{tikzcd}$. 
    Let $G$ be the image of $\text{Gal}(L/K)$ in $\mu_n$, then $\left(\frac{\alpha}{\cdot }\right)_n$ induces a surjective homomorphism \[
    \left(\frac{\alpha}{\cdot }\right)_n : I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to G \subset \mu_n.
    \]
\end{theorem}
\begin{proof}
    Commutativity follows from the second exercise above. Based on our assumptions, we have $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}}) \subset I_K(\mathfrak{m})$. So by the commutative diagram, $\left(\frac{\alpha}{\cdot }\right)_n$ induces a surjective homomorphism $$I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to I_K(\mathfrak{m})/\text{ker}(\Phi_{L/K},\mathfrak{m}) \cong \text{Gal}(L/K) \to G \subset \mu_n.$$
\end{proof}
Strong reciprocity gives a formula for computing $\left(\frac{\alpha}{\cdot }\right)_n$ using Hilbert symbols. We can use Weak reciprocity to prove:
\begin{theorem}[Quadratic reciprocity]
    Let $p$ and $q$ be distinct odd primes. Then $\left(\frac{p}{q}\right)\left(\frac{q}{p}\right) = (-1)^{\frac{(p-1)(q-1)}{4}}$.
\end{theorem}
\begin{proof}
    A series of exercises.
\end{proof}
\section{Characters, zeta functions and $L$--series}
\textbf{Motivation.} In number theory, many arithmetic properties are captured in analytic objects.
\subsection{Dirichlet series}
\begin{defn}\label{defn2.1}
    A \textbf{Dirichlet series} is a series of the form \[
    f(s) = \sum_{n=1}^{\infty} \frac{a_n}{n^s}
    \]
    where $a_n \in \mathbb{C}$ and $s \in \mathbb{C}$.
\end{defn}
\begin{lemma}[Abel summation/Abel's lemma]\label{lemma2.2}
    If $(a_n)$ and $(b_n)$ are sequences of complex numbers, then \[
    \sum_{n=N}^{M} a_nb_n = \sum_{n=N}^{M-1} \left(\sum_{k=N}^{n} a_k\right)(b_n-b_{n+1}) + \left(\sum_{k=N}^{M} a_k \right)b_M. 
    \]
\end{lemma}
\begin{proof}
    Exercise.
\end{proof}
\textbf{Interlude}: Convergence review.
\begin{itemize}
    \item We say a series $\sum_{n=1}^{\infty} a_n$ of complex numbers converges to $L$ if the sequence of partial sums $(A_n)$ with $A_n = \sum_{k=1}^{n} a_k$ converges to $L$.
    \item We say a series $\sum_{n=1}^{\infty} a_n$ of complex numbers converges absolutely if the series $\sum_{n}^{} \left|a_n\right|$ of nonnegative real numbers converges.
    \item A sequence of complex functions $(f_n(z))$ is uniformly convergent on $S \subset \mathbb{C}$ if $\forall \epsilon>0 ~ \exists N \in \mathbb{N}$ such that if $n>N$, then $\left|f_n(z) - f(z)\right|<\epsilon ~\forall z \in S$. 
    \item A series of complex functions $\sum_{n=1}^{\infty} f_n(z)$ converges on $S$ if for each $z_0 \in S$, $\sum_{n=1}^{\infty} f_n(z_0)$ converges as a series of complex numbers. It converges uniformly on $S$ if the sequence of partial sums $(A_n(z))$ converges uniformly on $S$.
    \item An infinite product $\prod_{n}^{} a_n$ of nonzero complex numbers is absolutely convergent when the sum $\sum_{n}^{} \log a_n$ is, in which case $\prod_{n}^{} a_n = \exp (\sum_{n}^{} \log a_n)$.
\end{itemize}
\begin{theorem}\label{theorem2.3}
    Let $(a_n)$ be a sequence of complex numbers. If $f(s) = \sum_{n=1}^{\infty} \frac{a_n}{n^s}$ converges for some $s=s_0$, then it converges for any $s \in \mathbb{C}$ with $\text{Re}(s)>\text{Re}(s_0)$. Moreover, it converges uniformly on every domain of the form $\{s \mid \text{Re}(s)>\text{Re}(s_0), \left|\text{Arg}(s-s_0)\right|\le \theta\}$ for $\theta < \frac{\pi}{2}$.\footnote{We also need that our domain is compact.}
\end{theorem}
\begin{proof}
    Note that 
    \begin{align*}
        f(s) &= \sum_{n=1}^{\infty} \frac{1}{n^{s_0}}\frac{a_n}{n^{s-s_0}} \\
        &= \sum_{n=1}^{\infty} \frac{\tilde{a}_n}{n^{s-s_0}},
    \end{align*}
    where $\tilde{a}_n = \frac{a_n}{n^{s_0}}$. We can assume $s_0 = 0$, so $\sum_{n=1}^{\infty} a_n$ converges. Let $\epsilon>0$. Since $\sum_{n=1}^{\infty} a_n$ converges, there is a sufficiently large number $N_0$ such that if $M>N\ge N_0$, then $\left|\sum_{n=N}^{M} a_n\right|<\epsilon$. Let $b_n = n^{-s}$ and apply Abel's lemma to get
    \begin{align*}
        \sum_{n=N}^{M} a_n n^{-s} = \sum_{n=N}^{M-1} \left(\sum_{k=N}^{n} a_k\right)\left(n^{-s} - (n+1)^{-s}\right) + \left(\sum_{n=N}^{M} a_n \right)M^{-s}. 
    \end{align*}
    We have 
    \begin{align*}
        \left|e^{-cs}-e^{-ds}\right| \le \left|s\right|\int_{c}^{d} e^{-t \text{\text{Re}(s)}}\mathrm{d}t = \frac{\left|s\right|}{\text{Re}(s)}\left(e^{-c \text{Re}(s)} - e^{-d \text{Re}(s)}\right)
    \end{align*}
    and $\frac{\left|s\right|}{\text{Re}(s)}$ is bounded by some $B$ in our domain $\text{Re}(s)>0$, and $\left|\text{Arg}(s)\right|<\theta$ for some $\theta < \frac{\pi}{2}$. Choosing $c = \log n$ and $d = \log (n+1)$ gives \[
    \left|n^{-s} - (n+1)^{-s}\right| \le \frac{\left|s\right|}{\text{Re}(s)} \left(n^{-\text{Re}(s)} - (n+1)^{-\text{Re}(s)}\right) \le B(n^{-\text{Re}(s)}-(n+1)^{-\text{Re}(s)}).
    \]
    This gives
    \begin{align*}
        &\left|\sum_{n=N}^{M} a_n n^{-s}\right| \le \sum_{n=N}^{M-1} \left|\sum_{k=N}^{n} a_k\right| \left|n^{-s} - (n+1)^{-s}\right| + \left|\sum_{n=N}^{M} a_n\right| \left|M^{-s}\right| \\
        \le & B \epsilon \sum_{n=N}^{M-1} \left(n^{-\text{Re}(s)} - (n+1)^{-\text{Re}(s)}\right) + \epsilon M^{-\text{Re}(s)}\\
        \le & \epsilon(B+1)
    \end{align*}
    for $N,M$ large enough. The final part follows since any $s$ with $\text{Re}(s)>0$ is contained in a domain of the form $\{s \mid \text{Re}(s)>0, \left|\text{Arg}(s)\right|\le \theta\}$ for some $\theta < \frac{\pi}{2}$.
\end{proof}
\marginpar{07 Feb 2024, Lecture 9}
\begin{cor}\label{cor2.4}
    Let $f(s) =\sum_{}^{} a_n/n^s$ be a Dirichlet series.
    \begin{enumerate}[(i)]
        \item If the $a_n$ are bounded, then $f(s)$ converges absolutely for $\text{Re}(s)>1$.
        \item If $f(s)$ converges at $s=s_0$, then it converges absolutely for $\text{Re}(s)>\text{Re}(s_0)+1$.
    \end{enumerate}
\end{cor}
\begin{proof}
    Exercise.
\end{proof}
\begin{defn}\label{defn2.5}
    Suppose a Dirichlet series $\sum_{}^{} a_n/n^s$ converges for some $s$. Then the smallest real number $\sigma_0$ such that the series converges for $\text{Re}(s)>\sigma_0$ is called the \textbf{abscissa of convergence}.
\end{defn}
\begin{theorem}\label{theorem2.6}
    Assume there exists a number $C$ and $\sigma_1\ge 0$ such that $\left|A_n\right|=\left|a_1+\ldots+a_n\right|\le Cn^{\sigma_1} ~\forall n$. Then the abscissa of convergence of $\sum_{}^{} a_n/n^s$ is $\le \sigma_1$.
\end{theorem}
\begin{proof}
    We omit this. See e.g. \textit{Algebraic Number Theory} by Lang for the proof.
\end{proof}
\subsection{The Riemann zeta function}
\begin{defn}\label{defn2.7}
    Let $s \in \mathbb{C}$ with $\text{Re}(s)>1$. Then the Riemann zeta function is \[
    \zeta(s) = \sum_{n=1}^{\infty} \frac{1}{n^s}.
    \]
    By Theorem \ref{theorem2.6}, we have $\sigma_1=1$, so we know $\zeta(s)$ converges for $\text{Re}(s)>1$.
\end{defn}
We will extend $\zeta(s)$ meromorphically to $\text{Re}(s)>0$. Recall first that a function is (complex) analytic on some open $S \subset \mathbb{C}$ if for any $z_0 \in S$, we can write $f(z) = \sum_{n=0}^{\infty} a_n(z-z_0)^n$, where $a_n \in \mathbb{C}$ and the series converges to $f(z)$ for $z$ in a neighborhood of $z_0$. This is equivalent to being holomorphic.
\vspace{1mm}
 
A function is meromorphic on $S \subset \mathbb{C}$ if it is holomorphic on all of $S$, except for a set of isolated points called poles. If $f$ is meromorphic, a pole of $f$ is a zero of $\frac{1}{f}$. Suppose $z_0$ is a pole, then for some integer $n$, $(z-z_0)^nf(z)$ is holomorphic and nonzero in a neighborhood of $z_0$, and then $z_0$ is a pole of order $n$. If $n=1$, then $z_0$ is called a simple pole and the residue is $\text{Res}(f,z_0) = \lim_{z \to z_0}(z-z_0)f(z)$.

\vspace{1mm}
 
If $f$ is a meromorphic/analytic function defined on some open $S \subset \mathbb{C}$ with $S \subset T$, $T \subset \mathbb{C}$ open, and $F$ is a meromorphic/analytic function defined on $T$ such that $F(z)=f(z) ~\forall z \in S$, then $F$ is called a meromorphic/analytic continuation of $f$.
\begin{theorem}\label{theorem2.8}
    The Riemann zeta function $\zeta(s)$ has a meromorphic continuation to $\text{Re}(s)>0$ with a simple pole at $s=1$ with residue equal to 1. If $\delta>0$, then the series $\sum_{n=1}^{\infty} 1/n^s$ converges absolutely in the region $\text{Re}(s)\ge 1+\delta$.
\end{theorem}
(In fact, the Riemann zeta function is analytic for $\text{Re}(s)>0$ except for the simple pole at $s=1$.)
\begin{proof}
    Let $s>1$ be real. Then 
    \begin{align*}
        \frac{1}{s-1} \le \int_{1}^{\infty} \frac{1}{x^s} \mathrm{d}x \le \zeta(s) \le 1 + \frac{1}{s-1},
    \end{align*}
    so for $s>1$, $1\le (s-1)\zeta(s) \le s$ and so $\lim_{s \to 1^+} (s-1)\zeta(s)=1$. If we show that we can continue (i.e. extend) $\zeta(s)$, we can conclude that $\zeta(s)$ has a simple pole at $s=1$ with residue 1.
    \vspace{1mm}
     
    To continue $\zeta(s)$, consider the alternating Riemann zeta function \[
    \zeta_2(s) = \sum_{n=1}^{\infty} \frac{(-1)^{n+1}}{n^s} = 1 - \frac{1}{2^s} + \frac{1}{3^s} - \ldots.
    \]
    Since the partial sums of the coefficients are 1 or 0, they are bounded, hence by Theorem \ref{theorem2.6}, this converges for $\text{Re}(s)>0$. We have 
    \begin{align*}
        &\frac{2}{2^s}\zeta(s) + \zeta_2(s) = \zeta(s) \\
        \implies & \zeta(s) = \zeta_2(s) \left(1-\frac{1}{2^{s-1}}\right)^{-1}.
    \end{align*}
    This gives us an analytic continuation to the line $\text{Re}(s)=0$. We show there are no poles except at $s=1$. From our expression for $\zeta_2(s)$, we see the only possible poles other than $s=1$ satisfy $1-2^{1-s}=0 \iff 2^{s-1}=1 \iff s = \frac{2\pi i n}{\log 2}+1$ for some integer $n$. Consider for $r=2,3,\ldots$ the function \[
    \zeta_r(s) = \frac{1}{1^s} + \frac{1}{2^s} + \ldots + \frac{1}{(r-1)^s} - \frac{r-1}{r^s} + \frac{1}{(r+1)^s} + \ldots,
    \]
    e.g. for $r=3$ we get
    \[
    \zeta_3(s) = \sum_{n=0}^{\infty} \frac{1}{(3n+1)^3} + \frac{1}{(3n+2)^3} - \frac{2}{(3n+3)^3}. 
    \]
    The partial sums of the coefficients are bounded by $r$, so $\zeta_r(s)$ converges for $\text{Re}(s)>0$ by Theorem \ref{theorem2.6}. We have 
    \begin{align*}
        &\zeta(s) = \frac{\zeta_r(s)}{1-\frac{1}{r^{s-1}}} \\
        \implies & \zeta(s) = \frac{\zeta_3(s)}{1-3^{1-s}},
    \end{align*}
    so the only poles occur when $3^{s-1}=1 \iff s = \frac{2\pi i m}{\log 3}+1$ for some integer $m$. Hence at any such pole we need $3^n = 2^m$, so $n=m=0$.
\end{proof}
\begin{theorem}\label{theorem2.9}
    Let $(a_n)$ be a sequence of complex numbers and let $A_n = a_1 + \ldots + a_n$. Let $0 \le \sigma_1 \le 1$ and assume there is $z_0 \in \mathbb{C}$ and a constant $C>0$ such that for all $n$, $\left|A_n - n z_0\right|\le Cn^{\sigma_1}$. Then $f(s) = \sum_{n=1}^{\infty} a_n/n^s$ (defined say for $\text{Re}(s)>1$) has an analytic continuation to $\text{Re}(s)>\sigma_1$ where it is analytic, except for a simple pole with residue $z_0$ at $s=1$. 
\end{theorem}
\begin{proof}
    Consider $f(s)-z_0\zeta(s)$ and apply Theorem \ref{theorem2.6} and Theorem \ref{theorem2.8}.
\end{proof}
\begin{prop}\label{prop2.10}
    We have \[
    \zeta(s) = \prod_{p}^{} \frac{1}{1-p^{-s}}.
    \]
\end{prop}
\begin{proof}
    We write $E(s) = \prod_{p}^{} \frac{1}{1-p^{-s}}$, then $\log E(s) = \sum_{p}^{} \sum_{n=1}^{\infty} \frac{1}{np^{ns}}$. Let $\text{Re}(s)>1+\delta$. Then $\left|p^{ns}\right| = p^{n \text{Re}(s)} \ge p^{(1+\delta)n}$, so
    \[
    \sum_{p}^{} \sum_{n=1}^{\infty} \left(\frac{1}{p^{1+\delta}}\right)^n = \sum_{p}^{} \frac{1}{p^{1+\delta}-1} \le 2\sum_{p}^{} \frac{1}{p^{1+\delta}}
    \]
    which converges, so the series $E(s)$ converges absolutely. We need to show equality, so again use $\frac{1}{1-p^{-s}}= 1 + p^{-s} + p^{-2s} + \ldots$. Fix $N \in \mathbb{N}$ and let $p_1,\ldots,p_r$ be the primes less than $N$. Then 
    \begin{align*}
        \prod_{p\le N}^{}\frac{1}{1-p^{-s}} = \prod_{v_1,\ldots,v_r\ge 0}^{\infty} \frac{1}{(p_1^{v_1}\ldots p_r^{v_r})^s} = \sum_{n}^{'} \frac{1}{n^s} 
    \end{align*}
    where $\Sigma'$ denotes the sum over all natural numbers only divisible by primes $p\le N$. It contains all $n\le N$, so 
    \begin{align*}
        &\prod_{p\le N}^{} \frac{1}{1-p^{-s}} = \sum_{n\le N}^{} \frac{1}{n^s}  + \sum_{n>N}^{'} \frac{1}{n^s} \\
        \implies & \left|\prod_{p\le N}^{} \frac{1}{1-p^{-s}} - \zeta(s)\right| \le \left|\sum_{n>N, p_i \nmid n}^{} \frac{1}{n^s}\right|\le \sum_{n>N}^{} \frac{1}{n^{1+\delta}} \stackrel{N \to \infty}{\to} 0. 
        \qedhere
    \end{align*}
\end{proof}

\end{document}
