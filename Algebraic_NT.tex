\documentclass{article}
%build with recipe latexmk
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{fancyhdr}
\pagestyle{fancy}

\usepackage{tcolorbox}
\tcbuselibrary{theorems}
\usepackage{babel}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
%\usepackage{a4wide}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{setspace}
\setstretch{1.1}
\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black,  %choose some color if you want links to stand out
}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{example}{Example}[section]
\newtheorem{defn}[theorem]{Definition}

\title{Part III - Algebraic Number Theory
    \\ \large
    Lectured by Hanneke Wiersema 
}
 
\author{Artur Avameri}
\date{}
 
\setcounter{section}{-1}
 
\begin{document}
\maketitle
\tableofcontents
\newpage
 
\section{Introduction}

\marginpar{19 Jan 2024, Lecture 1}


The lecturer will provide typed notes at the end of the course. The topics of the course are
\begin{itemize}
    \item global class field theory;
    \begin{itemize}
        \item both ideal--theoretic and idele--theoretic.
    \end{itemize}
    \item zeta functions;
    \item $L$--series;
    \item density theorems.
\end{itemize} 

\subsection{Rough goals of class field theory.}
\begin{enumerate}[(1)]
    \item Given a number field $K$, what are its abelian extensions? If $K = \mathbb{Q}$, we have the Kronecker--Weber theorem (which we will prove): Every finite abelian extension of $\mathbb{Q}$ is contained in some cyclotomic field, i.e. by adjoining a complex root of unity to $\mathbb{Q}$. We write $\mathbb{Q}(\zeta_n)$ for $\zeta_n = e^{2\pi i/n}$. 
    \vspace{1mm}
     
    Finite abelian extensions of $\mathbb{Q}$ can be generated by special values of the exponential function $e^{2\pi i z}$. It is an open problem to explicitly construct all abelian extensions for arbitrary number fields. Kronecker solved the case of imaginary quadratic fields using special values of analytic functions (elliptic and modular functions).
    \vspace{1mm}
     
    In class field theory, we classify extensions introducing the notion of a \textbf{class field}: for any $K$ we will show that any finite abelian extension will be contained in a class field. Moreover, the Galois group of this extension will be isomorphic to the generalized ideal class group (in the ideal case) or a subgroup of the Idele class group (in the idele case).
    \item Given a finite abelian extension, how do the prime ideals in the smaller field behave in the extension? In the quadratic case, we will prove quadratic reciprocity. There exist higher reciprocity laws. The most general answer we will see is the decomposition law, which is a consequence of the Artin reciprocity theorem.
\end{enumerate} 
\textbf{Warning.} There is no one convention for the notation for many objects -- different textbooks may use different notation.
\vspace{1mm}
 
\subsection{Review of basic Algebraic Number Theory}
Let $K$ be a number field and write $\mathcal{O}_K$ for its ring of integers. This is a Dedekind domain, so any ideal has a unique factorization into a product of prime ideals. Let $L/K$ be an extension of number fields and and $\mathfrak{p}$ a prime ideal of $K$. Then $\mathfrak{p}\mathcal{O}_L$ is an ideal of $L$ and by unique factorization $\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1^{e_1}\ldots \mathcal{P}_g^{e_g}$ with $\mathcal{P}_i$ distinct prime ideals in $\mathcal{O}_L$. Write $\mathcal{P}_i \mid \mathfrak{p}$ to mean that $\mathcal{P}_i$ appears in the factorization of $\mathcal{O}_L$. The number $e_i$ is called the ramification index $\mathcal{P}_1/\mathfrak{p}$. We also write $e_i = e_{\mathcal{P}_i/\mathfrak{p}}$. 
\begin{itemize}
    \item If $e_i=1$ for all $i$, we say $\mathfrak{p}$ is unramified in $L$.
    \item If $e_i>1$ for some $i$, we say $\mathfrak{p}$ is ramified.
    \item If there is a unique prime $\mathcal{P}$ dividing $\mathfrak{p}$ with $e_{\mathcal{P}/\mathfrak{p}} = [L:K]$, we say $\mathfrak{p}$ is totally ramified.
    \item If $\mathfrak{p}\mathcal{O}_L$ is prime, we say $\mathfrak{p}$ is inert (or remains inert) in $L$.
    \item If $g = [L:K]$, we say $\mathfrak{p}$ splits completely.
\end{itemize}
The quotient $\mathcal{O}_K/\mathfrak{p}$ is a finite field of characteristic $p$ ($\mathfrak{p} \cap \mathbb{Z} = p\mathbb{Z}$), called a residue field. If $\mathcal{P}\mid \mathfrak{p}$ (for $\mathcal{P} \in \mathcal{O}_L, \mathfrak{p} \in \mathcal{O}_K$), view $\mathcal{O}_K/\mathfrak{p}$ as a subfield of $\mathcal{O}_L/\mathcal{P}$. We call $f_{\mathcal{P}/\mathfrak{p}} = [\mathcal{O}_L/\mathcal{P} : \mathcal{O}_K/\mathfrak{p}]$ the residue field degree. If as before $\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1^{e_1}\ldots \mathcal{P}_g^{e_g}$, then $\sum_{i=1}^{g} e_{\mathcal{P}_i/\mathfrak{p}} f_{\mathcal{P}_i/\mathfrak{p}} = [L:K]$. If $L/K$ is Galois, then the Galois group permutes the $\mathcal{P}_i$ transitively, so $e_1 = \ldots = e_g = e$. Also if $L/K$ is Galois, $f_{\mathcal{P}_1/\mathfrak{p}} = \ldots f_{\mathcal{P}_g/\mathfrak{p}} = f$, so $efg = [L:K]$. Recall also that 
\begin{itemize}
    \item We can find the factorization of $\mathfrak{p}\mathcal{O}_L$ using the Kummer--Dedekind theorem.
    \item A prime $\mathfrak{p}$ in $\mathcal{O}_K$ ramifies in $L/K$ if and only if $\mathfrak{p} \mid d_{L/K}$ for $d_{L/K}$ the discriminant.
\end{itemize}
If $L/K$ is Galois, write $\text{Gal}(L/K)$ for the Galois group. Let $\mathcal{P}$ be a prime ideal in $\mathcal{O}_L$.

\begin{defn}
    The \textbf{decomposition subgroup} of $\mathcal{P}$ is $$D_{\mathcal{P}} = \{\sigma \in \text{Gal}(L/K) \mid \sigma(\mathcal{P})=\mathcal{P}\}.$$
    The \textbf{inertial subgroup} of $\mathcal{P}$ is \[
    I_{\mathcal{P}} = \{\sigma \in \text{Gal}(L/K) \mid \sigma(\alpha) \equiv \alpha \pmod{\mathcal{P}} ~\forall \alpha \in \mathcal{O}_L\}.
    \]
\end{defn}
\textbf{Remark.} We have $I_{\mathcal{P}} \subset D_{\mathcal{P}}$. Easy exercise: show this.
\vspace{1mm}
 
Let $\sigma \in D_\mathcal{P}$. This induces an automorphism $\overline{\sigma} : \mathcal{O}_L/\mathcal{P} \to \mathcal{O}_L/\mathcal{P}$ such that $\overline{\sigma}|_{\mathcal{O}_K/\mathfrak{p}} = \text{Id}|_{\mathcal{O}_K/\mathfrak{p}}$ for $\mathfrak{p} = \mathcal{P} \cap \mathcal{O}_K$. This gives a map $D_{\mathcal{P}} \to \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ by $\sigma \mapsto \overline{\sigma}$.

\begin{prop}\label{prop0.1}
    \begin{enumerate}[(i)]
        \item The Galois group $\text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ is a cyclic group with canonical generator the Frobenius automorphism $x \mapsto x^q$ for $q = |\mathcal{O}_K/\mathfrak{p}|$.
        \item The map $D_{\mathcal{P}} \stackrel{\sigma \mapsto \overline{\sigma}}{\to} \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ defines a surjective homomorphism with kernel $I_{\mathcal{P}}$.
        \item $|I_{\mathcal{P}}| = e_{\mathcal{P}/\mathfrak{p}}$ and $|D_{\mathcal{P}}| = e_{\mathcal{P}/\mathfrak{p}}f_{\mathcal{P}/\mathfrak{p}}$.
    \end{enumerate}
\end{prop}
Recall that if $\mathfrak{p}$ is a prime in $\mathcal{O}_K$ and $\mathcal{P}$ is a prime in $\mathcal{O}_L$ such that $\mathcal{P} \mid  \mathfrak{p}$, then the norm of $\mathcal{P}$ is $N_{L/K}(\mathcal{P}) = \mathfrak{p}^{f_{\mathcal{P}/\mathfrak{p}}}$. Note that if $\mathfrak{p}$ is a prime of $K$, we also write $N(\mathfrak{p})$ for $N_{K/\mathbb{Q}}(\mathfrak{p})$ and $N(\mathfrak{p}) = |\mathcal{O}_K/\mathfrak{p}|$.

\section{The Artin symbol}
\begin{lemma}
    Let $L/K$ be a Galois extension and let $\mathfrak{p}$ be a prime of $\mathcal{O}_K$, unramified in $L$. Suppose $\mathcal{P} \subset  \mathcal{O}_L$ such that $\mathcal{P} \mid  \mathfrak{p}$. Then there exists a unique element $\sigma \in \text{Gal}(L/K)$ such that for all $\alpha \in \mathcal{O}_L$,\[
    \sigma(\alpha) \equiv \alpha^{N(\mathfrak{p})} \pmod{\mathcal{P}}.
    \]
\end{lemma}
\begin{proof}
    Let $\sigma \in D_{\mathcal{P}}$ and $\overline{\sigma} \in \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ its image under the map from Proposition \ref{prop0.1}. By assumption, $\mathfrak{p}$ is unramified, so $|I_{\mathcal{P}}| = 1$, hence by Proposition \ref{prop0.1} again, we have $D_{\mathcal{P}} \stackrel{(\star)}{\cong}  \text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$. Recall that $\text{Gal}((\mathcal{O}_L/\mathcal{P})/ (\mathcal{O}_K/\mathfrak{p}))$ is generated by $x \mapsto x^q$ for $q = |\mathcal{O}_K/\mathfrak{p}|$. Let $\sigma \in D_{\mathcal{P}}$ be the unique element in $D_{\mathcal{P}}$ which maps to the Frobenius under $(\star)$. Then $\sigma(\alpha) \equiv \alpha^q \pmod{\mathcal{P}}$ for all $\alpha \in \mathcal{O}_L$ and $q = |\mathcal{O}_K/\mathfrak{p}| = N(\mathfrak{p})$. Uniqueness follows since any $\sigma \in \text{Gal}(L/K)$ satisfying this condition will be an element of $D_{\mathcal{P}}$.
\end{proof}
\marginpar{22 Jan 2024, Lecture 2}

\begin{defn}
    This unique element is called the \textbf{Artin symbol} and we denote it by $\left(\frac{L/K}{\mathcal{P}}\right)$.
\end{defn}
\begin{defn}
    Let $p$ be an odd prime and let $a$ be any integer. Recall that the \textbf{Legendre symbol} is $\left( \frac{a}{p}\right) = \begin{cases}
        1 &\text{ if} a \text{ is a QR mod }p.\\
        -1&\text{ if } a \text{ is not a QR mod }p.\\
        0 &\text{ if }a \equiv 0\pmod{p}.
    \end{cases}$
    Now let $n \in \mathbb{Z}$ be nonzero and write $ = u p_1^{k_1}\ldots p_u^{r_u}$ for $u = \pm 1$. Again let $a$ be an integer, then the \textbf{Kronecker symbol} is \[
    \left(\frac{a}{n}\right) = \left(\frac{a}{u}\right) \prod_{i=1}^{k} \left(\frac{a}{p_i}\right)^{r_i}
    \]
    with $\left(\frac{a}{p_i}\right)$ the Legendre symbol for odd primes, $\left(\frac{a}{2}\right) = \begin{cases}
        0 &a \equiv 0\pmod{2}\\
        1&a \equiv \pm 1 \pmod{8}\\
        -1 &a \equiv \pm 3 \pmod{8}
    \end{cases}$
    and $\left(\frac{a}{1}\right) =1$, $\left(\frac{a}{-1}\right) = \begin{cases}
        -1 & a<0\\
        1 &a\ge 0.
    \end{cases}$
\end{defn}
\textbf{The quadratic case.} Let $K=\mathbb{Q}$, $L = \mathbb{Q}(\sqrt{N})$ for $N\neq 0,1$ squarefree. Recall that \[
d_{L/\mathbb{Q}} = \begin{cases}
    N & N \equiv 1 \pmod{4}\\
    4N& N \not\equiv 1 \pmod{4}
\end{cases}
\]
with \[
\mathcal{O}_L = \begin{cases}
    \mathbb{Z}\left[\frac{1+\sqrt{N}}{2}\right] & N \equiv 1 \pmod{4}\\
    \mathbb{Z}[\sqrt{N}] & N \not\equiv 1\pmod{4}.
\end{cases}
\]
Then $\text{Gal}(L/K)$ has order 2 with $1 : \sqrt{N} \to \sqrt{N}$ and $\sigma: \sqrt{N} \to -\sqrt{N}$ and we can identify $\text{Gal}(L/K)$ with $\{\pm 1\}$. 
\vspace{1mm}
 
Let $\mathfrak{p}$ be unramified in $L$ and $\mathcal{P} \subset \mathcal{O}_L$ a prime lying above it (so $\mathcal{P} \mid \mathfrak{p}$). We then get $\sigma(\alpha) \equiv \alpha^{\mathfrak{p}} \pmod{\mathcal{P}}$ for all $\alpha \in \mathcal{O}_L$. We have \[
\left(\frac{L/K}{\mathfrak{p}}\right) = \left(\frac{\mathbb{Q}(\sqrt{N})/\mathbb{Q}}{\mathcal{P}}\right) = \left(\frac{d_{L/\mathbb{Q}}}{p}\right) = \pm 1
\]
since $p \nmid d_{L/\mathbb{Q}}$ (more on this on Ex. Sheet 1).
\begin{prop}
    Suppose $p$ is unramified in $L$. Then $p$ splits in $L$ if and only if $\left(\frac{d_{L/\mathbb{Q}}}{p}\right) = 1$.
\end{prop}
The Artin symbol tells us about the decomposition, but more generally:
\begin{lemma}
    Let $L/K$ be any Galois extension. Let $\mathfrak{p} \subset \mathcal{O}_K$ be unramified with $\mathcal{P} \subset \mathcal{O}_L$ lying above it. Then:
    \begin{enumerate}[(i)]
        \item Let $\sigma \in \text{Gal}(L/K)$. Then $\sigma \left(\frac{L/K}{\mathcal{P}}\right)\sigma^{-1} = \left(\frac{L/K}{\sigma(\mathcal{P})}\right)$.
        \item The order of $\left(\frac{L/K}{\mathcal{P}}\right)$ is the residue field degree $f = f_{\mathcal{P}/\mathfrak{p}}$.
        \item The prime $\mathfrak{p}$ splits completely in $L$ if and only if $\left(\frac{L/K}{\mathcal{P}}\right) = 1$ (i.e. the Artin map is trivial).
    \end{enumerate}
\end{lemma}
\begin{proof}
    Exercise!
\end{proof}
\begin{defn}
    In this course, we say $L/K$ is an abelian extension if it is a Galois extension of number fields with abelian Galois group $\text{Gal}(L/K)$.
\end{defn}
Suppose $L/K$ is abelian and let $\mathfrak{p} \subset \mathcal{O}_K$ be unramified. Let $\mathcal{P}, \mathcal{P}' \subset \mathcal{O}_L$ be distinct prime ideals lying above $\mathfrak{p}$. Then $\mathcal{P}' = \sigma(\mathcal{P})$ for some $\sigma \in \text{Gal}(L/K)$. Since the group is abelian, we find
\[
\left(\frac{L/K}{\mathcal{P}'}\right) = \left(\frac{L/K}{\sigma(\mathcal{P})}\right) = \sigma\left(\frac{L/K}{\mathcal{P}}\right)\sigma^{-1} = \left(\frac{L/K}{\mathcal{P}}\right).
\]
\textbf{Notation.} If $L/K$ is abelian, we also write $\left(\frac{L/K}{\mathfrak{p}}\right)$ for the Artin symbol for any $\mathcal{P} \mid \mathfrak{p}$. So for $L/K$ abelian, the Artin symbol defines a map 
\begin{align*}
    \{\text{unramified primes }\mathfrak{p} \subset \mathcal{O}_K \text{ in }L\} &\to \text{Gal}(L/K) \\
    \mathfrak{p} &\mapsto \left(\frac{L/K}{\mathfrak{p}}\right).
\end{align*}
We want to extend this map, for which we introduce fractional ideals. Quick review: recall that a \textbf{fractional ideal} of a number field $K$ is a $\mathcal{O}_K$--submodule $\mathfrak{a}$ of $K$ such that there exists $0 \neq x \in \mathcal{O}_K$ such that $x \mathfrak{a} \subset \mathcal{O}_K$. Equivalently, it is a set of the form $\alpha I$ for $\alpha \in K$ and some ideal $I$ of $\mathcal{O}_K$.
\vspace{1mm}
 
A principal fractional ideal is a $\mathcal{O}_K$--submodule generated by a single nonzero element of $K$. Since $\mathcal{O}_K$ is a Dedekind domain, each fractional ideal is invertible and we obtain a group with identity $\mathcal{O}_K$.
\vspace{1mm}
 
\textbf{Notation.} Write $I_K$ for the group of fractional ideals and $P_K$ for the subgroup of principal fractional ideals. The quotient $I_K/P_K$ is called the \textbf{ideal class group} $\text{Cl}(K)$, which is a finite abelian group with order $h_K$ called the \textbf{class number} of $K$.
\vspace{1mm}
 
Recall that for any $\mathfrak{a} \in I_K$, we have unique factorization \[
\mathfrak{a} = \prod_{i=1}^{n} \mathfrak{p}_i^{r_i}, r_i \in \mathbb{Z}
\]
with $\mathfrak{p}_i$ distinct prime ideals in $\mathcal{O}_K$.

\begin{defn}
    Suppose $L/K$ is an abelian unramified extension (i.e. every prime in $K$ is unramified in $L$). Then we define the \textbf{Artin map} to be the homomorphism \[
    \left(\frac{L/K}{\cdot }\right) : I_K \to \text{Gal}(L/K)
    \]
    by setting $\left(\frac{L/K}{\mathfrak{a}}\right) = \prod_{i=1}^{n} \left(\frac{L/K}{\mathfrak{p}_i}\right)^{r_i}$.
\end{defn}
To define this more generally, we need to define \textbf{moduli}.
\vspace{1mm}
 
\textbf{Interlude.} Finite and infinite primes. Let $K$ be a number field. Then a prime ideal is also called a finite prime to distinguish it from infinite primes. Infinite primes are determined by the embeddings of $K$ into $\mathbb{C}$. These correspond to archimedean absolute values (from local fields).
\vspace{1mm}
 
A real infinite prime is an embedding $\sigma: K \to \mathbb{R}$ and a complex infinite prime is a pair of conjugate embeddings $\sigma, \overline{\sigma}: K \to \mathbb{C}$ with $\sigma \neq \overline{\sigma}$. 
\begin{example}
    \begin{itemize}
        \item $\mathbb{Q}$ has one infinite real prime $\sigma\left(\frac{a}{b}\right) = \frac{a}{b}$.
        \item $\mathbb{Q}(\sqrt{2})$ has two infinite real primes $\sigma_1(\sqrt{2}) =\sqrt{2}$ and $\sigma_2(\sqrt{2}) = -\sqrt{2}$.
        \item $\mathbb{Q}(\sqrt{-2})$ has one infinite complex prime determined by $\sigma(\sqrt{-2})=\sqrt{-2}$, $\overline{\sigma}(\sqrt{-2})=-\sqrt{-2}$.
    \end{itemize}
\end{example}
\textbf{Remark.} If we have an extension $L/K$, then an infinite prime $\sigma$ of $K$ \textbf{ramifies} in $L$ is $\sigma$ is real, but has an extension to $L$ which is complex.
\begin{example}
    The infinite prime of $\mathbb{Q}$ is unramified in $\mathbb{Q}(\sqrt{2})$, but it is ramified in $\mathbb{Q}(\sqrt{-2})$.
\end{example}
\begin{defn}
    Let $K$ be a number field. Then a \textbf{modulus} in $K$ is a formal product \[
        \mathfrak{m} = \prod_{\mathfrak{p}}^{} \mathfrak{p}^{n_{\mathfrak{p}}}
    \]
    over all primes $\mathfrak{p}$, finite or infinite, of $K$, such that
    \begin{enumerate}[(i)]
        \item $n_{\mathfrak{p}}\ge 0$, and at most finitely many of these are nonzero.
        \item $n_{\mathfrak{p}} = 0$ for $\mathfrak{p}$ infinite complex primes.
        \item $n_{\mathfrak{p}} \le 1$ for $\mathfrak{p}$ infinite real primes.
    \end{enumerate}
    If $n_{\mathfrak{p}} = 0$ for all $\mathfrak{p}$, set $\mathfrak{m} = 1$.
\end{defn}
Note that if $K$ is a purely imaginary field (i.e. it has no real primes), then a modulus of $K$ is just an ideal of $\mathcal{O}_K$. We can write any modulus $\mathfrak{m}$ as a product $\mathfrak{m} = \mathfrak{m}_0 \mathfrak{m}_{\infty}$, where $\mathfrak{m}_0$ is an ideal of $\mathcal{O}_K$ and $\mathfrak{m}_{\infty}$ is a product of distinct real infinite primes. 

\marginpar{24 Jan 2024, Lecture 3}

Recall we write $v_{\mathfrak{p}_i}(\mathfrak{a}) = r_i$. We now extend this map using moduli.

\begin{defn}
    Let $\mathfrak{m}$ be a modulus. Define $I_K(\mathfrak{m})$ to be the group of fractional ideals coprime to $\mathfrak{m}$, where $\mathfrak{a} \in I_K$ is coprime to $\mathfrak{m}$ if $v_{\mathfrak{p}}(\mathfrak{a})=0$ for all primes $\mathfrak{p} \mid \mathfrak{m}_0$.
\end{defn}
Non--infinite primes play no role in this definition, i.e. $I_K(\mathfrak{m}) = I_K(\mathfrak{m}_0)$. 
\begin{example}
    \begin{itemize}
        \item Let $\mathfrak{m} = (1)$, then $I_K(\mathfrak{m}) = I_K$.
        \item Let $K = \mathbb{Q}$ and $\mathfrak{m} = (m)$ for $m$ a positive integer. Then $I_{\mathbb{Q}}(\mathfrak{m}) = \{\left(\frac{a}{b}\right)\mathbb{Z} \mid (a,m)=(b,m)=1\}$.
    \end{itemize}
\end{example}
Now let $L/K$ be abelian, not necessarily unramified.
\begin{defn}
    Let $\mathfrak{m}$ be a modulus of $K$ divisible by all prime ideals that ramify in $L$. The Artin map for $L/K$ and $\mathfrak{m}$ is a homomorphism \[
    \Phi_{\mathfrak{m}} = \Phi_{L/K, \mathfrak{m}} : I_K(\mathfrak{m}) \to \text{Gal}(L/K)
    \]
    given by $\mathfrak{a} \mapsto \left(\frac{L/K}{\mathfrak{a}}\right)$.
\end{defn}
\begin{example}
    Let $\mathfrak{m}$ be a positive integer and $\zeta_m$ a primitive $m^{\text{th}}$ root of unity. Let $K=\mathbb{Q}$ and $L = \mathbb{Q}(\zeta_m)$. Recall that $\text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q}) \cong (\mathbb{Z}/m\mathbb{Z})^\times$ given by $\{\sigma: \zeta_m \mapsto \zeta_m^a\} \mapsto [a]$. Also, if a prime $p$ ramifies in $\mathbb{Q}(\zeta_m)$, then $p \mid m$.
    \vspace{1mm}
     
    Hence let $\mathfrak{m} = (m)$, which contains all ramified prime ideals. We have a well--defined map $\Phi_{\mathfrak{m}} : I_{\mathbb{Q}}(\mathfrak{m}) \to \text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q}) \cong (\mathbb{Z}/m\mathbb{Z})^\times$.
    \vspace{1mm}
     
    Let $\left(\frac{a}{b}\right)\mathbb{Z} \in I_\mathbb{Q}(\mathfrak{m})$ with $\frac{a}{b}>0$, then \[
    \Phi_{\mathfrak{m}} \left( \left(\frac{a}{b}\right)\mathbb{Z}\right) = [a][b]^{-1} \in (\mathbb{Z}/m\mathbb{Z})^\times.
    \]
\end{example}
Exercises: verify this above claim, show that (here?) the Artin map is surjective and work out its kernel.

\begin{defn}
    Let $P_K(\mathfrak{m})$ be the subgroup of $I_K(\mathfrak{m})$ \underline{generated} by 
    \[
        \{(\alpha) \mid \alpha \in \mathcal{O}_K, \alpha \equiv 1 \text{ (mod }\mathfrak{m}_0), \sigma(\alpha)>0 \text{ for all real primes }\sigma \mid \mathfrak{m}_{\infty}\}.
    \]
    Note $\alpha \equiv 1 \pmod{\mathfrak{m}_0}$ can also be written as $v_{\mathfrak{p}}(\alpha-1) \ge v_{\mathfrak{p}}(\mathfrak{m}_0)$ (here $v_{\mathfrak{p}}(\alpha) = v_{\mathfrak{p}}(\alpha \mathcal{O}_K)$). This is called the \textbf{ray} or \textbf{ray group} for $\mathfrak{m}$.
\end{defn}
\textbf{Remark.} Definitions in the literature might differ a bit, but we use the one above.
\begin{example}
    Let $K = \mathbb{Q}, L = \mathbb{Q}(\zeta_m)$. Suppose $\mathfrak{m} = (m)$, then $P_{\mathbb{Q}}(\mathfrak{m}) = \{\left(\frac{a}{b}\right)\mathbb{Z} \in I_{\mathbb{Q}}(\mathfrak{m}) \mid a \equiv b \pmod{m}\}$. Note $I_{\mathbb{Q}}(\mathfrak{m}) = I_{\mathbb{Q}}(\mathfrak{m}_0)$, which is not true for $P_\mathbb{Q}(\mathfrak{m})$!
    \vspace{1mm}
     
    Now suppose $\mathfrak{m} = (m)\infty$ -- the infinite prime of $\mathbb{Q}$. Then \[
    P_\mathbb{Q}(\mathfrak{m}) = \left\{\left(\frac{a}{b}\right)\mathbb{Z} \in I_\mathbb{Q}(\mathfrak{m}) \mid a \equiv b\pmod{m}, \frac{a}{b}>0\right\}.
    \]
    We have $I_{\mathbb{Q}}((m))/P_\mathbb{Q}((m)) \cong (\mathbb{Z}/m\mathbb{Z})^\times/\{\pm 1\}$ and $I_\mathbb{Q}((m)\infty)/P_\mathbb{Q}((m)\infty) \cong (\mathbb{Z}/m\mathbb{Z})^\times$. 
\end{example}
In general, $P_K(\mathfrak{m})$ has finite index in $I_K(\mathfrak{m})$.
\begin{defn}
    The quotient $I_K(\mathfrak{m})/P_K(\mathfrak{m})$ is called the \textbf{ray class group}.
\end{defn}
Our goal is to show that this is a finite group. Recall by Ostrowski's theorem that every nontrivial absolute value is equivalent to either $|\cdot|_{\mathfrak{p}}$ for some prime ideal $\mathfrak{p}$ of $\mathcal{O}_K$ or $|\cdot|_{\sigma}$ for some embedding $\sigma : K \to \mathbb{C}$, where $|\cdot|_{\sigma} = |x|_{\mathbb{C}}$ with $|\cdot|_{\mathbb{C}}$ the complex absolute value; and $|x|_{\mathfrak{p}} = C^{v_\mathfrak{p}(x)}$ for $x \neq 0$ for some $0<C<1$ (often $C =\frac{1}{p}$) and $0$ for $0$. (Recall $v_{\mathfrak{p}}(x) = \alpha$ if $x \mathcal{O}_K = \mathfrak{p}^\alpha \mathfrak{p}_1^{\alpha_1}\ldots \mathfrak{p}_r^{\alpha_r}$.)

\vspace{1mm}
 
We quote a result proved in Local Fields:
\begin{theorem}[Approximation theorem]
    Let $|\cdot|_1,\ldots,|\cdot|_n$ be nontrivial pairwise inequivalent absolute values on $K$. Let $\beta_1,\ldots,\beta_n \in K$ be nonzero. Then for any $\epsilon>0$, there exists $\alpha \in K$ such that $|\alpha-\beta_j|_j <\epsilon$ for each $j = 1,\ldots,n$.
\end{theorem}
\textbf{Consequences.} 
\begin{itemize}
    \item Let $\mathfrak{p}$ be a real infinite prime corresponding to $\sigma : K \to \mathbb{R}$. If $\alpha \beta \neq 0$ and $|\alpha-\beta|_{\mathfrak{p}}<\epsilon$, then $\sigma \left(\frac{\alpha}{\beta}\right) > 0$.
    \item Let $\mathfrak{p}$ be a finite prime. Then $|\alpha-\beta|_{\mathfrak{p}}<\epsilon$ is equivalent to $\left|\frac{\alpha}{\beta}-1 \right|_{\mathfrak{p}} < \frac{\epsilon}{|\beta|_{\mathfrak{p}}}$. Let $\epsilon' = \frac{\epsilon'}{|\beta|_{\mathfrak{p}}}$. If $\epsilon'$ is small, say $\epsilon' < C^n$ for some $n$, then $v_{\mathfrak{p}}\left(\frac{\alpha}{\beta}-1\right) > n$ and so $\alpha \equiv  \beta \pmod{\mathfrak{p}^n}$.
\end{itemize}
\textbf{Remark/Exercise.} Let $I$ be an ideal of $\mathcal{O}_K$, then every class in $\text{Cl}(K)$ has a representative which is coprime to $I$.
\begin{defn}
    Let $P_{\mathfrak{m}} \subset I_K(\mathfrak{m})$ be the subgroup of principal fractional ideals which are coprime to $\mathfrak{m}$.
\end{defn}
\begin{prop}\label{prop1.5}
    Let $P_{\mathfrak{m}} \subset I_K(\mathfrak{m})$ be as above. Then we have two exact sequences
    \begin{align*}
        1 \to P_{\mathfrak{m}} \to &I_K(\mathfrak{m}) \to \text{Cl}(K) \to 1\\
        1 \to P_{\mathfrak{m}}/P_K(\mathfrak{m}) \to &I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to \text{Cl}(K) \to 1.
    \end{align*}
\end{prop}
\begin{proof}
    Let $\mathfrak{a} \in I_K(\mathfrak{m})$ and define $f: I_K(\mathfrak{m}) \to \text{Cl}(K)$ by $\mathfrak{a}\mapsto [a]$. This is a group homomorphism, it is surjective by the previous remark with kernel $P_{\mathfrak{m}}$, so $1 \to P_{\mathfrak{m}} \to I_K(\mathfrak{m}) \to \text{Cl}(K) \to 1$. The second sequence follows immediately because $f$ is trivial on $P_K(\mathfrak{m})$.
\end{proof}

\marginpar{26 Jan 2024, Lecture 4}

\begin{defn}
    For $\mathfrak{m}$ a modulus, let 
    \begin{align*}
        &K_{\mathfrak{m}} = \{\alpha \in K^\times \mid (\alpha) \in I_K(\mathfrak{m})\}\\
        &K_{\mathfrak{m},1} = \{\alpha \in K^\times \mid  \alpha \equiv 1 \pmod{\mathfrak{m}_0}, \sigma(\alpha)>0 ~\forall \sigma \mid \mathfrak{m}_\infty\}.
    \end{align*}
\end{defn}
Note $P_k(\mathfrak{m}) = \{(\alpha) \in I_K(\mathfrak{m}) \mid  \alpha \in K_{\mathfrak{m},1}\}$.

\begin{theorem}
    The ray class group $I_K(\mathfrak{m})/P_K(\mathfrak{m})$ is a finite group with size \[
    h_K(\mathfrak{m}) = |I_K(\mathfrak{m})/P_K(\mathfrak{m})| = \frac{h_K \cdot \phi(\mathfrak{m})}{[\mathcal{O}_K^\times : (\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})]},
    \]
    where $h_K$ is the class number of $K$ and $\phi(\mathfrak{m}) = \phi(\mathfrak{m}_0)\phi(\mathfrak{m}_{\infty})$ with $\phi(\mathfrak{m}_0) = |(\mathcal{O}_K/\mathfrak{m}_0)^\times| = N(\mathfrak{m}_0) \cdot \prod_{\mathfrak{p} \mid \mathfrak{m}_0}^{} (1-N(\mathfrak{p}^{-1}))$ and $\phi(\mathfrak{m}_{\infty}) = 2^{\# \mathfrak{m}_{\infty}}$ where $\# \mathfrak{m}_{\infty}$ is the number of infinite real primes dividing $\mathfrak{m}$.
\end{theorem}
\begin{proof}
    \textbf{Step 1.} $P_{\mathfrak{m}}/P_K(\mathfrak{m}) \cong K_{\mathfrak{m}}/\mathcal{O}_K^\times K_{\mathfrak{m},1}$.
    \begin{proof}[Proof of Step 1]
        Consider $K_{\mathfrak{m}} \to P_{\mathfrak{m}}/P_K(\mathfrak{m})$ by $\alpha \mapsto (\alpha)P_K(\mathfrak{m})$. This is a surjective homomorphism with kernel 
        \begin{align*}
            &\{\alpha \in K_{\mathfrak{m}}\mid  (\alpha) \in P_K(\mathfrak{m})\} \\
            =& \{\alpha \in K_{\mathfrak{m}} \mid \exists \beta \in K_{\mathfrak{m},1} \text{ s.t. }(\alpha)=(\beta)\} \\
            =& \{\alpha \in K_{\mathfrak{m}} \mid \exists \beta \in K_{\mathfrak{m},1} \text{ s.t. }\beta = \alpha\cdot \epsilon \text{ for some }\epsilon \in \mathcal{O}_K^\times\}.
        \end{align*}
    \end{proof}
    \textbf{Step 2.} $K_{\mathfrak{m}}/K_{\mathfrak{m},1} \cong \{\pm 1\}^{\# \mathfrak{m}_{\infty}} \times (\mathcal{O}_K/\mathfrak{m}_0)^\times$.
    \begin{proof}[Proof of Step 2]
        We can write $\alpha \in K_{\mathfrak{m}}$ as $\alpha = \frac{a}{b}$ for $a,b \in \mathcal{O}_K$ coprime, and $(a)$, $(b)$ coprime to $\mathfrak{m}_0$. For such $a,b$, the images $\overline{a},\overline{b} \in \mathcal{O}_K/\mathfrak{m}_0$ lie in $(\mathcal{O}_K/\mathfrak{m}_0)^\times$. Consider the map 
        \begin{align*}
            K_{\mathfrak{m}} &\to \left( \prod_{\sigma \mid \mathfrak{m}_{\infty}}^{} \{\pm 1\}\right) \times (\mathcal{O}_K/\mathfrak{m}_0)^\times\\
            \alpha &\mapsto \left(\prod_{\sigma \mid \mathfrak{m}_{\infty}}^{} \text{sgn}(\sigma(\alpha)) \right) \times \overline{\alpha}
        \end{align*}
        for $\overline{\alpha} = \overline{a} \overline{b}^{-1} \in (\mathcal{O}_K/\mathfrak{m}_0)^\times$. This map is surjective: this is on Ex. Sheet 1, use the Approximation Theorem. It has kernel 
        \begin{align*}
            \{\alpha \in K_{\mathfrak{m}}\mid \sigma(\alpha) > 0 ~\forall \sigma \mid \mathfrak{m}_{\infty}, ~\alpha \equiv 1 \text{ (mod }\mathfrak{m}_0)\} = K_{\mathfrak{m},1}.
        \end{align*}
    \end{proof}
    \textbf{Step 3.} $\mathcal{O}_K^\times K_{\mathfrak{m},1}/K_{\mathfrak{m},1} \cong \mathcal{O}_K^\times/(\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})$.
    \begin{proof}[Proof of Step 3.]
        This is just the second isomorphism theorem.
    \end{proof}
    \vspace{1mm}
     
    Putting it all together:
    \begin{align*}
        [I_K(\mathfrak{m}):P_K(\mathfrak{m})] = [I_K(\mathfrak{m}):P_{\mathfrak{m}}][P_{\mathfrak{m}}:P_K(\mathfrak{m})]
    \end{align*}
    and \begin{align*}
        (P_\mathfrak{m}/P_K(\mathfrak{m})) &\stackrel{\text{(i)}}{\cong}  K_{\mathfrak{m}}/\mathcal{O}_K^\times K_{\mathfrak{m},1} \\
        &\cong (K_{\mathfrak{m}}/K_{\mathfrak{m},1})/(\mathcal{O}_K^\times K_{\mathfrak{m},1}/K_{\mathfrak{m},1}) \\
        &\stackrel{\text{(iii)}}{\cong}  (K_{\mathfrak{m}}/K_{\mathfrak{m},1})/(\mathcal{O}_K^\times/(\mathcal{O}_K^\times \cap K_{\mathfrak{m},1}))
    \end{align*}
    and \begin{align*}
        I_K(\mathfrak{m})/P_\mathfrak{m} \cong \text{Cl}(K)
    \end{align*}
    by Proposition \ref{prop1.5}.
    \vspace{1mm}
     
    This gives 
    \begin{align*}
        &[I_K(\mathfrak{m}) : P_K(\mathfrak{m})] = [I_K(\mathfrak{m}) : P_{\mathfrak{m}}][P_\mathfrak{m} : P_K(\mathfrak{m})] \\
        =& |\text{Cl}(K)| \frac{[K_{\mathfrak{m}}:K_{\mathfrak{m},1}]}{[\mathcal{O}_K: (\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})]} \stackrel{\text{(ii)}}{=}  \frac{h_K \cdot \phi(\mathfrak{\mathfrak{m}})}{[\mathcal{O}_K : (\mathcal{O}_K^\times \cap K_{\mathfrak{m},1})]}.
    \end{align*}
\end{proof}
Next we have more general class groups, i.e. $I_K(\mathfrak{m})/H$ with $P_K(\mathfrak{m}) \subset H$.
\begin{defn}
    A subgroup $H \subset I_K(\mathfrak{m})$ is a \textbf{congruence subgroup} for $\mathfrak{m}$ if it satisfies $P_k(\mathfrak{m}) \subset  H \subset I_K(\mathfrak{m})$.
\end{defn}
Motivation: For ''suitably chosen'' moduli $\mathfrak{m}$, the congruence subgroup will be the kernel of the Artin map $\Phi_{\mathfrak{m}}$.

\begin{defn}
    Let $H$ be a congruence subgroup for $\mathfrak{m}$, then the quotient $I_K(\mathfrak{m})/H$ is called a \textbf{generalized ideal class group} for $\mathfrak{m}$.
\end{defn}
\textbf{Remark.} Recall that for $K=\mathbb{Q}$ and $\mathfrak{m}=(m)\infty$ for $m$ a positive integer, we saw $I_K(\mathfrak{m})/P_K(\mathfrak{m}) \cong (\mathbb{Z}/m\mathbb{Z})^\times$ and \[
(\mathbb{Z}/m\mathbb{Z})^\times \cong \text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q}) \cong I_K(\mathfrak{m})/P_K(\mathfrak{m})
\]
via the Artin map, so $\text{ker}(\Phi_{\mathbb{Q}(\zeta_m)/\mathbb{Q},\mathfrak{m}}) = P_K(\mathfrak{m})$.
\vspace{1mm}
 
The idea of class field theory is that generalized ideal class groups are Galois groups of abelian extensions and that the link between them is given by the Artin map. We will prove that the Artin map is surjective. Determining the kernel is a lot more difficult (not done in this course).
\vspace{1mm}
 
What is the meaning of ''suitably chosen'' above? For $L/K$ abelian, we want to know for which moduli $\mathfrak{m}$ will $\text{ker}(\Phi_\mathfrak{m})$ be a congruence subgroup.
\begin{lemma}\label{lemma1.7}
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus divisible by all ramified primes. If $\mathfrak{n}$ is another modulus such that $\mathfrak{m} \mid \mathfrak{n}$, then \[
    P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{\mathfrak{m}}) \implies P_K(\mathfrak{n}) \subset  \text{ker}(\Phi_{\mathfrak{n}}).
    \]
\end{lemma}
\begin{proof}
    Note first that if $\mathfrak{m} \mid \mathfrak{n}$, then $I_K(\mathfrak{n}) \subset I_K(\mathfrak{m})$, so $\Phi_\mathfrak{n} : I_K(\mathfrak{n}) \to \text{Gal}(L/K)$ is well--defined and $\Phi_{\mathfrak{n}} = \Phi_{\mathfrak{m}}|_{I_K(\mathfrak{m})}$, so $\text{ker}(\Phi_{\mathfrak{n}}) = \text{ker}(\Phi_{\mathfrak{m}}) \cap I_K(\mathfrak{n})$. If $\mathfrak{m} \mid \mathfrak{n}$, then $P_K(\mathfrak{n}) \subset P_K(\mathfrak{m})$. Now $P_K(\mathfrak{n}) \subset P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{\mathfrak{m}})$, so \[
        (\alpha) \in P_K(\mathfrak{n}) \subset P_K(\mathfrak{m}) \cap I_K(\mathfrak{n}) \subset \text{ker}(\Phi_{\mathfrak{m}}) \cap I_K(\mathfrak{n}) = \text{ker}(\Phi_{\mathfrak{n}}).
        \qedhere
    \]
\end{proof}
In the above situation, if $\text{ker}(\Phi_{\mathfrak{m}})$ is a congruence subgroup for $\mathfrak{m}$, then $\text{ker}(\Phi_{\mathfrak{n}})$ is a congruence subgroup for $\mathfrak{n}$.
\vspace{1mm}
 
Now we find a special modulus that works for each extension, called \textbf{the conductor}. 

\marginpar{29 Jan 2024, Lecture 5}

\textbf{Statements of global class field theory (ideal theoretic).} For $L/K$ abelian, we are interested to find out for which $\mathfrak{m} \subset \mathcal{O}_K$ is $\text{ker}(\Phi_{L/K,\mathfrak{m}})$ a congruence subgroup (i.e. $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K, \mathfrak{m}})$).
\begin{theorem}[The Conductor Theorem]
    Let $L/K$ be abelian. Then there is a modulus $\mathfrak{f}=\mathfrak{f}(L/K)$ such that 
    \begin{itemize}
        \item a prime of $K$, finite or infinite, ramifies in $L$ if and only if it divides $\mathfrak{f}_{L/K}$.
        \item If $\mathfrak{m}$ is divisible by all primes that ramify, then $\text{ker}(\Phi_{L/K, \mathfrak{m}})$ is a congruence subgroup for $\mathfrak{m}$ if and only if $\mathfrak{f}_{L/K} \mid \mathfrak{m}$.
    \end{itemize}
\end{theorem}
\begin{defn}
    The modulus $\mathfrak{f}_{L/K}$ is uniquely determined by $L/K$ and called the \textbf{conductor}.
\end{defn}
\begin{example}
    Let $K=\mathbb{Q}$ and let $L = \mathbb{Q}(\sqrt{N})$ for $N \neq 0,1$ squarefree. Then $\mathfrak{f}_{L/K} = \begin{cases}
        \left|d_{L/K} \right| & N>0\\
        \left|d_{L/K} \right|{\infty} & N<0.
    \end{cases}$ ($\left|D_{L/K}\right|{\infty}$ is the real infinite place of $\mathbb{Q}$).
\end{example}
\textbf{Remark.} The conductor is not just the product of ramified primes. In Ex. Sheet 1, there will be a cubic extension $L/\mathbb{Q}$ which is ramified only at 3. However, for $\mathfrak{m} = (3)$ or $\mathfrak{m} = (3)\infty$, $\text{ker}(\Phi_{L/\mathbb{Q},\mathfrak{m}})$ is not a congruence subgroup, so $\mathfrak{f}_{L/Q}\nmid (3)$ and $\mathfrak{f}_{L/\mathbb{Q}}\nmid (3)\infty$.
\vspace{1mm}
 
Next we focus on the kernel. Recall that if $\mathcal{P} \subset \mathcal{O}_L$ is a prime ideal, then we have $N_{L/K}(\mathcal{P}) = \mathfrak{p}^{f_{\mathcal{P}/\mathfrak{p}}}$ if $\mathfrak{p} = \mathcal{P} \cap \mathcal{O}_K$.
\vspace{1mm}
 
\textbf{Notation.} Let $N_{L/K}: I_K \to I_K$ be the norm map, given by $\mathfrak{a} \mapsto N_{L/K}(\mathfrak{a})$. If $\mathfrak{a} =\prod_{i=1}^{n} \mathcal{P}_i^{r_i}$, then $N_{L/K}(\mathfrak{a}) = \prod_{i=1}^{n} (N(\mathcal{P}_i)^{r_i}) = \prod_{i=1}^{n} (\mathfrak{p}_i^{f_{\mathcal{P}_i/\mathfrak{p}_i}})^{r_i}$.
\begin{defn}
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus of $K$ divisible by $\mathfrak{f}(L/K)$. Then the \textbf{norm group} (also called a Takagi group) is the congruence subgroup
    \[
    T_{L/K}(\mathfrak{m}) = P_K(\mathfrak{m})N_{L/K}(I_L(\mathfrak{m})),
    \]
    where $I_L(\mathfrak{m})$ is the subgroup of $I_L$ with elements fractional ideals that are coprime to $\mathfrak{m}\mathcal{O}_L$.
\end{defn}
\begin{theorem}[Artin Reciprocity Theorem]
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus of $K$ divisible by all ramified primes (both finite and infinite). Then the Artin map $\Phi_{L/K,\mathfrak{m}}(I_K(\mathfrak{m})) \to \text{Gal}(L/K)$ is surjective.
    \vspace{1mm}
     
    If also $\mathfrak{f}_{L/K} \mid \mathfrak{m}$, so that $\text{ker}(\Phi_{\mathfrak{m}})$ is a congruence subgroup, then $\text{ker}(\Phi_{L/K,\mathfrak{m}}) = T_{L/K}(\mathfrak{m})$ and the Artin map defines an isomorphism \[
    I_K(\mathfrak{m})/T_{L/K}(\mathfrak{m}) \cong \text{Gal}(L/K).
    \]
    So $\text{Gal}(L/K)$ is the generalized ideal class group for $\mathfrak{m}$. 
\end{theorem}
Artin reciprocity gives us information about the decomposition of primes:
\begin{theorem}[Decomposition law]
    Let $L/K$ be abelian of degree $n$ and let $\mathfrak{p} \subset \mathcal{O}_K$ be an unramified prime ideal. Let $\mathfrak{m}$ be divisible by $\mathfrak{f}(L/K)$, but not by $\mathfrak{p}$. Let $H = \text{ker}(\Phi_{\mathfrak{m}})$ be the congruence subgroup for $\mathfrak{m}$. Let $f$ be the smallest positive integer such that $\mathfrak{p}^{f} \in H$, i.e. $f$ is the order of $\mathfrak{p}$ mod $H$ in $I_K(\mathfrak{m})/H$. Then $\mathfrak{p}$ decomposes in $L$ into a product $$\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1 \ldots \mathcal{P}_g$$ for $g = \frac{n}{f}$ of distinct prime ideals of degree $f$ over $\mathfrak{p}$.
\end{theorem}
\begin{proof}
    Let $\mathfrak{p}\mathcal{O}_L = \mathcal{P}_1\ldots\mathcal{P}_g$ be the prime decomposition in $L$. These have to be distinct as $\mathfrak{p}$ is unramified, and all $\mathcal{P}_i$ have the same residue field degree $f_{\mathcal{P}_i/\mathfrak{p}}$ (as the extension is abelian, in particular Galois). We know that $f_{\mathcal{P}_i/\mathfrak{p}}$ is the order of $\left(\frac{L/K}{\mathfrak{p}}\right)$ and so under the isomorphism $I_K(\mathfrak{m})/H \cong \text{Gal}(L/K)$, this means it is also the order of $\mathfrak{p}$ mod $H$ in $I_K(\mathfrak{m})/H$. The result follows since $[L:K] = n = efg = fg$.
\end{proof}
Next we want to show that every generalized ideal class group is the Galois group of some abelian extension and that this extension is unique.
\begin{theorem}[The Existence Theorem]\label{theorem1.26}
    Let $\mathfrak{m}$ be a modulus of $f$ and let $H$ be a congruence subgroup for $\mathfrak{m}$. Then there exists a unique abelian extension $L/K$ with the following properties:
    \begin{itemize}
        \item All its ramified primes, finite or infinite, divide $\mathfrak{m}$.
        \item $H = T_{L/K}(\mathfrak{m})$.
        \item $I_K(\mathfrak{m})/H \cong \text{Gal}(L/K)$ under the Artin map $\Phi_{L/K,\mathfrak{m}}$.
    \end{itemize}
\end{theorem}
So for any number field $K$, we can find abelian extensions with specified ramification.
\begin{defn}
    Let $\mathfrak{m}$ be any modulus and let $H = P_K(\mathfrak{m})$. The \textbf{ray class field} is the unique abelian extension $K(\mathfrak{m})$ of $K$ such that $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K(\mathfrak{m})/K, \mathfrak{m}})$. This explains the name $\text{Gal}(K(\mathfrak{m})/K) \cong I_K(\mathfrak{m})/P_K(\mathfrak{m})$.
\end{defn}
\begin{example}
    Let $K=\mathbb{Q}$ and let $\mathfrak{m} = (m)\infty$ for $m$ odd or divisible by 4. Then $\mathbb{Q}(\mathfrak{m}) = \mathbb{Q}(\zeta_m)$. Taking $\mathfrak{m} = (m)$ instead gives $\mathbb{Q}(\mathfrak{m}) = \mathbb{Q}(\zeta_m + \zeta_m^{-1})$.
\end{example}
Next we want to show that every abelian extension is contained in a ray class field.
\marginpar{31 Jan 2024, Lecture 6}
In other words, given $K, \mathfrak{m}$, there is a unique abelian extension $K(\mathfrak{m})/K$ such that $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K(\mathfrak{m})/K,\mathfrak{m}})$.

\begin{prop}\label{prop1.12}
    Let $K\le L\le M$ be a tower of abelian extensions. Suppose $\mathfrak{m}$ contains all prime ideals $\mathfrak{p} \subset \mathcal{O}_K$ that ramify in $M$. Write $\text{res}: \text{Gal}(M/K) \to \text{Gal}(L/K)$ for the restriction map $\sigma \mapsto \sigma_L$. Then we have a commutative diagram $\begin{tikzcd}[]
        I_K(\mathfrak{m}) & \text{Gal}(M/K)\\
         & \text{Gal}(L/K)
        \arrow["\Phi_{M/K,\mathfrak{m}}", from=1-1, to=1-2]
        \arrow["\text{res}", from=1-2, to=2-2]
        \arrow["\Phi_{L/K,\mathfrak{m}}", from=1-1, to=2-2]
    \end{tikzcd}$. 
\end{prop}
\begin{proof}
    Exercise on Example Sheet 1.
\end{proof}
\begin{lemma}\label{lemma1.13}
    Let $L/K$ and $M/K$ be abelian extensions. Then $ L \subset M$ if and only if there is a modulus $\mathfrak{m}$ divisible by all primes of $K$ which ramify in either $L$ or $M$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K},\mathfrak{m}) \subset \text{ker}(\Phi_{L/K},\mathfrak{m})$.
\end{lemma}
\begin{proof}
    Suppose $L \subset M$. Then by Artin reciprocity, there exists $\mathfrak{m}_1$ for $L/K$ and $\mathfrak{m}_2$ for $M/K$ such that $P_K(\mathfrak{m_1}) \subset \text{ker}(\Phi_{L/K},\mathfrak{m}_1)$ and $P_K(\mathfrak{m}_2) \subset \text{ker}(\Phi_{M/K,\mathfrak{m}_2})$. By Lemma \ref{lemma1.7}, we can find $\mathfrak{m}$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$ and $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K,\mathfrak{m}})$. By Proposition \ref{prop1.12}, we have $\text{res} \circ \Phi_{M/K,\mathfrak{m}} = \Phi_{L/K,\mathfrak{m}}$, so $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K}, \mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$.
    \vspace{1mm}
     
    Now suppose we have $\mathfrak{m}$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{M/K}, \mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$. Then we get that under the map $\Phi_{M/K,\mathfrak{m}} : I_K(\mathfrak{m}) \to \text{Gal}(M/K)$, the subgroup $\text{ker}(\Phi_{L/K,\mathfrak{m}}) \subset I_K(\mathfrak{m})$ maps to a subgroup $H \subset \text{Gal}(M/K)$. By Galois theory, $H$ corresponds to an intermediate field $K \subset \tilde{L} \subset M$. Now apply the first part of the proof to $\tilde{L}\subset M$ to obtain  $\text{ker}(\Phi_{L/K,\mathfrak{m}}) = \text{ker}(\Phi_{\tilde{L}/M,\mathfrak{m}})$. By uniqueness, in the Existence Theorem, $L = \tilde{L} \subset M$.
\end{proof}
\begin{cor}
    Let $K$ be a number field. Then any abelian extension is contained in a ray class field.
\end{cor}
\begin{proof}
    Suppose $L/K$ is abelian and let $\mathfrak{m}$ be a modulus of $K$ such that $\mathfrak{f}_{L/K} \mid  \mathfrak{m}$. Then $H = \text{ker}(\Phi_{L/K,\mathfrak{m}})$ is a congruence subgroup for $\mathfrak{m}$. So $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K(\mathfrak{m})/K,\mathfrak{m}}) \subset H = \text{ker}(\Phi_{L/K},\mathfrak{m})$. By Lemma \ref{lemma1.13}, $L \subset K(\mathfrak{m})$.
\end{proof}

Before stating the Classification Theorem, we define an equivalence relation on the set of congruence subgroups. Why? 
\begin{itemize}
    \item If $\text{ker}(\Phi_\mathfrak{m})$ is a congruence subgroup for $\mathfrak{m}$, then $\text{ker}(\Phi_{\mathfrak{n}})$ is a congruence subgroup for $\mathfrak{n}$ for any modulus $\mathfrak{m} \mid  \mathfrak{n}$.
    \item Say a prime $\mathfrak{p}$ is in the support of $\mathfrak{m}$ if $\mathfrak{p} \mid \mathfrak{m}$. If $\mathfrak{m}$ and $\mathfrak{n}$ have the same support, then $I_K(\mathfrak{m}) = I_K(\mathfrak{n})$, but $P_K(\mathfrak{m})$ may differ from $P_K(\mathfrak{n})$.
\end{itemize}
\begin{defn}
    We say two congruence subgroups $H_1$ and $H_2$ are equivalent, written $H_1 \sim H_2$ if there is a modulus $\mathfrak{m}$ such that $I_K(\mathfrak{m}) \cap H_1 = I_K(\mathfrak{m}) \cap H_2$.
\end{defn}
Let $L/K$ be abelian. Let $\mathfrak{m}$ be such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$ and let $\mathfrak{m}'$ be such that $P_K(\mathfrak{m}') \subset \text{ker}(\Phi_{L/K,\mathfrak{m}'})$. Then $\text{ker}(\Phi_{L/K,\mathfrak{m}}) \sim \text{ker}(\Phi_{L/K,\mathfrak{m}'})$ because $$\text{ker}(\Phi_{L/K,\mathfrak{m}}) \cap I_K(\mathfrak{m}\mathfrak{m}') = \text{ker}(\Phi_{L/K},\mathfrak{m}\mathfrak{m}') = \text{ker}(\Phi_{L/K,\mathfrak{m}'}) \cap I_K(\mathfrak{m}\mathfrak{m}').$$ 
The collection of congruence subgroups $H$ for $\mathfrak{m}$ with $\mathfrak{m}$ such that $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}})$ lie in a single equivalence class of congruence subgroups. We write $H(L/K)$ for this class.

\begin{theorem}[The Classification Theorem]
    Let $K$ be a number field. Then there is a one--to--one inclusion--reversing correspondence 
    \begin{align*}
        \{\text{abelian extensions }L/K\} &\leftrightarrow \{\text{congruence subgroups}/\sim\}\\
        L/K &\mapsto H(L/K).
    \end{align*}
\end{theorem}
\textbf{''Applications'' of main theorems.}
\vspace{1mm}
 
\begin{theorem}[Kronecker--Weber theorem]
    Let $L/\mathbb{Q}$ be abelian. Then there is a positive integer $m$ such that $L \subset \mathbb{Q}(\zeta_m)$.
\end{theorem}
\begin{proof}
    By Artin reciprocity, there is a modulus $\mathfrak{m}$ satisfying the inclusions $P_{\mathbb{Q}}(\mathfrak{m}) \subset \text{ker}(\Phi_{L/\mathbb{Q}},\mathfrak{m}) \subset I_\mathbb{Q}(\mathfrak{m})$. Any modulus of $\mathbb{Q}$ will be $(m)$ or $(m)\infty$ for some $m$. By Lemma \ref{lemma1.7}, we may assume $\mathfrak{m} = (m)\infty$. We have $P_{\mathbb{Q}}(\mathfrak{m}) = \text{ker}(\Phi_{\mathbb{Q}(\zeta_m)/\mathbb{Q},\mathfrak{m}})$, so $P_{\mathbb{Q}}(\mathfrak{m}) = \text{ker}(\Phi_{\mathbb{Q}(\zeta_m)/\mathbb{Q},\mathfrak{m}}) \subset \text{ker}(\Phi_{L/\mathbb{Q},\mathfrak{m}})$. By Lemma \ref{lemma1.13}, we have $L \subset \mathbb{Q}(\zeta_m)$.
\end{proof}
\textbf{Remark.} There exist proofs of Kronecker--Weber that don't use class field theory (see e.g. \textit{Number Fields} by Marcus).
\vspace{1mm}
 
Hilbert Class Field: Given a number field $K$, by the Existence Theorem we can find an abelian extension and ''control'' the ramification. Now take $\mathfrak{m} = (1)$, then the corresponding abelian extension $K(\mathfrak{m})/K$ will be unramified at all primes (finite and infinite). We have $\Phi_{\mathfrak{m}}: I_K = I_K(1) \to \text{Gal}(K(1)/K)$ with kernel $P_K((1)) = P_K$, so we obtain $\text{Cl}(K) = I_K/P_K \cong \text{Gal}(K(1)/K)$. By the Existence Theorem, we obtain an unramified abelian extension with Galois group equal to the ideal class group. 
\begin{defn}
    The Hilbert class field $F$ is the ray class field for the modulus $\mathfrak{m}=(1)$.
\end{defn}
\begin{example}
    Let $K=\mathbb{Q}$. This is its own Hilbert class group (as $\text{Cl}(K)=1$).
\end{example}
\marginpar{02 Feb 2024, Lecture 7}
\begin{theorem}
    The Hilbert class field $F$ is the maximal unramified extension of $K$.
\end{theorem}
\begin{proof}
    Let $M$ be another unramified abelian extension. By the Conductor theorem, $\mathfrak{f}_{M/K} = (1)$. For $\mathfrak{m} = (1)$ we have $$P_K(\mathfrak{f}_{M/K}) = \underbrace{P_K(\mathfrak{m})}_{=\text{ker}(\Phi_{F/K,\mathfrak{m}})} \subset \text{ker}(\Phi_{M/K,\mathfrak{f}_{M/K}}).$$ By Lemma \ref{lemma1.13}, we have $M \subset F$.
\end{proof}
\begin{cor}
    Let $K$ be a number field. There is a one--to--one correspondence between unramified abelian expressions $M$ of $K$ and subgroups of the ideal class group $\text{Cl}(K)$. Furthermore, if $M/K$ corresponds to $H \subset \text{Cl}(K)$, then the Artin map induces an isomorphism 
    \begin{align*}
        \text{Cl}(K)/H \stackrel{\cong}{\to} \text{Gal}(M/K).
    \end{align*}
\end{cor}
\begin{proof}
    Let $F$ be the Hilbert class field at $K$. Then $\text{Gal}(F/K) \cong \text{Cl}(K)$. By Galois theory, there is a one-to-one inclusion-reversing correspondence between intermediate fields and subgroups of $\text{Gal}(F/K) \cong \text{Cl}(K)$. Since each unramified abelian extension is contained in $F$, the first part of the corollary follows.
    \vspace{1mm}
     
    Let $H$ be a subgroup of $\text{Gal}(F/K)$ and let \[
    M = F^H = \{x \in F \mid \sigma(x)=x ~\forall \sigma \in H\}.
    \]
    By Proposition \ref{prop1.12}, $\Phi_{M/K,\mathfrak{m}} : \text{Cl}(K) \to \text{Gal}(M/K)$ with $\Phi_{M/K,\mathfrak{m}} = \text{res} \circ \Phi_{F/K,\mathfrak{m}}$ and $\text{res}:\text{Gal}(F/K) \to \text{Gal}(M/K)$ by $\sigma \mapsto \sigma_M$. Now if $[a] \in H$, then $\Phi_{M/K,\mathfrak{m}}([a])=1$.
\end{proof}
\textbf{Fact.} Let $M_1/K$ and $M_2/K$ be extensions of number fields and $\mathfrak{p} \subset \mathcal{O}_K$ a prime ideal. If $\mathfrak{p}$ is unramified in both $M_1$ and $M_2$, then $\mathfrak{p}$ is unramified in the composite field $M_1M_2$.
\begin{example}
    Let $K = \mathbb{Q}(\sqrt{-5})$. We want to show the Hilbert class field $F$ is $\mathbb{Q}(\sqrt{-5},i)$. We know that $h_K=2$ and $\left|\text{Gal}(F/K)\right|=\left|\text{Cl}(K)\right|=2$, so $F$ is a quadratic unramified extension of $K$. Consider the diagram
    $$\begin{tikzcd}
        & \mathbb{Q}(\sqrt{-5},i) & \\
        \mathbb{Q}(i) & \mathbb{Q}(\sqrt{-5}) & \mathbb{Q}(\sqrt{5}) \\
        & \mathbb{Q} &
        \arrow[from=1-2, to=2-1, dash]
        \arrow[from=1-2, to=2-2, dash]
        \arrow["e_2\le 2", from=1-2, to=2-3, dash]
        \arrow[from=3-2, to=2-1, dash]
        \arrow["e_2 = 2", from=3-2, to=2-2, dash]
        \arrow["e_2 = 1", from=3-2, to=2-3, dash]
    \end{tikzcd}.$$
    \textbf{Fact.} If $\mathfrak{p}_F \subset \mathcal{O}_F$ and $\mathfrak{p}_M \subset \mathcal{O}_M$ with $M$ any of the intermediate fields, and if $p \in \mathbb{Z}$ is such that $\mathfrak{p}_F \mid \mathfrak{p}_M$ and $\mathfrak{p}_M \mid p$, then $e_{\mathfrak{p}_F/p} = e_{\mathfrak{p}_F/\mathfrak{p}_M}e_{\mathfrak{p}_M/p}\le [F:\mathbb{Q}] = 4$.

    \vspace{1mm}
     
    Since $\mathbb{Q}(i)/\mathbb{Q}$ has discriminant 8, the only ramified prime is 2. Similarly the only prime that ramifies in $\mathbb{Q}(\sqrt{5})/\mathbb{Q}$ is 5.If $p \neq 2,5$, then $p$ is unramified in $\mathbb{Q}(i)$ and $\mathbb{Q}(\sqrt{5})$, hence in $\mathbb{Q}(\sqrt{5},i)$. So $p$ is unramified in $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$.
    \vspace{1mm}
     
    Now $d_{K/\mathbb{Q}} = -20$, so the only ramified primes are 2 and 5. Suppose $2$ is ramified in $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$. Then $e_{\mathcal{P}_2/\mathfrak{p}_2}=2$, where $\mathfrak{p}_2$ is an ideal in $\mathbb{Q}(\sqrt{-5})$ such that $\mathfrak{p}_2 \mid 2$, $\mathcal{P}_2 \in \mathcal{O}_F$, $\mathcal{P}_2 \mid \mathfrak{p}_2$. Since 2 is unramified in $\mathbb{Q}(\sqrt{5})/\mathbb{Q}$, write $\mathfrak{q}_2$ for an ideal in $\mathbb{Q}(\sqrt{5})$ such that $\mathfrak{q}_2 \mid 2$. Then $e_{\mathcal{P}_2/2} = e_{\mathcal{P}_2/\mathfrak{q}_2}e_{\mathfrak{q_2}/2} = e_{\mathcal{P}_2/\mathfrak{q}_2}\cdot 1\le 2$ since $e_{\mathcal{P}_2/\mathfrak{q}_2}$ is at most $[F:\mathbb{Q}(\sqrt{5})]$. As $e_{\mathcal{P}_2/2} \neq 4$, 2 is unramified in $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$. In other words, just look at the diagram above (the notation here is bad but it's an easy example). The case $p=5$ is similar. Hence $\mathbb{Q}(\sqrt{-5},i)/\mathbb{Q}(\sqrt{-5})$ is unramified at all finite primes. In $\mathbb{Q}(\sqrt{-5})$ we only have one infinite prime, which is complex, so unramified by definition. Hence $(\sqrt{-5},i)$ is the Hilbert class field of $\mathbb{Q}(\sqrt{-5})$.
\end{example}
\begin{defn}
    The \textbf{narrow Hilbert class field} is the maximal abelian extension unramified at all finite primes.
\end{defn}
\begin{cor}
    Let $f$ be the Hilbert class field of $K$. Let $\mathfrak{p}$ be a prime ideal of $K$. Then $\mathfrak{p}$ splits completely in $F \iff \mathfrak{p}$ is a principal ideal.
\end{cor}
We can prove this in two ways: either we deduce this from the decomposition law, or we prove it directly, which we will now do.
\begin{proof}
    We know $\mathfrak{p}$ splits completely in $F$ if and only if $\left(\frac{F/K}{\mathfrak{p}}\right)=1$, and $\text{Cl}(K) \cong \text{Gal}(F/K)$. So \[
    \left(\frac{F/K}{\mathfrak{p}}\right) = 1 \iff [p]=[1] \text{ in }\text{Cl}(K).
    \qedhere\] 
\end{proof}
\begin{theorem}[Principal ideal theorem]
    In the Hilbert class field, any ideal $\mathfrak{a}$ of $K$ becomes a principal ideal.
\end{theorem}
We don't prove this.
\begin{example}
    Let $K = \mathbb{Q}(\sqrt{-5})$. Then $\text{Cl}(K) = \langle[\mathcal{O}_K], [(2,1+\sqrt{-5})]\rangle$, $F = \mathbb{Q}(\sqrt{-5},i)$ and $(2,1+\sqrt{-5})\mathcal{O}_F$ is generated by $(1+i)$ in $\mathcal{O}_F$.
\end{example}
\subsection{Reciprocity theorems}
Let $K$ be a number field containing a primitive $n^{\text{th}}$ root of unity $\zeta$. Then for $\alpha \in \mathcal{O}_K$ coprime to $\mathfrak{p}$, we have Fermat's little theorem: $\alpha^{N(\mathfrak{p})-1} \equiv 1 \pmod{\mathfrak{p}}$.
\vspace{1mm}
 
Exercise: Suppose $\mathfrak{p} \subset \mathcal{O}_K, \alpha \in \mathcal{O}_K$ such that $n, \alpha \not\in \mathfrak{p}$. Prove that:
\begin{enumerate}[(i)]
    \item $1, \zeta,\zeta^{n-1}$ are distinct mod $\mathfrak{p}$.
    \item $n \mid N(\mathfrak{p})-1$.
    \item $\alpha^{N(\mathfrak{p}-1)/n}$ is congruent to a unique $n^{\text{th}}$ root of unity mod $\mathfrak{p}$.
\end{enumerate} 
\begin{defn}
    This unique root of unity is called the $n^{\text{h}}$ power Legendre symbol, written $\left(\frac{\alpha}{\mathfrak{p}}\right)_n$.
\end{defn}
\marginpar{05 Feb 2024, Lecture 8}
Let $K$ be a number field containing a primitive $n^{\text{th}}$ root of $\zeta$. Let $\alpha \in \mathcal{O}_K$ and $\mathfrak{p} \subset \mathcal{O}_K$ such that $n \alpha \not\in \mathfrak{p}$. We saw that there was a unique $n^{\text{th}}$ root of unity congruent to $\alpha^{(N(\mathfrak{p})-1)/n}$ mod $\mathfrak{p}$.
\vspace{1mm}
 
Next let $I \subset \mathcal{O}_K$ be an ideal prime to both $n$ and $\alpha$, then if $I = \mathfrak{p}_1\ldots \mathfrak{p}_r, $\[
\left(\frac{\alpha}{I}\right)_n = \prod_{i=1}^{r} \left(\frac{\alpha}{\mathfrak{p}_i}\right).
\]
Let $\mathfrak{m}$ be a modulus containing all primes that contain $n \alpha$. Then we get a homomorphism $\left(\frac{\alpha}{\cdot }\right)_{n} : I_K(\mathfrak{m}) \to  \mu_n$ with $\mu_n \subset \mathbb{C}^\times$ the group of $n^{\text{th}}$ roots of unity. Let $L = K(\sqrt[n]{\alpha})$. Then $L/K$ is a Galois extension. If $\sigma \in \text{Gal}(L/K)$, then $\sigma(\sqrt[n]{\alpha}) = \zeta \sqrt[n]{\alpha}$ for some $n^{\text{th}}$ root of unity, i.e. we obtain an injective homomorphism $\text{Gal}(L/K) \hookrightarrow \mu_n$ by $\sigma \mapsto \zeta$.
\vspace{1mm}
 
\textbf{Exercises.} 1. Show that if $n \alpha \not\in \mathfrak{p}$, then $\mathfrak{p}$ is unramified in $L$.
\vspace{1mm}
 
2. Show that $\left(\frac{L/K}{\mathfrak{p}}\right)(\sqrt[n]{\alpha}) = \left(\frac{\alpha}{\mathfrak{p}}\right)_n \sqrt[n]{\alpha}$.

\begin{theorem}[Weak reciprocity]
    Let $K$ be a number field containing a primitive $n^{\text{h}}$ root of unity. Let $\alpha \in \mathcal{O}_K$ be nonzero and $L = K(\sqrt[n]{\alpha})$. Let $\mathfrak{m}$ be a modulus divisible by all primes of $K$ containing $n \alpha$, and assume that $\text{ker}(\Phi_{L/K,\mathfrak{m}})$ is a congruence subgroup. Then there is a commutative diagram $\begin{tikzcd}[]
        I_K(\mathfrak{m}) & \text{Gal}(L/K)\\
         & \mu_n
        \arrow["\Phi_{L/K,\mathfrak{m}}", from=1-1, to=1-2]
        \arrow["", from=1-2, to=2-2]
        \arrow["\left(\frac{\alpha}{\cdot }\right)_n", from=1-1, to=2-2, swap]
    \end{tikzcd}$. 
    Let $G$ be the image of $\text{Gal}(L/K)$ in $\mu_n$, then $\left(\frac{\alpha}{\cdot }\right)_n$ induces a surjective homomorphism \[
    \left(\frac{\alpha}{\cdot }\right)_n : I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to G \subset \mu_n.
    \]
\end{theorem}
\begin{proof}
    Commutativity follows from the second exercise above. Based on our assumptions, we have $P_K(\mathfrak{m}) \subset \text{ker}(\Phi_{L/K,\mathfrak{m}}) \subset I_K(\mathfrak{m})$. So by the commutative diagram, $\left(\frac{\alpha}{\cdot }\right)_n$ induces a surjective homomorphism $$I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to I_K(\mathfrak{m})/\text{ker}(\Phi_{L/K},\mathfrak{m}) \cong \text{Gal}(L/K) \to G \subset \mu_n.$$
\end{proof}
Strong reciprocity gives a formula for computing $\left(\frac{\alpha}{\cdot }\right)_n$ using Hilbert symbols. We can use Weak reciprocity to prove:
\begin{theorem}[Quadratic reciprocity]
    Let $p$ and $q$ be distinct odd primes. Then $\left(\frac{p}{q}\right)\left(\frac{q}{p}\right) = (-1)^{\frac{(p-1)(q-1)}{4}}$.
\end{theorem}
\begin{proof}
    A series of exercises.
\end{proof}
\section{Characters, zeta functions and $L$--series}
\textbf{Motivation.} In number theory, many arithmetic properties are captured in analytic objects.
\subsection{Dirichlet series}
\begin{defn}\label{defn2.1}
    A \textbf{Dirichlet series} is a series of the form \[
    f(s) = \sum_{n=1}^{\infty} \frac{a_n}{n^s}
    \]
    where $a_n \in \mathbb{C}$ and $s \in \mathbb{C}$.
\end{defn}
\begin{lemma}[Abel summation/Abel's lemma]\label{lemma2.2}
    If $(a_n)$ and $(b_n)$ are sequences of complex numbers, then \[
    \sum_{n=N}^{M} a_nb_n = \sum_{n=N}^{M-1} \left(\sum_{k=N}^{n} a_k\right)(b_n-b_{n+1}) + \left(\sum_{k=N}^{M} a_k \right)b_M. 
    \]
\end{lemma}
\begin{proof}
    Exercise.
\end{proof}
\textbf{Interlude}: Convergence review.
\begin{itemize}
    \item We say a series $\sum_{n=1}^{\infty} a_n$ of complex numbers converges to $L$ if the sequence of partial sums $(A_n)$ with $A_n = \sum_{k=1}^{n} a_k$ converges to $L$.
    \item We say a series $\sum_{n=1}^{\infty} a_n$ of complex numbers converges absolutely if the series $\sum_{n}^{} \left|a_n\right|$ of nonnegative real numbers converges.
    \item A sequence of complex functions $(f_n(z))$ is uniformly convergent on $S \subset \mathbb{C}$ if $\forall \epsilon>0 ~ \exists N \in \mathbb{N}$ such that if $n>N$, then $\left|f_n(z) - f(z)\right|<\epsilon ~\forall z \in S$. 
    \item A series of complex functions $\sum_{n=1}^{\infty} f_n(z)$ converges on $S$ if for each $z_0 \in S$, $\sum_{n=1}^{\infty} f_n(z_0)$ converges as a series of complex numbers. It converges uniformly on $S$ if the sequence of partial sums $(A_n(z))$ converges uniformly on $S$.
    \item An infinite product $\prod_{n}^{} a_n$ of nonzero complex numbers is absolutely convergent when the sum $\sum_{n}^{} \log a_n$ is, in which case $\prod_{n}^{} a_n = \exp (\sum_{n}^{} \log a_n)$.
\end{itemize}
\begin{theorem}\label{theorem2.3}
    Let $(a_n)$ be a sequence of complex numbers. If $f(s) = \sum_{n=1}^{\infty} \frac{a_n}{n^s}$ converges for some $s=s_0$, then it converges for any $s \in \mathbb{C}$ with $\text{Re}(s)>\text{Re}(s_0)$. Moreover, it converges uniformly on every domain of the form $\{s \mid \text{Re}(s)>\text{Re}(s_0), \left|\text{Arg}(s-s_0)\right|\le \theta\}$ for $\theta < \frac{\pi}{2}$.\footnote{We also need that our domain is compact.}
\end{theorem}
\begin{proof}
    Note that 
    \begin{align*}
        f(s) &= \sum_{n=1}^{\infty} \frac{1}{n^{s_0}}\frac{a_n}{n^{s-s_0}} \\
        &= \sum_{n=1}^{\infty} \frac{\tilde{a}_n}{n^{s-s_0}},
    \end{align*}
    where $\tilde{a}_n = \frac{a_n}{n^{s_0}}$. We can assume $s_0 = 0$, so $\sum_{n=1}^{\infty} a_n$ converges. Let $\epsilon>0$. Since $\sum_{n=1}^{\infty} a_n$ converges, there is a sufficiently large number $N_0$ such that if $M>N\ge N_0$, then $\left|\sum_{n=N}^{M} a_n\right|<\epsilon$. Let $b_n = n^{-s}$ and apply Abel's lemma to get
    \begin{align*}
        \sum_{n=N}^{M} a_n n^{-s} = \sum_{n=N}^{M-1} \left(\sum_{k=N}^{n} a_k\right)\left(n^{-s} - (n+1)^{-s}\right) + \left(\sum_{n=N}^{M} a_n \right)M^{-s}. 
    \end{align*}
    We have 
    \begin{align*}
        \left|e^{-cs}-e^{-ds}\right| \le \left|s\right|\int_{c}^{d} e^{-t \text{\text{Re}(s)}}\mathrm{d}t = \frac{\left|s\right|}{\text{Re}(s)}\left(e^{-c \text{Re}(s)} - e^{-d \text{Re}(s)}\right)
    \end{align*}
    and $\frac{\left|s\right|}{\text{Re}(s)}$ is bounded by some $B$ in our domain $\text{Re}(s)>0$, and $\left|\text{Arg}(s)\right|<\theta$ for some $\theta < \frac{\pi}{2}$. Choosing $c = \log n$ and $d = \log (n+1)$ gives \[
    \left|n^{-s} - (n+1)^{-s}\right| \le \frac{\left|s\right|}{\text{Re}(s)} \left(n^{-\text{Re}(s)} - (n+1)^{-\text{Re}(s)}\right) \le B(n^{-\text{Re}(s)}-(n+1)^{-\text{Re}(s)}).
    \]
    This gives
    \begin{align*}
        &\left|\sum_{n=N}^{M} a_n n^{-s}\right| \le \sum_{n=N}^{M-1} \left|\sum_{k=N}^{n} a_k\right| \left|n^{-s} - (n+1)^{-s}\right| + \left|\sum_{n=N}^{M} a_n\right| \left|M^{-s}\right| \\
        \le & B \epsilon \sum_{n=N}^{M-1} \left(n^{-\text{Re}(s)} - (n+1)^{-\text{Re}(s)}\right) + \epsilon M^{-\text{Re}(s)}\\
        \le & \epsilon(B+1)
    \end{align*}
    for $N,M$ large enough. The final part follows since any $s$ with $\text{Re}(s)>0$ is contained in a domain of the form $\{s \mid \text{Re}(s)>0, \left|\text{Arg}(s)\right|\le \theta\}$ for some $\theta < \frac{\pi}{2}$.
\end{proof}
\marginpar{07 Feb 2024, Lecture 9}
\begin{cor}\label{cor2.4}
    Let $f(s) =\sum_{}^{} a_n/n^s$ be a Dirichlet series.
    \begin{enumerate}[(i)]
        \item If the $a_n$ are bounded, then $f(s)$ converges absolutely for $\text{Re}(s)>1$.
        \item If $f(s)$ converges at $s=s_0$, then it converges absolutely for $\text{Re}(s)>\text{Re}(s_0)+1$.
    \end{enumerate}
\end{cor}
\begin{proof}
    Exercise.
\end{proof}
\begin{defn}\label{defn2.5}
    Suppose a Dirichlet series $\sum_{}^{} a_n/n^s$ converges for some $s$. Then the smallest real number $\sigma_0$ such that the series converges for $\text{Re}(s)>\sigma_0$ is called the \textbf{abscissa of convergence}.
\end{defn}
\begin{theorem}\label{theorem2.6}
    Assume there exists a number $C$ and $\sigma_1\ge 0$ such that $\left|A_n\right|=\left|a_1+\ldots+a_n\right|\le Cn^{\sigma_1} ~\forall n$. Then the abscissa of convergence of $\sum_{}^{} a_n/n^s$ is $\le \sigma_1$.
\end{theorem}
\begin{proof}
    We omit this. See e.g. \textit{Algebraic Number Theory} by Lang for the proof.
\end{proof}
\subsection{The Riemann zeta function}
\begin{defn}\label{defn2.7}
    Let $s \in \mathbb{C}$ with $\text{Re}(s)>1$. Then the Riemann zeta function is \[
    \zeta(s) = \sum_{n=1}^{\infty} \frac{1}{n^s}.
    \]
    By Theorem \ref{theorem2.6}, we have $\sigma_1=1$, so we know $\zeta(s)$ converges for $\text{Re}(s)>1$.
\end{defn}
We will extend $\zeta(s)$ meromorphically to $\text{Re}(s)>0$. Recall first that a function is (complex) analytic on some open $S \subset \mathbb{C}$ if for any $z_0 \in S$, we can write $f(z) = \sum_{n=0}^{\infty} a_n(z-z_0)^n$, where $a_n \in \mathbb{C}$ and the series converges to $f(z)$ for $z$ in a neighborhood of $z_0$. This is equivalent to being holomorphic.
\vspace{1mm}
 
A function is meromorphic on $S \subset \mathbb{C}$ if it is holomorphic on all of $S$, except for a set of isolated points called poles. If $f$ is meromorphic, a pole of $f$ is a zero of $\frac{1}{f}$. Suppose $z_0$ is a pole, then for some integer $n$, $(z-z_0)^nf(z)$ is holomorphic and nonzero in a neighborhood of $z_0$, and then $z_0$ is a pole of order $n$. If $n=1$, then $z_0$ is called a simple pole and the residue is $\text{Res}(f,z_0) = \lim_{z \to z_0}(z-z_0)f(z)$.

\vspace{1mm}
 
If $f$ is a meromorphic/analytic function defined on some open $S \subset \mathbb{C}$ with $S \subset T$, $T \subset \mathbb{C}$ open, and $F$ is a meromorphic/analytic function defined on $T$ such that $F(z)=f(z) ~\forall z \in S$, then $F$ is called a meromorphic/analytic continuation of $f$.
\begin{theorem}\label{theorem2.8}
    The Riemann zeta function $\zeta(s)$ has a meromorphic continuation to $\text{Re}(s)>0$ with a simple pole at $s=1$ with residue equal to 1. If $\delta>0$, then the series $\sum_{n=1}^{\infty} 1/n^s$ converges absolutely in the region $\text{Re}(s)\ge 1+\delta$.
\end{theorem}
(In fact, the Riemann zeta function is analytic for $\text{Re}(s)>0$ except for the simple pole at $s=1$.)
\begin{proof}
    Let $s>1$ be real. Then 
    \begin{align*}
        \frac{1}{s-1} \le \int_{1}^{\infty} \frac{1}{x^s} \mathrm{d}x \le \zeta(s) \le 1 + \frac{1}{s-1},
    \end{align*}
    so for $s>1$, $1\le (s-1)\zeta(s) \le s$ and so $\lim_{s \to 1^+} (s-1)\zeta(s)=1$. If we show that we can continue (i.e. extend) $\zeta(s)$, we can conclude that $\zeta(s)$ has a simple pole at $s=1$ with residue 1.
    \vspace{1mm}
     
    To continue $\zeta(s)$, consider the alternating Riemann zeta function \[
    \zeta_2(s) = \sum_{n=1}^{\infty} \frac{(-1)^{n+1}}{n^s} = 1 - \frac{1}{2^s} + \frac{1}{3^s} - \ldots.
    \]
    Since the partial sums of the coefficients are 1 or 0, they are bounded, hence by Theorem \ref{theorem2.6}, this converges for $\text{Re}(s)>0$. We have 
    \begin{align*}
        &\frac{2}{2^s}\zeta(s) + \zeta_2(s) = \zeta(s) \\
        \implies & \zeta(s) = \zeta_2(s) \left(1-\frac{1}{2^{s-1}}\right)^{-1}.
    \end{align*}
    This gives us an analytic continuation to the line $\text{Re}(s)=0$. We show there are no poles except at $s=1$. From our expression for $\zeta_2(s)$, we see the only possible poles other than $s=1$ satisfy $1-2^{1-s}=0 \iff 2^{s-1}=1 \iff s = \frac{2\pi i n}{\log 2}+1$ for some integer $n$. Consider for $r=2,3,\ldots$ the function \[
    \zeta_r(s) = \frac{1}{1^s} + \frac{1}{2^s} + \ldots + \frac{1}{(r-1)^s} - \frac{r-1}{r^s} + \frac{1}{(r+1)^s} + \ldots,
    \]
    e.g. for $r=3$ we get
    \[
    \zeta_3(s) = \sum_{n=0}^{\infty} \frac{1}{(3n+1)^3} + \frac{1}{(3n+2)^3} - \frac{2}{(3n+3)^3}. 
    \]
    The partial sums of the coefficients are bounded by $r$, so $\zeta_r(s)$ converges for $\text{Re}(s)>0$ by Theorem \ref{theorem2.6}. We have 
    \begin{align*}
        &\zeta(s) = \frac{\zeta_r(s)}{1-\frac{1}{r^{s-1}}} \\
        \implies & \zeta(s) = \frac{\zeta_3(s)}{1-3^{1-s}},
    \end{align*}
    so the only poles occur when $3^{s-1}=1 \iff s = \frac{2\pi i m}{\log 3}+1$ for some integer $m$. Hence at any such pole we need $3^n = 2^m$, so $n=m=0$.
\end{proof}
\begin{theorem}\label{theorem2.9}
    Let $(a_n)$ be a sequence of complex numbers and let $A_n = a_1 + \ldots + a_n$. Let $0 \le \sigma_1 \le 1$ and assume there is $z_0 \in \mathbb{C}$ and a constant $C>0$ such that for all $n$, $\left|A_n - n z_0\right|\le Cn^{\sigma_1}$. Then $f(s) = \sum_{n=1}^{\infty} a_n/n^s$ (defined say for $\text{Re}(s)>1$) has an analytic continuation to $\text{Re}(s)>\sigma_1$ where it is analytic, except for a simple pole with residue $z_0$ at $s=1$. 
\end{theorem}
\begin{proof}
    Consider $f(s)-z_0\zeta(s)$ and apply Theorem \ref{theorem2.6} and Theorem \ref{theorem2.8}.
\end{proof}
\begin{prop}\label{prop2.10}
    We have \[
    \zeta(s) = \prod_{p}^{} \frac{1}{1-p^{-s}}.
    \]
\end{prop}
\begin{proof}
    We write $E(s) = \prod_{p}^{} \frac{1}{1-p^{-s}}$, then $\log E(s) = \sum_{p}^{} \sum_{n=1}^{\infty} \frac{1}{np^{ns}}$. Let $\text{Re}(s)>1+\delta$. Then $\left|p^{ns}\right| = p^{n \text{Re}(s)} \ge p^{(1+\delta)n}$, so
    \[
    \sum_{p}^{} \sum_{n=1}^{\infty} \left(\frac{1}{p^{1+\delta}}\right)^n = \sum_{p}^{} \frac{1}{p^{1+\delta}-1} \le 2\sum_{p}^{} \frac{1}{p^{1+\delta}}
    \]
    which converges, so the series $E(s)$ converges absolutely. We need to show equality, so again use $\frac{1}{1-p^{-s}}= 1 + p^{-s} + p^{-2s} + \ldots$. Fix $N \in \mathbb{N}$ and let $p_1,\ldots,p_r$ be the primes less than $N$. Then 
    \begin{align*}
        \prod_{p\le N}^{}\frac{1}{1-p^{-s}} = \prod_{v_1,\ldots,v_r\ge 0}^{\infty} \frac{1}{(p_1^{v_1}\ldots p_r^{v_r})^s} = \sum_{n}^{'} \frac{1}{n^s} 
    \end{align*}
    where $\Sigma'$ denotes the sum over all natural numbers only divisible by primes $p\le N$. It contains all $n\le N$, so 
    \begin{align*}
        &\prod_{p\le N}^{} \frac{1}{1-p^{-s}} = \sum_{n\le N}^{} \frac{1}{n^s}  + \sum_{n>N}^{'} \frac{1}{n^s} \\
        \implies & \left|\prod_{p\le N}^{} \frac{1}{1-p^{-s}} - \zeta(s)\right| \le \left|\sum_{n>N, p_i \nmid n}^{} \frac{1}{n^s}\right|\le \sum_{n>N}^{} \frac{1}{n^{1+\delta}} \stackrel{N \to \infty}{\to} 0. 
        \qedhere
    \end{align*}
\end{proof}
\marginpar{09 Feb 2024, Lecture 10}
\textbf{Remark.} If a Dirichlet series is convergent on some half plane $\text{Re}(s)>\sigma_0$, then it defines an analytic function on this half plane. This follows from Theorem \ref{theorem2.3}.
\begin{defn}\label{defn2.11}
    The \textbf{gamma function} is the absolutely convergent integral \[
    \Gamma(s) = \int_{0}^{\infty} e^{-y}y^s \frac{\mathrm{d}y}{y},
    \]
    defined for $\text{Re}(s)>0$.
\end{defn}
\begin{prop}\label{prop2.12}
    \begin{enumerate}[(i)]
        \item The gamma function is analytic and admits a meromorphic continuation to all of $\mathbb{C}$.
        \item The gamma function is nowhere zero and only has simple poles at $s = -n, n = 0,1,2,\ldots$ with residues $\frac{(-1)^n}{n!}$.
        \item We have the functional equations
        \begin{itemize}
            \item $\Gamma(s+1)=s \Gamma(s)$,
            \item $\Gamma(s) \Gamma(1-s) = \frac{\pi}{\sin(\pi s)}$,
            \item $\Gamma(s) \Gamma\left(s+\frac{1}{2}\right) = \frac{2\sqrt{\pi}}{2^{2s}}\Gamma(2s)$.
        \end{itemize}
        \item The gamma function has special values 
        \begin{itemize}
            \item $\Gamma \left(\frac{1}{2}\right) = \sqrt{\pi}$,
            \item $\Gamma(1)=1$,
            \item $\Gamma(k+1) = k! ~\forall k \in \mathbb{Z}_{\ge 0}$.
        \end{itemize}
    \end{enumerate}
\end{prop}
\begin{proof}
    Omitted.
\end{proof}
We use $\Gamma(s)$ to complete the Riemann zeta function. For $\Gamma(s) = \int_{0}^{\infty} e^{-y}y^s \frac{\mathrm{d}y}{y}$, substitue $y \mapsto \pi n^2y$ to get \[
\pi^{-s}\Gamma(s)\frac{1}{n^{2s}} = \int_{0}^{\infty} e^{-\pi n^2 y} y^s \frac{\mathrm{d}y}{y}
\]
and summing over all $n$ gives 
\begin{align*}
    \pi^{-s}\Gamma(s)\zeta(2s) = \int_{0}^{\infty} \sum_{n=1}^{\infty} e^{-\pi n^2 y} y^s \frac{\mathrm{d}y}{y}.
\end{align*}
Note we can swap the order of the ingral and the sum, since \[
\sum_{n=1}^{\infty} \int_{0}^{\infty} \left|e^{-\pi n^2 y}y^s\right|\frac{\mathrm{d}y}{y} = \sum_{n=1}^{\infty} \int_{0}^{\infty} e^{-\pi n^2 y}y^{\text{Re}(s)}\frac{\mathrm{d}y}{y} = \pi^{-\text{Re}(s)}\Gamma(\text{Re}(s))\zeta(2\text{Re}(s))
\]
for $\text{Re}(s)>1$.
\begin{defn}\label{defn2.13}
    The function \[
    Z(s) = \pi^{-s/2}\Gamma \left(\frac{s}{2}\right) \zeta(s)
    \]
    is called the \textbf{complete zeta function}.
\end{defn}
\begin{defn}\label{defn2.14}
    Let $\theta(z) = \sum_{n \in \mathbb{Z}} e^{\pi i n^2 z}$ be the \textbf{Jacobi theta series}.
\end{defn}
\begin{prop}\label{prop2.15}
    The series $\theta(z)$ is analytic on $\mathfrak{h} = \{z \in \mathbb{C} \mid \text{Im}(z)>0\}$ and satisfies $\theta \left(-\frac{1}{z}\right) = \sqrt{\frac{z}{i}}\theta(z)$, where $\sqrt{\frac{z}{i}} = e^{\frac{1}{2}\log(z/i)}$.
\end{prop}
\begin{proof}
    Omitted.
\end{proof}
\begin{prop}\label{prop2.16}
    We have $Z(s) = \frac{1}{2}\int_{0}^{\infty} \left(\theta(iy)-1\right) y^{s/2} \frac{\mathrm{d}y}{y}$.
\end{prop}
\begin{proof}
    Follows from the above and the fact that $\theta(z) = 1 + 2 \sum_{n=1}^{\infty} e^{\pi i n^2 z}$.
\end{proof}
\begin{defn}\label{defn2.17}
    Let $f : \mathbb{R}_+ \to \mathbb{C}$ be a continuous function (here $\mathbb{R}_+$ is the group of positive real numbers). Then the \textbf{Mellin transform} is the improper integral \[
    M(f,s) = \int_{0}^{\infty} (f(y)-f(\infty))y^s \frac{\mathrm{d}y}{y} 
    \]
    provided that the limit $f(\infty) = \lim_{y \to \infty}f(y)$ and the integral exist.
\end{defn}
\begin{theorem}[Mellin principle]\label{theorem2.18}
    Let $f,g : \mathbb{R}_+ \to \mathbb{C}$ be continuous such that $f(y) = a_0 + O(e^{-c_0 y^{\alpha}})$ and $g(y) = b_0 + O(e^{-c_0 y^{\alpha}})$ with $c_0, \alpha$ positive constants. If $f \left(\frac{1}{y}\right) = Cy^k g(y)$ for some real $k>0$ and some $0 \neq C \in \mathbb{C}$, then:
    \begin{enumerate}[(i)]
        \item The integrals $M(f,s)$ and $M(g,s)$ converge absolutely and uniformly for $s$ in a compact subset of $\{s \in \mathbb{C} \mid  \text{Re}(s)>k\}$ and admit holomorphic continuations to $\mathbb{C} \setminus  \{0,k\}$.
        \item The integrals have simple poles at $s=0$ and $s=k$ such that 
        \begin{align*}
            &\text{Res}_{s=0} M(f,s) = - a_0 &\text{Res}_{s=k} M(f,s) = C b_0\\
            &\text{Res}_{s=0} M(g,s) = -b_0 &\text{Res}_{s=k} M(g,s) = C^{-1} a_0.
        \end{align*}
        \item We have $M(f,s) = C M(g,k-s)$.
    \end{enumerate}
\end{theorem}
\begin{proof}
    Omitted.
\end{proof}
\begin{theorem}\label{theorem2.19}
    The completed zeta function $Z(s)$ admits an analytic continuation to $\mathbb{C}\setminus \{0,1\}$. It has simple poles at $s=0$ and $s=1$ with residues $-1$ and $1$, and satisfies the functional equation $Z(s)=Z(1-s)$.
\end{theorem}
\begin{proof}
    By Proposition \ref{prop2.16} and Definition \ref{defn2.17}, we have $Z(2s) = M(f,s)$ for $f(y) = \frac{1}{2\theta(iy)}$. Note $\theta(iy) = 1 + 2e^{-\pi y}(1+ \sum_{n=2}^{\infty} e^{-\pi(n^2-1)y})$, so we have $f(y) =\frac{1}{2} + O(e^{-\pi y})$. By Proposition \ref{prop2.15}, we have $$f \left(\frac{1}{y}\right) = \frac{1}{2}\theta(\frac{-1}{iy}) = \frac{1}{2}y^{1/2}\theta(iy) = y^{1/2}f(y).$$ So by the Mellin principle, $M(f,s)$ has a holomorphic continuation to $\mathbb{C}\setminus \left\{0,\frac{1}{2}\right\}$ with simple poles at $0$ and $\frac{1}{2}$ with residues $\frac{1}{2}$ and $-\frac{1}{2}$, and $M(f,s) = M(f,\frac{1}{2}-s)$. 
    
    \vspace{1mm}
     
    Hence $Z(s) = M\left(f,\frac{s}{2}\right)$ has a holomorphic continuation to $\mathbb{C} \setminus \{0,1\}$ with simple poles at $s=0$ and $s=1$ with residues $-1$ and $1$, and we obtain $Z(s) = M\left(f,\frac{s}{2}\right) = M \left(f, \frac{1-s}{2}\right) = Z(1-s)$.
\end{proof}
\begin{cor}\label{cor2.20}
    The function $\zeta(s)$ admits an analytic continuation to $\mathbb{C} \setminus \{1\}$, has a simple pole at $s=1$ with residue 1 and satisfies $$\zeta(1-s) = 2 (2\pi)^{-s}\Gamma(s) \sin \left(\frac{\pi(1-s)}{2}\right) \zeta(s).$$
\end{cor}
\begin{proof}
    Recall $z(s) = \pi^{-s/2}\Gamma \left(\frac{s}{2}\right)\zeta(s)$, which has a simple pole at $s=0$ and so does $\Gamma \left(\frac{s}{2}\right)$, hence $\zeta(s)$ has no pole at 0. At $s=1$, $Z(s)$ has a simple pole and $\Gamma \left(\frac{s}{2}\right)$ does not, so $\zeta(s)$ does. Now $$\text{Res}_{s=1}\zeta(s) = \pi^{1/2}\Gamma \left(\frac{1}{2}\right)^{-1} \text{Res}_{s=1}Z(s) = 1$$ by Theorem \ref{theorem2.19}. Now from the functional equation from Theorem \ref{theorem2.18}, \[
    \zeta(1-s) \stackrel{(\dagger)}{=} \pi^{\frac{1}{2}-s}\frac{\Gamma \left(\frac{s}{2}\right)}{\Gamma \left(\frac{1-s}{2}\right)} \zeta(s).
    \]
    By Proposition \ref{prop2.12}, we have \begin{align*}
        &\Gamma \left(\frac{s}{2}\right) \Gamma \left(\frac{1+s}{2}\right) = \frac{2\sqrt{\pi}}{2^s}\Gamma(s),\\
        &\Gamma \left(\frac{1-s}{2}\right) \Gamma \left(\frac{1+s}{2}\right) = \frac{\pi}{\sin \left(\frac{\pi s}{2}\right)},\\
        \implies & \frac{\Gamma \left(\frac{s}{2}\right)}{\Gamma \left(\frac{1-s}{2}\right)} = \frac{2}{2^s \sqrt{\pi}}\sin \left(\frac{\pi s}{2}\right) \Gamma(s).
    \end{align*}
    Insert this into $(\dagger)$ to get our result, i.e. 
    \begin{align*}
        \zeta(1-s) = 2 (2\pi)^{-s}\Gamma(s) \sin \left(\frac{\pi (1-s)}{2}\right) \zeta(s).
    \end{align*}
\end{proof}
What about the zeroes of $\zeta(s)$? We have that 
\begin{itemize}
    \item $\zeta(s) \neq 0$ for $\text{Re}(s)>1$.
    \item For $\text{Re}(s)<0$, we have trivial zeroes at $s=-2,-4,-6,\ldots$.
    \item Any other zeroes have to lie in the critical strip $0\le \text{Re}(s)\le 1$.
\end{itemize}
The Riemann hypothesis says that all the nontrivial zeroes of $\zeta(s)$ lie on the line $\text{Re}(s) = \frac{1}{2}$.

\subsection{The Dedekind zeta function}

\marginpar{12 Feb 2024, Lecture 11}

Let $K$ be a number field.
\begin{defn}\label{defn2.21}
    The \textbf{Dedekind zeta function} of $K$ is the series 
    \begin{align*}
        \zeta_K(s) = \sum_{\mathfrak{a}}^{} \frac{1}{N(\mathfrak{a})^s} 
    \end{align*}
    for $\mathfrak{a}$ varying over integral ideals of $K$, and $N(\mathfrak{a})$ the absolute norm.
\end{defn}
\begin{prop}\label{prop2.22}
    The series $\zeta_K(s)$ converges absolutely and uniformly in the domain $\{\text{Re}(s)>1+\delta\}$ for every $\delta>0$ and one has 
    \begin{align*}
        \zeta_K(s) = \prod_{\mathfrak{p}}^{} \frac{1}{1-N(\mathfrak{p})^s} 
    \end{align*}
    for $\mathfrak{p}$ running through the prime ideals of $K$.
\end{prop}
\begin{proof}
    Exercise. This is similar to the same proof for $\zeta(s)$.
\end{proof}
We can also complete $\zeta_K(s)$. Let $Z_{\infty}(s) = \left|d_{K/\mathbb{Q}}\right|^{5/2}\pi^{-ns/2}\Gamma_k \left(\frac{s}{2}\right)$ for $n$ the degree of $K$, the ''Euler factor at infinity''.
\begin{defn}\label{defn2.23}
    The \textbf{completed zeta function} of the number field $K$ is 
    \begin{align*}
        Z_{K}(s) = Z_{\infty}(s)\zeta_K(s).
    \end{align*}
\end{defn}
\begin{prop}\label{prop2.24}
    The completed zeta function $Z_K(s)$ admits an analytic continuation to $\mathbb{C}\setminus \{0,1\}$ and satisfies $Z_K(s) = Z_K(1-s)$. It has simple poles at $s =0$ and $s=1$ with residues $-\frac{2^r h_K R}{\omega}$ and $\frac{2^r h_K R}{\omega}$, where $r$ is the number of infinite primes, $h_K$ is the class number, $\omega$ is the number of roots of unity in $K$, and $R$ is the regulator.
\end{prop}
\begin{cor}\label{cor2.25}
    \begin{enumerate}[(i)]
        \item The Dedekind zeta function $\zeta_K(s)$ admits an analytic continuation to $\Gamma\setminus \{1\}$.
        \item At $s=1$, we have a simple pole with residue $$\text{Res}_{s=1}\zeta_K(s) = \frac{2^{r_1}(2\pi)^{r_2 }h_K R}{\omega \left|d_K\right|^{1/2}}$$
        for $r_1$ the number of real infinite primes and $r_2$ the number of complex infinite primes.
        \item We have the functional equation $\zeta_K(1-s) = A(s)\zeta_K(s)$.
    \end{enumerate}
\end{cor}
\textbf{Remark.} The formula for $\text{Res}_{s=1}\zeta_K(s)$ is known as the analytic class number formula. Let $\kappa = \frac{2^{r_1}(2\pi)^{r_2}R}{\omega \left|d_K\right|^{1/2}}$, then $\text{Res}_{s=1} \zeta_K(s) = \kappa h_K$.
\vspace{1mm}
 
Let $K=\mathbb{Q}(\sqrt{N})$ for $N \neq 0,1$ squarefree. We get
\begin{align*}
    \zeta_K(s) &= \prod_{\mathfrak{p}}^{}\left(1-\frac{1}{N(\mathfrak{p}^s)}\right)^{-1} \\ 
    &= \prod_{\mathfrak{p}\text{ splits}}^{} \left(1-\frac{1}{\mathfrak{p}^s}\right)^{-2} \prod_{\mathfrak{p}\text{ inert}}^{} \left(1-\frac{1}{\mathfrak{p}^{2s}}\right)^{-1} \prod_{\mathfrak{p}\text{ ramifies}}^{} \left(1-\frac{1}{\mathfrak{p}^s}\right)^{-1}.
\end{align*}
From this we see that $\zeta(s)$ divides $\zeta_K(s)$, and we have
\begin{align*}
    \zeta_K(s) = \prod_{\mathfrak{p}}^{} \left(1-\frac{1}{p^s}\right)^{-1} \prod_{\mathfrak{p}}^{} \left(1-\frac{\chi_K(\mathfrak{p})}{p^s}\right)^{-1},  
\end{align*}
where \[
\chi_K(\mathfrak{p}) = \begin{cases}
    1 & \mathfrak{p} \text{ splits}\\
    -1 & \mathfrak{p} \text{ inert}\\
    0 & \mathfrak{p} \text{ ramifies}
\end{cases}
\]
is an (extended) Dirichlet character.
\begin{defn}\label{2.26}
    A \textbf{Dirichlet chracter} mod $m$ is a homomorphism $$\chi : (\mathbb{Z}/m\mathbb{Z})^\times \to \mathbb{C}^\times.$$ It is called \textbf{primitive} if it doesn't arise as the composite $\left(\mathbb{Z}/m\mathbb{Z}\right)^\times \to (\mathbb{Z}/m'\mathbb{Z})^\times \stackrel{\chi'}{\to} \mathbb{C}^\times$ for a Dirichlet character $\chi'$ mod $m'$ for a proper divisor $m' \mid m$.

    \vspace{1mm}
     
    If $\chi$ is a Dirichlet character mod $\mathfrak{f}$ and $\chi$ is primitive, then $\mathfrak{f}$ is called the \textbf{conductor} of $\chi$.
\end{defn}
\textbf{Remark.} The conductor is the greatest common divisor of all $m' \mid m$ such that a Dirichlet character mod $m$ is induced from a character mod $m'$.
\vspace{1mm}
 
A Dirichlet character mod $m$ can be extended to all of $\mathbb{Z}$ as follows:
\[
\chi(n) = \begin{cases}
    \chi(n \text{ mod }m) &(n,m)=1\\
    0 &(n,m) \neq 1.
\end{cases}
\]
\begin{example}
    \[
        \chi_K(\mathfrak{p}) = \begin{cases}
        1 & \mathfrak{p} \text{ splits}\\
        -1 & \mathfrak{p} \text{ inert}\\
        0 & \mathfrak{p} \text{ ramifies}
        \end{cases}
    \]
    is a Dirichlet character mod $d_K/\mathbb{Q}$.
\end{example}
\begin{defn}\label{defn2.27}
    The \textbf{principal character} mod $m$ is the trivial character $\chi_0$ mod $m$,
    \[
    \chi_0(n) = \begin{cases}
        1 & (n,m)=1\\
        0 & \text{ otherwise}.
    \end{cases}
    \]
\end{defn}
Suppose $\chi_1, \chi_2$ are two Dirichlet characters mod $m$. Then define $\chi_1\chi_2$ by $\chi_1\chi_2(n)=\chi_1(n)\chi_2(n)$. This turns the collection of all characters of $(\mathbb{Z}/m\mathbb{Z})^\times$ into an abelian group. Write $\widehat{(\mathbb{Z}/m\mathbb{Z})^\times}$ with identity $\chi_0$ and the inverse of any $\chi$ equal to $n \mapsto \chi(n)^{-1}$.
\vspace{1mm}
 
Let $A$ be any abelian group. Let $\widehat{A}$ be the group of homomorphisms $\chi : A \to \mathbb{C}^\times$. This is the \textbf{character group} or \textbf{dual group} of $A$.
\begin{prop}\label{prop2.28}
    If $A$ is a finite abelian group, then $A \cong \widehat{A}$.
\end{prop}
\begin{proof}
    Use induction on the order of $A$. Assume $A$ is cyclic with order $m$ and generator $y$. Then $y^m=1$, so $\chi(y)$ is an $m^{\text{th}}$ root of unity for every $\chi$ and every character is determined by $\chi(y)$. Let $\zeta$ be a primitive $m^{\text{th}}$ root of unity. Then for each $r=0,1,\ldots,m-1$, the function $\chi_r(y^s) = (\zeta^r)^j$ is a character, these are all distinct and $\chi_r = \chi_1^r$, so $\widehat{A}$ is the cyclic group generated by $\chi_1$. But $\chi_1^r(y) = 1 \iff \zeta^r = 1$, so $\chi_1$ must have order $m$, so $\widehat{A}$ is cyclic of order $m$, so $\widehat{A} \cong A$.
    \vspace{1mm}
     
    Now suppose $A = A_1 \times A_2$ with $A_1,A_2$ cyclic and such that $A_i \neq 1$. We will to show that $\widehat{A} \cong \widehat{A}_1 \times \widehat{A}_2$. For this, define $\widehat{A} \to \widehat{A}_1 \times \widehat{A}_2$ by $\chi \mapsto (\chi|_{A_1}, \chi|_{A_2})$ which has inverse $\widehat{A}_1 \times \widehat{A}_2 \to \widehat{A}$ by $(\chi_1,\chi_2) \mapsto \chi$ via $(a_1,a_2) \mapsto \chi_1(a_1)\chi_2(a_2)$. It follows by induction that $\widehat{A}_i \cong A_i$, so we're done.
\end{proof}
Recall that $(\mathbb{Z}/m\mathbb{Z})^\times$ has order $\phi(m)$, hence so does $\widehat{(\mathbb{Z}/m\mathbb{Z})^\times}$.
\begin{example}
    Let $m=4$, so $\phi(m)=2$. We have two characters mod 4: these are $\chi_0$ mod 4 and $\chi_1$ given by $\chi_1(n) = \begin{cases}
        1 & n \equiv 1 \pmod{4}\\
        -1 & n \equiv 3 \pmod{4}\\
        0 & 2 \mid n.
    \end{cases}$.
\end{example}
\begin{cor}\label{cor2.29}
    If $A$ is a finite abelian group, then $A \cong \widehat{\widehat{A}}$ via the correspondence sending 
    \begin{align*}
        &A \to \widehat{\widehat{A}}\\
        &a \mapsto \tilde{a} : \widehat{A} \to \mathbb{C}^\times \text{ defined by }\chi \mapsto \chi(a).
    \end{align*}
\end{cor}
\begin{proof}
    Left as an exercise.
\end{proof}
\begin{prop}[Orthogonality relations]\label{prop2.30}
    Let $A$ be a finite abelian group and $a \in A$. 
    \begin{enumerate}[(i)]
        \item If $\chi \in \widehat{A}$, $\sum_{a \in A}^{} \chi(a) = \begin{cases}
            0 & \chi \neq \chi_0\\
            \left|A\right| & \chi = \chi_0.
        \end{cases}$
        \item $\sum_{\chi \in \widehat{A}}^{} \chi(a)= \begin{cases}
            0 & \text{ if }a \neq 1\\
            \left|A\right| & \text{ if } a = 1.
        \end{cases}$
    \end{enumerate}
\end{prop}
\begin{proof}
    \marginpar{14 Feb 2024, Lecture 12}
    \begin{enumerate}[(i)]
        \item Let $\chi \in \widehat{A}$, $\chi \neq \chi_0$. Let $b \in A$ be such that $\chi(b) \neq 1$. Then 
        \begin{align*}
            \sum_{a \in A}^{} \chi(a) = \sum_{a \in A}^{} \chi(ab) = \chi(b) \sum_{a \in A}^{} \chi(a),
        \end{align*}
        so $\sum_{a \in A}^{} \chi(a) = 0$. The second part of (i) is immediate.
        \item Note by Proposition \ref{prop2.28} that  $\sum_{\chi \in \widehat{A}}^{} \chi(a) = \sum_{\chi \in \widehat{A}}^{} \tilde{a}(\chi)$, and now use (i).
    \end{enumerate}
\end{proof}
\begin{prop}\label{prop2.31}
    Let $\chi$ be a Dirichlet character mod $m$. If $\chi \neq \chi_0$, then $\left|\sum_{n\le x}^{} \chi(n)\right|\le m$.
\end{prop}
\begin{proof}
    Exercise.
\end{proof}
\subsection{Dirichlet $L$-series}
\begin{defn}\label{defn2.32}
    Let $\chi$ be a Dirichlet character. Then the \textbf{Dirichlet $L$-series} is 
    \begin{align*}
        L(\chi,s) = \sum_{n=1}^{\infty} \frac{\chi(n)}{n^s}. 
    \end{align*}
\end{defn}
\begin{prop}\label{prop2.33}
    For $\text{Re}(s)>1$, the series $L(\chi,s)$ converges absolutely and we get an Euler product 
    \begin{align*}
        L(\chi,s) = \prod_{p}^{} \left(1-\frac{\chi(p)}{p^s}\right)^{-1}.
    \end{align*}
    If $\chi$ is nontrivial, then $L(\chi,s)$ extends to a analytic function for $\text{Re}(s)>0$.
\end{prop}
\begin{proof}
    The first part is an exercise. The second part follows from Theorem \ref{theorem2.6} and Proposition \ref{prop2.31}.
\end{proof}
We can write 
\begin{align*}
    L(\chi,s) = \prod_{p \nmid m}^{} \left(1-\frac{\chi(p)}{p^s}\right)^{-1},
\end{align*}
so for $\chi = \chi_0$, 
\begin{align*}
    L(\chi_0,s) = \zeta(s) \cdot \prod_{p \mid m}^{} \left(1-\frac{1}{p^s}\right).
\end{align*}
Write $\zeta_K(s)$ as a product of $L$-functions. Let $K = \mathbb{Q}(\zeta_m)$.
\begin{prop}\label{prop2.34}
    Let $K = \mathbb{Q}(\zeta_m)$ and let $m = \prod_{p}^{} p^{v_{p}}$ be the prime factorization. For every prime $p$, let $f_p$ be the smallest positive integer such that $$p^{f_p} \equiv 1 \left(\text{mod }\frac{m}{p^{v_p}}\right).$$
    Then $p \mathcal{O}_K = (\mathfrak{p}_1,\ldots,\mathfrak{p}_r)^{\phi(p^{v_p})}$ with $\mathfrak{p}_1,\ldots,\mathfrak{p}_r$ distinct prime ideals, all of degree $f_p$. In particular, if $p \nmid m$, then the order of $[p]$ in $(\mathbb{Z}/m\mathbb{Z})^\times$ if $f_p$.
\end{prop}
\begin{proof}
    Omitted, can be found in Neukirch's book.
\end{proof}
\begin{prop}\label{prop2.35}
    Let $K = \mathbb{Q}(\zeta_m)$. Then 
    \begin{align*}
        \zeta_K(s) = \prod_{\mathfrak{p} \mid m}^{} (1-N(\mathfrak{p})^{-s})^{-1} \prod_{\chi \in \widehat{(\mathbb{Z}/m\mathbb{Z})^\times}}^{}L(\chi,s) 
    \end{align*}
    Since $(\mathbb{Z}/m\mathbb{Z})^\times \cong \text{Gal}(K/\mathbb{Q})$, $\chi \in (\mathbb{Z}/m\mathbb{Z})^\times$ can also be viewed as a character of $\text{Gal}(K/\mathbb{Q})$.
\end{prop}
\begin{proof}
    Let $p \mathcal{O}_K = (\mathfrak{p}_1,\ldots,\mathfrak{p}_r)^{e}$, and let $f = f_{\mathfrak{p}_i \mid p}$, so $N(\mathfrak{p}_i) = p^f$. Since we have $\zeta_K(s) = \prod_{\mathfrak{p}} (1-N(\mathfrak{p})^{-s})^{-1}$, $\zeta_K(s)$ contains $$\prod_{\mathfrak{p} \mid p}^{} (1-N(p)^{-s})^{-1} = (1-p^{-fs})^{-r}.$$
    For fixed $p$, $\prod_{\chi}^{} L(\chi,s)$ gives the factor $\prod_{\chi}^{} \left(1-\frac{\chi(p)}{p^s}\right)^{-1}$, which is 1 if $p \mid m$. Assume $p \nmid m$, then $e=1$ and $f$ is the order of $[p]$ in $(\mathbb{Z}/m\mathbb{Z})^\times$ by Proposition \ref{prop2.33}. Write $G_p$ for the subgroup of $(\mathbb{Z}/m\mathbb{Z})^\times$ generated by $[p]$. Since $efr = \left|(\mathbb{Z}/m\mathbb{Z})^\times\right| = \phi(m)$, this gives that $r = \frac{\phi(m)}{f}$ is the index of $G_p$ in $(\mathbb{Z}/m\mathbb{Z})^\times$.

    \vspace{1mm}
     
    There is an isomorphism between $\widehat{G_p}$ and $\mu_f$, the group of $f^{\text{th}}$ roots of unity by $\widehat{G_p} \to \mu_f$, $\chi \mapsto \chi(p)$. Let $G = (\mathbb{Z}/m\mathbb{Z})^\times$, then this gives us an exact sequence 
    \begin{align*}
        1 \to \widehat{G/G_p} \to \widehat{G} \to \mu_j \to 1.
    \end{align*}
    This means we have $r = \left|\widehat{G/G_p}\right| = [G:G_p]$ elements in the preimage of $\chi(p)$. Then 
    \begin{align*}
        \prod_{\chi}^{} \left(1-\frac{\chi(p)}{p^s}\right)^{-1} = \prod_{\zeta \in \mu_f}^{} \left(1-\frac{\zeta}{p^s}\right)^{-r} = (1-p^{-fs})^{-r},
    \end{align*}
    so $\prod_{\chi}^{} L(\chi,s)$ and $\zeta_K(s)$ both contain these terms. Take the product over all primes $p \nmid m$ to get the result.
\end{proof}
Since $L(\chi_0,s) = \zeta(s) \prod_{p \mid m}^{} \left(1-\frac{1}{p^s}\right)$, we have
\begin{align*}
    \zeta_K(s) = \prod_{\mathfrak{p} \mid m}^{} (1-N(\mathfrak{p})^{-s})\left(\zeta(s) \prod_{p \mid m}^{} \left(1-\frac{1}{p^s}\right)\right) \prod_{\chi \neq \chi_0}^{} L(\chi,s).
\end{align*}
Since $\zeta_K(s)$ and $\zeta(s)$ have poles at $s=1$, we have:
\begin{prop}\label{prop2.37}
    Every nontrivial Dirichlet character $\chi$ satisfies $L(\chi,1) \neq 0$.
\end{prop}
\begin{theorem}[Dirichlet's Prime Number Theorem]\label{theorem2.37}
    Every arithmetic progression of the form $a \pm km, k \in \mathbb{Z}$ with $(a,m)=1$, i.e. every class $a$ mod $m$ contains infinitely many prime numbers.
\end{theorem}
\begin{proof}
    Note $L(\chi,s) \neq 0$ for $\text{Re}(s)>1$ and we have
    \begin{align*}
        &L(\chi,s) = \prod_{p}^{} (1-\chi(p)p^{-s})^{-1} \\
        \implies & \log L(\chi,s) = - \sum_{p}^{} \log(1-\chi(p)p^{-s})\\
        =& \sum_{p}^{} \sum_{n\ge 1}^{} \frac{\chi(p)^n p^{-ns}}{n}.
    \end{align*}
    This converges absolutely for $\text{Re}(s)>1$ since 
    \begin{align*}
        &\left|\frac{\chi(p)^n}{np^{ns}}\right|\le \frac{1}{p^{ns}} = \frac{1}{p^{n \text{Re}(s)}} \\
        \implies & \sum_{p}^{} \sum_{n\ge 1} \frac{1}{p^{n \text{Re}(s)}} \le \sum_{m\ge 1}^{} \frac{1}{m^{\text{Re}(s)}}, 
    \end{align*}
    which converges for $\text{Re}(s)>1$. Hence 
    \begin{align*}
        \log L(\chi,s) = \sum_{p}^{} \frac{\chi(p)}{p^{s}} + \sum_{p}^{} \sum_{n\ge 2}^{} \frac{\chi(p)^{n}}{np^{ns}},
    \end{align*}
    where the latter sum is absolutely convergent for $\text{Re}(s)>\frac{1}{2}$ and takes a finite value at $s=1$. Write $$g_{\chi}(s) = \sum_{p}^{} \sum_{n\ge 2}^{} \frac{\chi(p)^n}{np^{ns}}.$$ 
    Let $(a,m)=1$. Then 
    \begin{align*}
        &\sum_{\chi \in \widehat{(\mathbb{Z}/m\mathbb{Z})^\times}}^{} \chi(a)^{-1} \log L(\chi,s) \\
        =& \sum_{\chi}^{} \chi(a^{-1}) \left(\sum_{p}^{} \frac{\chi(p)}{p^s} + g_\chi(s)\right) \\
        =& \sum_{p}^{} \frac{1}{p^s} \sum_{\chi}^{} \chi(a^{-1})\chi(p) + \sum_{\chi}^{} \chi(a)^{-1} g_\chi(s) \\
        =& \sum_{p}^{} \frac{1}{p^s} \sum_{\chi}^{} \chi(p a^{-1}) + \sum_{\chi}^{} \chi(a^{-1})g_{\chi}(s).
    \end{align*}
    By orthogonality,
    \begin{align*}
        \sum_{\chi}^{} \chi(p a^{-1}) = \begin{cases}
            \phi(m) & p \equiv a \pmod{m}\\
            0 & \text{ otherwise}.
        \end{cases}
    \end{align*}
    This gives 
    \begin{align*}
        &\sum_{\chi}^{} \chi(a)^{-1} \log L(\chi,s) \\
        =& \phi(m) \sum_{p \equiv a \text{ mod }m}^{} p^{-s} + \left(\text{smth. that conv. for }\text{Re}(s)>\frac{1}{2}\right).
    \end{align*}
    Let $s \to 1$, then the RHS is 
    \begin{align*}
        \lim_{s \to 1} \phi(m) \sum_{p \equiv a \text{ mod }m}^{} p^{-s} + \left(\text{finite constant}\right)
    \end{align*}
    finite since the theorem is false?? wtf does this mean? TODO: check it
    \vspace{1mm}
     
    Since $L(\chi_0,s) = \zeta(s) \prod_{p \mid m}^{} (1-p^{-s})$, so $\log L(\chi_0,s) \to \infty$ as $s \to 1$ (since $\zeta(s)$ has a pole at $s=1$). We know $L(\chi,1)$ is defined for $\chi \neq \chi_0$ and $L(\chi,1) \neq 0$, so $\log L(\chi,1)$ will be finite for $\chi \neq \chi_0$, so $\sum_{\chi}^{} \chi(a)^{-1} \log L(\chi,s) \to \infty$ as $s \to 1^+$, so the same is true for the RHS. 
\end{proof}

\marginpar{16 Feb 2024, Lecture 13}
Lecture start summary: Let $K/\mathbb{Q}$ be abelian. Then $K \subset \mathbb{Q}(\zeta_m)$ for some $m$. Let $G = \text{Gal}(K/\mathbb{Q})$ and consider its image in $(\mathbb{Z}/m\mathbb{Z})^\times \cong \text{Gal}(\mathbb{Q}(\zeta_m)/\mathbb{Q})$. We can consider characters of $G$ as Dirichlet characters mod $m$, and view $\widehat{G}$ as a subgroup of $\widehat{(\mathbb{Z}/m\mathbb{Z})^\times}$.

\begin{prop}\label{prop2.38}
    For $K$ as above, we have
    \[
    \zeta_K(s) = \prod_{\mathfrak{p} \mid m}^{} (1-N(\mathfrak{p})^{-s})^{-1} \prod_{\chi \in \widehat{G}}^{} L(\chi,s)
    \]
    for $\text{Re}(s)>1$.
\end{prop}
\begin{proof}
    Similar to Proposition \ref{prop2.35}, left as an exercise.
\end{proof}
\begin{cor}\label{cor2.39}
    We have \[
    h_K = \left(\prod_{\mathfrak{p}\mid m}^{} \left(1-\frac{1}{p}\right)\left(1-\frac{1}{p^{f_p}}\right) \right)^{-r_p} \prod_{\chi \neq \chi_0}^{} L(\chi,1)/K.
    \]
\end{cor}
\begin{proof}
    Follows from the analytic class number formula and $$L(\chi,s) = \zeta(s) \prod_{ p \mid m}^{} \left(1-\frac{1}{p^s}\right)$$ and the fact that $\zeta(s)$ has a simple pole at $s=1$ with residue 1.
\end{proof}
There exist explicit formulae for $L(\chi,1)$ that we can use to compute $h_K$ (see e.g. Marcus). In Ex. Sheet 2, there is an exercise making this explicit in the quadratic case. If $K = \mathbb{Q}(\sqrt{N})$, for $N \neq 0,1$ squarefree, let $m = \left|d_{K/\mathbb{Q}}\right|$, then $K \subset \mathbb{Q}(\zeta_m)$.
\vspace{1mm}
 
Next we will prove a fundamental inequality and a more general version of Dirichlet's prime number theorem.
\vspace{1mm}
 
\textbf{Notation.} Write $f(s)\sim g(s)$ to mean that two functions which have a singularity at $s=1$ differ by a function that is analytic at $s=1$. So $\zeta(s) \sim\frac{1}{s-1}$, which is because 
\begin{align*}
    \log -\zeta(s) = \sum_{p}^{} \sum_{n\ge 1}^{} \frac{1}{np^{ns}} = \sum_{p}^{} \frac{1}{p^s} + \sum_{p}^{} \sum_{n\ge 2}^{} \frac{1}{np^{ns}}
\end{align*}
and the second term converges uniformly and absolutely for $\text{Re}(s)>\frac{1}{2}$, so only $\sum_{p}^{} p^{-s}$ contributes to the singularity at $s=1$, so $\log \zeta(s) \sim \sum_{p}^{} p^{-s} \sim \log \frac{1}{s-1}$.
\vspace{1mm}
 
Similarly, since $\log \zeta_K(s) = \sum_{\mathfrak{p}}^{} \sum_{n\ge 1}^{} \frac{1}{nN(\mathfrak{p})^s}$, we have $$\log \zeta_K(s) \sim \sum_{\mathfrak{p}} \frac{1}{N(\mathfrak{p})^s} \sim \sum_{\text{deg }\mathfrak{p}=1}^{} \frac{1}{N(\mathfrak{p})^s},$$
where a degree one prime is a prime whose residue field degree over $\mathbb{Q}$ is 1, or equivalently a prime ideal whose absolute norm is a prime number. Note
\[
\zeta_K(s) = \sum_{C \in \text{Cl}(K)}^{} \zeta(C,s)
\]
for $\zeta(C,s)$ the \textbf{partial zeta function}, i.e.
\[
\zeta_K(s) = \sum_{\mathfrak{a} \in C}^{} \frac{1}{N(\mathfrak{a})^s}.
\]
\begin{prop}\label{prop2.40}
    Let $[K:\mathbb{Q}]=n$ and let $C \in \text{Cl}(K)$ be an ideal class. Then $\zeta(C,s)$ is analytic for $\text{Re}(s)>1-\frac{1}{n}$, except for a simple pole at $s=1$ with residue $\kappa$.
\end{prop}
This is what is needed for the analytic class number formula. We skip the proof, since it needs estimates for the number of ideals in a given ideal class, see e.g. Lang.
\vspace{1mm}
 
More generally, let $\mathfrak{m}$ be a modulus of $K$ and 
\[
\zeta_K(\mathfrak{m},s) = \sum_{(\mathfrak{a},\mathfrak{m})=1}^{} \frac{1}{N(\mathfrak{a})^s}, 
\]
then $$\zeta_K(\mathfrak{m},s) = \prod_{\mathfrak{p}\nmid \mathfrak{m}}^{} \left(1-\frac{1}{N(\mathfrak{p})^s}\right)^{^{-1}}$$
and \[
\zeta_K(\mathfrak{m},s) = \sum_{C \in I_K(\mathfrak{m})/P_K(\mathfrak{m})}^{}\zeta(C,s) 
\]
is as before, but with $C$ a class in $I_K(\mathfrak{m})/P_K(\mathfrak{m})$.

\begin{prop}\label{prop2.41}
    Let $\mathfrak{m}$ be a modulus of $K$, $C$ a class in $I_K(\mathfrak{m})/P_K(\mathfrak{m})$. Then $\zeta(C,s)$ is analytic for $\text{Re}(s)>1-\frac{1}{n}$. except for a simple pole at $s=1$ with residue $\rho_{\mathfrak{m}}$ depending only on $\mathfrak{m}$ and not on $C$.
    \vspace{1mm}
     
    Consequently, $\zeta_K(\mathfrak{m},s)$ is analytic for $\text{Re}(s)>1-\frac{1}{n}$, except for a simple pole at $s=1$ with residue $\rho_{\mathfrak{m}}h_{\mathfrak{m}}(K)$. 
\end{prop}
Note the product for $\zeta_K(\mathfrak{m},s)$ differs from $\zeta_K(s)$ by the factors corresponding to $p \mid \mathfrak{m}$, so only at finitely many primes. This finite product does not affect the singularity at $s=1$, so 
\begin{align*}
    \log \zeta_K(s) \sim \log \zeta_K(\mathfrak{m},s).
\end{align*} 
\begin{defn}\label{defn2.42}
    We define a \textbf{generalized Dirichlet character} (also known as a \textbf{Weber character}) af modulus $\mathfrak{m}$ to be a group homomorphism
    \[
    \chi: I_K(\mathfrak{m})/P_K(\mathfrak{m}) \to \mathbb{C}^\times.
    \]
    The corresponding $L$-series $L_\mathfrak{m}(\chi,s)$ is 
    \[
    L_{\mathfrak{m}}(\chi,s) = \sum_{\mathfrak{a} \subset \mathcal{O}_K, (\mathfrak{a},\mathfrak{m})=1}^{} \frac{\chi(\mathfrak{a})}{N(\mathfrak{a})^s}
    \]
    are called \textbf{Weber $L$-functions}. We can write
    \[
    L_{\mathfrak{m}}(\chi,s) = \sum_{C \in I_K(\mathfrak{m})/P_K(\mathfrak{m})}^{} \chi(C) \zeta(C,s). 
    \]
\end{defn}
\begin{prop}\label{prop2.43}
    The Dirichlet series $L_{\mathfrak{m}}(\chi,s)$ is analytic for $\text{Re}(s)>1-\frac{1}{n}$. If $\chi \neq \chi_0$, then 
    \[
        L_{\mathfrak{m}}(\chi,s) = \prod_{\mathfrak{p} \nmid m}^{} \left(1-\frac{\chi(\mathfrak{p})}{N(\mathfrak{p})^s}\right)^{-1}.
    \]
\end{prop}
\begin{proof}
    Lang.
\end{proof}
Note $L_{\mathfrak{m}}(\chi_0,s) = \prod_{\mathfrak{p}\nmid \mathfrak{m}}^{} \left(1-\frac{1}{N(\mathfrak{p})^{s}}\right)^{-1} = \zeta_K(\mathfrak{m},s)$, so by Proposition \ref{prop2.41}, this is analytic for $\text{Re}(s)>1-\frac{1}{n}$, except for a simple pole at $s=1$.
\vspace{1mm}
 
Let $L/K$ be Galois. Recall that we had the norm for the Takagi group $T_{L/K}(\mathfrak{m})=P_K(\mathfrak{m})N_{L/K}(I_L(\mathfrak{m}))$, which will be the kernel of $\Phi_{\mathfrak{m}}$ for suitable $\mathfrak{m}$. We call $[I_K(\mathfrak{m}) : T_{L/K}(\mathfrak{m})]$ the \textbf{norm index}.
\begin{theorem}[Universal Norm Index Inequality]\label{theorem2.45}
    Let $L/K$ be Galois and let $\mathfrak{m}$ be divisible by all primes of $K$ that ramify in $L$. Then \[
    [I_K(\mathfrak{m}): T_{L/K}(\mathfrak{m})] \le [L:K].
    \]
\end{theorem}
\begin{proof}
    Let $\chi \neq \chi_0$ be a character of $I_K(\mathfrak{m})/T_{L/K}(\mathfrak{m})$. We can also view this as a character of $I_K(\mathfrak{m})/P_K(\mathfrak{m})$. Let $m(\chi)$ be the order of the zero at $s=1$ of $L_{\mathfrak{m}}(\chi,s)$. By Proposition \ref{prop2.43}, $m(\chi)\ge 0$ (as the series is analytic). Write \[
    L_{\mathfrak{m}}(\chi,s) = (s-1)^{m(\chi)}g(\chi,s),
    \]
    so \[
    \log L_{\mathfrak{m}}(\chi,s) \sim m(\chi) \log(s-1) = -m(\chi) \log \frac{1}{s-1}.
    \]
    Let $\text{Re}(s)>1$ and let $\chi$ be any character of $I_K(\mathfrak{m})/T_{L/K}(\mathfrak{m})$. By the Euler product, 
    \begin{align*}
        \log L_{\mathfrak{m}}(\chi,s) = \sum_{\mathfrak{p} \nmid \mathfrak{m}}^{} \sum_{n\ge 1}^{} \frac{\chi(\mathfrak{p})^{n}}{n N(\mathfrak{p})^{ns}} = \sum_{\mathfrak{p} \nmid \mathfrak{m}}^{} \frac{\chi(\mathfrak{p})}{N(\mathfrak{p})^s} + \sum_{\mathfrak{p} \nmid \mathfrak{m}}^{} \sum_{n\ge 2}^{} \frac{\chi(\mathfrak{p})}{n N(\mathfrak{p})^{ns}} \sim \sum_{\mathfrak{p} \nmid \mathfrak{m}}^{} \frac{\chi(\mathfrak{p})}{N(\mathfrak{p})^s}.
    \end{align*}
    Write $h = [I_K(\mathfrak{m}): T_{L/K}(\mathfrak{m})]$. Since $\chi$ is trivial on $T_{L/K}(\mathfrak{m})$, we get \[
    \sum_{\chi}^{} \chi(\mathfrak{p}) = \begin{cases}
        h & \mathfrak{p} \in T_{L/K}(\mathfrak{m})\\
        0 & \mathfrak{p} \not\in T_{L/K}(\mathfrak{m})
    \end{cases}
    \]
    by the orthogonality relation. Let $s \to 1$ from above, and take the sum over all characters to get 
    \[
    \sum_{\chi}^{} \log L_{\mathfrak{m}}(\chi,s) \sim h \sum_{\mathfrak{p} \in T_{L/K}(\mathfrak{m})}^{} \frac{1}{N(\mathfrak{p})^s}.
    \]
    \marginpar{Feb 19 2024, Lecture 14}
    If $\chi = \chi_0$, we get $L_{\mathfrak{m}}(\chi,s) = \zeta_K(\mathfrak{m},s)$, so $\log L(\chi,s) \sim \log \zeta_K(s) \sim \log\frac{1}{s-1}$ as $s \to 1$. Thus
    \begin{align*}
        &\sum_{\chi}^{} \log L_{\mathfrak{m}}(\chi,s) \sim \log \zeta_K(s) + \sum_{\chi \neq \chi_0}^{} \log L_{\mathfrak{m}}(\chi,s) \\
        \sim& \log \frac{1}{s-1} - \sum_{\chi \neq 1}^{} m(\chi)\log \left(\frac{1}{s-1}\right) = \left(1-\sum_{\chi \neq 1}^{} m(\chi)\right) \log\frac{1}{s-1}. 
    \end{align*}
    If $\mathfrak{p}$ splits completely in $L$, then $\mathcal{P} \in \mathcal{O}_L$ with $\mathcal{P} \mid \mathfrak{p}$, then $f_{\mathcal{P}|\mathfrak{p}}=1$, so $N_{L/K}(\mathcal{P})=\mathfrak{p}$. So then (if $\mathfrak{p}\nmid \mathfrak{m}$), then $\mathfrak{p} \in T_{L/K}(\mathfrak{m}) = P_{K}(\mathfrak{m})N_{L/K}(I_L(\mathfrak{m}))$. Then there are $[L:K]$ primes of $L$ above $\mathfrak{p}$, so
    \begin{align*}
        h \sum_{\mathfrak{p} \in T_{L/K}(\mathfrak{m})}^{} \frac{1}{N(\mathfrak{p})^s} = h \left(\sum_{\substack{\mathfrak{p} \in T_{L/K}(\mathfrak{m})\\\text{splits completely}}}^{}N(\mathfrak{p})^{-s} + \sum_{\substack{\mathfrak{p} \in T_{L/K}(\mathfrak{m})\\f_{\mathcal{P}\mid \mathfrak{p}}>1}}^{}N(\mathfrak{p})^{-s}\right) 
    \end{align*}
    since $\mathfrak{m}$ is divisible by all ramified primes. The second series does not contribute to the singularity, as $N(\mathfrak{p}) \ge p^2$.
    \vspace{1mm}
     
    If $\mathcal{P} \subset \mathcal{O}_L$ is a degree one prime and if for $\mathfrak{p} \subset \mathcal{O}_K$ we have $\mathcal{P} \mid \mathfrak{p}$, then $f_{\mathcal{P}\mid \mathfrak{p}} = 1$. If $\mathfrak{p}$ is unramified in $L$, then $\mathfrak{p}$ splits completely with $[L:K]$ primes above it.
    \vspace{1mm}
     
    Write $\gtrsim$ to mean that the RHS is less than or equal to the LHS plus some constant in a neighborhood of $s=1$. We get
    \begin{align*}
        h \sum_{\mathfrak{p} \in T_{L/K}(\mathfrak{m})}^{} \frac{1}{N(\mathfrak{p})^s} \gtrsim h \sum_{\mathfrak{p}\text{ splits comp.}}^{}  \frac{1}{N(\mathfrak{p})^s} \gtrsim \frac{h}{[L:K]} \sum_{\text{deg}(\mathcal{P})=1}^{} \frac{1}{N(\mathcal{P})^s} \gtrsim \frac{h}{[L:K]} \log\frac{1}{s-1}. 
    \end{align*}
    Hence
    \begin{align*}
        \left(1-\sum_{\chi \neq1}^{} m(\chi)\right)\log\frac{1}{s-1} \gtrsim\frac{h}{[L:K]} \log\frac{1}{s-1},
    \end{align*}
    which means that $m(\chi)=0 ~\forall \chi \neq 1$ and $h \le [L:K]$.
\end{proof}
The fact that $L_{\mathfrak{m}}(\chi,s) \neq 0$ for $\chi \neq \chi_0$ is important for the generalization of the Prime Number Theorem.
\section{Density results}
\subsection{Dirichlet density}
To motivate the definition, reconsider the proof of Dirichlet's Prime Number Theorem. For some $m$ with $(a,m)=1$, we had 
\begin{align*}
    \sum_{\chi \in \widehat{(\mathbb{Z}/m\mathbb{Z})^\times}}^{}\chi(a)^{-1} \log L(\chi,s) = \phi(m) \sum_{p \equiv a \text{ mod }m}^{} p^{-s} + \left(\text{abs. conv. part for }\text{Re}(s)>\frac{1}{2}\right),
\end{align*}
so
\begin{align*}
    \sum_{\chi}^{} \chi(a)^{-1} \log L(\chi,s) \sim \phi(m) \sum_{p \equiv a \text{ mod } m}^{} \frac{1}{p^s} \sim \log L(\chi_0,s) \sim \log \zeta(s)
\end{align*}
as $L(\chi,s) = \prod_{p \mid m}^{} (1-p^{-s})\zeta(s)$, so
\begin{align*}
    \sum_{ p \equiv  a \text{ mod }m}^{}\frac{1}{p^s} \sim \phi(m) \log \zeta(s). 
\end{align*}
Let $s \to 1^+$, which diverges, which finished the proof, and 
\begin{align*}
    \lim_{s \to 1^+} \frac{\sum_{p \equiv a \text{ mod }m}^{} p^{-s}}{\log \frac{1}{s-1}} = \frac{1}{\phi(m)}.
\end{align*}
Why did we just do this? Let $S$ be any set of primes. If 
\[
\lim_{s \to 1^+} \frac{\sum_{p \in S}^{} p^{-s}}{\log\frac{1}{s-1}}
\]
exists, then we say this set $S$ has Dirichlet density $\delta=\delta(S)$. If $S$ is finite, we say $\delta(S)=0$. So we can ''rephrase'' Dirichlet's Prime Number Theorem by saying
\[
\delta(S) = \frac{1}{\phi(m)},
\]
where $S = \{p \in \mathbb{Z} \mid p \text{ prime, }p \equiv a \pmod{m}\}$.
\begin{prop}\label{prop3.1}
    Let $K/\mathbb{Q}$ be Galois. Let $$\mathcal{S}_K = \{p \in \mathbb{Z} \mid p \text{ prime, }p \text{ splits completely in }K/\mathbb{Q}\}.$$ Then $\delta(\mathcal{S}_K)=\frac{1}{[K:\mathbb{Q}]}$.
\end{prop}
\begin{proof}
    We have seen 
    \begin{align*}
        &\log \zeta_K(s) \sim \log \left(\frac{1}{s-1}\right) \sim \sum_{\mathfrak{p}}^{} N(\mathfrak{p})^{-s} \\
        \sim& \sum_{\substack{\mathfrak{p}\\ f_{\mathcal{P}\mid \mathfrak{p}} = 1 = e_{\mathcal{P}\mid \mathfrak{p}}}}^{} p^{-s} + \sum_{\substack{\mathfrak{p} \\ f_{\mathcal{P}\mid \mathfrak{p}}>1}}^{} p^{-f_{\mathcal{P}\mid \mathfrak{p}}s} + \sum_{\substack{\mathfrak{p}\\ f_{\mathcal{P}\mid \mathfrak{p}}>1 \\e_{\mathcal{P}\mid \mathfrak{p}}>1}}^{} p^{-s} \\
        \sim& \sum_{p \in \mathcal{S}_K}^{} [K:\mathbb{Q}]p^{-s}.
    \end{align*}
    So 
    \begin{align*}
        \log \left(\frac{1}{s-1}\right) = [K:\mathbb{Q}]\sum_{p \in \mathcal{S}_K}^{} p^{-s} + g(s)
    \end{align*}
    for $g(s)$ bounded as $s \to 1^+$, so 
    \begin{align*}
        \delta(\mathcal{S}_K) = \lim_{s \to 1^+} \frac{\sum_{p \in \mathcal{S}_K}^{} p^{-s}}{\log \left(\frac{1}{s-1}\right)} = \lim_{s \to 1^+} \left(\frac{[K:\mathbb{Q}]\sum_{p \in \mathcal{S}_K}^{} p^{-s} + g(s)}{\sum_{p \in \mathcal{S}_K}^{} p^{-s}}\right)^{-1} = \frac{1}{[K:\mathbb{Q}]}.   
    \end{align*}
\end{proof}
\begin{defn}\label{defn3.2}
    Let $K$ be a number field. Let $S$ be a set of prime ideals in $\mathcal{O}_K$. If the limit \[
    \lim_{s \to 1^+} \frac{\sum_{\mathfrak{p} \in S}^{} N(\mathfrak{p})^{-s}}{\log \left(\frac{1}{s-1}\right)}
    \]
    exists, then we say this set $S$ has \textbf{Dirichlet density} $\delta = \delta(S)$.
\end{defn}
Note that since $\log \left(\frac{1}{s-1}\right) \sim \sum_{\mathfrak{p}}^{} \frac{1}{N(\mathfrak{p})^s}$, we can also write 
\[
\delta(S) = \lim_{s \to 1^+} \frac{\sum_{\mathfrak{p} \in S}^{} N(\mathfrak{p}) ^{-s}}{\sum_{\mathfrak{p}}^{} N(\mathfrak{p})^{-s}}.
\]
\begin{lemma}\label{lemma3.3}
    Let $\mathcal{P}_K$ be the set of all prime ideals of $K$. Let $S, T$ be subsets of $\mathcal{P}_K$. Then
    \begin{enumerate}[(i)]
        \item $\delta(\mathcal{P}_K)=1$.
        \item If $S \subset T$ and $\delta(S),\delta(T)$ exist, then $\delta(S)\le \delta(T)$.
        \item If $\delta(S)$ exists, then $0\le \delta(S)\le 1$.
        \item If $S$ and $T$ are disjoint and $\delta(S),\delta(T)$ exist, then $\delta(S \cup T)=\delta(S)+\delta(T)$. 
        \item If $S$ is finite, then $\delta(S)=0$.
        \item If $\delta(S)$ exists and $T$ differs from $S$ by only finitely many elements, then $\delta(T)=\delta(S)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Exercises. Note that it might be simpler to prove this in some order different than the one listed above.
\end{proof}
\begin{lemma}\label{lemma3.4}
    Let $L/K$ be Galois and let $$\mathcal{S}_{L/K} = \{\mathfrak{p} \in \mathcal{O}_K \mid \mathfrak{p} \text{ splits completely in }L\}.$$
    Then $\delta(\mathcal{S}_{L/K}) = \frac{1}{[L:K]}$.
\end{lemma}
\begin{proof}
    Left as an exericse.
\end{proof}
\begin{lemma}\label{lemma3.5}
    Let $\mathcal{S}_1$ be the set of prime ideals of degree one. Then $\delta(\mathcal{S}_1)=1$, and if $\mathcal{S}$ is a set of prime ideals of $K$ and $\delta(\mathcal{S})$ exists, then $\delta(\mathcal{S}) = \delta(\mathcal{S} \cup \mathcal{S}_1)$.
\end{lemma}
\begin{proof}
    Similarly to before we write
    \begin{align*}
        \log P_K(\mathcal{S}) = \sum_{\mathfrak{p}}^{} \frac{1}{N(\mathfrak{p})^s} = \sum_{\mathfrak{p} \in \mathcal{S}_1}^{} \frac{1}{N(\mathfrak{p})^s} + \sum_{\mathfrak{p} \not\in \mathcal{S}_1}^{}\frac{1}{N(\mathfrak{p})^s} \sim \sum_{\mathfrak{p} \in \mathcal{S}_1}^{} \frac{1}{N(\mathfrak{p})^s}, 
    \end{align*}
    since $N(\mathfrak{p}) = p^f = p^2$ for all $\mathfrak{p} \not\in \mathcal{S}_1$. Hence from the definition we get $\delta(\mathcal{S}_1)=1$, and $\sum_{\substack{\mathfrak{p} \in \mathcal{S}\\ \mathfrak{p} \not\in \mathcal{S}_1}}^{} N(\mathfrak{p})^{-s}=0$, so 
    \[
    \sum_{\mathfrak{p} \in \mathcal{S}}^{} N(\mathfrak{p})^{-s} \sim \sum_{\mathfrak{p} \in \mathcal{S} \cup \mathcal{S}_1}^{} N(\mathfrak{p})^{-s}.
    \qedhere
    \]
\end{proof}
\marginpar{21 Feb 2024, Lecture 15}

By the Existence Theorem (Theorem \ref{theorem1.26}), for a number field $K$ and a modulus $\mathfrak{m}$ of $K$, and any congruence subgroup $P_K(\mathfrak{m}) \subset H \subset I_K(\mathfrak{m})$, we can find an abelian extension $L/K$ such that $H = T_{L/K}(\mathfrak{m})$. In particular, we can find this for $P_K(\mathfrak{m})$. Hence we obtain
\begin{theorem}\label{theorem3.6}
    Let $\mathfrak{m}$ be a modulus of $K$ and $\chi$ a nontrivial character of $I_K(\mathfrak{m})/P_K(\mathfrak{m})$. Then $L(\chi,1) \neq 0$.
\end{theorem}
\begin{cor}[Generalized version of Dirichlet's Prime Number Theorem]\label{cor3.7}
    Let $h_K(\mathfrak{m}) = \left|I_K(\mathfrak{m})/P_K(\mathfrak{m})\right|$ and let $C_0$ be an ideal class in $I_K(\mathfrak{m})/P_K(\mathfrak{m})$. Let $S$ be the set of prime ideals in $C_0$, then \[
    \delta(S) = \frac{1}{h_K(\mathfrak{m})}.
    \]
\end{cor}
\begin{proof}
    For $\text{Re}(s)>1$, we have
    \begin{align*}
        \log L_{\mathfrak{m}}(\chi,s) \sim& \sum_{\mathfrak{p} \nmid \mathfrak{m}}^{} \frac{\chi(\mathfrak{p})}{N(\mathfrak{p})^s} \\
        \sim& \sum_{C \in I_K(\mathfrak{m})/P_K(\mathfrak{m})}^{} \chi(C) \sum_{\mathfrak{p}\in C}^{} \frac{1}{N(\mathfrak{p})^s}.
    \end{align*}
    Multiply this by $\chi(C_0^{-1})$ and sum over all $\chi$ to get
    \begin{align*}
        \log \zeta_K(s) \sim \sum_{C}^{} \sum_{\chi}^{} \chi(C C_0^{-1}) \sum_{\mathfrak{p} \in C}^{} \frac{1}{N(\mathfrak{p})^s}.
    \end{align*}
    By the orthogonality relation, the sum over $\chi$ is zero unless $C C_0^{-1} = 1$, hence 
    \begin{align*}
        \log \frac{1}{s-1} \sim h_K(\mathfrak{m}) \sum_{\mathfrak{p} \in C_0}^{} \frac{1}{N(\mathfrak{p})^s}.
        \qedhere
    \end{align*}
\end{proof}
Hence any ideal class contains infinitely many prime ideals, and they are equidistributed.

\subsection{Frobenius density theorems}
Let $K \subset E \subset L$ with $L/K$ Galois but $E/K$ not necessarily Galois. Let $G = \text{Gal}(L/K)$ and let $H$ be the elements of $G$ fixing $E$ elementwise. Consider a coset decomposition $G = H_{\sigma_1} \cup \ldots \cup H_{\sigma_k}$. Any $\sigma \in G$ permutes these cosets by right multiplication $H_{\sigma_i} \mapsto H_{\sigma_i \sigma}$. A sequence 
\begin{align*}
    H_{\sigma_i}, H_{\sigma_i \sigma}, H_{\sigma_i \sigma^2}, \ldots, H_{\sigma_i \sigma^{t-1}}
\end{align*}
is a cycle of length $t$, if these are $t$ distinct cosets and $H_{\sigma_i} = H_{\sigma_i \sigma^t}$. The collection of all cosets of $H$ is partitioned into disjoint cycles of $\sigma$.

\begin{prop}\label{prop3.8}
    Let $K \subset E \subset L$ with $L/K$ Galois. Let $\mathcal{P} \subset \mathcal{O}_L, \mathfrak{p} = \mathcal{P} \cap \mathcal{O}_K$ for $\mathfrak{p}$ unramified in $L$. Let $\sigma = \left(\frac{L/K}{\mathfrak{P}}\right)$. Suppose $\sigma$ has cycles of length $t_1,\ldots,t_s$ (when acting on the cosets of $H = \text{Gal}(L/E)$). Then $\mathfrak{p}\mathcal{O}_E$ factors as a product of $s$ distinct prime ideals of $E$, with degrees $t_1,\ldots,t_s$. As a consequence, the number of prime ideals in $E$ dividing $\mathfrak{p}$ equals the number of cosets $H_{\sigma_i}$ for which $\sigma_i D_{\mathcal{P}\mid \mathfrak{p}}\sigma_i^{-1} \subset H$.
\end{prop}
\begin{proof}
    Can be found in Janusz, chapter 3.
\end{proof}
\begin{defn}\label{defn3.9}
    Let $L/K$ be Galois, $G = \text{Gal}(L/K)$ and let $\sigma \in G$ be an element of order $n$. Then the \textbf{division} of $\sigma$ is the set of all elements of $G$ which are conjugate to some $\sigma^m$ for some $m$ relatively prime to $n$.
\end{defn}
\begin{lemma}\label{lemma3.10}
    Let $\sigma \in G$, $H = \langle \sigma \rangle$ and let $t$ be the number of elements in the division of $\sigma$. Then 
    \begin{align*}
        t = \phi(n) [G:N_G(H)],
    \end{align*}
    where $\phi$ is the Euler totient function and $N_G(H) = \{g \in G \mid g H g^{-1} = H\}$ is the normalizer of $H$ in $G$.
\end{lemma}
\begin{proof}
    Exercise. Use the fact that for any $g \in G$, the number of elements in its conjugacy class is $[G:C_G(g)]$, where $C_G(g) = \{a \in G \mid ag=ga\}$ is the centralizer of $g$ in $G$.
\end{proof}
\begin{theorem}[Frobenius Density Theorem]\label{theorem3.11}
    Let $L/K$ be Galois and let $\sigma \in G = \text{Gal}(L/K)$. Suppose $\sigma$ has $t$ elements in its division. Let $S$ be the set of prime ideals $\mathfrak{p}$ of $K$ such that there is $\mathcal{P} \subset \mathcal{O}_L$ with $\mathcal{P} \mid \mathfrak{p}$ with $\left(\frac{L/K}{\mathcal{P}}\right)$ in the division of $\sigma$, i.e. 
    \begin{align*}
        S = \{\mathfrak{p} \in P_K \mid \exists \mathcal{P} \in \mathcal{P}_L \text{ with }\mathcal{P}\mid \mathfrak{p} \text{ and }\left(\frac{L/K}{\mathcal{P}}\right) \text{ conjugate to }\sigma^m \\
    \text{ with }m \text{ coprime to the order of }\sigma\}.
    \end{align*}
    Then $\delta(S) = \frac{t}{\left|G\right|}$.
\end{theorem}
\begin{proof}
    Induct on $n$, the order of $\sigma$. If $n=1$, so $\sigma=1$, then $S=S_{L/K}$ and the result follows from Lemma \ref{lemma3.4}. Assume now that $\sigma$ has order $n>1$. Let $t_d$ be the number of elements in the division of $\sigma^d$ for $d \mid n$. Let $S_d$ be the set of primes divisible by some prime of $L$ whose Artin symbol belongs to the division of $\sigma^d$. Note that $S_1=S$. By induction, we have $\delta(S_d)=\frac{t_d}{\left|G\right|}$ for $d \neq 1$. Let $H = \langle \sigma \rangle$ and let $E = L^H = \{x \in L \mid \sigma(x)=x ~\forall \sigma \in H\}$.
    \vspace{1mm}
     
    By Proposition \ref{prop3.8}, a prime $\mathfrak{p} \subset \mathcal{O}_K$ is divisible by at least one prime of $E$ having relative degree one if $\mathfrak{p}$ is divisible by a prime $\mathcal{P} \subset \mathcal{O}_L$ such that $\left(\frac{L/K}{\mathcal{P}}\right)$ has a cycle of length one (when acting as permutations on the cosets $H_{\gamma}$ of $H$ in $G$). This occurs precisely when $\gamma \left(\frac{L/K}{\mathcal{P}}\right) \gamma^{-1} \in H$, which means that $\mathfrak{p} \in S_d$ for some $d$.
    \vspace{1mm}
     
    Let $S_E$ be the primes of $E$ with degree one over $K$. For each prime $\mathfrak{p} \in S_E$, let $n(\mathfrak{p})$ be the number of primes in $S_E$ dividing $\mathfrak{p}$. Then $\mathfrak{p} \in S_d$ is the norm of exactly $n(\mathfrak{p})$ primes in $S_E$. Since $S_E$ contains all the primes of $E$ with degree one over $\mathbb{Q}$, we get $\delta(S_E)=1$. Then 
    \begin{align*}
        -\log(s-1) \sim \sum_{\mathfrak{p}_E \in S_E}^{} \frac{1}{N_{K/\mathbb{Q}}(N_{E/K}(\mathfrak{p}_E))^s} \sim \sum_{d \mid n}^{} \sum_{\mathfrak{p} \in S_d}^{} \frac{n(\mathfrak{p})^s}{N(\mathfrak{p})^s}. ~~~ (\dagger)
    \end{align*} 
    By Proposition \ref{prop3.8}, for $\mathfrak{p} \in S_d$, $n(\mathfrak{p})$ is the number of distinct cosets $H \gamma$ such that $H \gamma \sigma^d = H \gamma$, or equivalently $\gamma \sigma^d \gamma^{-1}\in H$. But $H$ is cyclic, so this can only happen if $\gamma \sigma^d \sigma^{-1} \in \langle \sigma^d \rangle$, so $\gamma \in N_G(\langle \sigma^d \rangle)$. Putting this all together, $n(\mathfrak{p}) = [N_G(\langle \sigma^d \rangle) : H]$ for $\mathfrak{p} \in S_d$.
    \vspace{1mm}
     
    Using $(\dagger)$ above and induction hypothesis for the sum over $S_d$ for $d \neq 1$, we find 
    \begin{align*}
        [N_G(H):H]\sum_{\mathfrak{p} \in S_1}^{} N(\mathfrak{p})^{-s} \sim \left(-1 + \sum_{\substack{d \mid n, d \neq 1}}^{} \frac{[N_G(\langle \sigma^d \rangle):H]t_d}{\left|G\right|}\right)\log(s-1).
    \end{align*}
    \marginpar{23 Feb 2024, Lecture 16}
    By Lemma \ref{lemma3.10}, we have $t_d = \phi \left(\frac{n}{d}\right) [G:N_G(\langle \sigma^d \rangle)]$, so the expression in the brackets above is
    \begin{align*}
        &-1 + \sum_{d \mid n, d \neq 1}^{} \phi \left(\frac{n}{d}\right)\frac{[G:N_G(\langle \sigma^d \rangle)][N_G(\langle \sigma^d \rangle):H]}{\left|G\right|} \\
        =& -1 + \sum_{d \mid n, d \neq 1}^{} \phi \left(\frac{n}{d}\right)\frac{[G:H]}{\left|G\right|} \\
        =& -1 + \sum_{d \mid n, d\neq 1}^{} \frac{1}{n} \phi \left(\frac{n}{d}\right) = -1 - \frac{\phi(n)}{n} + \frac{1}{n}\sum_{d \mid n}^{} \phi \left(\frac{n}{d}\right).
    \end{align*}
    We have $\sum_{d \mid n}^{} \phi \left(\frac{n}{d}\right) = n$, so 
    \begin{align*}
        \sum_{\mathfrak{p} \in S}^{} \frac{1}{N(\mathfrak{p})^s} \sim \frac{-\phi(n)}{[N_G(H):H]}\log(s-1) = \frac{-t}{\left|G\right|}\log(s-1)
    \end{align*}
    by Lemma \ref{lemma3.10}.
\end{proof}
We are now in a position to prove the surjectivity of the Artin map.
\begin{theorem}[Surjectivity of the Artin map]\label{theorem3.12}
    Let $L/K$ be abelian and let $\mathfrak{m}$ be a modulus divisible by all ramified prime ideals. Then the Artin map $\Phi_{\mathfrak{m}}: I_K(\mathfrak{m}) \to \text{Gal}(L/K)$ is surjective.
\end{theorem}
\begin{proof}
    Let $\sigma \in \text{Gal}(L/K)$. Since this is abelian, the division of $\sigma$ consists of elements which are all generators of the cyclic group $\langle \sigma \rangle$. By the Frobenius density theorem, there exist infinitely many prime ideals $\mathcal{P}$ of $L$ whose Artin symbol $\left(\frac{L/K}{\mathcal{P}}\right)$ generates $\langle \sigma \rangle$.
    \vspace{1mm}
     
    Since only finitely many primes divide $\mathfrak{m}$, we can pick $\mathcal{P}$ with $\mathfrak{p} = \mathcal{P} \cap \mathcal{O}_K$ coprime to $\mathfrak{m}$. Then $\Phi_{\mathfrak{m}}(\mathfrak{p}) = \sigma'$, where $\sigma'$ is some generator of $\langle \sigma \rangle$. Hence $\sigma$ is in the image of $\Phi_{\mathfrak{m}}$.
\end{proof}
\subsection{Chebotarev's density theorem}
\begin{theorem}[Chebotarev's density theorem]\label{theorem3.13}
    Let $L/K$ be Galois and let $\sigma \in \text{Gal}(L/K)$. Suppose $\sigma$ has $c$ conjugates in $\text{Gal}(L/K)$. Let $$S = \{\mathfrak{p} \subset \mathcal{O}_K \mid \left(\frac{L/K}{\mathcal{P}}\right) = \sigma \text{ for some }\mathcal{P}\mid \mathfrak{p}\}.$$
    Then this set $S$ has density $$\delta(S)=\frac{c}{\left|\text{Gal}(L/K)\right|}.$$
\end{theorem}
Note that the original proof of this does not use class field theory, but most proofs in modern textbooks do.
\vspace{1mm}
 
\textbf{Notation.} If $L/K$ is not abelian, we can still write $\left(\frac{L/K}{\mathfrak{p}}\right)$ which refers to the conjugacy class of $\left(\frac{L/K}{\mathcal{P}}\right)$ for any $\mathcal{P} \mid \mathfrak{p}$.
\begin{cor}\label{cor3.14}
    Let $L/K$ be abelian, $\mathfrak{m}$ a modulus divisible by all primes that ramify in $L$, and $\sigma \in \text{Gal}(L/K)$. If \[
    S = \left\{\mathfrak{p} \subset \mathcal{O}_K \mid \mathfrak{p}\nmid \mathfrak{m}, \left(\frac{L/K}{\mathcal{P}}\right) = \sigma\right\},
    \]
    then $\delta(S)=\frac{1}{[L:K]}$.
\end{cor}
Chebotarev gives an alternative proof for Lemma \ref{lemma3.4}.
\begin{proof}[Alternate proof of Lemma \ref{lemma3.4}]
    Let $\sigma=1$. Then the set of primes with $\left(\frac{L/K}{\mathcal{P}}\right)$ has density $\frac{1}{[L:K]}$. But $\left(\frac{L/K}{\mathcal{P}}\right)$ if and only if $\mathfrak{p}$ splits completely.
\end{proof}
We next show that the primes that split completely characterize the extension $L/K$.
\vspace{1mm}
 
\textbf{Notation.} Given two sets $S,T$, we say $S \stackrel{\cdot }{\subset} T$ if $S \subset T \cup \Sigma$ for some finite set $\Sigma$. Write $S \stackrel{\cdot }{=} T$ if $S \stackrel{\cdot }{\subset} T$ and $T \stackrel{\cdot }{\subset} S$.
\begin{theorem}\label{theorem3.15}
    Let $L$ and $M$ be Galois extensions of $K$. Then
    \begin{enumerate}[(i)]
        \item $L \subset M$ if and only if $S_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$.
        \item $L=M$ if and only if $S_{M/K} \stackrel{\cdot }{=} S_{L/K}$.
    \end{enumerate}
\end{theorem}
To prove this, we first prove a proposition and a lemma.
\begin{prop}\label{prop3.16}
    Let $L$ and $M$ be finite extensions of $K$.
    \begin{enumerate}[(i)]
        \item If $M/K$ is Galois, then $L \subset M \iff S_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$.
        \item If $L/K$ is Galois, then $L \subset M \iff \widetilde{S}_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$, where \[
            \widetilde{S}_{M/K} = \{\mathfrak{p} \subset \mathcal{O}_K  \mid \mathfrak{p} \text{ unramified in }M, f_{\mathcal{P}|\mathfrak{p}}=1 \text{ for some }\mathcal{P} \subset \mathcal{O}_M \text{ with } \mathcal{P}\mid \mathfrak{p}\}.
        \]
    \end{enumerate}
\end{prop}
\begin{lemma}\label{lemma3.17}
    Let $L/K$ is a finite extension with Galois closure $M/K$. Then \[
    \delta(S_{L/K}) = \delta(S_{M/K}) = \frac{1}{[L:K]}. 
    \]
\end{lemma}
\begin{proof}
    Note that a prime $\mathfrak{p}$ of $K$ splits completely in $L$ if and only if it splits completely in all of the conjugates of $L$ in $M$, i.e. $\sigma(L)$ for $\sigma \in \text{Gal}(M/K)$. But the Galois closure $M$ is the compositum of the conjugates of $L$. Hence $\mathfrak{p}$ splits completely in $L$ if and only if it does so in $M$. 
\end{proof}
\begin{proof}[Proof of Proposition \ref{prop3.16}.]
    We first prove (ii). The direction $\implies $, i.e. if $L \subset M$, then $\widetilde{S}_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$, is left as an exercise.
    \vspace{1mm}
     
    Now assume $\widetilde{S}_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$. Let $N$ be a Galois extension of $K$ containing both $L$ and $M$. To prove $L \subset M$, by Galois theory it suffices to show that $\text{Gal}(N/M) \subset \text{Gal}(N/L)$. In other words, for any $\sigma \in \text{Gal}(N/M)$, we need to show $\sigma|_L = 1$. By Chebotarev, we can find a prime $\mathfrak{p} \subset \mathcal{O}_K$ unramified in $N$ such that $\left(\frac{N/K}{\mathfrak{p}}\right)$ is the conjugacy class of $\sigma$. In particular, there is $\mathcal{P} \subset \mathcal{O}_N$ such that $\mathcal{P} \mid \mathfrak{p}$ and $\left(\frac{N/K}{\mathcal{P}}\right) = \sigma$. We show $\mathfrak{p} \in \widetilde{S}_{M/K}$. Let $\mathcal{P}_M = \mathcal{P} \mathbb{N} \mathcal{O}_M$. Then for $\alpha \in \mathcal{O}_M$ we have $$\alpha \equiv \sigma(\alpha) \equiv \alpha^{N(\mathfrak{p})} \pmod{\mathcal{P}_M},$$ where the left equality uses $\sigma|_M=1$ and the right uses the definition of the Artin symbol. It follows that $\mathcal{O}_M/\mathcal{P}_M \cong \mathcal{O}_K/\mathcal{P}$, so $f_{\mathcal{P}_M|\mathfrak{p}}=1$ and hence $\mathfrak{p} \in \widetilde{S}_{M/K}$. By Chebotarev, we can find infinitely many such $\mathfrak{p}$, so we can assume $\mathfrak{p} \in S_{L/K}$. Since we assumed $\widetilde{S}_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$, we have $\left(\frac{L/K}{\mathfrak{p}}\right)=1$. We also have $\left(\frac{L/K}{\mathfrak{p}}\right) = \left(\frac{N/K}{\mathcal{P}}\right)|_L$ and since $\sigma = \left(\frac{L/K}{\mathcal{P}}\right)$, this implies $\sigma|_L=1$.
    \vspace{1mm}
     
    For the first part, direction $\impliedby$, suppose $S_{M/K} \stackrel{\cdot }{\subset } S_{L/K}$. By the proof of the previous lemma (Lemma \ref{lemma3.17}), we have $S_{L/K} = S_{L'/K}$ for $L'$ the Galois closure of $L$ over $K$. Since $M/K$ is Galois, we have $\widetilde{S}_{M/K} = S_{M/K}$ (exercise!). Hence $S_{M/K} \stackrel{\cdot }{\subset } S_{L/K} \implies \widetilde{S}_{M/K} \stackrel{\cdot }{\subset } S_{L'/K}$, but by the second part of this proposition we have $L' \subset M$, $L \subset M$.
    \vspace{1mm}
     
    The direction $\implies$ is left as an exercise.
\end{proof}
\begin{proof}[Proof of Theorem \ref{theorem3.15}.]
    \marginpar{26 Feb 2024, Lecture 17}
    Note that (ii) follows from (i), and (i) follows from Proposition \ref{prop3.16} since $\widetilde{S}_{M/K} = S_{M/K}$ for $M/K$ Galois.
\end{proof}
Next we use Chebotarev to prove some class field theory statements.
\begin{theorem}\label{theorem3.18}
    Let $\mathfrak{m}$ be a modulus of $K$ and let $L$ and $M$ be abelian extensions of $K$ which are both unramified at primes which do not divide $\mathfrak{m}$. If $\text{ker}(\Phi_{L/K,\mathfrak{m}})=\text{ker}(\Phi_{M/K,\mathfrak{m}})$, then $L=M$. In particular, the ray class field is unique if it exists.
\end{theorem}
\begin{proof}
    Let $S$ be the set of primes of $K$ that do not divide $\mathfrak{m}$. Then $\mathfrak{p} \in S$ is unramified in both $L$ and $M$ and $\mathfrak{p}$ splits completely in $L$ (respectively $M$) if and only if it lies in the kernel of $\Phi_{L/K,\mathfrak{m}}$ (respectively $\Phi_{M/K,\mathfrak{m}}$). If $\text{ker}(\Phi_{L/K,\mathfrak{m}}) = \text{ker}(\Phi_{M/K},\mathfrak{m})$, then $$S_{L/K} \stackrel{\cdot }{=} (S \cap \text{ker}(\Phi_{L/K,\mathfrak{m}})) = (S \cap \text{ker}(\Phi_{M/K,\mathfrak{m}})) \stackrel{\cdot }{=} S_{M/K},$$
    so $L = M$ by Theorem \ref{theorem3.15}.
\end{proof}
\begin{prop}\label{prop3.19}
    Let $L/K$ abelian and let $\mathfrak{m}$ be a modulus divisible by $\mathfrak{f}_{L/K}$. Then $\text{ker}(\Phi_{\mathfrak{m}}) \subset T_{L/K}(\mathfrak{m})$.
\end{prop}
\begin{proof}
    Since $\mathfrak{m}$ is divisible by $\mathfrak{f}_{L/K}$, we have $P_K(\mathfrak{m})\subset \text{ker}(\Phi_{\mathfrak{m}})\subset I_{K}(\mathfrak{m})$. In particular, for any $\mathfrak{a} \in I_K(\mathfrak{m})$, we know $\left(\frac{L/K}{\mathfrak{a}}\right)$ depends only on the class of $\mathfrak{a}$ mod $P_K(\mathfrak{m})$. Recall $P_K(\mathfrak{m}) = \text{ker}(\Phi_{K_{\mathfrak{m}}/K,\mathfrak{m}})$. Now by Chebotarev, for any $\sigma \in \text{Gal}(K_{\mathfrak{m}}/K)$, there are infinitely many primes $\mathfrak{p}$ such that $\left(\frac{K_\mathfrak{m}/K}{\mathfrak{p}}\right)=\sigma$ (so $\mathfrak{p} \nmid \mathfrak{m}$). Since we have an isomorphism $I_K(\mathfrak{m})/P_{K}(\mathfrak{m}) \cong \text{Gal}(K_{\mathfrak{m}}/K)$, so every ideal $\mathfrak{a}$ in $I_K(\mathfrak{m})$ is equivalent to a prime $\mathfrak{p}$ mod $P_K(\mathfrak{m})$. Now suppose $\mathfrak{p} \subset \mathcal{O}_K$ is such that $\mathfrak{p} \in \text{ker}(\Phi_{L/K,\mathfrak{m}})$, so $\left(\frac{L/K}{\mathfrak{p}}\right) = 1$. Hence $\mathfrak{p}$ splits completely in $L$. If $\mathcal{P} \in \mathcal{O}_L$ is such that $\mathcal{P} \mid \mathfrak{p}$, then $N_{L/K}(\mathcal{P})=\mathfrak{p}$, so $\mathfrak{p} \in N_{L/K}(I_L(\mathfrak{m})) \subset T_{L/K}(\mathfrak{m})$.
\end{proof}
\section{Global class field theory using the language of id\'eles}
\textbf{Recap of local fields.} Let $K$ be a number field. Recall that an absolute value on $K$ is equivalent (by Ostrowski's theorem) to either $\left|x\right|_{\mathfrak{p}} = c^{v_{\mathfrak{p}}(x)}$ for $\mathfrak{p}$ some prime ideal or $\left|x\right|_{\sigma} = \left|\sigma(x)\right|_{\infty}$ for $\sigma: K \hookrightarrow \mathbb{R}$ or $\sigma: K \hookrightarrow \mathbb{C}$. As before, write $\mathfrak{p}$ for both finite and infinite primes. Recall the product formula $\prod_{\mathfrak{p}} \left|x\right|_{\mathfrak{p}} = 1$ for $x \in K^\times$. Recall that $\left|\cdot \right|_{\mathfrak{p}}$ induces a (metric) topology on $K$. An absolute value $\left|\cdot \right|_{\mathfrak{p}}$ on $K$ is nonarchimedean if it satisfies $\left|x+y\right|\le \max(\left|x\right|,\left|y\right|)$ and archimedean if it is not equivalent to an evaluation satisfying the condition above, which is the case for infinite primes. If $\left|\cdot \right|_{\mathfrak{p}}$ is non--archimedean, let $R = \{x \in K \mid \left|x\right|_{\mathfrak{p}}\le 1\}$ and $\mathfrak{p} = \{x \in K \mid \left|x\right|<1\}$. Then $R$ is a local ring with maximal ideal $\mathfrak{p}$ and quotient field $K$, called the valuation ring of $\left|\cdot \right|_{\mathfrak{p}}$. For any $\left|\cdot \right|_{\mathfrak{p}}$, we write $K_{\mathfrak{p}}$ for the completion of $K$ with respect to $\left|\cdot \right|_{\mathfrak{p}}$. If $\mathfrak{p}$ is infinite, then $K_{\mathfrak{p}}\cong \mathbb{R}$ or $\mathbb{C}$ depending on whether $\mathfrak{p}$ is real or complex. For a nonarchimedean local field $K_{\mathfrak{p}}$, we have $\mathcal{O}_{K_{\mathfrak{p}}} = \{x \in K_{\mathfrak{p}}\mid \left|x\right|_{\mathfrak{p}}\le 1\}$ as the ring of integers, which is compact and a discrete valuation, i.e. the value group is isomorphic to the integers under addition. This is an open subring of $K_{\mathfrak{p}}$ with units $\mathcal{O}_{K_\mathfrak{p}}^\times = \{x \in K_{\mathfrak{p}} \mid \left|x\right|_{\mathfrak{p}}=1\}$ and unique maximal ideal $\mathfrak{p}\mathcal{O}_{K_{\mathfrak{p}}}=\{x \in K_{\mathfrak{p}}\mid \left|x\right|_{\mathfrak{p}}<1\}$.

\begin{example}
    Take $K=\mathbb{Q}$, $p$ a rational prime. Then $K_{\mathfrak{p}} = \mathbb{Q}_{p}$ and $\mathcal{O}_{K_{\mathfrak{p}}}=\mathbb{Z}_p$.
\end{example}

For each $\mathfrak{p}$, we can embed $\iota_{\mathfrak{p}}: K \hookrightarrow K_{\mathfrak{p}}$. If $\alpha \in K$ is nonzero, then $\iota_{\mathfrak{p}}(\alpha)$ is a nonzero element of $K_{\mathfrak{p}}$ for every $\mathfrak{p}$, and $\iota_{\mathfrak{p}}(\alpha)$ is a unit in $K_{\mathfrak{p}}$ for all but finitely many primes $\mathfrak{p}$. (Here we distinguish between ''units of $K_{\mathfrak{p}}$'' being $\mathcal{O}_{K_{\mathfrak{p}}}^\times$ for $\mathfrak{p}$ finite and $K_{\mathfrak{p}}^\times$ for $\mathfrak{p}$ infinite.)
\vspace{1mm}
 
We would like to use local data, e.g. the study of local fields and valuation theory to study number fields. To do this, we would like to ''embed'' $K$ into all completions $K_{\mathfrak{p}}$ simultaneously. But $\prod_{\mathfrak{p}}^{} K_{\mathfrak{p}}$ is not ''nice'' in a topological sense, as it is not locally compact. Thus we adjust $\prod_{\mathfrak{p}}^{} K_{\mathfrak{p}}$ to get something locally compact, that is the Restricted Product Topology.

\subsection{The restricted product topology}
\begin{defn}\label{defn4.1}
    Let $(X_i)$ be a family of topological spaces, indexed by $i \in I$, and let $(U_i)$ be a family of open sets $U_i \subset X_i$. Then the \textbf{restricted product} $\prod' (X_i,U_i)$ is the topological space
    \begin{align*}
        \prod \hspace{0mm} ' (X_i,U_i) = \{(x_i) \mid x_i \in U_i \text{ for all but finitely many }i \in I\} \subset \prod_{}^{} X_i
    \end{align*}
    with the bases of open sets
    \begin{align*}
        B = \left\{\prod_{}^{} V_i \mid V_i \subset X_i \text{ open for all }i \in I, V_i = U_i \text{ for all but finitely many }i \in I \right\}.
    \end{align*}
    Note that this is in general not equal to the subspace topology that the set $\prod' (X_i,U_i)$ inherits from $\prod_{}^{} X_i$, since it has more open sets.
\end{defn}
\begin{prop}\label{prop4.2}
    Let $(X_i)_{i \in I}$ be a family of locally compact topological spaces, and let $(U_i)_{i \in I}$ be a corresponding family of open subsets $U_i \subset X_i$, almost all of which are compact. Then $X=\prod' (X_i,U_i)$ is locally compact.
\end{prop}
\begin{proof}
    Omitted.
\end{proof}
Our next step is to define adeles and id\'eles. These words are shorthand for ''additive id\'ele'' and ''ideal element''.
\begin{defn}\label{defn4.3}
    An \textbf{adele} of a number field $K$ is a family 
    \begin{align*}
        \alpha = (\alpha_{\mathfrak{p}})
    \end{align*}
    of elements $\alpha_{\mathfrak{p}} \in K_{\mathfrak{p}}$, where $\mathfrak{p}$ runs through all primes of $K$ and $\alpha_{\mathfrak{p}}$ is integral in $K_{\mathfrak{p}}$, i.e. $\alpha_{\mathfrak{p}} \in \mathcal{O}_{K_{\mathfrak{p}}}$ for almost all $\mathfrak{p}$.
\end{defn}
Note again that if $\mathfrak{p}$ is finite, then $\mathcal{O}_{K_{\mathfrak{p}}} = \{\alpha \in K_{\mathfrak{p}} \mid \left|\alpha\right|_{\mathfrak{p}}\le 1\}$ and if $\mathfrak{p}$ is infinite, then $\mathcal{O}_{K_{\mathfrak{p}}} = K_{\mathfrak{p}}$.
\vspace{1mm}
 
The adeles form a ring $\mathbb{A}$ by defining addition and multiplication component-wise. We have 
\begin{align*}
    \mathbb{A} = \{(\alpha_\mathfrak{p}) \subset \prod_{\mathfrak{p}}^{} K_{\mathfrak{p}} \mid \alpha_{\mathfrak{p}} \in \mathcal{O}_{K_{\mathfrak{p}}} \text{ for almost all }\mathfrak{p}\} = \prod_{\mathfrak{p}}^{} \hspace{0mm}' (K_{\mathfrak{p}},\mathcal{O}_{K_{\mathfrak{p}}}).
\end{align*}
\marginpar{28 Feb 2024, Lecture 18}
If $\alpha \in \mathbb{A}_K$, then we write $\alpha_{\mathfrak{p}}$ for the projection of $\alpha$ in $K_{\mathfrak{p}}$.
\begin{example}
    If $K=\mathbb{Q}$, then
    \begin{align*}
        &\mathbb{A}_{\mathbb{Q}} = \prod_{\mathfrak{p}}^{} \hspace{0mm}' (\mathbb{Q}_{\mathfrak{p}}, \mathcal{O}_{\mathbb{Q}_{\mathfrak{p}}}) \\
        =& \mathbb{R} \times \{(\alpha_{\mathfrak{p}})_{\mathfrak{p}} \in \prod_{\mathfrak{p} \text{ finite}}^{} \mathbb{Q}_{\mathfrak{p}} \mid \alpha_{\mathfrak{p}} \in \mathbb{Z}_{\mathfrak{p}} \text{ for almost all }\mathfrak{p}\}\\
        =& \mathbb{R} \times \{\alpha \in \prod_{\mathfrak{p} \text{ finite}}^{} \mathbb{Q}_{\mathfrak{p}} \mid \left|\alpha\right|_{\mathfrak{p}}\le 1 \text{ for almost all }\mathfrak{p}\}.
    \end{align*}
\end{example}
\begin{prop}\label{prop4.4}
    The ring of adeles $\mathbb{A}_K$ is locally compact and Hausdorff.
\end{prop}
\begin{proof}
    Note first that all local fields $K_{\mathfrak{p}}$ are locally compact and all but finitely many $\mathcal{O}_{K_{\mathfrak{p}}}$ are valuation rings of a nonarchimedean local field. Hence by Proposition \ref{prop4.2}, $\mathbb{A}_K$ is locally compact. Now $\prod_{\mathfrak{p}}^{} K_{\mathfrak{p}}$ is Hausdorff as each $K_{\mathfrak{p}}$ is Hausdorff, since the topology on the adeles is finer than the subspace topology. This means that $\mathbb{A}_K$ is also Hausdorff.
\end{proof}
Let $S$ be a finite set of primes. Then we have a subring of $\mathbb{A}_K$, called the $S$-adeles
\[
\mathbb{A}_{K,S} = \prod_{\mathfrak{p} \in S}^{} K_{\mathfrak{p}} \times \prod_{\mathfrak{p} \not\in S}^{} \mathcal{O}_{K_{\mathfrak{p}}}. 
\]
The canonical embeddings $K \hookrightarrow K_{\mathfrak{p}}$ induces a canonical embedding $K \hookrightarrow \mathbb{A}_K$ by $x \mapsto (\ldots,x,x,x,\ldots)$. Note that for each $x \in K$ we have $x \in \mathcal{O}_{K_{\mathfrak{p}}}$ for all but finitely many $\mathfrak{p}$. The image of $K$ in $\mathbb{A}_K$ is the subring of principal adeles.
\subsection{The group of id\'eles}
The idele group of $K$ is the unit group of the ring of adeles,
\begin{align*}
    \mathbb{A}_K^\times = \{\alpha = (\alpha_{\mathfrak{p}})_{\mathfrak{p}} \in \mathbb{A}_K \mid \alpha_{\mathfrak{p}} \in K_{\mathfrak{p}}^\times \text{ for all }\mathfrak{p}, \alpha_{\mathfrak{p}} \in \mathcal{O}_{K_{\mathfrak{p}}} \text{ for almost all }\mathfrak{p}\}.
\end{align*}
Note that as a subspace of $\mathbb{A}_K$, this is not a topological group.
\begin{defn}\label{defn4.5}
    The \textbf{group of id\'eles} of $K$ is the topological group 
    \[
    \mathbb{I}_K = \prod_{\mathfrak{p}}^{} \hspace{0mm}' (K_{\mathfrak{p}}^\times, \mathcal{O}_{K_{\mathfrak{p}}}^\times)
    \]
    with multiplication defined componentwise.
\end{defn}
\begin{prop}\label{prop4.6}
    The id\'ele group $\mathbb{I}_K$ is locally compact and Hausdorff.
\end{prop}
\begin{proof}
    Note that the topology on $\mathbb{I}_K$ is finer than the topology of $\mathbb{A}_K^\times \subset \mathbb{A}_K$, which is Hausdorff, so $\mathbb{I}_K$ is Hausdorff. For each finite prime $\mathfrak{p}$, $\mathcal{O}_{K_{\mathfrak{p}}}^\times = \{x \in K_{\mathfrak{p}}^\times \mid \left|x\right|_{\mathfrak{p}}=1\}$ is a closed subset of the compact set $\mathcal{O}_{K_{\mathfrak{p}}}$, so it is compact. This applies to almost all primes $\mathfrak{p}$, and the $K_{\mathfrak{p}}^\times$ are locally compact, so by Proposition \ref{prop4.2} $\mathbb{I}_K = \prod_{\mathfrak{p}}^{} \hspace{0mm}' (K_{\mathfrak{p}}^\times, \mathcal{O}_{K_{\mathfrak{p}}}^\times)$ is locally compact.
\end{proof}
The canonical embedding $K \hookrightarrow \mathbb{A}_K$ restricts to a canonical embedding $K^\times \hookrightarrow \mathbb{I}_K$. We view $K$ as a subgroup of $\mathbb{I}_K$.
\begin{defn}\label{defn4.7}
    The elements of $K^\times$ in $\mathbb{I}_K$ are called \textbf{principal id\'eles}, and the quotient group $C_K = \mathbb{I}_K\setminus K^\times$ is called the \textbf{id\'ele class group} of $K$.
\end{defn}
For any finite set of primes $S$, we let the $S$-id\'eles be 
\begin{align*}
    \mathbb{I}_{K,S} =& \prod_{\mathfrak{p} \in S}^{} K_{\mathfrak{p}}^\times \times \prod_{\mathfrak{p} \not\in S}^{} \mathcal{O}_{K_{\mathfrak{p}}}^\times \\
    =& \prod_{\mathfrak{p} \mid \infty}^{} K_{\mathfrak{p}}^\times \times \prod_{\substack{\mathfrak{p} \nmid \infty\\ \mathfrak{p} \in S}}^{} K_{\mathfrak{p}}^\times \times \prod_{\mathfrak{p} \not\in S}^{} \mathcal{O}_{K_{\mathfrak{p}}}^\times. 
\end{align*}
Hence $\mathbb{I}_K = \bigcup_{S \text{ finite}} \mathbb{I}_{K,S}$. Let $S_{\infty} = \{\text{infinite primes }\mathfrak{p}\}$, then 
\[
\mathbb{I}_{K,S_{\infty}} = \prod_{\mathfrak{p} \mid  \infty}^{} K_{\mathfrak{p}}^\times \times \prod_{\mathfrak{p} \nmid \infty}^{} \mathcal{O}_{K_{\mathfrak{p}}}^\times.
\]
The id\'ele class group is not finite, in contrast to the ideal class group.
\begin{prop}\label{prop4.8}
    We have $\mathbb{I}_K/\mathbb{I}_{K,S_{\infty}} \cong I_K$ and $\text{Cl}(K) \cong \mathbb{I}_K/\mathbb{I}_{K,S_{\infty}}K^\times$.
\end{prop}
\begin{proof}
    Consider the surjective homomorphism $(~): \mathbb{I}_K \to I_K$ given by $\alpha \mapsto (\alpha) = \prod_{\mathfrak{p} \nmid \infty}^{} \mathfrak{p}^{v_{\mathfrak{p}}(\alpha_{\mathfrak{p}})}$. We see the map ignores the infinite primes and hence has kernel $\prod_{\mathfrak{p} \mid \infty}^{} K_{\mathfrak{p}}^\times \times \prod_{\mathfrak{p} \nmid \infty}^{} \mathcal{O}_{K_{\mathfrak{p}}}^\times = \mathbb{I}_{K,S_{\infty}}$. Moreover, it is a continuous map with respect to the discrete topology on $I_K$. Note the composite $K^\times \hookrightarrow \mathbb{I}_K \to I_K$ has image $P_K$, the set of principal fractional ideals. Hence the map induces a surjective homomorphism from $C_K = \mathbb{I}_K/K$ to $\text{Cl}(K) = I_K/P_K$ with kernel $\mathbb{I}_{K,S_{\infty}}K^\times$.
\end{proof}
Since $I_K/P_K$ is finite, we can enlarge $S_{\infty}$ to a set $S$ such that $\mathbb{I}_K = \mathbb{I}_{K,S}K^\times$. More formally:
\begin{prop}\label{prop4.9}
    We have $\mathbb{I}_K = \mathbb{I}_{K,S}K^\times$ and $C_K = \mathbb{I}_{K,S}/K^\times$ for $S$ a sufficiently large (but finite) set of primes of $K$.  
\end{prop}
\begin{proof}
    Let $\mathfrak{a}_1,\ldots,\mathfrak{a}_h$ be ideals representing the $h$ classes of $I_K/P_K$. For each of these classes, there are only finitely many prime ideals $\mathfrak{p}_1,\ldots,\mathfrak{p}_n$ dividing $\mathfrak{a}_i$. We claim $\mathbb{I}_K = \mathbb{I}_{K,S}K^\times$ for $S$ any finite set of primes containing all these primes and all the infinite primes.
    \vspace{1mm}
     
    We have $\mathbb{I}_K/\mathbb{I}_{K,S_{\infty}} \cong I_K$. Let $\alpha \in I_K$, then $(\alpha) = \prod_{\mathfrak{p}\nmid \infty}^{} \mathfrak{p}^{v_{\mathfrak{p}}(\alpha_{\mathfrak{p}})}$ belongs to some class $\mathfrak{a}_i P_K$, i.e. there is a principal ideal $(a)$ such that $(\alpha) = \mathfrak{a}_i (a)$. Consider the id\'ele $\alpha' = \alpha a^{-1}$. Then under the map $\mathbb{I}_K \to I_K$, $\alpha'$ is mapped to the ideal $\mathfrak{a}_i = \prod_{\mathfrak{p} \nmid \infty}^{} \mathfrak{p}^{v_{\mathfrak{p}}(\alpha_{\mathfrak{p}}')}$. Since the prime ideals occurring in $\mathfrak{a}_i$ lie in $S$, we have $v_{\mathfrak{p}}(\alpha_{\mathfrak{p}}') = 0$, i.e. $\alpha_{\mathfrak{p}}' \in \mathcal{O}_{K_{\mathfrak{p}}}^\times$ for $\mathfrak{p} \not\in S$. This means $\alpha' = \alpha a^{-1} \in \mathbb{I}_{K,S}$, so $\alpha \in \mathbb{I}_{K,S}K^\times$.
\end{proof}
\begin{prop}\label{prop4.10}
    $K^\times$ is a discrete subgroup of $\mathbb{I}_K$.
\end{prop}
\begin{proof}
    Since $\mathbb{I}_K$ is a topological group, it suffices to show that $1 \in \mathbb{I}_K$ has a neighborhood containing no other elements of $K^\times$, i.e. no other principal id\'ele. Consider the following neighborhood of 1:
    \begin{align*}
        U = \{\alpha \in \mathbb{I}_K \mid \left|\alpha_{\mathfrak{p}}\right|_{\mathfrak{p}}=1 \text{ for }\mathfrak{p}\nmid \infty, \left|\alpha_{\mathfrak{p}}-1\right|<1 \text{ for }\mathfrak{p} \mid \infty\}.
    \end{align*}
    Let $x \in U$ be a principal id\'ele with $x \neq 1$. Then by the product formula,
    \begin{align*}
        1 =& \prod_{\mathfrak{p}}^{} \left|x-1\right|_{\mathfrak{p}} = \prod_{\mathfrak{p}\nmid \infty}^{} \left|x-1\right|_{\mathfrak{p}} \prod_{\mathfrak{p} \mid \infty}^{} \left|x-1\right|_{\mathfrak{p}}\\
        <& \prod_{\mathfrak{p}\nmid \infty}^{} \left|x-1\right|_{\mathfrak{p}}\\
        \le & \prod_{\mathfrak{p}\nmid \infty}^{} \max(\left|x\right|_{\mathfrak{p},1}) = 1, 
    \end{align*}
    a contradiction.
\end{proof}
Hence $K^\subset \mathbb{I}_K$ is a closed subgroup, and the quotient topology on the id\'eles class group $C_K$ is therefore Hausdorff and locally compact.
\marginpar{01 Mar 2024, Lecture 19}


\end{document}