\documentclass{article}
%build with recipe latexmk
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{fancyhdr}
\pagestyle{fancy}

\usepackage{tcolorbox}
\tcbuselibrary{theorems}
\usepackage{babel}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
%\usepackage{a4wide}
\usepackage{float}
\usepackage{tikz-cd}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{setspace}
\setstretch{1.1}
\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black,  %choose some color if you want links to stand out
}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{cor}[theorem]{Corollary}
\newtheorem{prop}[theorem]{Proposition}
\newtheorem{example}[theorem]{Example}
\newtheorem{defn}{Definition}[section]

\title{Part III - Elliptic Curves
    \\ \large
    Lectured by Tom Fisher 
}
 
\author{Artur Avameri}
\date{}
 
\setcounter{section}{-1}
 
\begin{document}
\maketitle
\tableofcontents
\newpage
 
\section{Introduction}

\marginpar{19 Jan 2024, Lecture 1}


The best books for the course include \textit{The arithmetic of elliptic curves} by Silverman, Springer 1996, and \textit{Lectures on elliptic curves} by Cassels, CUP 1991. 

\section{Fermat's Method of Infinite Descent}

A right--angled triangle $\Delta$ has $a^2+b^2=c^2$ and $\text{area}(\Delta) = \frac{1}{2}ab$.
\begin{defn}
    $\Delta$ is \textbf{rational} if $a,b,c \in \mathbb{Q}$. $\Delta$ is \textbf{primitive} if $a,b,c \in \mathbb{Z}$ are coprime.
\end{defn}
Note that a primitive triangle has pairwise coprime side lengths because $a^2+b^2=c^2$.
\begin{lemma}\label{lemma1.1}
    Every primitive triangle is of the form $(u^2-v^2, 2uv, u^2+v^2)$ for some integers $u > v > 0$.
\end{lemma}
\begin{proof}
    WLOG let $a,b,c$ be odd, even, odd. Then $\left(\frac{b}{2}\right)^2 = \frac{c+a}{2}\frac{c-a}{2}$, where we note that the RHS is a product of positive coprime integers. By unique factorization, $\frac{c+a}{2} = u^2, \frac{c-a}{2}=v^2$ for $u,v \in \mathbb{Z}$. This gives the desired result.
\end{proof}
\begin{defn}
    $D \in \mathbb{Q}_{>0}$ is a \textbf{congruent} number if there exists a rational triangle $\Delta$ with $\text{area}(\Delta)=D$.
\end{defn}
Note that it suffices to consider $D \in \mathbb{Z}_{> 0}$ squarefree.
\begin{example}
    $D=5,6$ are congruent.
\end{example} 
\begin{lemma}\label{lemma1.2}
    $D \in \mathbb{Q}_{>0}$ is congruent $\iff Dy^2 = x^3-x$ for some ${x,y \in \mathbb{Q}, y \neq 0}$.
\end{lemma}
\begin{proof}
    Lemma \ref{lemma1.1} shows that $D$ congruent $\implies Dw^2 = uv(u^2-v^2)$ for some $u,v,w \in \mathbb{Q}, w \neq 0$. This implication also obviously goes the other way. To finish, divide through by $w^4$ and take $x = \frac{u}{v}, y = \frac{w}{v^2}$.
\end{proof}
Fermat showed that $1$ is not a congruent number.
\begin{theorem}\label{theorem1.3}
    There is no solution to $w^2 = uv(u+v)(u-v)$ for $u,v,w \in \mathbb{Z}, w \neq 0$.
\end{theorem}
\begin{proof}
    WLOG assume $u,v$ are coprime and that $u,w > 0$. If $v<0$, then replace $(u,v,w)$ by $(-v,u,w)$. If $u,v$ are both odd, then replace $(u,v,w)$ by $\left(\frac{u+v}{2},\frac{u-v}{2},\frac{w}{2}\right)$. Then $u,v,u+v,u-v$ are pairwise coprime positive integers with their product a square, so by unique factorization in $\mathbb{Z}$, $u=a^2, v = b^2, u+v = c^2, u-v = d^2$ for $a,b,c,d \in \mathbb{Z}$. 
    \vspace{1mm}
     
    Since $u \not\equiv v \pmod{2}$, both $c$ and $d$ are odd. Then $\left(\frac{c+d}{2}\right)^2 + \left(\frac{c-d}{2}\right)^2 = \frac{c^2+d^2}{2} = u = a^2$. This gives a primitive triangle with area $\frac{c^2-d^2}{8} = \frac{v}{4} = \left(\frac{b^2}{2}\right)$. Let $w_1 = \frac{b}{2}$, then by Lemma \ref{lemma1.1}, $w_1^2 = u_1v_1(u_1+v_1)(u_1-v_1)$ for some $u_1, v_1 \in \mathbb{Z}$. Hence we have a new solution to our original question, with $4w_1^2 = b^2 = v \mid w^2 \implies w_1 \le \frac{w}{2}$, so we're done by infinite descent.
\end{proof}
\vspace{1mm}
 
\textbf{A variant for polynomials.} In the above, $K$ is a field with $\text{char }K \neq 2$. Let $\overline{K}$ be the algebraic closure of $K$ and consider for this whole section $K$ with $\text{char }K \neq 2$.

\begin{lemma}\label{lemma1.4}
    Let $u,v \in K[t]$ be coprime. If $\alpha u + \beta v$ is a square for 4 distinct $(\alpha : \beta) \in \mathbb{P}^1$, then $u, v \in K$.
\end{lemma}
\begin{proof}
    WLOG let $K = \overline{K}$ by extending if necessary. Changing coordinates on $\mathbb{P}^1$ (i.e. multiplying by a $2 \times 2$ invertible matrix), we may assume that the points $(\alpha : \beta)$ are $(1 : 0)$, $(0 : 1)$, $(1: -1)$, $(1: - \lambda)$ for $\lambda \in K \setminus \{0,1\}$. Since our field is algebraically closed, let $\mu = \sqrt{\lambda}$. Then $u = a^2, v = b^2, u-v = (a+b)(a-b), u - \lambda v = (a + \mu b)(a - \mu b)$.
    \vspace{1mm}
     
    Unique factorization in $K[t]$ implies that $a+b, a-b, a+ \mu b, a- \mu b$ are squares (since the necessary terms are coprime up to units, i.e. constants). But $\max(\text{deg}(a), \text{deg}(b)) \le \frac{1}{2}\max(\text{deg}(u),\text{deg}(v))$, so by Fermat's method of infinite descent, $u, v \in K$.
\end{proof}
\begin{defn}
    \begin{enumerate}[(i)]
        \item An \textbf{elliptic curve} $E/K$ is the projective closure of the plane affine curve $y^2 = f(x)$ (this is called a Weierstrass equation) where $f \in K[x]$ is a monic cubic polynomial with distinct roots in $\overline{K}$.
        \item For $L/K$ any field extension, $E(L) = \{(x,y) \in L^2 \mid y^2 = f(x)\} \cup \{0\}$ (the point at infinity in the projective closure), it turns out that $E(L)$ is naturally an abelian group.  
    \end{enumerate}
\end{defn}
In this course, we study $E(K)$ for $K$ a finite field, local field, number field.
\vspace{1mm}
 
Lemma \ref{lemma1.2} and Theorem \ref{theorem1.3} show that if $E : y^2 = x^3-x$, then $E(\mathbb{Q}) = \{0, (0,0), (\pm 1, 0)\}$.

\begin{cor}\label{cor1.5}
    Let $E/K$ be an elliptic curve. Then $E(K(t)) = E(K)$.
\end{cor}
\begin{proof}
    WLOG $K = \overline{K}$. By a change of coordinates, we may assume $y^2 = x(x-1)(x-\lambda)$ for some $\lambda \in K\setminus \{0,1\}$. Suppose $(x,y) \in E(K(t))$. Write $x = \frac{u}{v}$ for $u,v \in K(t)$ coprime. Then $w^2 = uv(u-v)(u-\lambda v)$ for some $w \in K[t]$. Unique factorization in $K[t]$ shows that $u,v, u-v, u- \lambda v$ are all squares, so by Lemma \ref{lemma1.4}, $u, v \in K$, so $x, y \in K$.
\end{proof}

\section{Some remarks on algebraic curves}

\marginpar{22 Jan 2024, Lecture 2}

In this section, work over an algebraically closed field $K = \overline{K}$.

\begin{defn}\label{defn2.1}
    A plane curve $C = \{f(x,y) = 0\} \subset \mathbb{A}^2$ (for $f \in K[x,y]$ irreducible) is \textbf{rational} if it has a rational parametrization, i.e. $\exists \phi, \psi \in K(t)$ such that
    \begin{enumerate}[(i)]
        \item The map $\mathbb{A}^1 \to \mathbb{A}^2$ by $t \mapsto (\phi(t), \psi(t))$ is injective on $\mathbb{A}^1\setminus \{\text{finite set}\}$.
        \item $f(\phi(t),\psi(t))=0$ in $K(t)$.
    \end{enumerate}
\end{defn}
\begin{example}
    \begin{enumerate}[(a)]
        \item Any nonsingular conic is rational. For example, for $x^2+y^2=1$, take a line with slope $t$ through $(-1,0)$ (the anchor) and solve to get the rational parametrization $(x,y) = \left(\frac{1-t^2}{1+t^2},\frac{2t}{1+t^2}\right)$.
        \item Any singular plane cubic is rational, for example $y^2=x^3$ giving $(x,y) = (t^2, t^3)$ with the anchor at the singularity $(0,0)$ and $y^2 = x^2(x+1)$ with the parametrization to be computed on Ex. Sheet 1 (anchor still at $(0,0)$).
        \item Corollary \ref{cor1.5} shows that elliptic curves are not rational.
    \end{enumerate}
\end{example}
\textbf{Remark.}
The genus $g(C) \in \mathbb{Z}_{\ge 0}$ is an invariant of a smooth projective curve $C$. If $K=\mathbb{C}$, then $g(C)$ is the genus of the Riemann surface. A smooth plane curve $C \subset \mathbb{P}^2$ of degree $d$ has genus $g(C) = \frac{(d-1)(d-2)}{2}$.
\begin{prop}
    (Here we still assume $K = \overline{K}$). Let $C$ be a smooth projective curve.
    \begin{itemize}
        \item $C$ is rational (see Definition \ref{defn2.1})$\iff$ $g(C)=0$.
        \item $C$ is an elliptic curve $\iff$ $g(C)=1$.
    \end{itemize}
\end{prop}
\begin{proof}
    \begin{enumerate}[(i)]
        \item Omitted.
        \item $(\implies)$: Check $C$ is a smooth plane curve in $\mathbb{P}^2$ (see Ex. Sheet 1) and use the above remark.
        \vspace{1mm}
         
        $(\impliedby)$: We will see this later.
    \end{enumerate}
\end{proof}

\vspace{1mm}
 
\textbf{Order of vanishing.} Let $C$ be an algebraic curve with function field $K(C)$ and let $P \in C$ be a smooth point. Write $\text{ord}_P(f)$ for the order of vanishing of $f \in K(C)$ at $P$ (which is negative if $f$ has a pole at $P$).
\vspace{1mm}
 
\textbf{Fact.} $\text{ord}_P : K(C)^\times \to \mathbb{Z}$ is a discrete valuation, i.e. $\text{ord}_P(f_1f_2) = \text{ord}_P(f_1) + \text{ord}_P(f_2)$ and $\text{ord}_P(f_1+f_2)\ge \min(\text{ord}_P(f_1),\text{ord}_P(f_2))$. 

\begin{defn}
    We say $t \in K(C)^\times$ is a \textbf{uniformizer} at $P$ if $\text{ord}_P(t)=1$.
\end{defn}
\begin{example}
    $C =\{g = 0\} \subset \mathbb{A}^2$ for $g \in K[x,y]$. Then $K(C) = \text{Frac}\left(\frac{K[x,y]}{(g)}\right)$. Write $g = g_0+g_1(x,y) + g_2(x,y) + \ldots$ for $g_i$ homogeneous of degree $i$. Suppose $P = (0,0)$ is a smooth point, e.g. $g_0=0$ and let $g_1(x,y)=\alpha x + \beta y$ with $\alpha,\beta$ not both zero ($\alpha x + \beta y =0$ gives a tangent to the curve at $P$). Let $\gamma,\delta \in K$ and consider also the line $\gamma x + \delta y$ through $P$. Then it is a fact that $\gamma x + \delta y \in K(C)$ is a uniformizer at $P$ if and only if $\alpha \delta - \beta \gamma \neq 0$. 
\end{example}
\begin{example}\label{ex2.3}
    Consider $\{y^2 = x(x-1)(x-\lambda)\} \subset \mathbb{A}^2$ for $\lambda \neq 0,1$ and consider its projective closure by taking $x =\frac{X}{Z}, y = \frac{Y}{Z}$ to get $\{Y^2Z = X(X-Z)(X-\lambda Z)\} \subset \mathbb{P}^2$. This has only one point at infinity, $P = (0 : 1 : 0)$. Our aim is to compute $\text{ord}_P(x)$ and $\text{ord}_P(y)$.
    \vspace{1mm}
     
    For this, put $t = \frac{X}{Y}, w =\frac{Z}{Y}$, so $w \stackrel{(\dagger)}{=}  t(t-w)(t-\lambda w) $. Now $P$ is the point $(t,w) = (0,0)$, which is a smooth point with $\text{ord}_P(t) = \text{ord}_P(t-w) = \text{ord}_P(t-\lambda w) = 1$, so $(\dagger)$ gives $\text{ord}_P(w) = 3$. We now find
    \begin{align*}
        &\text{ord}_P(x) = \text{ord}_P\left(\frac{X}{Z}\right) = \text{ord}_P\left(\frac{t}{w}\right) = 1-3 = -2\\
        &\text{ord}_P(y) = \text{ord}_P\left(\frac{Y}{Z}\right) = \text{ord}_P\left(\frac{1}{w}\right) = -3.
    \end{align*}
\end{example}

\textbf{Riemann--Roch space.} Let $C$ be a smooth projective curve. 
\begin{defn}
    A \textbf{divisor} is a formal sum of points on $C$, say $D = \sum_{P \in C}^{} n_P P$ where $n_P \in \mathbb{Z}$ and $n_P = 0$ for all but finitely many $P \in C$. We say $\text{deg }D= \sum_{P \in C}^{} n_P$.
    \vspace{1mm}
     
    $D$ is \textbf{effective} (written $D\ge 0$) if $n_P \ge 0 ~\forall P \in C$. If $f \in K(C)^\times$, then $\text{div}(f) = \sum_{P \in C}^{} \text{ord}_P(f)P$. The Riemann--Roch space of $D \in \text{Div}(C)$ is  
    \[
        \mathcal{L}(D) = \{f \in K(C)^\times \mid \text{div}(f) + D \ge 0\} \cup \{0\},
    \]
    i.e. the $K$--vector space of rational functions on $C$ with ''poles no worse than specified by $D$'' (i.e. every coefficient of $\text{div}(f)+D$ is nonnegative).
\end{defn}
We quote Riemann--Roch for surfaces of genus 1: We have
\begin{align*}
    \text{dim }\mathcal{L}(D) = \begin{cases}
        \text{deg }D &\text{if deg }D>0\\
        0 \text{ or }1 &\text{if deg }D=0\\
        0 &\text{if deg }D<0.
    \end{cases}
\end{align*}
\begin{example}
    We revisit Example \ref{ex2.3}. We have $\mathcal{L}(2P) = \langle 1,x \rangle$ and $\mathcal{L}(3P) = \langle 1,x,y \rangle$.
\end{example}

\marginpar{24 Jan 2024, Lecture 3}

We still have $\text{char }K \neq 2$ and $\overline{K} = K$.

\begin{prop}\label{prop2.2}
    Let $C \subset \mathbb{P}^2$ be a smooth plane cubic and let $P \in C$ be a point of inflection. Then we may change coordinates such that $C : Y^2Z = X(X-Z)(X-\lambda Z)$ and $P = (0:1:0)$ (for some $\lambda \neq 0,1$).
\end{prop}
\begin{proof}
    First change coordinates such that $P = (0:1:0)$. Then change coordinates such that the tangent line becomes $T_p C = \{Z = 0\}$. Say $C = \{F(X,Y,Z) = 0\} \subset  \mathbb{P}^2$. A point on the tangent line is of the form $(t:1:0)$ and since $P \in C$ is a point of inflection, we get $F(t,1,0) = \text{const}\cdot t^3$, i.e. $F$ has no terms $X^2Y, XY^2$ or $Y^3$.
    \vspace{1mm}
     
    Hence $F = \langle Y^2Z, XYZ, YZ^2, X^3, X^2Z, XZ^2, Z^3 \rangle$. Notably, $Y^2Z$ has a nonzero coefficient, otherwise $P \in C$ would be singular, a contradition to $C$ being smooth. The coefficient of $X^3$ is nonzero as well, otherwise $Z \mid F$. We are free to rescale $X,Y,Z,F$, so WLOG $C$ is defined by \[
    Y^2Z + a_1 XYZ + a_3 YZ^2 = X^3 + a_2 X^2 Z + a_4 XZ^2 + a_6 Z^3.
    \]
    Substituting $Y \mapsto Y - \frac{1}{2}a_1 X - \frac{1}{2}a_3 Z$, we may assume $a_1 = a_3 = 0$. This gives \[
    C : Y^2Z = Z^3 f \left(\frac{X}{Z}\right)
    \]
    for a monic cubic polynomial $f$. Since $C$ is smooth, $f$ has distinct roots, WLOG $0,1,\lambda$, so $C: Y^2Z = X(X-Z)(X-\lambda Z)$.
\end{proof}
The form $Y^2Z + a_1 XYZ + a_3 YZ^2 = X^3 + a_2 X^2 Z + a_4 XZ^2 + a_6 Z^3$ is the Weierstrass form. The form $ Y^2Z = X(X-Z)(X-\lambda Z)$ is the Legendre form.

\textbf{Remark.} It can be shown that the points of inflection of a plane curve $C = \{F(X_1,X_2,X_3) = 0\} \subset \mathbb{P}^2$ are given by solving the Hessian:
\[
\begin{cases}
    &\det H = \det\left(\frac{\partial^2 F}{\partial X_i \partial X_j} \right) = 0\\
    &F(X_1,X_2,X_3) = 0.
\end{cases}
\]
\subsection{The degree of a morphism}
Let $\phi : C_1 \to C_2$ be a nonconstant morphism of smooth projective curves. Then $\phi^* : K(C_2) \to K(C_1)$ by $f \mapsto f \circ \phi$, giving an injective map $\phi^* K(C_2)$ to $K(C_1)$.

\begin{defn}
    The \textbf{degree} of $\phi$ is $\text{deg }\phi = [K(C_1) : \phi^* K(C_2)]$.
    \vspace{1mm}
     
    We say $\phi$ is \textbf{separable} if $K(C_1)/\phi^* K(C_2)$ is a separable field extension.
\end{defn}

Suppose $P \in C_1, Q \in C_2$ and $\phi : P \mapsto Q$. Let $t \in K(C_2)$ be a uniformizer at $Q$.
\begin{defn}
    $e_{\phi}(P) = \text{ord}_P(\phi^* t)$, which is always $\ge 1$ and independent of $t$.
\end{defn}
\begin{theorem}\label{theorem2.3}
    Let $\phi : C_1 \to C_2$ be a nonconstant morphism of smooth projective curves. Then \[
    \sum_{P \in \phi^{-1}(Q)}^{} e_{\phi}(P) = \deg \phi ~\forall  Q \in C_2.
    \]
    Moreover, if $\phi$ is separable, then $e_{\phi}(P)=1$ for all but infitely many $P \in C_1$.
\end{theorem}
We don't prove this.
\vspace{1mm}
 
In particular, this shows that:
\begin{itemize}
    \item $\phi$ is surjective (very important here that we're in $\overline{K}$).
    \item $|\phi^{-1}(Q)|\le \deg \phi$.
    \item If $\phi$ is separable, then equality holds in (ii) for all but finitely many points $Q \in C_2$.
\end{itemize}
\textbf{Important remark.} Let $C$ be an algebraic curve. A rational map is given by 
\begin{align*}
    C &\to \mathbb{P}^n \\
    \phi &\mapsto (f_0,f_1,\ldots,f_n)
\end{align*}
where $f_0,\ldots,f_n \in K(C)$ are not all zero. Then we have a fact: If $C$ is smooth, then $\phi$ is a morphism. This saves us a lot of time (we can go from a rational map to a morphism immediately).

\section{Weierstrass equations}

We now drop the assumption that $\overline{K} = K$, but we will still assume that $K$ is perfect.

\begin{defn}
    An \textbf{elliptic curve} $E/K$ is a smooth projective curve of genus 1 defined over $K$ with a specified $K$--rational point $O = 0_E$.
\end{defn}
\begin{example}
    $\{X^3 + pY^3 + p^2Z^3 = 0\} \subset \mathbb{P}^2$ is not an elliptic curve over $\mathbb{Q}$, since it has no $\mathbb{Q}$--rational point.
\end{example}
\begin{theorem}
    Every elliptic curve $E$ is isomorphic over $K$ to a curve in Weierstrass form via an isomorphism taking $0_E$ to $(0:1:0)$.
\end{theorem}
\textbf{Remark.} Proposition \ref{prop2.2} treated the special case where $E$ is a smooth plane cubic and $0_E$ is a point of inflection.
\vspace{1mm}
 
\textbf{Fact.} If $D \in \text{Div}(E)$ is defined over $K$, then $\mathcal{L}(D)$ has a basis in $K(E)$ (not just in $\overline{K}(E)$). Here $D$ is defined over $K$ if it is fixed by $\text{Gal}(\overline{K}/K)$ (this is unimportant for us and we just write it down to be rigorous).

\begin{proof}
    $\mathcal{L}(2\cdot 0_E) \subset \mathcal{L}(3\cdot 0_E)$. Pick bases $1,x$ and $1,x,y$. Note $\text{ord}_{0_E}(x) = -2$ and $\text{ord}_{0_E}(y) = -3$ (else $x,y$ don't give a basis). The 7 elements $1,x,y,x^2,xy,x^3,y^2$ lie in the 6--dimensional vector space $\mathcal{L}(60_E)$ (as they have at most a sixth order pole), so they must satisfy a linear dependence relation. 

    \vspace{1mm}
     
    Leaving out $x^3$ or $y^2$ leaves us with 6 elements, all with different order poles, giving a basis for $\mathcal{L}(60_E)$. Hence the coefficients of $x^3$ and $y^2$ are nonzero, so by rescaling $x,y$ (if necessary) we get \[
    E': y^2 + a_1xy + a_2y = x^3 + a_2 x^2 + a_4 x + a_6
    \]
    for some $a_i \in K$. Let $E'$ be the curve defined by this equation (or rather its projective closure). There is a morphism $\phi: E \to E' \subset \mathbb{P}^2$ by $P \mapsto (x(P):y(P):1) = \left(\frac{x}{y}(P): 1: \frac{1}{y}(P)\right)$. (Since $E$ is smooth, we know that this rational map is a morphism). Hence $0_E \mapsto (0:1:0)$.
    \vspace{1mm}
     
    We have $E \stackrel{x}{\to} \mathbb{P}^1$ by $x \mapsto (x:1)$ (and similarly for $y$), so 
    \begin{align*}
        &[K(E):K(x)] = \deg(E \stackrel{x}{\to} \mathbb{P}^1) = \text{ord}_{0_E}\left(\frac{1}{x}\right) = 2\\
        &[K(E):K(y)] = \deg(E \stackrel{y}{\to} \mathbb{P}^1) = \text{ord}_{0_E}\left(\frac{1}{y}\right) = 3.
    \end{align*}
    This gives an inclusion of fields $K(x) \le K(E)$ of degree 2, $K(y) \le K(E)$ of degree 3, while $K(x), K(y) \le K(x,y) \le  K(E)$, so tower law gives $[K(E):K(x,y)] = 1 \implies K(E)=K(x,y)=\phi^* K(E') \implies \deg \phi = 1$. (draw a picture!). This gives us an inverse that is a rational map, which we want to show is a morphism. For this, we just need to show that $E'$ is smooth.
    \vspace{1mm}
     
    If $E'$ were singular, then $E$ and $E'$ are rational, a contradiction. So $E'$ is smooth and hence $\phi^{-1}$ is a morphism, so $\phi$ is an isomorphism.
\end{proof}
\begin{prop}\label{prop3.2}
    Let $E,E'$ be elliptic curves over $K$ in Weierstrass form. Then $E \cong E'$ over $K \iff$ the equations are related by a change of variables 
    \begin{align*}
    x &= u^2x' + r \\
    y &= u^3y' + u^2sx' + t
    \end{align*}
    for $r,s,t,u \in K$ with $u \neq 0$. 
\end{prop}
\begin{proof}
    $\mathcal{L}(2\cdot 0_E) = \langle 1, x \rangle = \langle 1, x' \rangle \implies x = \lambda x' + r$ for some ${\lambda, r \in K, \lambda \neq 0}$. Similarly $\mathcal{L}(3\cdot 0_E) = \langle 1,x,y \rangle = \langle 1,x',y' \rangle \implies y = \mu y' + \sigma x' + t$ for some $\mu, \sigma, t \in K, \mu \neq 0$. 
    \vspace{1mm}
     
    Looking at the coefficients of $x^3$ and $y^2$ tells us that $\lambda^3 = \mu^2$, so $\lambda = u^2, \mu = u^3$ for some $u \in K^\times$. Put $s = \frac{\sigma}{u^2}$ to conclude.
\end{proof}

A Weierstrass equation defines an elliptic curve $\iff$ it defines a smooth curve $\iff \Delta(a_1,\ldots,a_6) \neq 0$, where $\Delta \in \mathbb{Z}[a_1,\ldots,a_6]$ is a certain polynomial.

\vspace{1mm}
 
If $\text{char }K \neq 2,3$, we may reduce to the case $E: y^2 = x^3 + ax + b$. In this case, the discriminant is $\Delta = -16(4a^3 + 27b^2)$.
\begin{cor}
    Assume $\text{char }K \neq 2,3$. Elliptic curves 
    \begin{align*}
        &E : y^2 = x^3 + ax + b \\
        &E' : y^2 = x^3 + a'x + b'
    \end{align*}
    are isomorphic over $K \iff \begin{cases}
        a' = u^4 a \\
        b' = u^6 b
    \end{cases}$ for some $u \in K^\times$.
\end{cor}
\begin{proof}
    $E, E'$ are related by a substitution as in Proposition \ref{prop3.2} with $r=s=t=0$.
\end{proof}
\begin{defn}
    The \textbf{$j$--invariant} is $j(E) = \frac{1728(4a^3)}{4a^3+27b^2}$.
\end{defn}
\begin{cor}
    $E \cong E' \implies j(E) \cong j(E')$ and the converse holds if $K = \overline{K}$.
\end{cor}
\begin{proof}
    $E \cong E' \iff \begin{cases}
        a' &= u^4 a \\
        b' &= u^6 b
    \end{cases}$ for some $u \in K^\times \implies (a^3:b^2) = ((a')^3:(b')^2) \iff j(E) = j(E')$. The middle step is reversible if $K=\overline{K}$.
\end{proof}
\section{The Group Law}
Let $E \subset \mathbb{P}^2$ be a smooth plane cubic with $0_E \in E(K)$ (not immediately assumed to be in Weierstrass form). $E$ meets any line in 3 points, counted with multiplicity.
\vspace{1mm}
 
For $P,Q \in E$, let $S$ be the $3^{\text{rd}}$ point of intersction of $PQ$ with $E$ and then let $R$ be the $3^{\text{rd}}$ intersection of $0_ES$ with $E$. We define $P \oplus Q = R$. (Later we drop the circle and just write $+$). If $P=Q$, instead take the tangent line at $P$, i.e. $T_PE$, etc. This is the ''chord and tangent process''.
\begin{theorem}
    $(E, \oplus)$ is an abelian group.
\end{theorem}
\textbf{Remark.} Here $E$ means $E(\overline{K})$ since we haven't specified a field yet.
\begin{proof}
    \begin{enumerate}[(i)]
        \item $\oplus$ is commutative trivially.
        \item $0_E$ is the identity, since the line through $0_EP$ meets $S$ for the $3^{\text{rd}}$ time at $S$ and then $SP$ meets $E$ for the $3^{\text{rd}}$ time at $0_E$ (drawing a picture makes this obvious).
        \item Inverses: Let $S$ be the $3^{\text{rd}}$ intersection of $T_{0_E}$ with $E$ and $Q$ the $3^{\text{rd}}$ intersection of $PS$ with $E$. Then $P \oplus Q = 0_E$.
        \item Associativity is much harder. We have some setup:
    \end{enumerate}
    \begin{defn}
        $D_1,D_2 \in \text{Div}(E)$ are \textbf{linearly equivalent} if $\exists f \in K(E)^\times$ such that $\text{div}(f) = D_1 - D_2$. Write $D_1 \sim D_2$ and $[D] = \{D' \mid D' \sim D\}$.
    \end{defn}
    \begin{defn}
        The \textbf{Picard group} is $\text{Pic}(E) = \text{Div}(E)/\sim$. Also define $\text{Pic}^0(E) = \text{Div}^0(E)/\sim$ where $\text{Div}^0(E) = \{D \in \text{Div}(E) \mid \text{deg}(D) = 0\}$.
    \end{defn}
    We define $\psi: E \to \text{Pic}^0(E)$ by $P \mapsto [(P)-(0_E)]$.
    \begin{prop}
        \begin{enumerate}[(i)]
            \item $\psi(P \oplus Q) = \psi(P) + \psi(Q)$.
            \item $\psi$ is a bijection.
        \end{enumerate}
    \end{prop}
    \begin{proof}
        \begin{enumerate}[(i)]
            \item WLOG let the lines $PQ$ and $0_ES$ be given by $l=0$ and $m=0$. Then \[
            \text{div}\left(\frac{l}{m}\right) = (P)+(S)+(Q)-(0_E)-(S)-(R),
            \]
            hence $(P)+(Q) \sim (P \oplus Q) + (0_E)$, so $(P\oplus Q)- (0_E) \sim (P)-(0_E) + (Q) - (0_E)$, so $\psi(P \oplus Q) = \psi(P) + \psi(Q)$.
            \item Injectivity: Suppose $\psi(P) = \psi(Q)$ for $P \neq Q$. Then $\exists f \in \overline{K}(E)^\times$ such that $\text{div}(f) = (P)-(0_E)-(Q)+(0_E) = (P) - (Q) \implies E \stackrel{f}{\to} \mathbb{P}^1$ has degree $1$ (for example since evaluation at 0 on the affine line gives that $P$ has one root and $Q$ has one pole), so $E \cong \mathbb{P}^1$, a contradiction.
            \vspace{1mm}
             
            Surjectivity: Let $[D] \in \text{Pic}^0(E)$. Then $D + (0_E)$ has degree 1, so by Riemann--Roch, $\text{dim}\mathcal{L}(D+(0_E)) = 1$, so $\exists 0\neq f \in \overline{K}(E)$ such that $\text{div}(f) + D + (0_E) \ge 0$, but $\text{div}(f) + D + (0_E)$ has degree 1, so $\text{div}(f) + D + (0_E) = (P)$ for some $P \in E \implies (P) - (0_E) \sim D \implies  \psi(P) = [D]$. 
        \end{enumerate}
    \end{proof}
    We conclude that $\psi$ identifies $(E,\oplus)$ with $(\text{Pic}^0(E), +)$, so $\oplus$ is associative.
\end{proof}
\marginpar{29 Jan 2024, Lecture 5}

\textbf{Formulae for $E$ in Weierstrass form.}
Let $E : y^2 + a_1xy + a_3 y  = x^3 +a_2x^2 + a_4 x + a_6$. Choose two points $P_1 = (x_1, y_1)$ and $P_2 = (x_2, y_2)$ on it. Let the line through $P_1$ and $P_2$ be given by $y = \lambda x + \nu$ and let it meet $E$ again at $P' = (x', y')$. We want to find $P_1 \oplus P_2 = P_3 = (x_3, y_3) = \ominus P'$ for $\ominus P$ the reflection of $P$ across the $x$--axis. We easily compute $\ominus P_1 = (x_1, -(a_1x +a_3)-y_1)$. 
\vspace{1mm}
 
Substituting $y = \lambda x + \nu$ into our equation for $E$ and looking at the coefficient of $x^2$ gives $\lambda^2 + a_1 \lambda - a_2 = x_1 + x_2 + x' = x_1 + x_2 + x_3$, so $x_3 = \lambda^2 +a_1 \lambda - a_2 - x_1 - x_2$. For $y_3$ we find $$y_3 = -(a_1x' + a_3) - y' = -(a_1x_3+a_3) - (\lambda x_3  + \nu) = - (\lambda+a_1)x_3 - a_3 - \nu.$$
It remains to find formulas for $\lambda$ and $\nu$.
\begin{itemize}
    \item Case 1. $x_1 = x_2$, but $P_1 \neq P_2$. Then $P_1 \oplus P_2 = 0_E$.
    \item Case 2. $x_1 \neq x_2$. Then $\lambda = \frac{y_2-y_1}{x_2-x_1}$ and $\nu = y_1 - \lambda x_1 = \frac{x_2y_1-x_1y_2}{x_2-x_1}$.
    \item Case 3. $P_1 = P_2$. In this case, compute the equation for the tangent line to get $\lambda, \nu$ as rational expressions in $x_1,x_2,y_1,y_2$.
\end{itemize}
\begin{cor}
    $E(K)$ is an abelian group.
\end{cor}
\begin{proof}
    $E(K)$ is a subgroup of $(E, \oplus)$.
    \begin{itemize}
        \item It has identity $0_E$ by definition.
        \item We have closure and inverses through the formulae above.
        \item Associativity and commutativity is inherited.
    \end{itemize}
\end{proof}
\begin{theorem}\label{theorem4.4}
    Elliptic curves are group varieties, i.e. 
    \begin{align*}
        [-1]&:E \to E, P \mapsto \ominus P\\
        \oplus&: E \to E, (P,Q) \mapsto P \oplus Q
    \end{align*}
    are morphisms of algebraic varieties.
\end{theorem}
\begin{proof}
    By the above formulae, $[-1]:E \to E$ is a rational map, i.e. a morphism by our important remark.
    \vspace{1mm}
     
    For $\oplus$, note by the above formulae that $\oplus : E \to E$ is a rational map regular on 
    \begin{align*}
        U = \{(P,Q) \in E \times E \mid 0_E \not\in \{P,Q, P \oplus Q, P \ominus Q  \}\}.
    \end{align*}
    For $P \in E$, let $\tau_P : E \to E$ be the ''translation by $P$'' map, given by $X \mapsto P \oplus X$. $\tau_P$ is a rational map, hence a morphism. Now for $A, B \in E$, we factor $\oplus$ as 
    \begin{align*}
        E \times E \stackrel{\tau_{\ominus A} \times \tau_{\ominus B}}{\to} E \times E \stackrel{\oplus}{\to} E \stackrel{\tau_{A\oplus B}}{\to} E.  
    \end{align*}
    This shows $\oplus$ is regular on $(\tau_{A} \times \tau_B)(U)$, so $\oplus$ is regular on $E \times E$.
\end{proof}
\textbf{Statement of results.}
The following isomorphisms in (i), (ii), (iv) respect the relevant topologies.
\begin{enumerate}[(i)]
    \item $K=\mathbb{C}$. Then $E(\mathbb{C}) \cong \mathbb{C}/\Lambda \cong \mathbb{R}/\mathbb{Z} \times \mathbb{R}/\mathbb{Z}$ for $\Lambda$ a lattice.
    \item $K=\mathbb{R}$. Then \[
    E(\mathbb{R}) = \begin{cases}
        \mathbb{Z}/2\mathbb{Z} \times \mathbb{R}/\mathbb{Z}& \text{ if }\Delta>0\\
        \mathbb{R}/\mathbb{Z} &\text{ if }\Delta<0.
    \end{cases}
    \] 
    \item $K = \mathbb{F}_q$. Then $\left| \left|E(\mathbb{F}_q)\right| - (q+1)\right| \le 2\sqrt{q}$. This is Hasse's Theorem.
    \item For a local field $[K:\mathbb{Q}_p] <\infty$ with ring of integers $\mathcal{O}_K$, $E(K)$ has a subgroup of finite index isomorphic to $(\mathcal{O}_K,+)$.
    \item For a number field $[K:\mathbb{Q}]<\infty$, $E(K)$ is a finitely generated abelian group (this is the Mordell--Weil Theorem).
    Basic group theory says that if $A$ is a finitely generated abelian group, then $A \cong (\text{finite subgroup})\times \mathbb{Z}^r$. Here $r$ is called the rank of $A$. The proof of Mordell--Weil gives an upper bound for $\text{rank }E(K)$, but there is no known algorithm to compute the rank in all cases.
\end{enumerate}
\textbf{Brief remarks on the case $K=\mathbb{C}$.} Let $\Lambda = \{a \omega_1 + b \omega_2 \mid a,b \in \mathbb{Z}\}$ where $\omega_1,\omega_2$ are a basis for $\mathbb{C}$ as an $\mathbb{R}$--vector space. Then meromorphic functions on the Riemann surface $\mathbb{C}/\Lambda$ correspond bijectively with $\Lambda$--invariant meromorphic functions in $\mathbb{C}$. The function field of $\mathbb{C}/\Lambda$ is generated by $\wp(z)$ and $\wp'(z)$, where 
\begin{align*}
    &\wp(z) = \frac{1}{z^2}+\sum_{\lambda \in \Lambda \setminus \{0\}}^{} \left(\frac{1}{(z-\lambda)^2} - \frac{1}{\lambda^2}\right)\\
    &\wp'(z) = -2\sum_{\lambda \in \Lambda}^{} \frac{1}{(z-\lambda)^3}.
\end{align*}
These satisfy $\wp'(z)^2 = 4\wp(z)^3 - g_2\wp(z) - g_3$ for some constants $g_2,g_3 \in \mathbb{C}$ depending on $\Lambda$. One shows $\mathbb{C}/\Lambda \cong E(\mathbb{C})$, where $E: y^2 = 4x^3 - g_2x -g_3$ which is an isomorphism on both groups (via $z \mapsto (\wp(z),\wp'(z))$) and on Riemann surfaces. We have the following result:
\begin{theorem}[Uniformization theorem]
    Every elliptic curve over $\mathbb{C}$ arises in this way.
\end{theorem}
\begin{defn}
    For $n \in \mathbb{Z}$, let $[n]: E \to E$ be given by $P \mapsto \underbrace{P\oplus P \oplus \ldots \oplus P}_{n\text{ copies}}$ if $n>0$ and $[-n] = [-1] \circ [n]$.
\end{defn}
\begin{defn}
    The \textbf{$n$--torsion subgroup} of $E$ is \[
    E[n] = \text{ker}(E \stackrel{[n]}{\longrightarrow} E).
    \]
\end{defn}
If $K=\mathbb{C}$, then $E(\mathbb{C}) \cong \mathbb{C}/\Lambda$, so $E[n] \cong (\mathbb{Z}/n\mathbb{Z})^2$ and $\text{deg}[n] = n^2$. Call these results (1) and (2). We will show that (2) holds over any field $K$ and (1) holds if $\text{char }K \nmid n$.
\marginpar{31 Jan 2024, Lecture 6}
\begin{lemma}\label{lemma4.6}
    Assume $\text{char }K \neq 2$ and $E: y^2=f(x)=(x-e_1)(x-e_2)(x-e_3)$ (with $e_i \in \overline{K}$). Then $E[2] = \{0, (e_1,0), (e_2,0), (e_3,0)\} \cong (\mathbb{Z}/2\mathbb{Z})^\times$.
\end{lemma}
\begin{proof}
    Let $P = (x,y) \in E$. Then $2[P] = 0 \iff P = -P \iff (x,y) = (x,-y) \iff y=0$.
\end{proof}
\section{Isogenies}
Let $E_1,E_2$ be elliptic curves.
\begin{defn}
    \begin{enumerate}[(i)]
        \item An \textbf{isogeny} $\phi : E_1 \to E_2$ is a nonconstant morphism with $\phi(0_{E_1}) = 0_{E_2}$.
        \item We say $E_1$ and $E_2$ are \textbf{isogenous} if there is an isogeny between them.
    \end{enumerate}
\end{defn}
In (i), nonconstant is equivalent to surjective on $\overline{K}$--points. See Theorem \ref{theorem2.3}.
\begin{defn}
    $\text{Hom}(E_1,E_2) = \{\text{isogenies }E_1 \to E_2\} \cup \{0\}$ (the constant map at $0_E$). This is an abelian group under $(\phi + \psi)(P) := \phi(P) \oplus \psi(P)$.
\end{defn}
If $E_1 \stackrel{\phi}{\to} E_2 \stackrel{\psi}{\to} E_3$ are isogenies, then $\psi \circ \phi$ is an isogeny. By tower law, $\text{deg}(\psi \circ \phi) = \text{deg}(\psi)\text{deg}(\phi)$.
\begin{prop}
    If $0 \neq n \in \mathbb{Z}$, then $[n] : E \to E$ is an isogeny.
\end{prop}
\begin{proof}
    $[n]$ is a morphism by Theorem \ref{theorem4.4}. We need to show $[n] \neq [0]$. Assume $\text{char }K \neq 2$.
    \begin{itemize}
        \item Case $n=2$. Lemma \ref{lemma4.6} implies that $E[2] \neq E$, so $[2] \neq 0$.
        \item Case $n$ odd. Lemma \ref{lemma4.6} implies that $\exists 0 \neq T \in E[2]$. Then $nT = T \neq 0$, so $[n] \neq [0]$.
    \end{itemize}
    Now use $[mn] = [m]\circ[n]$ to conclude.
    \vspace{1mm}
     
    If $\text{char }K=2$, then we can replace Lemma \ref{lemma4.6} with an explicit lemma about 3--torsion points.
\end{proof}
\begin{cor}
    $\text{Hom}(E_1,E_2)$ is a torsion--free $\mathbb{Z}$--module.
\end{cor}
\begin{theorem}\label{theorem5.3}
    Let $\phi : E_1 \to E_2$ be an isogeny. Then \[
    \phi(P+Q) = \phi(P)+\phi(Q) ~\forall P,Q \in E.
    \]
\end{theorem}
\begin{proof}[Sketch proof.]
    $\phi$ induces a map $\phi_* : \text{Div}^0(E_1) \to \text{Div}^0(E_2)$ by $\sum_{P \in E_1}^{} n_P P \mapsto \sum_{p \in E_1}^{} n_P \phi(P)$. Recall $\phi^* : K(E_2) \hookrightarrow K(E_1)$.
    \vspace{1mm}
     
    \textbf{Fact.} If $f \in K(E_1)$, then $\text{div}(N_{K(E_1)/K(E_2)}f) = \phi^*(\text{div }f)$. So $\phi_*$ sends principal divisors to principal divisors. Since $\phi(0_{E_1}) = 0_{E_2}$, the following diagram commutes: $$\begin{tikzcd}[]
        E_1 & E_2\\
        \text{Pic}^0(E_1) & \text{Pic}^0(E_2)
        \arrow["\phi", from=1-1, to=1-2]
        \arrow["g", from=1-2, to=2-2]
        \arrow["f", from=1-1, to=2-1]
        \arrow["\phi_*", from=2-1, to=2-2]
    \end{tikzcd}$$ (with $f(P) = [(P)-(0_{E_1})], g(Q) = [(Q)-(0_{E_2})]$). Since $\phi_*$ is a group homomorphism, $\phi$ is a group homomorphism.
\end{proof}
\begin{lemma}\label{lemma5.4}
    Let $\phi : E_1 \to E_2$ be an isogeny. Then there exists a morphism $\xi$ making the following diagram commute:
    $$\begin{tikzcd}[]
        E_1 & E_2\\
        \mathbb{P}^1 & \mathbb{P}^1
        \arrow["\phi", from=1-1, to=1-2]
        \arrow["x_2", from=1-2, to=2-2]
        \arrow["x_1 ", from=1-1, to=2-1]
        \arrow["\xi", from=2-1, to=2-2]
    \end{tikzcd}$$
    with $x_i$ the $x$--coordinate in a Weierstrass equation for $E_i$. Moreover, if $\xi(t)=\frac{r(t)}{s(t)}$ with $r,s \in K[t]$ coprime, then $\text{deg}(\phi) = \text{deg}(\xi) = \max(\text{deg}(r),\text{deg}(s))$.
\end{lemma}
\begin{proof}
    For $i=1,2$, $K(E_i)/K(x_i)$ is a degree 2 Galois extension with Galois group generated by $[-1]^*$. By Theorem \ref{theorem5.3}, $\phi \circ [-1] = [-1] \circ \phi$, so if $f \in K(x_2)$, then $[-1]^*(\phi^*f) = \phi^*([-1]^* f) = \phi^* f$ and hence $\phi^* f \in K(x_1)$. Hence we find
    $$\begin{tikzcd}[]
         & K(E_1) = K(x_1,y_1)\\
        K(x_1) & K(E_2) = K(x_2,y_2)\\
        K(x_2) &
        \arrow["2", from=2-1, to=1-2, dash]
        \arrow["2", from=3-1, to=2-2, dash]
        \arrow["", from=2-1, to=3-1, dash]
        \arrow["", from=1-2, to=2-2, dash]
    \end{tikzcd}.$$
    In particular, $\phi^*x_2 = \xi(x_1)$ for some $\xi \in K(t)$. By tower law, $2 \text{deg}(\phi) = 2 \text{deg}(\xi) \implies \text{deg}(\phi) = \text{deg}(\xi)$. Now $K(x_2) \hookrightarrow K(x_1)$ by $x_2 \mapsto \xi(x_1) = \frac{r(x_1)}{s(x_1)}$ for $r,s \in K[t]$ coprime. Then minimal polynomial of $x_1$ over $K(x_2)$ is $F(t) =r(t) -s(t)x_2 \in K(x_2)[t]$. This is true as $F(x_1)=0$, $F$ is irreducible on $K[x_2,t]$ (since $r,s$ are coprime) and by Gauss' Lemma, $F$ is irreducible on $K(x_2)[t]$. Hence $\text{deg}(\phi) = \text{deg}(\xi) = [K(x_1):K(x_2)] = \text{deg}(F) = \max(\text{deg}(r),\text{deg}(s))$.
\end{proof}
\begin{lemma}
    $\text{deg}[2] = 4$.
\end{lemma}
\begin{proof}
    Assume $\text{char }K \neq 2,3$, so $E : y^2 = x^3+ax+b = f(x)$. If $P = (x,y)$, then $x(2P) = \left(\frac{3x^2+a}{2y}\right)^2-2x = \frac{(3x^2+a)^2-2xf(x)}{4f(x)}$. The numerator and denominator are coprime, since otherwise $\exists \theta \in \overline{K}$ with $f(\theta) = f'(\theta) = 0$, meaning $f$ has a multiple root, contradiction. We are now done by Lemma \ref{lemma5.4}, since $\text{deg}[2] = \max(3,4) = 4$.
\end{proof}
\begin{defn}
    Let $A$ be an abelian group. Then a map $q : A \to \mathbb{Z}$ is a quadratic form if
    \begin{enumerate}[(i)]
        \item $q(nx) = n^2q(x)~\forall n \in \mathbb{Z}, q \in A$.
        \item $(x,y) \mapsto q(x+y)-q(x)-q(y)$ is $\mathbb{Z}$--bilinear.
    \end{enumerate}
\end{defn}
\begin{lemma}
    $q : A \to \mathbb{Z}$ is a quadratic form if and only if it satisfies the parallelogram law $q(x+y)+q(x-y) = 2q(x)+2q(y) ~\forall x,y \in A$.
\end{lemma}
\begin{proof}
    $(\implies)$. Let $\langle x,y \rangle = q(x+y)-q(x)-q(y)$. Then $\langle x,x \rangle = q(2x) - 2q(x) = 2q(x)$ by (i) with $n=2$. By (ii), $\langle x+y, x+y \rangle + \langle x-y, x-y \rangle = 2 \langle x,x \rangle + 2 \langle y, y \rangle$, which implies $q(x+y)+q(x-y)=2q(x)+2q(y)$.
    \vspace{1mm}
     
    $(\impliedby)$. This is on Ex. Sheet 2.
\end{proof}
\marginpar{02 Jan 2024, Lecture 7}
\begin{theorem}\label{theorem5.7}
    $\text{deg}:\text{Hom}(E_1,E_2) \to \mathbb{Z}$ is a quadratic form (with $\text{deg}(0)=0$).
\end{theorem}
\begin{proof}
    Assume $\text{char }K \neq 2,3$ and write $E_2 = y^2=x^3+ax+b$. Let $P, Q \in E_2$ with $P,Q,P+Q,P-Q$ all nonzero and let $x_1,x_2,x_3,x_4$ be the $x$--coordinates of these points.
    \begin{lemma}\label{lemma5.8}
        There exist polynomials $W_0,W_1,W_2 \in \mathbb{Z}[a,b][x_1,x_2]$ of degree $\le 2$ in $x_1$ and of degree $\le 2$ in $x_2$ such that 
        \begin{align*}
            (1:x_3+x_4:x_3x_4) = (W_0:W_1:W_2)
        \end{align*}
    \end{lemma}
    \begin{proof}
        Method 1: Direct calculation (results on the formula sheet) gives the result (e.g. $W_0 = (x_1-x_2)^2$).
        \vspace{1mm}
         
        Method 2: Let $y = \lambda x + \nu$ be the line through $P$ and $Q$. Substituting, we get $x^3+ax+b -(\lambda x + \nu)^2 = (x-x_1)(x-x_2)(x-x_3) = x^3 - s_1x^2 + s_2 x - s_3$ where $s_i$ is the $i^{\text{th}}$ symmetric polynomial in $x_1,x_2,x_3$. Comparing coefficients gives $\lambda^2 = s_1,  -2\lambda \nu = s_2-a, \nu^2 = s_3+b$. Eliminating $\lambda$ and $\nu$ gives $$F(x_1,x_2,x_3) =(s_2-a)^2 - 4s_1(s_3+b) = 0,$$
        where $F$ has degree at most $2$ in each $x_i$. Hence $x_3$ is a root of the quadratic $W(t) = F(x_1,x_2,t)$. Repeating this for the line through $P$ and $-Q$ shows that $x_4$ is the other root of $W(t)$. Therefore 
        \begin{align*}
            W(t) &= W_0(t-x_3)(t-x_4) = W_0t^2 - W_1t + W_2\\
            \implies & (1:x_3+x_4:x_3x_4) = (W_0:W_1:W_2).
        \end{align*}
    \end{proof}
    We now show that if $\phi, \psi \in \text{Hom}(E_1,E_2)$, then $\text{deg}(\phi + \psi) + \text{deg}(\phi - \psi) \le 2\text{deg}(\phi) + 2\text{deg}(\psi)$. We may assume that $\phi, \psi, \phi+\psi, \phi-\psi$ are not the zero maps (otherwise we're done trivially, or use $\text{deg}[-1]=1,~\text{deg}[2]=4$). Now
    \begin{align*}
        \phi: (x,y) \mapsto (\xi_1(x), \ldots)\\
        \psi: (x,y) \mapsto (\xi_2(x), \ldots)\\
        \phi+\psi: (x,y) \mapsto (\xi_3(x), \ldots)\\
        \phi-\psi: (x,y) \mapsto (\xi_4(x), \ldots).
    \end{align*}
    Lemma \ref{lemma5.8} implies $(1:\xi_3+\xi_4: \xi_3\xi_4) = ((\xi_1-\xi_2)^2: \ldots)$. Say $\xi_i = \frac{r_i}{s_i}$ for $r_i,s_i \in K[t]$ coprime. This gives $$(s_3s_4:r_3s_4+r_4s_3:r_3r_4) \stackrel{(\star)}{=} ((r_1s_2-r_2s_1)^2 : \ldots)$$
    where every term is quadratic in $r_3,r_4,s_3$ and $s_4$. Hence (as the terms on the LHS of $(\star)$ are coprime)
    \begin{align*}
        \text{deg}(\phi+\psi) + \text{deg}(\phi-\psi) &= \max(\text{deg}(r_3),\text{deg}(s_3)) + \max(\text{deg}(r_4),\text{deg}(s_4)) \\
        &= \max(\text{deg}(s_3s_4),\text{deg}(r_3s_4+r_4s_3), \text{deg}(r_3r_4))\\
        &\le 2\max(\text{deg}(r_1),\text{deg}(s_1)) + 2\max(\text{deg}(r_2),\text{deg}(s_2))\\
        &= 2\text{deg}(\phi)+2\text{deg}(\psi).
    \end{align*}
    Now replace $\phi$ and $\psi$ by $\phi+\psi$ and $\phi-\psi$ and use $\text{deg}[2]=4$ to get \[
    4\text{deg}(\phi) + 4\text{deg}(\psi) = \text{deg}(2\phi) + \text{deg}(2\psi) \le 2\text{deg}(\phi+\psi) + 2\text{deg}(\phi-\psi).
    \]
    This gives the parallelogram law, so $\text{deg}$ is a quadratic form.
\end{proof}
\begin{cor}\label{cor5.9}
    $\text{deg}(n \phi) = n^2 \text{deg}(\phi)$. In particular, $\text{deg}[n] = n^2$.
\end{cor}
\begin{example}
    Let $E/K$ be an elliptic curve. Suppose $\text{char }K\neq 2$ and $0\neq T \in E(K)[2]$. WLOG let $E: y^2 = x(x^2+ax+b)$ for $a,b \in K, b(a^2-4b)\neq 0$ (by moving a root to zero) and WLOG $T=(0,0)$. 
    \vspace{1mm}
     
    If $P = (x,y)$ and $P' = P+T = (x',y')$, then 
    \begin{align*}
        &x' = \left(\frac{y}{x}\right)^2-a-x = \frac{x^2+ax+b}{x}-a-x = \frac{b}{x}\\
        &y' = -\left(\frac{y}{x}\right)x' = -\frac{by}{x^2}.
    \end{align*}
    We let $\xi = x + x' + a = \left(\frac{y}{x}\right)^2, \eta = y + y' = \frac{y}{x}\left(x-\frac{b}{x}\right)$.
    Then 
    \begin{align*}
        \eta^2 = \left(\frac{y}{x}\right)^2\left(\left(x+\frac{b}{x}\right)^2-4b \right) = \xi((\xi-a)^2-4b) = \xi(\xi^2-2a\xi + a^2-4b).
    \end{align*}
    Let $E' : y^2 = x(x^2+a'x+b')$ with $a'=-2a, b' = a^2-4b$. There is an isogeny $\phi : E \to E'$ given by $(x,y) \mapsto \left(\left(\frac{y}{x}\right)^2 : \frac{y(x^2-b)}{x^2} : 1 \right)$.
    \vspace{1mm}
     
    Sanity check/finding where $0_E$ maps to: $x$ is a double pole, $y$ is a triple pole, so $\left(\frac{y}{x}\right)^2$ is a double pole and $\frac{y(x^2-b)}{x^2}$ is a triple pole (and the last coordinate $1$ has degree 0). Multiplying through by a cube of a uniformizer, the degrees go from $(-2,-3,0)$ to $(1,0,3)$, so $0_E \mapsto (0:1:0)$.
    \vspace{1mm}
     
    To compute $\text{deg}(\phi)$, $\left(\frac{y}{x}\right)^2 = \frac{x^2+ax+b}{x}$ with the numerator and denominator coprime as $b \neq 0$, so by Lemma \ref{lemma5.4}, $\text{deg}(\phi)=2$. We say $\phi$ is a \textbf{2--isogeny}.
\end{example}
\section{The invariant differential}
For $C$ some algebraic curve over $K=\overline{K}$.
\begin{defn}
    The space of differentials $\Omega_C$ (sometimes called one--forms) is the $K(C)$--vector space generated by $\mathrm{d}f$ for all $f \in K(C)$ subject to the relations
    \begin{enumerate}[(i)]
        \item $\mathrm{d}(f+g)=\mathrm{d}f+\mathrm{d}g$.
        \item $\mathrm{d}(fg)=f\mathrm{d}g+g\mathrm{d}f$.
        \item $\mathrm{d}a = 0~\forall a \in K$.
    \end{enumerate}
\end{defn}
\textbf{Fact.} $\Omega_C$ is a 1--dimensional $K(C)$--vector space. 
\marginpar{05 Feb 2024, Lecture 8}
\vspace{1mm}
 
Let $0\neq \omega \in \Omega_C$, let $P \in C$ be a smooth point and let $t \in K(C)$ be a uniformizer at $P$. Then $\omega = f \mathrm{d}t$ for some $f \in K(C)^\times$. We define $\text{ord}_P(\omega) = \text{ord}_P(f)$, which is independent of the choice of $t$.
\vspace{1mm}
 
\textbf{Fact.} Suppose $f \in K(C)^\times$ with $\text{ord}_P(f) = n \neq 0$. If $\text{char }K \nmid n$, then $\text{ord}_P(\mathrm{d}f)=n-1$. 
\vspace{1mm}
 
We assume that $C$ is a smooth projective curve.
\begin{defn}
    We define $\text{div}(\omega) = \sum_{P \in C}^{} \text{ord}_P(\omega)P \in \text{Div}(C)$. Here we use the fact that $\text{ord}_P(\omega) = 0$ for all but finitely many $P \in C$.
\end{defn}
\begin{defn}
    A differential $\omega \in \Omega_C$ is regular if $\text{div}(\omega)\ge 0$. We define the genus $g(C)$ of $C$ to be \[
    g(C) = \text{dim}_K \{\omega \in \Omega_C \mid \text{div}(\omega)\ge 0\},
    \]
    where the set on the RHS is the set of regular differentials.
\end{defn}
As a consequence of Riemann--Roch, we have that if $0 \neq \omega \in \Omega_C$, then $\text{deg}(\text{div}(\omega)) = 2g(C)-2$.
\begin{lemma}
    Assume $\text{char }K \neq 2$ and let $E : y^2 = (x-e_1)(x-e_2)(x-e_3)$ for $e_1,e_2,e_3$ distinct. Then $\omega = \frac{\mathrm{d}x}{y}$ is a differential on $E$ with no zeroes or poles, which implies $g(E)=1$. In particular, the $K$--vector space of regular differentials on $E$ is 1--dimensional, spanned by $\omega$.
\end{lemma}
\begin{proof}
    Let $T_i = (e_i,0)$. Then $E[2]=\{0,T_1,T_2,T_3\}$ and $\text{div}(y) \stackrel{(\dagger)}{=} (T_1)+(T_2)+(T_3)-3(0)$. For $0 \neq P \in E$, $\text{div}(x-x_P) = (P)+(-P)-2(0)$. 
    \begin{itemize}
        \item If $P \in E\setminus E[2]$, then $\text{ord}(x-x_P)=1 \implies \text{ord}_P(\mathrm{d}x) = 0$.
        \item If $P = T_i$, then $\text{ord}_P(x-x_P) = 2 \implies \text{ord}_P(\mathrm{d}x)=1$. 
        \item If $P=0$, then $\text{ord}_P(x)= - 2 \implies \text{ord}_P(\mathrm{d}x) = -3$.
    \end{itemize}
    Hence $\text{div}(\mathrm{d}x) = (T_1)+(T_2)+(T_3) - 3(0)$, which with $(\dagger)$ gives $\text{div}\left(\frac{\mathrm{d}x}{y}\right) = 0$.
\end{proof}
\begin{defn}
    For $\phi : C_1 \to C_2$ a nonconstant morphism, we define 
    \begin{align*}
        \phi^* : \Omega_{C_2} &\to \Omega_{C_1}\\
        f \mathrm{d}g &\mapsto \phi^* f d(\phi^* g).
    \end{align*}
\end{defn}
\begin{lemma}
    Let $P \in E$, $\tau_P : E \to E$ by $X \mapsto X+P$ and $\omega = \frac{\mathrm{d}x}{y}$ as above. Then $\tau_P^*\omega = \omega$. We say $\omega$ is the \textbf{invariant differential}.
\end{lemma}
\begin{proof}
    $\tau_P^*\omega$ is a regular differential on $E$, so $\tau_P^* \omega = \lambda_P \omega$ for some $\lambda_P \in K^\times$. The map $E \to \mathbb{P}^1$ by $P \mapsto \lambda_P$ is a morphism of smooth projectives curves, but it is not surjective (as it misses $0$ and $\infty$). Hence it is constant by Theorem \ref{theorem2.3}, i.e. $\exists \lambda \in K^\times$ such that $\tau_P^* \omega = \lambda \omega ~\forall P \in E$. Taking $P=0$ shows $\lambda=1$.
\end{proof}
\textbf{Remark.} If $K=\mathbb{C}$ and $\mathbb{C}/\Lambda \cong E(\mathbb{C})$ by $ z\mapsto (\wp(z),\wp'(z)) := (x,y)$, then $\frac{\mathrm{d}x}{y} = \frac{\wp'(z)\mathrm{d}z}{\wp'(z)}=\mathrm{d}z$, which is invariant under $z \mapsto z + \text{const}$.
\begin{lemma}\label{lemma6.3}
    Let $\phi,\psi \in \text{Hom}(E_1,E_2)$. Let $\omega$ be the invariant differential on $E_2$. Then $(\phi+\psi)^* \omega = \phi^* \omega + \psi^* \omega$.
\end{lemma}
\begin{proof}
    Write $E$ for $E_2$. We have the maps
    \begin{align*}
        E \times E &\to E \\
        \mu: (P,Q) &\mapsto P +Q\\
        \text{pr}_1 : (P,Q)&\mapsto P\\
        \text{pr}_2 : (P,Q)&\mapsto Q. 
    \end{align*}
    \textbf{Fact.} $\Omega_{E \times E}$ is a 2--dimensional $K(E \times E)$--vector space with basis $\text{pr}_1^*\omega$ and $\text{pr}_2^*\omega$. Consequently, $\mu^* \omega \stackrel{(\dagger)}{=} f \text{pr}_1^* \omega + g \text{pr}_2^* \omega$ for some $f,g \in K(E \times E)$.
    \vspace{1mm}
     
    For fixed $Q \in E$, let $i_Q : E \to E \times E$ by $P \mapsto (P,Q)$. Applying $i^*_Q$ to $(\dagger)$ gives 
    \begin{align*}
        (\underbrace{\mu \circ i_Q}_{\tau_Q})^* \omega &= (i_Q^* f)(\underbrace{\text{pr}_1 \circ i_Q}_{\text{identity map}})^* \omega + (i_Q^* g)(\underbrace{\text{pr}_2 \circ i_Q}_{\text{constant map}})^* \omega\\
        \implies & \tau_Q^* \omega = (i_Q^*f)\omega + 0.
    \end{align*}
    As $\tau_Q^*\omega = \omega$ by the previous lemma, we conclude $i_Q^*f = 1 ~\forall q \in E$, so $f(P,Q) = 1 ~\forall P,Q \in E$. Similarly $g(P,Q) = 1 ~\forall P,Q \in E$, so $(\dagger)$ gives $\mu^* \omega = \text{pr}_1^* \omega + \text{pr}_2^* \omega$. Now pull back using
    \begin{align*}
        E_1 &\to E \times E\\
        P &\mapsto (\phi(P),\psi(P))
    \end{align*}
    to get $(\phi+\psi)^*\omega = \phi^* \omega + \psi^* \omega$.
\end{proof}
\begin{lemma}\label{lemma6.4}
    Let $\phi : C_1 \to C_2$ be a nonconstant morphism. Then $\phi$ is separable if and only if $\phi^* : \Omega_{C_2} \to \Omega_{C_1}$ is nonzero.
\end{lemma}
\begin{proof}
    Omitted.
\end{proof}
\begin{example}
    Let $\mathbb{G}_m = \mathbb{A}^1 \setminus \{0\}$ be the multiplicative group. For $n\ge 2$ an integer, consider $\phi : \mathbb{G}_m \to \mathbb{G}_m$ by $x \mapsto x^n$. Then $\phi^*(\mathrm{d}x)=\mathrm{d}(x^n)=nx^{n-1}\mathrm{d}x$. So if $\text{char }K \nmid n$, then $\phi$ is separable, so $\left|\phi^{-1}(Q)\right|=\text{deg} \phi$ for all but at most finitely many $Q \in \mathbb{G}_m$.
    \vspace{1mm}
     
    But $\phi$ is a group homomorphism, so $\left|\phi^{-1}(Q)\right|=\left|\text{ker}(Q)\right| ~\forall Q \in \mathbb{G}_m$. Hence $\left|\text{ker}Q \right| = \text{deg}\phi = n$. This shows that $K = \overline{K}$ contains exactly $n$ distinct $n^{\text{th}}$ roots of unity.
\end{example}
\marginpar{07 Feb 2024, Lecture 9}
\begin{theorem}\label{theorem6.5}
    If $\text{char }K \nmid n$, then $E[n] = (\mathbb{Z}/n\mathbb{Z})^2$.
\end{theorem}
\begin{proof}
    Lemma \ref{lemma6.3} and induction imply $[n]^* \omega = n \omega$ where $\text{char }K \nmid n$, so $[n]$ is separable by Lemma \ref{lemma6.4}. Hence $\left|[n]^{-1}(Q)\right| = \text{deg}[n]$ for all but finitely many points $Q \in E$. But $[n]$ is a group homomorphism, so $\left|[n]^{-1} Q\right| = \left|E[n]\right| ~\forall Q \in E$. We conclude that $\left|E[n]\right|=\text{deg}[n] = n^2$ by Corollary \ref{cor5.9}.
    \vspace{1mm}
     
    By classification of finite abelian groups, $E[n] \cong \mathbb{Z}/d_1\mathbb{Z} \times \ldots \times d_t\mathbb{Z}/\mathbb{Z}$ with $d_1 \mid d_2 \mid \ldots \mid d_t$, but $d_t \mid n$, and if $p$ is a prime with $p \mid d_1$, then $E[p] \cong (\mathbb{Z}/p\mathbb{Z})^t$, so $\left|E[p]\right| = p^2$, so $t=2$. Hence $d_1 \mid d_2 \mid n$ with $d_1d_2=n^2$, so $d_1=d_2=n$ and so $E[n] \cong (\mathbb{Z}/n\mathbb{Z})^2$.
\end{proof}
\textbf{Remark.} If $\text{char }K = p$, then $[p]$ is inseparable. It can be shown that either $E[p^r] \cong \mathbb{Z}/p^r \mathbb{Z} ~\forall r\ge 1$ or $E[p] = 0$ (the ''ordinary'' case and the ''supersingular'' case).

\textbf{Remark about the remark.} Do not use this remark to trivialize a question on Ex. Sheet 2.

\section{Elliptic curves over finite fields}
\begin{lemma}\label{lemma7.1}
    Let $A$ be an abelian group. Let $q : A \to \mathbb{Z}$ be a positive definite quadratic form. Then \[
    \underbrace{\left|q(x+y)-q(x)-q(y)\right|}_{\langle x,y \rangle}\le 2\sqrt{q(x)q(y)}.
    \] 
\end{lemma}
\begin{proof}
    We may assume $x \neq 0$, otherwise the result is clear. Hence $q(x) \neq 0$. Let $m,n \in \mathbb{Z}$, then 
    \begin{align*}
        0&\le q(mx+ny) = \frac{1}{2}\langle mx+ny,mx+ny \rangle \\
        &= m^2q(x) + mn \langle x,y \rangle +n^2q(y) \\
        &= q(x) \left( m + \frac{\langle x,y \rangle}{2q(x)}n\right)^2 + \left(q(y)- \frac{\langle x,y \rangle^2}{4q(x)}\right)n^2.
    \end{align*}
    Get rid of the first term by taking $m = - \langle x, y \rangle$ and $n = 2q(x)$ to deduce $\langle x,y \rangle^2 \le 4q(x)q(y)$, so the result follows.
\end{proof}
\begin{theorem}[Hasse]
    Let $E/\mathbb{F}_q$ be an elliptic curve. Then \[
    \left|\# E(\mathbb{F}_q) - (q+1)\right| \le 2\sqrt{q}.
    \]    
\end{theorem}
\begin{proof}
    Recall $\text{Gal}(\mathbb{F}_{q^r}/\mathbb{F}_q)$ is cyclic of order $r$, generated by the Frobenius map $x \mapsto x^q$. Let $E$ have Weierstrass equation with coefficients $a_1,\ldots,a_6 \in \mathbb{F}_q$ (and note that $a_i^q = a_i ~\forall i$). 
    \vspace{1mm}
     
    Define the Frobenius endomorphism $\phi: E \to E$ by $(x,y) \mapsto (x^q,y^q)$, which is an isogeny of degree $q$. Then $E(\mathbb{F}_q) = \{P \in E \mid \phi(P) = P\} = \text{ker}(1-\phi)$. We have
    \begin{align*}
        \phi^* \omega = \phi^* \left(\frac{\mathrm{d}x}{y}\right) = \frac{d(x^q)}{y^q} = \frac{qx^{q-1}\mathrm{d}x}{y^q} = 0
    \end{align*}
    as $q=p^n$, so $p \mid q$. By Lemma \ref{lemma6.3},
    \begin{align*}
        (1-\phi)^* \omega = \omega - \phi^* \omega = \omega \neq 0,
    \end{align*}
    so $1-\phi$ is separable. By Theorem \ref{theorem2.3} and the fact that $1-\phi$ is a group homomorphism, we argue in the proof of Theorem \ref{theorem6.5} that $$\underbrace{\left|\text{ker}(1-\phi)\right|}_{\left|E(\mathbb{F}_q)\right|} = \text{deg}(1-\phi).$$
    The map $\text{deg}: \text{Hom}(E,E) \to \mathbb{Z}$ is a positive definite quadratic form by Theorem \ref{theorem5.7}. Hence by Lemma \ref{lemma7.1}, 
    \begin{align*}
        &\left|\text{deg}(1-\phi) - 1 - \text{deg}\phi\right|\le 2\sqrt{\text{deg}\phi}\\
        \implies&\left|\# E(\mathbb{F}_q)-q-1\right| \le 2\sqrt{q}.
        \qedhere
    \end{align*}
\end{proof}
\begin{defn}
    For $\phi, \psi \in \text{End}(E) = \text{Hom}(E,E)$, we put $\langle \phi, \psi \rangle = \text{deg}(\phi+\psi)-\text{deg}(\phi)-\text{deg}(\psi)$ and $\text{tr}(\phi) = \langle \phi,1 \rangle$.
\end{defn}
\begin{cor}
    Let $E/\mathbb{F}_q$ be an elliptic curve and let $\phi \in \text{End}(E)$ be the $q^{\text{th}}$ power Frobenius map. Then $\# E(\mathbb{F}_q) = q+1 - \text{tr}(\phi)$ and $\left|\text{tr}(\phi)\right|\le 2\sqrt{q}$.
\end{cor}
\textbf{Zeta functions.} For $K$ a number field, 
\begin{align*}
    \zeta_K(s) = \sum_{\mathfrak{a} \subset \mathcal{O}_K}^{} \frac{1}{(N(\mathfrak{a}))^s} = \prod_{\mathfrak{p} \subset \mathcal{O}_K, \mathfrak{p} \text{ prime}}^{} \left(1-\frac{1}{(N(\mathfrak{p}))^s}\right)^{-1}.
\end{align*} 
For $K$ a function field, i.e. $K = \mathbb{F}_q(C)$ where $C$ is a smooth projective curve,
\begin{align*}
    \zeta_K(s) = \prod_{x \in \left|C\right|} \left(1-\frac{1}{(Nx))^2}\right)^{-1}, 
\end{align*}
where $\left|C\right| = \{\text{closed points of }C\} = \{\text{orbits for the action of Gal}(\overline{\mathbb{F}_q}/\mathbb{F}_q) \text{ on }C(\overline{\mathbb{F}_q})\}$ and $Nx = q^{\text{deg }x}$, where $\text{deg }x$ is the size of the corresponding orbit (these definitions are borrowed from scheme theory). We have $\zeta_K(s) = F(q^{-s})$ for some $F \in \mathbb{Q}[[T]]$. We have
\begin{align*}
    F(T) &= \prod_{x \in \left|C\right|}^{} \left(1-T^{\text{deg }x}\right)^{-1} \\
    \implies \log F(T) &= \sum_{x \in \left|C\right|}^{} \sum_{m=1}^{\infty} \frac{1}{m}T^{m \text{deg }x} \\
    \implies T\frac{\mathrm{d}}{\mathrm{d}T} \log F(T) &= \sum_{x \in \left|C\right|}^{} \sum_{m=1}^{\infty} \text{deg }x T^{m \text{deg }x} \\
    &\stackrel{n = m\text{deg }x}{=} \sum_{n=1}^{\infty} \left(\sum_{x \in \left|C\right|,\text{deg }x \mid n}^{} \text{deg }x \right)T^n \\
    &= \sum_{n=1}^{\infty} \# C(\mathbb{F}_{q^n})T^n \\
    \implies F(T) &= \exp \left(\sum_{n=1}^{\infty} \frac{\# C(\mathbb{F}_{q^n})}{n}T^n \right).
\end{align*}
\begin{defn}
    The zeta function of a smooth projective curve $C/\mathbb{F}_q$ is 
    \[
    Z_C(T) = \exp \left(\sum_{n=1}^{\infty} \frac{\# C(\mathbb{F}_{q^n})}{n}T^n \right).
    \]
\end{defn}

\end{document}